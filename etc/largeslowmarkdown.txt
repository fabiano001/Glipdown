commit 57b76592787a8f90cc428e95e47eaffba882435e
Author: Brett Paden <paden@glip.com>
Date:   Thu Jun 4 21:39:40 2015 -0400

    minified assets

diff --git a/minified-assets-prod/.versions.json b/minified-assets-prod/.versions.json
index dd534cd..3e8c1b1 100644
--- a/minified-assets-prod/.versions.json
+++ b/minified-assets-prod/.versions.json
@@ -1 +1 @@
-{"all":{"scripts":"9787af9e3129beb49458ab8628955ae5","templates":"adc75f04883219c6799efbf820da4e43","styles":"de30432731f9f285950b55a05839ec7b"},"anon":{"scripts":"ef89a055296b08f39b0a2a27699ed113","templates":"9d05b4256ff419d288bf81be97ec9e06","styles":"4c777eed3e10f52052a0fd0f20e2dcf9"},"named":{"scripts":"5f6012bdf573a333945e14052a56f0e7","templates":"032a7980258d336cc171e29439c2e79f","styles":"0f6aadde5e176d3a0c97963e6d4682e5"},"private":{"scripts":"bbfa73c349c7c7dae8e676476c1877b2","templates":"ac8f7d856d171c724af9403bb44128d0","styles":"d7863057805b292659a246c02fa67fd0"},"ie":{"scripts":"acea896999bd046ca1787412a81fde82","styles":"dd06bd2e6d9ab0802d3d66226d65955c"},"bootloader":{"scripts":"036fe922fa8079edf4a3171a30eb5e81"},"glip-static":{"scripts":"f6c6eb66a52afca754ef328a2a7e4de0"},"mobile-web":{"scripts":"6260aff317a05ce2d9f517b89de0fd59","styles":"4eee1e9683175ebcd80a272384b72237"}}
\ No newline at end of file
+{"all":{"scripts":"44015cab970c8f7f05b48ab9a0185747","templates":"adc75f04883219c6799efbf820da4e43","styles":"de30432731f9f285950b55a05839ec7b"},"anon":{"scripts":"ef89a055296b08f39b0a2a27699ed113","templates":"9d05b4256ff419d288bf81be97ec9e06","styles":"4c777eed3e10f52052a0fd0f20e2dcf9"},"named":{"scripts":"b8f6d2ff0001a379e7faf6b2bfc54e60","templates":"032a7980258d336cc171e29439c2e79f","styles":"0f6aadde5e176d3a0c97963e6d4682e5"},"private":{"scripts":"bb5fe0a8e73ffcd34677de6d7f990ed9","templates":"ac8f7d856d171c724af9403bb44128d0","styles":"d7863057805b292659a246c02fa67fd0"},"ie":{"scripts":"acea896999bd046ca1787412a81fde82","styles":"dd06bd2e6d9ab0802d3d66226d65955c"},"bootloader":{"scripts":"036fe922fa8079edf4a3171a30eb5e81"},"glip-static":{"scripts":"f6c6eb66a52afca754ef328a2a7e4de0"},"mobile-web":{"scripts":"6260aff317a05ce2d9f517b89de0fd59","styles":"4eee1e9683175ebcd80a272384b72237"}}
\ No newline at end of file
diff --git a/minified-assets-prod/all-scripts.js b/minified-assets-prod/all-scripts.js
index fb3771d..dc908bd 100644
--- a/minified-assets-prod/all-scripts.js
+++ b/minified-assets-prod/all-scripts.js
@@ -59,11 +59,11 @@ message:loc("Socket timed out")}},Internal:function(a){return{code:"internal",me
 message:loc("Server-side search is disabled.")}},Domain_Blacklisted:function(a){return{code:"domain_blacklisted",message:loc("Glip uses your work email address to automatically connect you with your co-workers. Please use an email address on your company's private domain instead of a webmail address, such as @gmail.com or @yahoo.com.",{email:a},!0),validation:!0}},Already_Uploading:function(){return{code:"already_uploading",message:loc("There is already a file being uploaded. Please wait until it has completed.")}},
 Domain_Not_In_Beta:function(){return{code:"domain_not_in_beta",message:loc("We are currently in beta and are not accepting public sign ups.  We'll notify you as soon as glip is open to the public."),validation:!0}},Email_Confirm_Required:function(){return{code:"email_confirm_required",message:loc("Email confirmation is required"),validation:!0}},Invalid_Filename:function(){return{code:"invalid_filename",message:loc("Filename is invalid"),validation:!0}},Action_Count_Exceeded:function(a,b){return{code:"action_count_exceeded",
 message:loc("You have exceeded your limits for this action.",{email:a,action:b},!0),validation:!0}},Free_Trial_Ended:function(a){return{code:"free_trial_ended",message:loc("Your free trial has ended"),can_extend:a}},Card_Declined:function(a){return{code:"card_declined",message:loc("Your credit card has been declined")}},Subscription_Canceled:function(){return{code:"subscription_canceled",message:loc("Your subscription has been canceled")}},Bitpay_Expired:function(){return{code:"subscription_expired",
-message:loc("Your subscription has ended")}},Plan_Limits_Exceeded:function(){return{code:"plan_limits_exceeded",message:loc("You have exceeded the limits of your current payment plan")}},Custom:function(a,b){return{code:a,message:b}},Coworkers_Only:function(){return{code:"coworkers_only",message:loc("You can only add people from the same company.")}},No_Invite_Registered:function(a,b){return{code:"no_invite_registered",message:loc("Can not re-invite [_email], this user has already registered on [_product].",
-{email:a,product:b})}},Email_Invalid_Network:function(a,b){return{code:"email_invalid_network",message:loc("Your message could not be posted because [_domain] is not a valid network on [_product].",{domain:a,product:b},!0),for_email:!0}},Email_Invalid_Recipient:function(a,b){return{code:"email_invalid_recipient",message:loc("Your message could not be posted because [_recipient] has not yet been added to [_product].",{recipient:a,product:b})+loc(" Sign into [_product] and go to the People page in order to add them.",
-{product:b}),for_email:!0}},Email_Recipient_Deactivated:function(a){return{code:"email_recipient_deactivated",message:loc("Your message could not be posted because the account for [_recipient] has been deactivated.",{recipient:a}),for_email:!0}},Email_Group_Archived:function(a,b,c,d){b=b?loc("team"):loc("group");return{code:"email_group_archived",message:loc("Your message could not be posted because the [_recipient] [_group_team] has been archived. [Visit [_product]]([_link]) to restore it.",{recipient:a,
-group_team:b,product:c,link:d}),for_email:!0}},Email_Sender_Deactivated:function(a,b){return{code:"email_sender_deactivated",message:loc("Your message could not be posted because [_email] is not associated with an active account on [_product].",{email:a,product:b}),for_email:!0}},Email_Invalid_Reply_Sender:function(a){return{code:"email_invalid_reply_sender",message:loc("Your comment could not be posted because [_email] is not the email address to which the notification was sent.",{email:a}),for_email:!0}},
-Email_Invalid_Sender:function(a,b){return{code:"email_invalid_sender",message:loc("Your message could not be posted because [_email] is not associated with an account on [_product].",{email:a,product:b}),for_email:!0}},Email_Not_Member:function(a,b){return{code:"email_not_member",message:loc("Your message could not be posted because [_email] is not a member of the [_team] team.",{email:a,team:b}),for_email:!0}},Email_Internal:function(a){return{code:"email_internal",message:loc("Your message could not be posted because of an unknown error. Please try again, or use [_product] mobile.",
+message:loc("Your subscription has ended")}},Plan_Limits_Exceeded:function(){return{code:"plan_limits_exceeded",message:loc("You have exceeded the limits of your current payment plan")}},Custom:function(a,b){return{code:a,message:b}},No_Script:function(){return{code:"no_script",message:loc("Javascript not allowed"),validation:!0}},Coworkers_Only:function(){return{code:"coworkers_only",message:loc("You can only add people from the same company.")}},No_Invite_Registered:function(a,b){return{code:"no_invite_registered",
+message:loc("Can not re-invite [_email], this user has already registered on [_product].",{email:a,product:b})}},Email_Invalid_Network:function(a,b){return{code:"email_invalid_network",message:loc("Your message could not be posted because [_domain] is not a valid network on [_product].",{domain:a,product:b},!0),for_email:!0}},Email_Invalid_Recipient:function(a,b){return{code:"email_invalid_recipient",message:loc("Your message could not be posted because [_recipient] has not yet been added to [_product].",
+{recipient:a,product:b})+loc(" Sign into [_product] and go to the People page in order to add them.",{product:b}),for_email:!0}},Email_Recipient_Deactivated:function(a){return{code:"email_recipient_deactivated",message:loc("Your message could not be posted because the account for [_recipient] has been deactivated.",{recipient:a}),for_email:!0}},Email_Group_Archived:function(a,b,c,d){b=b?loc("team"):loc("group");return{code:"email_group_archived",message:loc("Your message could not be posted because the [_recipient] [_group_team] has been archived. [Visit [_product]]([_link]) to restore it.",
+{recipient:a,group_team:b,product:c,link:d}),for_email:!0}},Email_Sender_Deactivated:function(a,b){return{code:"email_sender_deactivated",message:loc("Your message could not be posted because [_email] is not associated with an active account on [_product].",{email:a,product:b}),for_email:!0}},Email_Invalid_Reply_Sender:function(a){return{code:"email_invalid_reply_sender",message:loc("Your comment could not be posted because [_email] is not the email address to which the notification was sent.",{email:a}),
+for_email:!0}},Email_Invalid_Sender:function(a,b){return{code:"email_invalid_sender",message:loc("Your message could not be posted because [_email] is not associated with an account on [_product].",{email:a,product:b}),for_email:!0}},Email_Not_Member:function(a,b){return{code:"email_not_member",message:loc("Your message could not be posted because [_email] is not a member of the [_team] team.",{email:a,team:b}),for_email:!0}},Email_Internal:function(a){return{code:"email_internal",message:loc("Your message could not be posted because of an unknown error. Please try again, or use [_product] mobile.",
 {product:a}),for_email:!0}},DB_Connection_Timeout:function(){return{code:"db_connection_timeout",message:loc("The database connection timed out.")}},Invalid_Coupon:function(){return{code:"invalid_code",message:loc("Invalid coupon code.")}},Weak_Password:function(){return{code:"weak_password",message:loc("Passwords must be between 8 and 32 characters, and include at least one letter, one number, and a special character  (e.g., !, @, $, #) or upper case letter."),validation:!0}}};
 (function(){var a="undefined"!==typeof require,b=this.Backbone,c=this._;!b&&a&&(b=require("backbone"));!c&&a&&(c=require("underscore"));a={};a.models={Document:b.Model.extend({idAttribute:"_id",models:{},get:function(a){return this._prepareAttribute(a)},_prepareAttribute:function(a){var b;this.attributes&&!c.isUndefined(this.attributes[a])&&(b=this.attributes[a]);a in this.models&&(b=new this.models[a](b),b.container=this);return b}})};b.MongoDb=a;c.extend(b,a.models);"undefined"!==typeof exports&&
 (exports.Backbone=b,exports.Db=require("./lib/db"))}).call(this);var emoji_reg=/:(bowtie|smile|laughing|blush|smiley|relaxed|smirk|heart_eyes|kissing_heart|kissing_closed_eyes|flushed|relieved|satisfied|grin|wink|wink2|stuck_out_tongue_winking_eye|stuck_out_tongue_closed_eyes|grinning|kissing|kissing_smiling_eyes|stuck_out_tongue|sleeping|worried|frowning|anguished|open_mouth|grimacing|confused|hushed|expressionless|unamused|sweat_smile|sweat|weary|pensive|disappointed|confounded|fearful|cold_sweat|persevere|cry|sob|joy|astonished|scream|neckbeard|tired_face|angry|rage|triumph|sleepy|yum|mask|sunglasses|dizzy_face|imp|smiling_imp|neutral_face|no_mouth|innocent|alien|yellow_heart|blue_heart|purple_heart|heart|green_heart|broken_heart|heartbeat|heartpulse|two_hearts|revolving_hearts|cupid|sparkling_heart|sparkles|star|star2|dizzy|boom|collision|anger|exclamation|question|grey_exclamation|grey_question|zzz|dash|sweat_drops|notes|musical_note|fire|hankey|poop|shit|\+1|thumbsup|-1|thumbsdown|ok_hand|punch|facepunch|fist|v|wave|hand|open_hands|point_up|point_down|point_left|point_right|raised_hands|pray|point_up_2|clap|muscle|metal|fu|walking|runner|running|couple|family|two_men_holding_hands|two_women_holding_hands|dancer|dancers|ok_woman|no_good|information_desk_person|raised_hand|bride_with_veil|person_with_pouting_face|person_frowning|bow|couplekiss|couple_with_heart|massage|haircut|nail_care|boy|girl|woman|man|baby|older_woman|older_man|person_with_blond_hair|man_with_gua_pi_mao|man_with_turban|construction_worker|cop|angel|princess|smiley_cat|smile_cat|heart_eyes_cat|kissing_cat|smirk_cat|scream_cat|crying_cat_face|joy_cat|pouting_cat|japanese_ogre|japanese_goblin|see_no_evil|hear_no_evil|speak_no_evil|guardsman|skull|feet|lips|kiss|droplet|ear|eyes|nose|tongue|love_letter|bust_in_silhouette|busts_in_silhouette|speech_balloon|thought_balloon|feelsgood|finnadie|goberserk|godmode|hurtrealbad|rage1|rage2|rage3|rage4|suspect|trollface|sunny|umbrella|cloud|snowflake|snowman|zap|cyclone|foggy|ocean|cat|dog|mouse|hamster|rabbit|wolf|frog|tiger|koala|bear|pig|pig_nose|cow|boar|monkey_face|monkey|horse|racehorse|camel|sheep|elephant|panda_face|snake|bird|baby_chick|hatched_chick|hatching_chick|chicken|penguin|turtle|bug|honeybee|ant|beetle|snail|octopus|tropical_fish|fish|whale|whale2|dolphin|cow2|ram|rat|water_buffalo|tiger2|rabbit2|dragon|goat|rooster|dog2|pig2|mouse2|ox|dragon_face|blowfish|crocodile|dromedary_camel|leopard|cat2|poodle|paw_prints|bouquet|cherry_blossom|tulip|four_leaf_clover|rose|sunflower|hibiscus|maple_leaf|leaves|fallen_leaf|herb|mushroom|cactus|palm_tree|evergreen_tree|deciduous_tree|chestnut|seedling|blossom|ear_of_rice|shell|globe_with_meridians|sun_with_face|full_moon_with_face|new_moon_with_face|new_moon|waxing_crescent_moon|first_quarter_moon|waxing_gibbous_moon|full_moon|waning_gibbous_moon|last_quarter_moon|waning_crescent_moon|last_quarter_moon_with_face|first_quarter_moon_with_face|moon|earth_africa|earth_americas|earth_asia|volcano|milky_way|partly_sunny|octocat|squirrel|bamboo|gift_heart|dolls|school_satchel|mortar_board|flags|fireworks|sparkler|wind_chime|rice_scene|jack_o_lantern|ghost|santa|christmas_tree|gift|bell|no_bell|tanabata_tree|tada|confetti_ball|balloon|crystal_ball|cd|dvd|floppy_disk|camera|video_camera|movie_camera|computer|tv|iphone|phone|telephone|telephone_receiver|pager|fax|minidisc|vhs|sound|speaker|mute|loudspeaker|mega|hourglass|hourglass_flowing_sand|alarm_clock|watch|radio|satellite|loop|mag|mag_right|unlock|lock|lock_with_ink_pen|closed_lock_with_key|key|bulb|flashlight|high_brightness|low_brightness|electric_plug|battery|calling|email|mailbox|postbox|bath|bathtub|shower|toilet|wrench|nut_and_bolt|hammer|seat|moneybag|yen|dollar|pound|euro|credit_card|money_with_wings|e-mail|inbox_tray|outbox_tray|envelope|incoming_envelope|postal_horn|mailbox_closed|mailbox_with_mail|mailbox_with_no_mail|door|smoking|bomb|gun|hocho|pill|syringe|page_facing_up|page_with_curl|bookmark_tabs|bar_chart|chart_with_upwards_trend|chart_with_downwards_trend|scroll|clipboard|calendar|date|card_index|file_folder|open_file_folder|scissors|pushpin|paperclip|black_nib|pencil2|straight_ruler|triangular_ruler|closed_book|green_book|blue_book|orange_book|notebook|notebook_with_decorative_cover|ledger|books|bookmark|name_badge|microscope|telescope|newspaper|football|basketball|soccer|baseball|tennis|8ball|rugby_football|bowling|golf|mountain_bicyclist|bicyclist|horse_racing|snowboarder|swimmer|surfer|ski|spades|hearts|clubs|diamonds|gem|ring|trophy|musical_score|musical_keyboard|violin|space_invader|video_game|black_joker|flower_playing_cards|game_die|dart|mahjong|clapper|memo|pencil|book|art|microphone|headphones|trumpet|saxophone|guitar|shoe|sandal|high_heel|lipstick|boot|shirt|tshirt|necktie|womans_clothes|dress|running_shirt_with_sash|jeans|kimono|bikini|ribbon|tophat|crown|womans_hat|mans_shoe|closed_umbrella|briefcase|handbag|pouch|purse|eyeglasses|fishing_pole_and_fish|coffee|tea|sake|baby_bottle|beer|beers|cocktail|tropical_drink|wine_glass|fork_and_knife|pizza|hamburger|fries|poultry_leg|meat_on_bone|spaghetti|curry|fried_shrimp|bento|sushi|fish_cake|rice_ball|rice_cracker|rice|ramen|stew|oden|dango|egg|bread|doughnut|custard|icecream|ice_cream|shaved_ice|birthday|cake|cookie|chocolate_bar|candy|lollipop|honey_pot|apple|green_apple|tangerine|lemon|cherries|grapes|watermelon|strawberry|peach|melon|banana|pear|pineapple|sweet_potato|eggplant|tomato|corn|house|house_with_garden|school|office|post_office|hospital|bank|convenience_store|love_hotel|hotel|wedding|church|department_store|european_post_office|city_sunrise|city_sunset|japanese_castle|european_castle|tent|factory|tokyo_tower|japan|mount_fuji|sunrise_over_mountains|sunrise|stars|statue_of_liberty|bridge_at_night|carousel_horse|rainbow|ferris_wheel|fountain|roller_coaster|ship|speedboat|boat|sailboat|rowboat|anchor|rocket|airplane|helicopter|steam_locomotive|tram|mountain_railway|bike|aerial_tramway|suspension_railway|mountain_cableway|tractor|blue_car|oncoming_automobile|car|red_car|taxi|oncoming_taxi|articulated_lorry|bus|oncoming_bus|rotating_light|police_car|oncoming_police_car|fire_engine|ambulance|minibus|truck|train|station|train2|bullettrain_front|bullettrain_side|light_rail|monorail|railway_car|trolleybus|ticket|fuelpump|vertical_traffic_light|traffic_light|warning|construction|beginner|atm|slot_machine|busstop|barber|hotsprings|checkered_flag|crossed_flags|izakaya_lantern|moyai|circus_tent|performing_arts|round_pushpin|triangular_flag_on_post|jp|kr|cn|us|fr|es|it|ru|gb|uk|de|one|two|three|four|five|six|seven|eight|nine|keycap_ten|1234|zero|hash|symbols|arrow_backward|arrow_down|arrow_forward|arrow_left|capital_abcd|abcd|abc|arrow_lower_left|arrow_lower_right|arrow_right|arrow_up|arrow_upper_left|arrow_upper_right|arrow_double_down|arrow_double_up|arrow_down_small|arrow_heading_down|arrow_heading_up|leftwards_arrow_with_hook|arrow_right_hook|left_right_arrow|arrow_up_down|arrow_up_small|arrows_clockwise|arrows_counterclockwise|rewind|fast_forward|information_source|ok|twisted_rightwards_arrows|repeat|repeat_one|new|top|up|cool|free|ng|cinema|koko|signal_strength|u5272|u5408|u55b6|u6307|u6708|u6709|u6e80|u7121|u7533|u7a7a|u7981|sa|restroom|mens|womens|baby_symbol|no_smoking|parking|wheelchair|metro|baggage_claim|accept|wc|potable_water|put_litter_in_its_place|secret|congratulations|m|passport_control|left_luggage|customs|ideograph_advantage|cl|sos|id|no_entry_sign|underage|no_mobile_phones|do_not_litter|non-potable_water|no_bicycles|no_pedestrians|children_crossing|no_entry|eight_spoked_asterisk|eight_pointed_black_star|heart_decoration|vs|vibration_mode|mobile_phone_off|chart|currency_exchange|aries|taurus|gemini|cancer|leo|virgo|libra|scorpius|sagittarius|capricorn|aquarius|pisces|ophiuchus|six_pointed_star|negative_squared_cross_mark|a|b|ab|o2|diamond_shape_with_a_dot_inside|recycle|end|on|soon|clock1|clock130|clock10|clock1030|clock11|clock1130|clock12|clock1230|clock2|clock230|clock3|clock330|clock4|clock430|clock5|clock530|clock6|clock630|clock7|clock730|clock8|clock830|clock9|clock930|heavy_dollar_sign|copyright|registered|tm|x|heavy_exclamation_mark|bangbang|interrobang|o|heavy_multiplication_x|heavy_plus_sign|heavy_minus_sign|heavy_division_sign|white_flower|100|heavy_check_mark|ballot_box_with_check|radio_button|link|curly_loop|wavy_dash|part_alternation_mark|trident|black_square|white_square|white_check_mark|black_square_button|white_square_button|black_circle|white_circle|red_circle|large_blue_circle|large_blue_diamond|large_orange_diamond|small_blue_diamond|small_orange_diamond|small_red_triangle|small_red_triangle_down|shipit):/ig;
@@ -158,11 +158,11 @@ String_Utilities.prototype.ellipsify_string=function(a,b,c,d){var e={string:a,sh
 Query_Utilities.prototype.get_query_parameter=function(a,b){if(_.isUndefined(b)||_.isNull(b))b=null;a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c=RegExp("[\\?&]"+a+"=([^&#]*)").exec(window.location.href);return null===c?b:c[1]};"undefined"!==typeof exports&&(exports.URL_Utilities=URL_Utilities);_.mixin({deep_clone:function(a){a=JSON.stringify(a);var b=null;try{b=JSON.parse(a)}catch(c){}return b}});
 var BigForEach=function(a,b,c,d){d=d||{};is_client&&Client.benchmark.aggregate("bigforeach");if(is_client&&!0===Data._loading_initial_data)return _.each(a,b),Client.benchmark.end("bigforeach"),c();var e=d.min_threshold||100,e=2>e?2:e,f=a.length,g=Math.sqrt(f);g<e&&(g=e);var k=Math.floor(f/g),h=f%g,l=k+(h?1:0);1E3<f&&console.warn("In BigForEach - length: >"+f+"< threshold: >"+g+"< min_threshold: >"+e+"< count: >"+k+"< leftover: >"+h+"< total_count: >"+l+"<");var m=0;ASync.whilst(function(){return m<
 l},function(c){var e=m<k?a.slice(m*g,(m+1)*g):a.slice(k*g,k*g+h);m++;ASync.forEach(e,b,function(){d.breathe_interval?setTimeout(c,d.breathe_interval):ASync.nextTick(c)})},function(a){is_client&&Client.benchmark.end("bigforeach");if(c)return c(a)})},_=_||null;"undefined"==typeof require||_||(_=require("underscore"));
-var Markdown=function(a,b){b=b||{};if(!a)return"";b.dont_escape||(a=_.escape(a));var c={},d=0,e=b.use_blockquote?'span class="blockquote"':"q",f=b.use_blockquote?"/span":"/q",g=0,k=!1;return a.replace(/\&\#x2F;/g,"/").replace(/\[([^\]]*?)\]\(([\s\S]*?)\)/g,function(a,b,c){return"code"===b?a:"<a href='"+c+"' target='_blank' rel='noreferrer'>"+b+"</a>"}).replace(Markdown.global_url_regex,function(a,b,c,d,e,f,q,u,v,z,D,E,C,s,t,w,A){b=A.substr(g,w-g);g=w;if(b.match(/[\s\S]*\($/))return a;if(k?!b.match(/[\s\S]*>[^<]*$/):
-b.match(/[\s\S]*<[^>]*$/))return k=!0,a;k=!1;if(b.match(/[\s\S]*(\{\{-\{\{)(?![\s\S]*\}\}-\}\})[\s\S]*$/))return a;if(w=(A.substring(0,w)+a).replace(/\{\{\-\{\{/g,"<").replace(/\}\}-\}\}/g,">").match(/^[\s\S]*<a[\s\S]*?>([\s\S]*?)$/))if(w=w[1],!w.match(/<\/a>/)||w.match(/<\/a>$/))return a;return"<a href='"+(c&&!f?"mailto:"+c:f?"":"http://")+d.replace("&amp;","&")+"' target='_blank' rel='noreferrer'>"+(c?c:"")+d+"</a>"+t}).replace(/\[code\]([\s\S]*?)(\[\/code\]|$)/gi,function(a,b){var e;try{e=unescape(b)}catch(f){e=
+var Markdown=function(a,b){b=b||{};if(!a)return"";b.dont_escape||(a=_.escape(a));var c={},d=0,e=b.use_blockquote?'span class="blockquote"':"q",f=b.use_blockquote?"/span":"/q",g=0,k=0,h=!1;return a.replace(/\&\#x2F;/g,"/").replace(/\[([^\]]*?)\]\(([\s\S]*?)\)/g,function(a,b,c){return"code"===b?a:"<a href='"+c+"' target='_blank' rel='noreferrer'>"+b+"</a>"}).replace(Markdown.global_url_regex,function(a,b,c,d,e,f,k,v,z,D,E,C,s,t,B,w,x){b=x.substr(g,w-g);g=w;if(b.match(/[\s\S]*\($/))return a;if(h?!b.match(/.*>[^<]*$/):
+b.match(/.*<[^>]*$/))return h=!0,a;h=!1;if(b.match(/.*(\{\{-\{\{)(?![\s\S]*\}\}-\}\})[\s\S]*$/))return a;if(w=(x.substring(0,w)+a).replace(/\{\{\-\{\{/g,"<").replace(/\}\}-\}\}/g,">").match(/^[\s\S]*<a[\s\S]*?>([\s\S]*?)$/))if(w=w[1],!w.match(/<\/a>/)||w.match(/<\/a>$/))return a;return"<a href='"+(c&&!f?"mailto:"+c:f?"":"http://")+d.replace("&amp;","&")+"' target='_blank' rel='noreferrer'>"+(c?c:"")+d+"</a>"+B}).replace(/\[code\]([\s\S]*?)(\[\/code\]|$)/gi,function(a,b){var e;try{e=unescape(b)}catch(f){e=
 b.replace(/(\%\w\w)/g,function(a,b){return unescape(b)})}c["code_"+d]=e;e="[code_"+d+"]";d++;return e}).replace(/\|([^\n]*)\|(\s|\n|$)/g,function(a,b){var c=b.split(/\|/);if(!c.length)return b;var d=(100/c.length).toFixed(0);return"<table><tr valign='top'><td width='"+d+"%'>"+c.join("</td><td width='"+d+"%'>")+"</tr></table>"}).replace(/<\/table><table>/,"").replace(/((^|\n)\* [^\*\n]*)+/g,function(a,b,c){a=a.split(/\n/);0===a[0].length&&a.shift();return c+"<ul><li>"+a.map(function(a){return a.replace(/^\* /,
-"")}).join("</li><li>")+"</li></ul>"}).replace(/\*\*(\S[^\*\*]*?\S)\*\*/g,function(a,b,c,d){return Markdown.is_in_url(a,b,c,d)?a:"<b>"+b+"</b>"}).replace(/\*(\S[^\*]*?\S)\*/g,function(a,b,c,d){return Markdown.is_in_url(a,b,c,d)?a:"<i>"+b+"</i>"}).replace(/__(\S[^__]*?\S)__/g,function(a,b,c,d){return Markdown.is_in_url(a,b,c,d)?a:"<u>"+b+"</u>"}).replace(/~~(\S[^~~]*?\S)~~/g,function(a,b,c,d){return Markdown.is_in_url(a,b,c,d)?a:"<strike>"+b+"</strike>"}).replace(/\{\{\[\[-([^\{\{\[\[]*?)-\]\]\}\}/g,
-function(a,b,c,d){return"<span class='search_match_stream'>"+b+"</span>"}).replace(/(^|\n)&gt; ([^\n]*)/g,function(a,b,c){return b+"<"+e+">"+c+"<"+f+">"}).replace(/\[code_(\w+)\]/g,function(a,b){return"<pre class=codesnippet>"+c["code_"+b]+"</pre>"})};Markdown.is_in_url=function(a,b,c,d){a=d.substr(0,c);return a.match(/[\s\S]*<[^>]*$/)?!0:(a=/([A-Za-z0-9\!\#\$\%\&\'\*\+\-\/\=\?\%\_\`\{\|\}\~\.\:]+)$/g.exec(a))&&(a[0]+b).match(Markdown.url_regex)?!0:!1};Markdown.url_regex=/^((ftp|https?):\/\/)?[-\w]+\.([-\w]+\.)*(\d+\.\d+\.\d+|[-A-Za-z]+)(:\d+)?($|(\/\S?(\/\S)*\/?)|(\#\S?)|(\?\S?))/i;
+"")}).join("</li><li>")+"</li></ul>"}).replace(/\*\*(\S[^\*\*]*?\S)\*\*/g,function(a,b,c,d){k++;return Markdown.is_in_url(a,b,c,d)?a:"<b>"+b+"</b>"}).replace(/\*(\S[^\*]*?\S)\*/g,function(a,b,c,d){return Markdown.is_in_url(a,b,c,d)?a:"<i>"+b+"</i>"}).replace(/__(\S[^__]*?\S)__/g,function(a,b,c,d){return Markdown.is_in_url(a,b,c,d)?a:"<u>"+b+"</u>"}).replace(/~~(\S[^~~]*?\S)~~/g,function(a,b,c,d){return Markdown.is_in_url(a,b,c,d)?a:"<strike>"+b+"</strike>"}).replace(/\{\{\[\[-([^\{\{\[\[]*?)-\]\]\}\}/g,
+function(a,b,c,d){return"<span class='search_match_stream'>"+b+"</span>"}).replace(/(^|\n)&gt; ([^\n]*)/g,function(a,b,c){return b+"<"+e+">"+c+"<"+f+">"}).replace(/\[code_(\w+)\]/g,function(a,b){return"<pre class=codesnippet>"+c["code_"+b]+"</pre>"})};Markdown.is_in_url=function(a,b,c,d){a=d.substr(0,c);return a.match(/.*<[^>]*$/)?!0:(a=/([A-Za-z0-9\!\#\$\%\&\'\*\+\-\/\=\?\%\_\`\{\|\}\~\.\:]+)$/g.exec(a))&&(a[0]+b).match(Markdown.url_regex)?!0:!1};Markdown.url_regex=/^((ftp|https?):\/\/)?[-\w]+\.([-\w]+\.)*(\d+\.\d+\.\d+|[-A-Za-z]+)(:\d+)?($|(\/\S?(\/\S)*\/?)|(\#\S?)|(\?\S?))/i;
 Markdown.global_url_regex=/(([a-zA-Z0-9\!\#\$\%\&\'\*\+\-\/\=\?\%\_\`\{\|\}\~\.]+@)?)(((ftp|https?):\/\/)?[-\w]+\.([-\w]+\.)*(\d+\.\d+\.\d+|[-A-Za-z]+)(:\d+)?(((\/([A-Za-z0-9-\._~:\/\?\#\[\]\@\!\$\&\'\(\)\*\+\,\;\=])*)+)\??([A-Za-z0-9-\._~:\/\?\#\[\]\@\!\$\&\'\(\)\*\+\,\;\=\%])*)?)([^A-Za-z]|$)/gi;
 var Markdown_For_Search=function(a,b){b=b||{};if(!a)return"";b.dont_escape||(a=_.escape(a));return a.replace(/\{\{\[\[-([^\{\{\[\[]*?)-\]\]\}\}/g,function(a,b){return"<span class='search_match_stream'>"+b+"</span>"})},Remove_Markdown=function(a,b){b=b||{};return(b.dont_escape?a:_.escape(a)).replace(/\&\#x2F;/g,"/").replace(/\[code\]/g,"").replace(/\[\/code\]/g,"").replace(/\|([^\n]*)\|/g,function(a,b){var e=b.split(/\|/);return e.length?e.join("\t"):b}).replace(/\*\*(\S[^\*\*]*?\S)\*\*/g,function(a,
 b){return b}).replace(/\*(\S[^\*]*?\S)\*/g,function(a,b){return b}).replace(/__(\S[^__]*?\S)__/g,function(a,b){return b}).replace(/~~(\S[^~~]*?\S)~~/g,function(a,b){return b}).replace(/(^|\n)&gt; ([^\n]*)/g,function(a,b,e){return b+" "+e+" "}).replace(/\[([^\]]*?)\]\(([\s\S]*?)\)/g,function(a,b,e){return b})};"object"==typeof exports&&(exports.Markdown=Markdown,exports.Remove_Markdown=Remove_Markdown,exports.Markdown_For_Search=Markdown_For_Search);var root;root||(root=window);
@@ -203,8 +203,7 @@ EC_Model.prototype.make_activity_text=function(a,b){var c=this;if(!a.activity_da
 EC_Model.prototype.validate=function(a){for(var b in this.attribute_validations){var c=this.attribute_validations[b];if(c){var d=c.required_client,e=c.validate_client;if(_.isUndefined(a[b])||_.isNull(a[b])||"string"==typeof a[b]&&0==a[b].length)if(c["default"])a[b]=c["default"];else if(c.required||d)return console.warn("VALIDATION FAILED, ID="+a._id+": "+b+" required"),console.warn(a),Errors.Required(b);if((d=c.validate||e)&&!_.isUndefined(a[b])&&(null!==a[b]||!c.null_ok)&&(c=d(a[b],a,b)))return console.warn("VALIDATION FAILED, ID="+
 a._id+": "+b+"("+a[b]+"): "),console.warn(c),c}}if(!this.attribute_validations._free_form_ok)for(var f in a)if(_.isUndefined(this.attribute_validations[f])){console.warn("UNKNOWN ATTRIBUTE IN VALIDATION, ID="+a._id+": "+f);console.warn(a);if("dev"==(Data?Data.ec_env:process&&process.env&&process.env.EC_ENV||"???"))return Errors.Unknown_Attribute(f);if(_.isString(a[f])){if(c=EC_Model.prototype.validate_long_string(a[f],a,f))return c}else if(_.isObject(a[f])){if(c=EC_Model.prototype.validate_medium_object(a[f]))return c}else if(_.isArray(a[f])&&
 (c=EC_Model.prototype.validate_medium_array(a[f])))return c}};EC_Model.prototype.validate_positive_integer=function(a){if(!_.isNumber(a)||0!=a%1)return Errors.Invalid_Int()};EC_Model.prototype.validate_id=function(a){return EC_Model.prototype.validate_positive_integer(a)};EC_Model.prototype.validate_ids=function(a){if(a)for(var b=0,c;c=a[b];b++)if(c=EC_Model.prototype.validate_id(c))return c};
-EC_Model.prototype.validate_not_empty=function(a,b,c){if(!_.isString(a))return Errors.Invalid_Type();if(0==a.trim().length)return Errors.Required(c)};
-EC_Model.prototype.validate_string=function(a,b,c){if(!_.isNull(a)){if(_.isString(a)){if(a.length>b)return Errors.Too_Long(b);if(a.match(/<script/gi))return Errors.Custom("no_script",loc("Javascript not allowed"))}else return Errors.Invalid_Type();if(a=a.match(/<.*?>/g))for(b=0;b<a.length;b++)if(c=a[b],c.match(/\s+on\w/g)||c.match(/=\s?["|']?javascript/g))return Errors.Custom("no_script",loc("Javascript not allowed"))}};
+EC_Model.prototype.validate_not_empty=function(a,b,c){if(!_.isString(a))return Errors.Invalid_Type();if(0==a.trim().length)return Errors.Required(c)};EC_Model.prototype.validate_string=function(a,b,c){if(!_.isNull(a)){if(_.isString(a)){if(a.length>b)return Errors.Too_Long(b);if(a.match(/<script/gi))return Errors.No_Script()}else return Errors.Invalid_Type();if(a=a.match(/<.*?>/g))for(b=0;b<a.length;b++)if(c=a[b],c.match(/\s+on\w/g)||c.match(/=\s?["|']?javascript/g))return Errors.No_Script()}};
 EC_Model.prototype.validate_short_string=function(a,b,c){return EC_Model.prototype.validate_string(a,20,c)};EC_Model.prototype.validate_medium_string=function(a,b,c){return EC_Model.prototype.validate_string(a,100,c)};EC_Model.prototype.validate_long_string=function(a,b,c){return EC_Model.prototype.validate_string(a,EC_Model.prototype.GENERAL_STRING_LIMIT,c)};
 EC_Model.prototype.validate_long_string_not_empty=function(a,b,c){return EC_Model.prototype.validate_long_string(a,b,c)||EC_Model.prototype.validate_not_empty(a,b,c)};EC_Model.prototype.validate_text=function(a,b,c){return EC_Model.prototype.validate_string(a,EC_Model.prototype.TEXT_STRING_LIMIT,c)};EC_Model.prototype.validate_text_not_empty=function(a,b,c){return EC_Model.prototype.validate_text(a,b,c)||EC_Model.prototype.validate_not_empty(a,b,c)};
 EC_Model.prototype.validate_user_email=function(a){var b=EC_Model.prototype.validate_email(a);if(b)return b;if(a.match(/.*?\.glip\.com$/i))return Errors.Invalid_Field("email address",a)};
@@ -695,9 +694,9 @@ Search_Engine.prototype.add_to_group_collection=function(a){var b=a.get_type_id(
 this.search_group.search_collections[c].add(a,{silent:!0}))}};Search_Engine.prototype.collection_from_options=function(a,b){if(b.filter&&b.filter.creator_id&&("people"==a||"groups"==a||"teams"==a||"public_teams"==a))return null;if(b.filter&&b.filter.group_id){var c=Data.groups.get(b.filter.group_id);return c?"people"==a?Data.people:c.search_collections&&c.search_collections[a]?c.search_collections[a]:null:null}return Data[a]};
 Search_Engine.prototype._client_side_search=function(a,b,c,d){if(_.isString(a)){var e=this;b=b||{};var f=this.current_client_request_id,g=a.toLowerCase().trim().split(" ");if(1==g.length&&""==g[0])return c(null,[{}]);var k=this.current_client_request_id;e.client_search_in_progress=!0;var h=[],l=e.types_by_options(b),m=0,n=0,n=4>a.length&&!b.from_server?this.client_key_stroke_timeout:this.process_timeout,p=0,r=0,q=l.length,u=b.limit_to_members_of_group?Data.groups.get(b.limit_to_members_of_group):
 null,v=Data.get_all_members();ASync.whilst(function(){return k==e.current_client_request_id&&(!b.from_server||e.active_server_request_id)&&p<q&&(!e.stop_client_search||b.from_server)},function(a){e.next_client_timeout=setTimeout(function(){for(m=0;100>m&&p<q;){var d=l[p],f=e.collection_from_options(d,b);if(f){var k=[],k=b.from_server?f.filter(function(a){return a.search_request_id===e.active_server_request_id}):f.active(),f=k.length;for(b.from_server&&(r=0);100>m&&r<f;){var s=k[r];delete s.search_request_id;
-if(!("groups"==d&&s.is_person_group()&&1==s.get("members").length||"people"==d&&!Data.user.person_is_visible(s,{group_member_ids:v})||"people"==d&&u&&!u.is_member(s.id))){m++;var t=null,w=d;"people"==d?t=(t=Data.groups.find_by_members(s.id==Data.user.id?[Data.user.id]:[Data.user.id,s.id]))?[t]:[]:"posts"==d?t=(t=Data.groups.get(s.get("group_id")))?[t]:[]:"groups"==d||"teams"==d||"public_teams"==d?(t=[s],s.is_team()?w="teams":s.is_project()&&(w="projects")):t=_.compact(_.map(s.get("group_ids"),function(a){return Data.groups.get(a)}));
-t=t||[];(t=e.groups_matching_filter(s,b.filter,t))&&0==t.length&&"people"==d&&(t=[null]);if(t&&t.length){for(var A=[],y=0,x;x=g[y];y++)if(x=s.match(x,b),null===x&&b.from_server&&!Base_Type_IDs[s.get_type_id()]&&(x={query:g[y]}),x)A.push(x);else break;if(A.length)for(y=0,x=t.length;y<x;y++){var B={result_id:e.result_counter++,model:s,group:t[y],query_word_matches:A,query_words:_.clone(g),relevance:s.get_relevance(),type:w};e.results.push(B);h.push(B);0<=["people","teams","public_teams"].indexOf(d)&&
-s.counted_for_request_id!=e.current_client_request_id&&(B={client_request_id:e.current_client_request_id,content_types:{}},"people"===d?(e.people_count++,B.content_types[Type_IDs.TYPE_ID_PERSON]=e.people_count):(e.teams_count++,B.content_types[Type_IDs.TYPE_ID_TEAM]=e.teams_count),s.counted_for_request_id=e.current_client_request_id,_.isFunction(e.content_types_callback)&&e.content_types_callback(B))}}}r++}r==f&&(r=0)}100>m&&p++}h.length&&(colin("RETURNING RESULTS: "+JSON.stringify(_.pluck(_.pluck(h,
+if(!("groups"==d&&s.is_person_group()&&1==s.get("members").length||"people"==d&&!Data.user.person_is_visible(s,{group_member_ids:v})||"people"==d&&u&&!u.is_member(s.id))){m++;var t=null,B=d;"people"==d?t=(t=Data.groups.find_by_members(s.id==Data.user.id?[Data.user.id]:[Data.user.id,s.id]))?[t]:[]:"posts"==d?t=(t=Data.groups.get(s.get("group_id")))?[t]:[]:"groups"==d||"teams"==d||"public_teams"==d?(t=[s],s.is_team()?B="teams":s.is_project()&&(B="projects")):t=_.compact(_.map(s.get("group_ids"),function(a){return Data.groups.get(a)}));
+t=t||[];(t=e.groups_matching_filter(s,b.filter,t))&&0==t.length&&"people"==d&&(t=[null]);if(t&&t.length){for(var w=[],x=0,y;y=g[x];x++)if(y=s.match(y,b),null===y&&b.from_server&&!Base_Type_IDs[s.get_type_id()]&&(y={query:g[x]}),y)w.push(y);else break;if(w.length)for(x=0,y=t.length;x<y;x++){var A={result_id:e.result_counter++,model:s,group:t[x],query_word_matches:w,query_words:_.clone(g),relevance:s.get_relevance(),type:B};e.results.push(A);h.push(A);0<=["people","teams","public_teams"].indexOf(d)&&
+s.counted_for_request_id!=e.current_client_request_id&&(A={client_request_id:e.current_client_request_id,content_types:{}},"people"===d?(e.people_count++,A.content_types[Type_IDs.TYPE_ID_PERSON]=e.people_count):(e.teams_count++,A.content_types[Type_IDs.TYPE_ID_TEAM]=e.teams_count),s.counted_for_request_id=e.current_client_request_id,_.isFunction(e.content_types_callback)&&e.content_types_callback(A))}}}r++}r==f&&(r=0)}100>m&&p++}h.length&&(colin("RETURNING RESULTS: "+JSON.stringify(_.pluck(_.pluck(h,
 "model"),"id"))),c(null,h,e.current_client_request_id,b.from_server));h=[];n=e.process_timeout;ASync.nextTick(a)},n)},function(){e.client_search_in_progress=!1;e.active_server_request_id&&e._check_search_done(f);d&&d()})}};
 Search_Engine.prototype.scroll=function(a){var b=this;b.active_server_request_id&&!b.active_scroll_request_id&&(b.active_scroll_request_id=b.scroll_request_counter++,b.scroll_callback=a,colin("ISSUING SEARCH SCROLL REQUEST, request_id="+b.active_server_request_id),Client.request("/api/search_scroll",{parameters:{search_request_id:b.active_server_request_id,scroll_request_id:b.active_scroll_request_id}},function(a){200!=a.request.status_code&&(b.active_scroll_request_id=null,a.body&&a.body.error?console.warn("Server error making search scroll request: "+
 JSON.stringify(a.body.error)):console.warn("Invalid server response to search scroll request"))}))};Search_Engine.prototype.can_scroll=function(){return this.active_server_request_id?!0:!1};Search_Engine.prototype.type_id_from_type=function(a){return"chats"==a?Type_IDs.TYPE_ID_POST:"people"==a?Type_IDs.TYPE_ID_PERSON:"groups"==a?Type_IDs.TYPE_ID_GROUP:"teams"==a?Type_IDs.TYPE_ID_TEAM:(a=Data.plugins_by_name[a])?a.get("type_id"):null};
diff --git a/minified-assets-prod/all-scripts.js-raw b/minified-assets-prod/all-scripts.js-raw
index 0f41a17..4a67ef2 100644
--- a/minified-assets-prod/all-scripts.js-raw
+++ b/minified-assets-prod/all-scripts.js-raw
@@ -1335,6 +1335,14 @@ Errors.Custom = function(code, message) {
 	};
 };
 
+Errors.No_Script = function() {
+	return {
+		code: 'no_script',
+		message: loc("Javascript not allowed"),
+		validation: true
+	}
+};
+
 Errors.Coworkers_Only = function() {
 	return {
 		code: 'coworkers_only',
@@ -4339,6 +4347,8 @@ var Markdown = function(raw, options) {
 	var end_quote_tag = options.use_blockquote ? '/span' : '/q';
 	var bench = +new Date();
 	var last_offset = 0;
+	var test = 0;
+	var total = 0;
 	var was_inside_tag = false;
 	var val = raw.replace(/\&\#x2F;/g, '/'). // not sure why underscore replaces these...docs don't even claim that it does 
 		replace(/\[([^\]]*?)\]\(([\s\S]*?)\)/g, function(full_match, text, link) {
@@ -4372,13 +4382,13 @@ var Markdown = function(raw, options) {
 			if (start.match(/[\s\S]*\($/)) {
 				return full_match;
 			}
-			var inside_tag = was_inside_tag ? (start.match(/[\s\S]*>[^<]*$/) ? false : true) : start.match(/[\s\S]*<[^>]*$/);
+			var inside_tag = was_inside_tag ? (start.match(/.*>[^<]*$/) ? false : true) : start.match(/.*<[^>]*$/);
 			if (inside_tag) {
 				was_inside_tag = true;
 				return full_match;
 			}
 			was_inside_tag = false;
-			var inside_post_tag = start.match(/[\s\S]*(\{\{-\{\{)(?![\s\S]*\}\}-\}\})[\s\S]*$/);
+			var inside_post_tag = start.match(/.*(\{\{-\{\{)(?![\s\S]*\}\}-\}\})[\s\S]*$/);
 			if (inside_post_tag) {
 				return full_match;
 			}
@@ -4437,6 +4447,7 @@ var Markdown = function(raw, options) {
 				"</li></ul>";
 		}).
 		replace(/\*\*(\S[^\*\*]*?\S)\*\*/g, function(full_match, text, offset, full_str) {
+			total++;
 			if (Markdown.is_in_url(full_match, text, offset, full_str)) {
 				return full_match;
 			}
@@ -4474,7 +4485,7 @@ var Markdown = function(raw, options) {
 
 Markdown.is_in_url = function(full_match, text, offset, full_str) {
 	var start = full_str.substr(0, offset);
-	var inside_tag = start.match(/[\s\S]*<[^>]*$/);
+	var inside_tag = start.match(/.*<[^>]*$/);
 	if (inside_tag) { return true; }
 	var last_str = /([A-Za-z0-9\!\#\$\%\&\'\*\+\-\/\=\?\%\_\`\{\|\}\~\.\:]+)$/g.exec(start);
 	if (last_str) {
@@ -5786,7 +5797,7 @@ EC_Model.prototype.validate_string = function(value, length, attribute) {
 		return Errors.Too_Long(length);
 	}
 	else if (value.match(/<script/gi)) {
-		return Errors.Custom('no_script', loc("Javascript not allowed"));
+		return Errors.No_Script();
 	}
 	var matches = value.match(/<.*?>/g);
 	if (matches) {
@@ -5794,11 +5805,11 @@ EC_Model.prototype.validate_string = function(value, length, attribute) {
 			var match = matches[x];
 			var submatch = match.match(/\s+on\w/g);
 			if (submatch) {
-				return Errors.Custom('no_script', loc("Javascript not allowed"));
+				return Errors.No_Script();
 			}
 			var script = match.match(/=\s?["|']?javascript/g);
 			if (script) {
-				return Errors.Custom('no_script', loc("Javascript not allowed"));
+				return Errors.No_Script();
 			}
 		}
 	}
diff --git a/minified-assets-prod/named-scripts.js b/minified-assets-prod/named-scripts.js
index 9db37da..5ee6d4d 100644
--- a/minified-assets-prod/named-scripts.js
+++ b/minified-assets-prod/named-scripts.js
@@ -97,7 +97,7 @@ this.previous_view=this.view_cache[b],this.showing_plugin=a,this.track_plugin_pa
 Data.user_id?Analytics.page_my_profile():Analytics.page_profile();break;case "chat":a=Data.groups.get(Data.state.get("current_group_id"));if(!a)break;a.is_team()?Analytics.stream_team_conversation():a.is_one_on_one_group()?Analytics.stream_people_conversation():a.is_person_group()&&Analytics.stream_group_conversation();break;default:if(_.isFunction(Analytics["page_"+a]))Analytics["page_"+a]()}}}),Popup_Dialog_View=EC_View.extend({events:{"click .dismiss":"remove_popup","click .modal_popup_overlay.lower":"remove_popup"},
 initialize:function(){},remove_popup:function(a){a&&"click"===a.type&&a.isTrigger||(this.$(".popup").stop().fadeOut(100),this.$el.stop().delay(100).fadeOut(100,this.$el.remove.bind(this.$el)),Client.trigger("dismiss_search_popups"))},present:function(){this.$(".popup").stop().hide();this.$(".modal_popup_overlay").stop().hide();this.$el.show();this.handle_resize();this.$(".modal_popup_overlay").fadeIn(100);this.$(".popup").delay(100).fadeIn(100);this.focus_input&&_.delay(_.bind(this.focus_input,this),
 100)},handle_resize:function(){if(this.in_DOM()){var a=$(window).height(),b=this.$(".popup").height(),a=(a-b)/2;this.$(".popup").css("top",10>a?10:a)}}}),Conversation_Switch_View=Popup_Dialog_View.extend({events:_.extend({},Popup_Dialog_View.prototype.events,{"keyup input":"handle_keyup_input",keydown:"handle_keydown","mouseenter li":"remove_hover_class","click li":"select_group",submit:"noop"}),initialize:function(){this.template=JST["named/conversation_switch.jst"];this.view("Body_View",{},!1,!1,
-!0).on("escape",this.remove_popup,this)},render:function(){this.$el.html(this.template());this.options.message&&this.$("#message").html(this.options.message).show();this.render_groups("")},noop:function(){return!1},handle_keydown:function(a){this.clear_errors();a=a.keyCode?a.keyCode:a.which;if(38===a)return this.select_previous_group(!0);if(40===a)return this.select_next_group(!0);if(13===a||9===a)return this.select_the_group(this.$("li.hover").first().attr("id"))},select_previous_group:function(){this.$("li.hover").removeClass("hover").prevAll().first().addClass("hover");
+!0).on("escape",this.remove_popup,this)},render:function(){this.$el.html(this.template());this.options.message&&this.$("#message").text(this.options.message).show();this.render_groups("")},noop:function(){return!1},handle_keydown:function(a){this.clear_errors();a=a.keyCode?a.keyCode:a.which;if(38===a)return this.select_previous_group(!0);if(40===a)return this.select_next_group(!0);if(13===a||9===a)return this.select_the_group(this.$("li.hover").first().attr("id"))},select_previous_group:function(){this.$("li.hover").removeClass("hover").prevAll().first().addClass("hover");
 0===this.$("li.hover").length&&this.$("li").last().addClass("hover");this.$(".select").addClass("keyboard-nav")},select_next_group:function(){this.$("li.hover").removeClass("hover").nextAll().first().addClass("hover");0===this.$("li.hover").length&&this.$("li").first().addClass("hover");this.$(".select").addClass("keyboard-nav")},handle_keyup_input:function(a){a=a.keyCode?a.keyCode:a.which;38!==a&&40!==a&&(a=this.$("input").val(),this.render_groups(a))},render_groups:function(a){var b=this,c=0,d=
 this.$("#groups-list");d.empty();Data.groups.comparator=function(a){var b=0;if(a.is_me_group())return-9E12;b=a.posts&&a.posts.length?_.max(a.posts.pluck("created_at")):a.get("created_at");return-b};Data.groups.sort();a=a.toLowerCase();Data.groups.each(function(e){if(!(100<=c||!e.is_team()&&e.has_removed_members()||e.get("is_archived")||b.options.no_me_group&&e.is_me_group())){var f=_.escape(e.abbreviation(Data.user_id,{no_and:!0}));if(!a||-1!==f.toLowerCase().indexOf(a)){var g=e.is_team()?"team":
 e.is_one_on_one_group()?"person":e.is_me_group()?"person":"group";d.append('<li id="'+e.id+'"><span class="ico ico-'+g+'"></span>'+f+"</li>");c++}}});this.$("li").first().addClass("hover")},remove_hover_class:function(a){this.$("li").removeClass("hover");this.$(".select").removeClass("keyboard-nav")},select_group:function(a){a=$(a.target);this.select_the_group(a.attr("id"))},select_the_group:function(a){if(a=parseInt(a,10))if(this.remove_popup(),this.options&&this.options.select_group_function){var b=
@@ -444,73 +444,73 @@ a.append(e);b.append(e.clone())}});c?(a.prepend($("<div class=sep></div>")),b.pr
 add_zero_contacts_error:function(){this.clear_errors();this.handle_error(this.$(".forms.addpeople form input").first(),Errors.Zero_Contacts(),this.cid)},check_add_person:function(a,b){this.clear_errors();var c=a.keyCode?a.keyCode:a.which;if(13==c||9==c)return this.add_person(a),!1},keyup_email:function(a){var b=a.keyCode?a.keyCode:a.which;if(13==b||9==b)return!1;50===b&&a.shiftKey||$(a.target).val().match(/@/)?("tour"===Data.state.get("current_plugin")?$(a.target).attr("guest_or_internal","guest"):
 this.$("#guest_or_internal").val("guest"),this.on_change_guest_internal(a,$(a.target))):"tour"!==Data.state.get("current_plugin")||$(a.target).val().match(/@/)||($(a.target).attr("guest_or_internal","internal"),this.on_change_guest_internal(a,$(a.target)))},handle_click_input:function(a){0==$(a.target).closest("form").find('[name="email"]').val().length&&$(".forms.addpeople form").trigger("submit")},add_person:function(a){a=$(a.target);var b=a.closest("form"),c=b.find('[name="email"]'),d=c.val(),
 e=this;a="tour"==Data.state.get("current_plugin")?a.attr("guest_or_internal"):b.find('[name="guest_or_internal"]').val();if(0==c.val().length)return!1;b.clear_errors(this.cid);var f=b.serializeObject(this);if(f.errors)return b.mark_errors(f.errors,this.cid),"tour"==Data.state.get("current_plugin")&&$("#onetour").trigger("stay_on_step"),!1;f=c.val();"guest"===a||f.match(/@/)||Data.user.get("is_webmail")||(f+="@"+Data.user.domain());if(this.adding_person===f)return!1;this.adding_person=f;this.add_person_from_hash({person:{email:f}},
-!1,function(a){e.adding_person=null;a?(c.val(d).focus(),"CANCEL"!==a&&(e.handle_error(c,a,e.cid,{preamble:loc("The person could not be created."),force_left:"tour"===Data.state.get("current_plugin")?null:!0}),e.trigger("validation_error",a))):e.slide_form_out(b)});return!1},add_person_from_hash:function(a,b,c,d){var e=this,f=a.person;if(!f.email)return c();var g=f.email,h=Person.prototype.validate_email(g);if(h)return c(h);h=g.match(/@(.*$)/)[1];if(Data.user.get("invited_as_guest")&&!b){var k=function(){ec_confirm({subject:loc("Add People to Glip"),
-body:loc("<div style='width: 500px; text-align: left;'><p>Adding people to Glip means that you\u2019re ready to start using Glip beyond your role as a guest. This requires a subscription, but not to worry. You\u2019ll be put on the \"Free plan\" which gives you a whopping 10,000 messages before you have to consider one of the premium plans.</p><p>Go ahead and add [_new_people] to Glip?</p></div>",{new_people:_.escape(g)}),wrapper_class:"confirm-invite",buttons:[{label:"OK",action:function(){Client.has_seen_free_trial_on_add_user=
-!0;return e.add_person_from_hash(a,!0,c)}},{label:"Cancel",action:function(){return c("CANCEL")}}]})};if(Client.has_seen_free_trial_on_add_user)return this.add_person_from_hash(a,!0,c),!1;Client.do_request_with_retries("/user-is-free-guest",{},"GET",{success:function(b){b.is_free_guest?k():e.add_person_from_hash(a,!0,c)},error:function(a){console.warn("ERROR FETCHING PAYMENT FOR USER")}});return!1}var l=null;if("dev"!=Data.ec_env&&"qa"!=Data.ec_env||!g.match(/^newtestuser(.+)([0-9]+)@(.+)\.com$/i))l=
-Data.people.get_from_email(g);if(l){var s=function(a){Data.create_group([l.id],{success:a})};l.is_guest()&&!Data.user.person_is_visible(l)?Data.make_guest(l,{success:function(a){s(function(b){$(".leftrail .section").trigger("slide_to_top",b.id);e.new_person(a);return c(null,a)})}}):s(function(a){$(".leftrail .section").trigger("slide_to_top",a.id);return c(null,l)})}else l={email:g,inviter_id:Data.user_id},f.first_name&&(l.first_name=f.first_name),f.last_name&&(l.last_name=f.last_name),f.headshot&&
-(l.headshot=f.headshot),Data.company.has_domain(h)&&(l.company_id=Data.company.id),Data.create_person(l,{created:function(a){a.invited_by_me=!0;c(null,a)},error:function(a,b){a&&a.destroy();return c(b)},success:function(b){e.trigger("added_person");a.suppress_ga||(b.get("is_webmail")?Analytics.people_add_person("Webmail Guest"):b.is_guest()?Analytics.people_add_person("Domain Guest"):Analytics.people_add_person("Co-worker"));d&&d(null,b)}});return!1},slide_form_out:function(a){if("tour"!==Data.state.get("current_plugin"))this.$(".addpeople-peoplepage #firstemail").val("").focus();
-else{var b=a.clone();b.find("input").val("");b.find("input").attr("guest_or_internal","internal");b.find(".ininput").text("@"+Data.user.domain());b.find("[name=inputid]").val(a.find("[name=inputid]").val());var c=a.offset(),d=a.width(),e=a.height();$(".main").append(a);a.css({position:"absolute",top:c.top,left:c.left,width:d,"z-index":1});$(".leftrail").css("z-index","2");this.$(".forms").css("padding-top",e);this.$(".forms").delay(500).animate({"padding-top":0},250);a.animate({left:-(2*d)},500);
-b.hide();this.$(".forms").append(b);b.delay(500).fadeIn();this.$("input").first().focus();return!1}},validate_email:function(a,b){if(0<a.length){a=a.replace(/^ +/,"").replace(/ +$/,"");var c="tour"==Data.state.get("current_plugin")?this.$el.find("#"+b.inputid).attr("guest_or_internal"):b.guest_or_internal,d=a;"guest"===c||d.match(/@/)||Data.user.get("is_webmail")||(d+="@"+Data.user.domain());if(c=Person.prototype.validate_email(d))return c}},render_people:function(){var a=this;a.$(".people .person_row").detach();
-this.$("#guests").hide();Data.people.visible().forEach(function(b){var c=a.person_row(b);b.is_guest()&&!Data.user.get("is_webmail")?a.$("#guests").show().append(c.$el):a.$("#coworkers").append(c.$el);c.render()})},render_uninvited:function(){var a=this,b=Data.user.domain(),c=Data.user.get("uninvited_contacts")||{},d=$("<div />"),e=0,f=_.filter(Object.keys(c),function(a){var b=c[a].email;return!Data.people.find(function(a){return a.get("email")===b})}).sort(function(a,d){var e=c[a],f=c[d],s=e.email,
-r=f.email,p=s.match(/@(.*?)$/),v=r.match(/@(.*?)$/);if(s&&r&&p&&v)return f=p[1],e=v[1],f===b&&f!==e?-1:e===b&&f!==e?1:s.localeCompare(r);var s=e["first-name"],r=f["first-name"],u=e["last-name"],v=f["last-name"],p=u+" "+s,E=v+" "+r;if(!s&&!u)if(e.name===e.email)p=e.name;else if(e=e.name.split(/\s/))s=e.shift(),u=e.join(" "),p=u+" "+s;if(!r&&!v)if(f.name===f.email)E=f.name;else if(e=f.name.split(/\s/))r=e.shift(),v=e.join(" "),E=v+" "+r;return p.localeCompare(E)});_.each(f,function(b){b=a.uninvited_row(c[b]);
-d.append(b.$el);b.render();e++});a.$(".people").append(d)},person_row:function(a){return this.view("Person_Row_View",{model:a},a.cid)},uninvited_row:function(a){return this.view("Uninvited_Row_View",{model:new EC_Model(a)},a.email)},new_person:function(a){"tour"!==Data.state.get("current_plugin")&&(Data.user.person_is_visible(a)&&this.render_person(a),this.$('[email="'+a.get("email")+'"]').remove())},check_new_person:function(a){Data.user.person_is_visible(a)&&(this.person_row(a).in_DOM()||this.new_person(a))},
-person_is_current:function(a){if(a.id)return this.current_people.get(a.id)?!0:!1;var b=this.$el.find("#which_people").val();if("all"==b)return!0;var c=a.domain();if("coworkers"==b){if(Data.company.has_domain(c))return!0}else if("other"==b)a.once("change:_id",_.bind(function(a){this.new_person(a)},this));else if((a=Data.companies.get(b))&&a.has_domain(c))return!0;return!1},render_person:function(a){if(!a.get("deactivated")){var b=this.person_row(a),c=!1,d=(a.is_guest()?"B__":"A__")+a.abbreviation(),
-e=this;this.$(".people .person_row").each(function(){var a=$(this).attr("sort_index");!c&&a&&0<a.localeCompare(d)&&(c=!0,"A__"==d.substring(0,3)&&"B__"==a.substring(0,3)?e.$el.find("#coworkers").append(b.$el):b.$el.get(0)!==$(this).get(0)&&$(this).before(b.$el))});c||(a.is_guest()?self.$("#guests").show().append(b.$el):self.$("#coworkers").append(b.$el));b.animating?b.version_needs_rendering=a.get("version"):(b.render(),b.version_needs_rendering=null);this.in_DOM()&&!b.animating&&(a=b.$el.css("height"),
-b.$el.css("height",0),b.animating=!0,b.$el.stop().animate({height:a},{complete:function(){b.animating=!1;b.version_needs_rendering!=b.model.get("version")&&(b.render(),b.version_needs_rendering=null)}}))}},remove_person:function(a){this.person_row(a).$el.detach()},check_person_changed:function(a){Data.user.person_is_visible(a)||this.remove_person(a)},handle_append:function(){this.in_DOM()&&this.options.parent_view.handle_resize()},handle_resize:function(){this.handle_resize_centerrail()},size_page:function(){},
-check_person_removed:function(){Data.people.each(_.bind(function(a){Data.user.person_is_visible(a)||this.remove_person(a)},this))},on_change_guest_internal:function(a,b){var c=b?b.attr("guest_or_internal"):this.$el.find("#guest_or_internal").val();b=b||this.$el;"internal"==c?b.parent().find(".ininput").text("@"+Data.user.domain()):b.parent().find(".ininput").text("")}}),Person_Card_View=EC_Model_View.extend({tagName:"div",className:"person",my_template:"named/person_card.jst",events:_.extend({},EC_Model_View.prototype.events,
-{"click .person_card":"flip_person","click #delete_person":"delete_person","click #view_profile":"view_profile","click #start_chat":"start_conversation"}),initialize:function(){EC_Model_View.prototype.initialize.call(this);this.model.on("change",this.render,this)},render:function(a,b,c){EC_Model_View.prototype.render.call(this,a,b,c)&&(a=this.view("Headshot_View",{model:this.model},this.model.cid),a.dont_show_card=!0,this.$("heads").append(a.$el),a.render(),a.delegateEvents(),this.$el.attr("cid",
-this.model.cid),this.model.id===Data.user_id&&(this.$("#delete_person").hide(),this.$("#remove_from_conversation").hide(),this.$("#start_chat").hide(),this.$("#view_profile").css({margin:0,width:"100%"})),this.model.can_be_removed()||this.$("#delete_person").hide(),a=Data.company.short_domain(),this.$("#delete_person").val(Data.user.get("is_webmail")?loc("Remove"):loc("Remove from ")+a),this.$el.find("#leave_conversation").hide(),a=Data.presences.where({person_id:this.model.id})[0],a||(Data.presences.add({person_id:this.model.id,
-presence:"offline"}),a=Data.presences.where({person_id:this.model.id})[0]),a&&(a=this.view("Presence_View",{model:a},a.id,!0),a.show_label=!0,a.render(),this.$(".presence_holder").append(a.$el)),(this.model.get("headshot")||Data.company.id!==this.model.get("company_id"))&&this.$(".headshot_hint").hide(),(this.model.get("deactivated")||this.model.is_removed_guest())&&this.$(".account-status").show());this.delegateEvents()},select_person:function(){"people"==Data.state.get("current_plugin")&&(this.$el.hasClass("selected")?
-this.$el.removeClass("selected"):this.$el.addClass("selected"))},start_conversation:function(){var a=[this.model.id],b=this;b.clear_errors();this.$el.removeClass("flip");Data.create_group(a,{success:function(a){Data.save_state({current_plugin:"chat",current_group_id:a.id});b.$el.find("person.selected").removeClass("selected")},error:function(a,d){b.handle_error(b.$el,d,b.cid,{preamble:loc("The conversation could not be started.")});a&&a.destroy()}});this.$el.trigger("start_chat");$(".modal_popup_overlay").trigger("click");
-$(".modal_popup_overlay").trigger("remove_popup");$(".notes-modal").trigger("remove_popup");return!1},unflip_person:function(a){},flip_person:function(){},delete_person:function(){Delete_Person(this)},view_profile:function(){this.$el.removeClass("flip");Data.save_state({current_plugin:"person",current_person_id:this.model.id});this.$el.trigger("view_profile");$(".modal_popup_overlay").trigger("click");$(".modal_popup_overlay").trigger("remove_popup");$(".notes-modal").trigger("remove_popup");return!1}}),
-Person_Menu=function(a){var b=this.view("Person_Menu_View",{model:this.model,target:$(a.currentTarget)},null,!0);$("body").clear_errors();$("body").append(b.$el);b.render(a);b.$el.show();return!1},Uninvited_Row_View=EC_Model_View.extend({tagName:"div",className:"person_row uninvited_row clear-self",my_template:"named/uninvited_row.jst",events:{"click .invite":"invite"},initialize:function(){EC_Model_View.prototype.initialize.call(this);var a=Data.plugins_by_name[this.model.get("use_plugin")];a&&a.get("invite_label")&&
-window[a.get("invite_label")]&&(this.model.attributes.invite_label=window[a.get("invite_label")](this.model));this.$el.attr("email",this.model.get("email"));this.no_delegate=!0},invite:function(a){var b=Data.plugins_by_name[this.model.get("use_plugin")];if(b&&b.get("invite_function")&&window[b.get("invite_function")])return window[b.get("invite_function")](this.model);var c=this.model.get("email");a={email:this.model.get("email"),inviter_id:Data.user_id};var d=this.model.get("name"),d=d?d.split(/\s/):
-[];0<d.length&&(a.first_name=d.shift(),0<d.length&&(a.last_name=d.join(" ")));if(d=this.model.get("headshot"))a.headshot={creator_id:d.creator_id,stored_file_id:d._id,url:d.storage_url};c=c.match(/@(.*?)$/)[1];c==Data.company.has_domain(c.toLowerCase())&&(a.company_id=Data.company.id);var e=this;this.add_person_from_hash({person:a},!1,function(a){if(a)return e.handle_error(a);console.warn(b);if(b&&b.get("invite_ga_ping")&&window[b.get("invite_ga_ping")])window[b.get("invite_ga_ping")]()})},add_person_from_hash:People_View.prototype.add_person_from_hash}),
-Person_Row_View=EC_Model_View.extend({tagName:"div",className:"person_row clear-self",my_template:"named/person_row.jst",events:_.extend({},EC_Model_View.prototype.events,{"click .ico-settings":Group_Menu_From_Person,click_person:"click_person",click:"click_person","click .amazon_ses_suppressed":"click_amazon_ses_suppressed","click #reinvite_person":"reinvite_person","click #unlock_account":"unlock_account"}),initialize:function(){EC_Model_View.prototype.initialize.call(this);this.$el.attr("id",this.model.id);
-this.$el.attr("sort_index",(this.model.is_guest()?"B__":"A__")+this.model.abbreviation());this.model.on("change",this.on_change,this)},render:function(a,b,c){Data.user.person_is_visible(this.model)&&(EC_Model_View.prototype.render.call(this,a,b,c)&&(a=this.view("Headshot_View",{model:this.model},this.model.cid),a.dont_show_card=!0,this.$("heads").append(a.$el),a.render(),a.delegateEvents(),this.$el.attr("cid",this.model.cid),this.model.id===Data.user_id&&(this.$el.find("#delete_person").hide(),this.$el.find("#remove_from_conversation").hide(),
-this.$el.find("#delete_person").hide(),this.$el.find("#start_chat").hide(),Data.profile.get("feature_user_deletion")||this.$el.find(".ico-settings").hide()),this.options.search_result&&this.$el.find(".ico-settings").hide(),(this.model.get("has_registered")&&!this.model.is_hosted()&&!Data.profile.get("feature_user_deletion")||this.model.get("deactivated")||this.model.is_removed_guest())&&this.$el.find("#delete_person").hide(),this.model.is_hosted()&&this.$el.find("#delete_person").text(loc("Remove Guest")),
-this.$el.find("#leave_conversation").hide(),this.model.get("has_registered")?(a=Data.presences.where({person_id:this.model.id})[0],a||(Data.presences.add({person_id:this.model.id,presence:"offline"}),a=Data.presences.where({person_id:this.model.id})[0]),a&&(this.presence_view&&this.presence_view.remove(),a=this.view("Presence_View",{model:a},a.id,!0),a.render(),this.$(".person_info").before(a.$el),this.presence_view=a)):this.$(".person_info").html("Not yet signed up for Glip."),this.model.get("headshot")&&
-this.$(".headshot_hint").hide(),(this.model.get("deactivated")||this.model.is_removed_guest())&&this.$(".account-status").show(),this.model.is_guest()&&(a=this.model.is_kip_clone()?"Glip":this.model.get("email").replace(/.*@/,"").replace(/\.com/,""),this.$(".company").text(a),Data.user.get("invited_as_guest")||Data.user.get("is_webmail")||this.$el.addClass("guest")),this.model.get("amazon_ses_suppressed")?this.$el.find(".amazon_ses_suppressed").show():this.$el.find(".amazon_ses_suppressed").hide(),
-this.model.get("has_registered")||this.model.get("amazon_ses_suppressed")||this.model.id===Data.user_id?this.$el.find("#reinvite_person").hide():this.$el.find("#reinvite_person").show(),this.model.get("locked")&&!this.model.is_guest()&&Data.company.current_user_is_admin_strict()?this.$el.find("#unlock_account").show():this.$el.find("#unlock_account").hide()),this.model.id!==Data.user_id&&this.$el.attr("title",loc("Go to the conversation with [_person_name]",{person_name:this.model.abbreviation()})),
-this.delegateEvents())},on_change:function(a){this.animating||this.render(a)},select_person:function(){"people"==Data.state.get("current_plugin")&&(this.$el.hasClass("selected")?this.$el.removeClass("selected"):this.$el.addClass("selected"))},click_person:function(a){if("tour"===Data.state.get("current_plugin")||this.model.id===Data.user.id)return!0;a=[this.model.id];var b=this;b.clear_errors();this.$el.removeClass("flip");Data.create_group(a,{success:function(a){Data.save_state({current_plugin:"chat",
-current_group_id:a.id});b.$el.find("person.selected").removeClass("selected")},error:function(a,d){b.handle_error(b.$el,d,b.cid,{preamble:loc("The conversation could not be started.")});a&&a.destroy()}});return!1},view_profile:function(){this.$el.removeClass("flip");Data.save_state({current_plugin:"person",current_person_id:this.model.id});this.$el.trigger("view_profile");return!1},delete_person:function(){Delete_Person(this)},click_amazon_ses_suppressed:function(){Show_Undeliverable(this.model.get("email"));
-return!1},reinvite_person:function(){var a=this,b=this.$el.find("#reinvite_person");Client.request("/api/reinvite_user/"+this.model.id,{method:"put"},_.bind(function(c){if(c.body)if(c.body.error){var d=c.body.error.validation?null:{preamble:loc("Could not send re-invite email.")};this.handle_error(b,c.body.error,this.cid,d)}else ec_confirm({subject:loc("Invitation Sent"),body:loc("Invitation successfully sent to [_email].",{email:"<strong>"+a.model.get("email")+"</strong>"}),buttons:[{label:"OK"}]});
-else this.handle_error(b,Errors.Invalid_Server_Response(),a.cid,{preamble:loc("Could not send re-invite email.")})},this));return!1},unlock_account:function(){ec_confirm({subject:loc("Unlock Account"),body:loc("[_email] has been locked out due to numerous failed login attempts. Do you want to unlock this account?",{email:this.model.get("email")}),buttons:[{label:"OK",action:_.bind(this.confirm_unlock_account,this)},{label:"Cancel"}]});return!1},confirm_unlock_account:function(){var a=this,b=this.$el.find("#unlock_account");
-Client.request("/api/unlock_account/"+this.model.id,{method:"put"},_.bind(function(c){if(!c.body)this.handle_error(b,Errors.Invalid_Server_Response(),a.cid,{preamble:loc("Could not unlock this account.")});else if(c.body.error){var d=c.body.error.validation?null:{preamble:loc("Could not unlock this account.")};this.handle_error(b,c.body.error,this.cid,d)}},this));return!1}}),Person_View=EC_View.extend({id:"profile-page",events:{"click button.upload_headshot":"handle_headshot","click button.change_password":"change_password",
-keydown:"keydown","blur #person_form":"blur","focus #person_form":"focus"},initialize:function(){var a=Data.state.get("current_person_id");this.model=Data.people.get(a);this.template=JST["named/person.jst"];Data.state.on("change:current_person_id",this.change_person,this);Data.teams.on("change:is_archived",this.render,this);Data.teams.on("add",this.render,this);Data.teams.on("change:set_abbreviation",this.render,this);this.model.on("change",this.on_change,this)},blur:function(a){this.clear_errors();
-Client.has_connected?(this.leaving_target=$(a.target),this.save_person(this.leaving_target)):this.in_disconnect||(this.in_disconnect=!0,this.leaving_target=$(a.target),Client.once("reconnected",_.bind(function(){this.leaving_target.focus();this.in_disconnect=!1},this)))},focus:function(a){if("email"===$(a.target).attr("id")&&Data.user.externally_registered_needs_password()){$(a.target).blur();a=this.view("Set_Password_View",{},null,!0);a.render();var b=ec_confirm({subject:loc("Changing your email address will require you to sign in with a password going forward."),
-buttons:[],wrapper_class:"set-password-block",perform_after:function(){$(".ec_error").fadeOut()},remove_other_modals:!0,body_view:"Body_View"});a.on_finish=function(){b.fade()};b.find(".confirmbody").append(a.$el);return!1}this.current_tab_index=parseInt($(a.target).attr("tabindex"),10)},change:function(a){void 0!=$(a.target).attr("data-advanceable")&&this.advance(a)},on_change:function(a){this.render_header();this.saving||this.render()},advance:function(a){this.advance_from_target($(a.target))},
-advance_from_target:function(a,b){var c=parseInt(a.attr("tabindex"),10),d=this.$el.find("[data-tabbable]").length;b?(c-=1,0==c&&(c=d-1)):c=c%d+1;this.$el.find("[tabindex="+c+"]").focus()},change_person:function(){if("person"==Data.state.get("current_plugin")){var a=Data.state.get("current_person_id");this.model&&this.model.off("change",this.on_change,this);this.model=Data.people.get(a);this.model.on("change",this.on_change,this);this.render()}},render:function(a){this.model&&(this.$el.html(this.template({model:this.model})),
-this.headshot_view=this.view("Headshot_View",{model:this.model},this.model.cid),this.headshot_view.dont_show_card=!0,this.headshot_view.size="100x100",this.$el.find("heads").append(this.headshot_view.$el),this.headshot_view.render(),this.headshot_view.cant_upload_headshot()&&this.$el.find("button.upload_headshot").remove(),this.populate_fields(),this.model.id!==Data.user.id&&(this.$("button.change_password").remove(),this.$el.find("input").attr({placeholder:"",disabled:!0}),this.$el.find("input, select").each(function(){$(this).replaceWith($("<value />").text(" "+
-$(this).val()).attr("id",$(this).attr("id")))})),_.delay(_.bind(function(){this.$el.find("input").trigger("grow")},this),50),(this.current_tab_index=this.current_tab_index||1)&&this.$el.find("[tabindex="+this.current_tab_index+"]").focus())},render_header:function(){this.$el.find("h1 .abbreviation").text(this.model.abbreviation())},populate_fields:function(){var a=this.model.id,b=Data.teams.filter(function(b){return b.is_member(a)&&!b.get("is_archived")}).map(function(a){return a.abbreviation()}).join(", "),
-c={comfortZone:2},d=this.model.get("company_id")!=Data.company.id,e=this.model.get("is_webmail");this.$el.find("#teams").text(b);this.model.is_kip_clone()?this.$el.find("#domain").text("@glip.com"):this.$el.find("#domain").text(d||e?"":"@"+this.model.domain());this.$el.find("#first_name").val(this.model.get("first_name")).autoGrowInput(c).trigger("grow");this.$el.find("#last_name").val(this.model.get("last_name")).autoGrowInput(c).trigger("grow");this.model.is_kip_clone()?this.$el.find("#email").val("kip").autoGrowInput(c).trigger("grow"):
-this.$el.find("#email").val(d||e?this.model.email_for_display():this.model.short_email()).autoGrowInput(c).trigger("grow");this.$el.find("#job_title").val(this.model.get("job_title"));this.$el.find("#homepage").val(this.model.get("homepage"));this.$el.find("#location").val(this.model.get("location"));this.$el.find("#gender").val(this.model.get("gender"));var f=this;this.$el.find("#birthday").val(this.model.get("birthday")).datepicker({dateFormat:"MM d",changeYear:!1,appendTo:this.$el,beforeShow:function(a,
-b){b.dpDiv.addClass("no-year")},onSelect:function(){$(this).change();f.save_person($(this));f.advance_from_target($(this))},onClose:function(a,b){b.dpDiv.removeClass("no-year")}});this.$el.find("#employee_since").val(this.model.get("employee_since")).datepicker({dateFormat:"m/d/y",acceptedDateFormats:["m/d/y","m/d/yy"],appendTo:this.$el,onSelect:function(){$(this).change();f.save_person($(this));f.advance_from_target($(this))}})},end_edit:function(){},handle_headshot:function(a){a.preventDefault();
-this.headshot_view.file_select()},change_password:function(a){a=Client.view_singleton("Set_Password_View");a.render();this.append_view(a);return!1},save_person:function(a){if(this.model.id==Data.user.id&&!this.saving){var b=this;if(this.in_DOM()){b.clear_errors();var c=a.attr("name"),d=this.$el.find("[name=email]"),e=$("#person_form").serializeObject(this);if(e.errors)$("#person_form").mark_errors(e.errors,this.cid);else{var f=this.model.get("company_id")!=Data.company.id,g=this.model.get("is_webmail"),
-h=f||g?this.model.get("email"):this.model.short_email();if(e.email!=h)d.val(h),h=this.model.domain(e.email),f||g||Data.is_unique_abbreviation(e.email,{company_team_ok:!0,domain:h})?(f=f||g?e.email:e.email+"@"+Data.user.domain(),ec_confirm({subject:"Email Change Request",body:"Please check your INBOX to confirm your new email address.<br><br>Once you confirm it, your address will update on Glip.",buttons:[{label:"OK"}]}),Client.request("/api/confirm_email",{parameters:{email:f,user_id:Data.user.id},
-method:"post"},_.bind(function(a){if(!a.body)this.handle_error(d,Errors.Invalid_Server_Response(),this.cid,{preamble:loc("Could not send confirmation email.")});else if(a.body.error){var b=a.body.error.validation?null:{preamble:loc("Could not send confirmation email.")};this.handle_error(d,a.body.error,this.cid,b)}},this))):setTimeout(function(){d.focus();$(".ui-datepicker").hide();b.handle_error(a,Errors.Duplicate_Email(e.email+"@"+_.escape(Data.cuser.domain())),b.cid)},0);else if("email"!=a.attr("name")&&
-a.val()!=this.model.get(a.attr("name"))){var k=a.val(),l=this.model,s={first_name:e.first_name,last_name:e.last_name,homepage:e.homepage,location:e.location,birthday:e.birthday,gender:e.gender,job_title:e.job_title,employee_since:e.employee_since};_.find(_.keys(s),function(a){return s[a]!=l.get(a)&&!(!l.get(a)&&!s[a])})&&(this.saving=!0,Data.change_object(l,s,{success:function(a){b.saving=!1},error:function(d,e){b.saving=!1;a=b.$el.find("[name="+c+"]");setTimeout(function(){b.handle_error(a,e,b.cid,
-{preamble:loc("This person could not be changed."),no_error_class:!0})},0);a.val(k);a.focus()}}))}}return!1}}},keydown:function(a){var b=a.keyCode?a.keyCode:a.which,c=$("*:focus");if(13==b)return!1;if(9==b)return this.advance_from_target(c,a.shiftKey),!1}}),Delete_Person=function(a,b){b||(b=a.model);ec_confirm({subject:b.is_hosted()?loc("Remove Guest"):loc("Remove Person"),body:b.is_hosted()?loc("Are you sure you want to remove <b>[_name]</b>?",{name:_.escape(b.abbreviation())}):loc("Are you sure you want to remove <b>[_name]</b> from Glip?",
-{name:_.escape(b.abbreviation())}),buttons:[{label:"OK",action:function(){var c=function(b,c){a.handle_error(a.$el,c,a.cid,{preamble:b.is_hosted()?loc("This person could not be removed as a guest."):loc("This person could not be removed.")})};b.is_hosted()?Data.remove_guest(b,{error:c}):Data.deactivate_object(b,{error:c})}},{label:"Cancel",post_action:"denied"}]});return!1},Undeliverable_Message=function(a){return loc("We are not able to deliver email to [_email]. If this address is incorrect, remove it from the People page. Otherwise, please [_link]contact customer support.</a>",
-{email:"<strong>"+a+"</strong>",link:'<a target=_blank rel="noreferrer" href="https://glip.zendesk.com/hc/en-us/requests/new">'})},Show_Undeliverable=function(a){ec_confirm({subject:loc("Email undeliverable"),body:Undeliverable_Message(a),buttons:[{label:"OK"}]})},Person_Next_Step_View=EC_Model_View.extend({className:"person-next-step",initialize:function(){EC_Model_View.prototype.initialize.call(this);this.template=JST["named/person_next_step.jst"]},render:function(){var a;this.model.get("has_registered")?
-this.model.get("headshot")?this.model.get("first_name")||(a=loc("Ask [_name] to update their name on their profile.",{name:this.model.abbreviation()})):a=Data.company.id===this.model.get("company_id")?loc("[_name] has registered, but not yet added a headshot. You can add one for them, or ask [_name] to do it by dragging a photo onto their headshot circle.",{name:_.escape(this.model.abbreviation())}):loc("[_name] has registered, but not yet added a headshot. Ask [_name] to add one by dragging a photo onto their headshot circle.",
-{name:_.escape(this.model.abbreviation())}):a=loc("Ask [_name] to check their email for an invitation to Glip. While we wait for them to register, anything you share here, including tasks, events and files, will be forwarded by email so you can get started right away.",{name:_.escape(this.model.abbreviation())});this.$el.html(a)}}),Plugin_List_View=EC_View.extend({initialize:function(){Data.plugins.on("add",this.add_plugin,this);Data.plugins.on("remove",this.remove_plugin,this)},render:function(){},
-plugin_tab:function(a){return this.view("Plugin_Tab_View",{model:a},a.cid)}}),Plugin_Tab_View=EC_View.extend({events:{"click label":"select_tab","click .folder-settings":Folder_Menu},tagName:"div",className:"plugintab section",initialize:function(){_.bindAll(this,"handle_append");this.model.on("change",this.render,this);if(this.model&&"account"===this.model.get("name"))Data.user.on("change:first_name change:last_name change:display_name",this.change_name,this);Data.state.on("change:current_plugin",
-this.change_state,this);Data.state.on("change:plugin_active:"+this.model.get("name"),this.render,this);Data.profile.on("change:feature_add_plugin",this.render,this);this.template=JST["named/plugin_tab.jst"];this.added_accordion_listener={}},render:function(){var a=this.model,b=a.get("name");a.get("no_left_rail")?this.$el.hide():this.$el.show();a.get("float")&&this.$el.css("float",a.get("float"));this.$el.html(this.template({model:a,new_items:this.new_items}));this.$el.attr("name",b);this.$el.attr("id",
-"plugin-"+b);"account"===b&&this.$("label").html($("<span class='ico ico-settings'></span><span class='ico ico-arrow-down-2 plus'></span><span>"+_.escape(Data.user.abbreviation())+"</span>"));this.$(".new").hide()},change_name:function(){"account"===this.model.get("name")?this.$("label").html($("<span class='ico ico-settings'></span><span class='ico ico-arrow-down-2 plus'></span><span>"+_.escape(Data.user.abbreviation())+"</span>")):this.$("label").html($("<span class='ico ico-settings'></span><span>"+
-_.escape(Data.user.abbreviation())+"</span>"))},handle_append:function(){this.change_state()},change_state:function(a){if(this.is_active()){this.$el.addClass("selected");var b=this.model,c=b.get("name");if("show"===a)this.$(".accordion").show();else{var d=$(".leftrail");this.$(".accordion").slideDown({duration:500,progress:function(){if("chat"!=c&&"account"!=c&&"account"!=b.get("parent_plugin")){var a=$(this),f=a.height(),g=d.scrollTop(),a=a.offset().top+g,h=d.height();h+g<a+f+10&&d.scrollTop(f>h?
-a+10:a+f+10-h)}}})}}else this.$el.removeClass("selected"),this.$(".accordion").slideUp(500)},check_accordion:function(){var a=this.model.get("name");Data[a].off("add",this.check_accordion,this);this.change_state()},is_active:function(){var a=this.model.get("name"),b=Data.state.get("current_plugin"),c=Data.plugins_by_name[b];return a===b?!0:"chat"!==a||"people"!==b&&"teams"!==b&&"groups"!==b&&"tour"!==b&&"favorites"!==b?"chat"===a?!0:"account"===a&&("account_settings"===b||"person"===b&&Data.state.get("current_person_id")==
-Data.user.id||c&&"account"===c.get("parent_plugin")||"referral"===b)?!0:!1:!0},show_plugin:function(){var a=this.model.get("name");if(Data[a]){Data[a].off("add",this.show_plugin);this.$el.fadeIn();var b=this.model.get("tab_label"),c=this.model.get("item_label_plural")||a,b="<b>Congratulations!</b><br><br>You have unlocked the "+b+" App, which you can use to view and manage all of the "+c.toLowerCase()+" in your company, across all conversations.";this.$el.width();Hint(b,this.$el,{id:"help_"+a,top:35,
-right:43,arrow:"wn"})}},select_tab:function(a){var b=this.model.get("name");"tour"===Data.state.get("current_plugin")||"chat"===b&&$(a.target).closest(".people, .teams, .groups, .favorites").length||((b=this.model.get("select_function"))&&_.isFunction(window[b])?(b=this.view(b),$("body").clear_errors(),$("body").append(b.$el),b.render(a),b.$el.show(),a.stopImmediatePropagation()):Data.save_state({current_plugin:this.model.get("name")}))}}),Plugin_Card_View=EC_View.extend({events:{"click input":"add_plugin"},
-initialize:function(){this.template=JST["named/plugin_card.jst"]},render:function(){$(this.el).html(this.template())},add_plugin:function(){$("#plugin_button_bug").fadeOut();$("plugintab[name=bugs]").fadeIn();$(".rightrail").html("")}}),Plugin_Header=function(a,b,c){var d="<b>",e="";b=Data.get_profile_value(b);_.isArray(b)?("Posted by"==b[0]&&(e=" posted by "+_.escape(b[2])),"Team"==b[0]&&(e=" in "+_.escape(b[2])),"Folder"==b[0]&&(e=" in "+_.escape(b[2])),"Person"==b[0]&&(e=" from "+_.escape(b[2])),
-"Group"==b[0]&&(e=" from "+_.escape(b[2])),"Assigned to"==b[0]&&(e=" assigned to "+_.escape(b[2]))):d="mine"==b?d+"My ":d+"All ";c&&(d+=c);d=_.isArray(b)?d+(a+"</b>"):d+("</b>"+a);return d+e},Post_Menu_View=EC_View.extend({initialize:function(){_.bindAll(this)},render:function(a){var b=Data.get_profile_value("favorite_post_ids");$.inArray(this.model.id,b);this.model.is_liked_by(Data.user_id);Data.get_profile_value("post_show_authors");Data.get_profile_value("post_show_timestamps");var b=!this.model.mine(),
-c=Data.company.current_user_is_admin_strict(),d=Data.groups.get(this.model.get("group_id")),e=c&&d.get("company_id")===Data.user.get("company_id"),f=this.model.get("activity_data")?!0:!1;this.original_event=a;var g=b||this.model.get("parent_id")||f,d=Data.groups.get(this.model.get("group_id")),d=b&&!e;1<$(".postslist > .post.selected").length&&(g=!0);menu=[['<span class="ico ico-move"></span> Move To...',this.move,{disabled:g}]];var g=this.model.get("item_ids").reverse()||[],h=g.length;_.each(g,_.bind(function(a,
-b){var d=Data.objects.get(a);if(d){var e=d.get_plugin();if(e){var f=e.get("is_integration")?"Post":e.get("item_label"),g=e.has("edit_label")?e.get("edit_label"):f;if(1<h){var u=b+1;d.get("name")?u=d.get("name"):d.get("title")&&(u=d.get("title"));f=f+" ("+u+")";g=g+" ("+u+")"}e.get("suppress_view_details")||menu.push(["-"],['<span class="ico ico-info"></span> View Details',this.view_details,{argument:d}]);e.get("edit_function")&&window[e.get("edit_function")]&&menu.push(['<span class="ico ico-edit"></span> Edit '+
-g,e.get("edit_function"),{argument:d,no_event_argument:1,disabled:!d.can_edit(),attributes:[["mid",d.id],["type","edit"]]}]);menu.push(['<span class="ico ico-delete"></span> Delete '+f,this.delete_item,{argument:d,disabled:!d.mine(this.model)&&(!c||d.get("company_id")!=Data.user.get("company_id")),attributes:[["mid",d.id],["type","delete"]]}])}}},this));1<h&&menu.push(["-"],['<span class="ico ico-delete"></span> Delete All',this.delete_post,{disabled:d}]);g=this.model.get("text")||"";if(0===h||0<
-g.length)menu.push(["-"],['<span class="ico ico-edit"></span> Edit Post',this.edit_post,{disabled:b||f}]),0===h&&menu.push(['<span class="ico ico-delete"></span> Delete Post',this.delete_post,{disabled:d}]);Menu(menu,{align:"right",menuClass:1<h?"post_menu scrollable":"post_menu",mark_active:this.options.parent_view.$el,allow_html:!0}).render(a)},mark_favorite:function(){var a=Data.get_profile_value("favorite_post_ids");-1<$.inArray(this.model.id,a)?(a=_.without(a,this.model.id),"account"===Data.state.get("current_plugin")&&
-Analytics.dashboard_unfavorite()):a.unshift(this.model.id);Data.set_profile_value("favorite_post_ids",a);Data.profile.trigger("change:favorite_post_ids",a);Data.save_profile()},mark_like:function(){Like_Post(this.model)},create_task:function(){this.options.parent_view.options.parent_view.options.parent_view.compose_view.create_task(this.model.get("text"))},edit_post:function(a){this.model.trigger("edit_post")},delete_post:function(){if(!this.check_locked()){var a;a=(a=this.model.get("item_ids"))&&
-1<a.length?loc("Are you sure you want to delete this post and all attached items?"):loc("Are you sure you want to delete this post?");var b=this;ec_confirm({subject:loc("Delete Post?"),body:a,buttons:[{label:"OK",action:function(){Data.deactivate_object(b.model,{error:function(a,d){b.handle_error(b.options.target||$("#post_menu"),d,b.cid,{preamble:loc("Your post could not be deleted.")})}})}},{label:"Cancel",post_action:"denied"}]})}},delete_item:function(a,b,c){if(!this.check_locked())if((a=b.plugin)&&
-a.get("delete_from_post_method"))b[a.get("delete_from_post_method")](this.model,c);else{var d=this;a=function(){Data.deactivate_object(b,{error:function(a,b){d.handle_error(d.options.target||$("#post_menu"),b,d.cid,{preamble:loc("Your post could not be deleted.")})}})};if(c)return a();ec_confirm({subject:loc("Delete Item?"),body:loc("Are you sure you want to delete this item?"),buttons:[{label:"OK",action:a},{label:"Cancel",post_action:"denied"}]})}},share_multiple:function(a){Select_Group_Menu(a,
+!1,function(a){e.adding_person=null;a?(c.val(d).focus(),"CANCEL"!==a&&(e.handle_error(c,a,e.cid,{preamble:loc("The person could not be created."),force_left:"tour"===Data.state.get("current_plugin")?null:!0}),e.trigger("validation_error",a))):e.slide_form_out(b)});return!1},add_person_from_hash:function(a,b,c,d){var e=this,f=a.person;console.warn("ADDING PERSON FROM HASH:",a,b);if(!f.email)return c();var g=f.email,h=Person.prototype.validate_email(g);if(h)return c(h);h=g.match(/@(.*$)/)[1];if(Data.user.get("invited_as_guest")&&
+!b){var k=function(){ec_confirm({subject:loc("Add People to Glip"),body:loc("<div style='width: 500px; text-align: left;'><p>Adding people to Glip means that you\u2019re ready to start using Glip beyond your role as a guest. This requires a subscription, but not to worry. You\u2019ll be put on the \"Free plan\" which gives you a whopping 10,000 messages before you have to consider one of the premium plans.</p><p>Go ahead and add [_new_people] to Glip?</p></div>",{new_people:_.escape(g)}),wrapper_class:"confirm-invite",
+buttons:[{label:"OK",action:function(){Client.has_seen_free_trial_on_add_user=!0;return e.add_person_from_hash(a,!0,c)}},{label:"Cancel",action:function(){return c("CANCEL")}}]})};if(Client.has_seen_free_trial_on_add_user)return this.add_person_from_hash(a,!0,c),!1;Client.do_request_with_retries("/user-is-free-guest",{},"GET",{success:function(b){b.is_free_guest?k():e.add_person_from_hash(a,!0,c)},error:function(a){console.warn("ERROR FETCHING PAYMENT FOR USER")}});return!1}var l=null;if("dev"!=Data.ec_env&&
+"qa"!=Data.ec_env||!g.match(/^newtestuser(.+)([0-9]+)@(.+)\.com$/i))l=Data.people.get_from_email(g);if(l){var s=function(a){Data.create_group([l.id],{success:a})};l.is_guest()&&!Data.user.person_is_visible(l)?Data.make_guest(l,{success:function(a){s(function(b){$(".leftrail .section").trigger("slide_to_top",b.id);e.new_person(a);return c(null,a)})}}):s(function(a){$(".leftrail .section").trigger("slide_to_top",a.id);return c(null,l)})}else l={email:g,inviter_id:Data.user_id},f.first_name&&(l.first_name=
+f.first_name),f.last_name&&(l.last_name=f.last_name),f.headshot&&(l.headshot=f.headshot),Data.company.has_domain(h)&&(l.company_id=Data.company.id),Data.create_person(l,{created:function(a){a.invited_by_me=!0;c(null,a)},error:function(a,b){a&&a.destroy();return c(b)},success:function(b){e.trigger("added_person");a.suppress_ga||(b.get("is_webmail")?Analytics.people_add_person("Webmail Guest"):b.is_guest()?Analytics.people_add_person("Domain Guest"):Analytics.people_add_person("Co-worker"));d&&d(null,
+b)}});return!1},slide_form_out:function(a){if("tour"!==Data.state.get("current_plugin"))this.$(".addpeople-peoplepage #firstemail").val("").focus();else{var b=a.clone();b.find("input").val("");b.find("input").attr("guest_or_internal","internal");b.find(".ininput").text("@"+Data.user.domain());b.find("[name=inputid]").val(a.find("[name=inputid]").val());var c=a.offset(),d=a.width(),e=a.height();$(".main").append(a);a.css({position:"absolute",top:c.top,left:c.left,width:d,"z-index":1});$(".leftrail").css("z-index",
+"2");this.$(".forms").css("padding-top",e);this.$(".forms").delay(500).animate({"padding-top":0},250);a.animate({left:-(2*d)},500);b.hide();this.$(".forms").append(b);b.delay(500).fadeIn();this.$("input").first().focus();return!1}},validate_email:function(a,b){if(0<a.length){a=a.replace(/^ +/,"").replace(/ +$/,"");var c="tour"==Data.state.get("current_plugin")?this.$el.find("#"+b.inputid).attr("guest_or_internal"):b.guest_or_internal,d=a;"guest"===c||d.match(/@/)||Data.user.get("is_webmail")||(d+=
+"@"+Data.user.domain());if(c=Person.prototype.validate_email(d))return c}},render_people:function(){var a=this;a.$(".people .person_row").detach();this.$("#guests").hide();Data.people.visible().forEach(function(b){var c=a.person_row(b);b.is_guest()&&!Data.user.get("is_webmail")?a.$("#guests").show().append(c.$el):a.$("#coworkers").append(c.$el);c.render()})},render_uninvited:function(){var a=this,b=Data.user.domain(),c=Data.user.get("uninvited_contacts")||{},d=$("<div />"),e=0,f=_.filter(Object.keys(c),
+function(a){var b=c[a].email;return!Data.people.find(function(a){return a.get("email")===b})}).sort(function(a,d){var e=c[a],f=c[d],s=e.email,r=f.email,p=s.match(/@(.*?)$/),v=r.match(/@(.*?)$/);if(s&&r&&p&&v)return f=p[1],e=v[1],f===b&&f!==e?-1:e===b&&f!==e?1:s.localeCompare(r);var s=e["first-name"],r=f["first-name"],u=e["last-name"],v=f["last-name"],p=u+" "+s,E=v+" "+r;if(!s&&!u)if(e.name===e.email)p=e.name;else if(e=e.name.split(/\s/))s=e.shift(),u=e.join(" "),p=u+" "+s;if(!r&&!v)if(f.name===f.email)E=
+f.name;else if(e=f.name.split(/\s/))r=e.shift(),v=e.join(" "),E=v+" "+r;return p.localeCompare(E)});_.each(f,function(b){b=a.uninvited_row(c[b]);d.append(b.$el);b.render();e++});a.$(".people").append(d)},person_row:function(a){return this.view("Person_Row_View",{model:a},a.cid)},uninvited_row:function(a){return this.view("Uninvited_Row_View",{model:new EC_Model(a)},a.email)},new_person:function(a){"tour"!==Data.state.get("current_plugin")&&(Data.user.person_is_visible(a)&&this.render_person(a),this.$('[email="'+
+a.get("email")+'"]').remove())},check_new_person:function(a){Data.user.person_is_visible(a)&&(this.person_row(a).in_DOM()||this.new_person(a))},person_is_current:function(a){if(a.id)return this.current_people.get(a.id)?!0:!1;var b=this.$el.find("#which_people").val();if("all"==b)return!0;var c=a.domain();if("coworkers"==b){if(Data.company.has_domain(c))return!0}else if("other"==b)a.once("change:_id",_.bind(function(a){this.new_person(a)},this));else if((a=Data.companies.get(b))&&a.has_domain(c))return!0;
+return!1},render_person:function(a){if(!a.get("deactivated")){var b=this.person_row(a),c=!1,d=(a.is_guest()?"B__":"A__")+a.abbreviation(),e=this;this.$(".people .person_row").each(function(){var a=$(this).attr("sort_index");!c&&a&&0<a.localeCompare(d)&&(c=!0,"A__"==d.substring(0,3)&&"B__"==a.substring(0,3)?e.$el.find("#coworkers").append(b.$el):b.$el.get(0)!==$(this).get(0)&&$(this).before(b.$el))});c||(a.is_guest()?self.$("#guests").show().append(b.$el):self.$("#coworkers").append(b.$el));b.animating?
+b.version_needs_rendering=a.get("version"):(b.render(),b.version_needs_rendering=null);this.in_DOM()&&!b.animating&&(a=b.$el.css("height"),b.$el.css("height",0),b.animating=!0,b.$el.stop().animate({height:a},{complete:function(){b.animating=!1;b.version_needs_rendering!=b.model.get("version")&&(b.render(),b.version_needs_rendering=null)}}))}},remove_person:function(a){this.person_row(a).$el.detach()},check_person_changed:function(a){Data.user.person_is_visible(a)||this.remove_person(a)},handle_append:function(){this.in_DOM()&&
+this.options.parent_view.handle_resize()},handle_resize:function(){this.handle_resize_centerrail()},size_page:function(){},check_person_removed:function(){Data.people.each(_.bind(function(a){Data.user.person_is_visible(a)||this.remove_person(a)},this))},on_change_guest_internal:function(a,b){var c=b?b.attr("guest_or_internal"):this.$el.find("#guest_or_internal").val();b=b||this.$el;"internal"==c?b.parent().find(".ininput").text("@"+Data.user.domain()):b.parent().find(".ininput").text("")}}),Person_Card_View=
+EC_Model_View.extend({tagName:"div",className:"person",my_template:"named/person_card.jst",events:_.extend({},EC_Model_View.prototype.events,{"click .person_card":"flip_person","click #delete_person":"delete_person","click #view_profile":"view_profile","click #start_chat":"start_conversation"}),initialize:function(){EC_Model_View.prototype.initialize.call(this);this.model.on("change",this.render,this)},render:function(a,b,c){EC_Model_View.prototype.render.call(this,a,b,c)&&(a=this.view("Headshot_View",
+{model:this.model},this.model.cid),a.dont_show_card=!0,this.$("heads").append(a.$el),a.render(),a.delegateEvents(),this.$el.attr("cid",this.model.cid),this.model.id===Data.user_id&&(this.$("#delete_person").hide(),this.$("#remove_from_conversation").hide(),this.$("#start_chat").hide(),this.$("#view_profile").css({margin:0,width:"100%"})),this.model.can_be_removed()||this.$("#delete_person").hide(),a=Data.company.short_domain(),this.$("#delete_person").val(Data.user.get("is_webmail")?loc("Remove"):
+loc("Remove from ")+a),this.$el.find("#leave_conversation").hide(),a=Data.presences.where({person_id:this.model.id})[0],a||(Data.presences.add({person_id:this.model.id,presence:"offline"}),a=Data.presences.where({person_id:this.model.id})[0]),a&&(a=this.view("Presence_View",{model:a},a.id,!0),a.show_label=!0,a.render(),this.$(".presence_holder").append(a.$el)),(this.model.get("headshot")||Data.company.id!==this.model.get("company_id"))&&this.$(".headshot_hint").hide(),(this.model.get("deactivated")||
+this.model.is_removed_guest())&&this.$(".account-status").show());this.delegateEvents()},select_person:function(){"people"==Data.state.get("current_plugin")&&(this.$el.hasClass("selected")?this.$el.removeClass("selected"):this.$el.addClass("selected"))},start_conversation:function(){var a=[this.model.id],b=this;b.clear_errors();this.$el.removeClass("flip");Data.create_group(a,{success:function(a){Data.save_state({current_plugin:"chat",current_group_id:a.id});b.$el.find("person.selected").removeClass("selected")},
+error:function(a,d){b.handle_error(b.$el,d,b.cid,{preamble:loc("The conversation could not be started.")});a&&a.destroy()}});this.$el.trigger("start_chat");$(".modal_popup_overlay").trigger("click");$(".modal_popup_overlay").trigger("remove_popup");$(".notes-modal").trigger("remove_popup");return!1},unflip_person:function(a){},flip_person:function(){},delete_person:function(){Delete_Person(this)},view_profile:function(){this.$el.removeClass("flip");Data.save_state({current_plugin:"person",current_person_id:this.model.id});
+this.$el.trigger("view_profile");$(".modal_popup_overlay").trigger("click");$(".modal_popup_overlay").trigger("remove_popup");$(".notes-modal").trigger("remove_popup");return!1}}),Person_Menu=function(a){var b=this.view("Person_Menu_View",{model:this.model,target:$(a.currentTarget)},null,!0);$("body").clear_errors();$("body").append(b.$el);b.render(a);b.$el.show();return!1},Uninvited_Row_View=EC_Model_View.extend({tagName:"div",className:"person_row uninvited_row clear-self",my_template:"named/uninvited_row.jst",
+events:{"click .invite":"invite"},initialize:function(){EC_Model_View.prototype.initialize.call(this);var a=Data.plugins_by_name[this.model.get("use_plugin")];a&&a.get("invite_label")&&window[a.get("invite_label")]&&(this.model.attributes.invite_label=window[a.get("invite_label")](this.model));this.$el.attr("email",this.model.get("email"));this.no_delegate=!0},invite:function(a){var b=Data.plugins_by_name[this.model.get("use_plugin")];if(b&&b.get("invite_function")&&window[b.get("invite_function")])return window[b.get("invite_function")](this.model);
+var c=this.model.get("email");a={email:this.model.get("email"),inviter_id:Data.user_id};var d=this.model.get("name"),d=d?d.split(/\s/):[];0<d.length&&(a.first_name=d.shift(),0<d.length&&(a.last_name=d.join(" ")));if(d=this.model.get("headshot"))a.headshot={creator_id:d.creator_id,stored_file_id:d._id,url:d.storage_url};c=c.match(/@(.*?)$/)[1];c==Data.company.has_domain(c.toLowerCase())&&(a.company_id=Data.company.id);var e=this;this.add_person_from_hash({person:a},!1,function(a){if(a)return e.handle_error(a);
+console.warn(b);if(b&&b.get("invite_ga_ping")&&window[b.get("invite_ga_ping")])window[b.get("invite_ga_ping")]()})},add_person_from_hash:People_View.prototype.add_person_from_hash}),Person_Row_View=EC_Model_View.extend({tagName:"div",className:"person_row clear-self",my_template:"named/person_row.jst",events:_.extend({},EC_Model_View.prototype.events,{"click .ico-settings":Group_Menu_From_Person,click_person:"click_person",click:"click_person","click .amazon_ses_suppressed":"click_amazon_ses_suppressed",
+"click #reinvite_person":"reinvite_person","click #unlock_account":"unlock_account"}),initialize:function(){EC_Model_View.prototype.initialize.call(this);this.$el.attr("id",this.model.id);this.$el.attr("sort_index",(this.model.is_guest()?"B__":"A__")+this.model.abbreviation());this.model.on("change",this.on_change,this)},render:function(a,b,c){Data.user.person_is_visible(this.model)&&(EC_Model_View.prototype.render.call(this,a,b,c)&&(a=this.view("Headshot_View",{model:this.model},this.model.cid),
+a.dont_show_card=!0,this.$("heads").append(a.$el),a.render(),a.delegateEvents(),this.$el.attr("cid",this.model.cid),this.model.id===Data.user_id&&(this.$el.find("#delete_person").hide(),this.$el.find("#remove_from_conversation").hide(),this.$el.find("#delete_person").hide(),this.$el.find("#start_chat").hide(),Data.profile.get("feature_user_deletion")||this.$el.find(".ico-settings").hide()),this.options.search_result&&this.$el.find(".ico-settings").hide(),(this.model.get("has_registered")&&!this.model.is_hosted()&&
+!Data.profile.get("feature_user_deletion")||this.model.get("deactivated")||this.model.is_removed_guest())&&this.$el.find("#delete_person").hide(),this.model.is_hosted()&&this.$el.find("#delete_person").text(loc("Remove Guest")),this.$el.find("#leave_conversation").hide(),this.model.get("has_registered")?(a=Data.presences.where({person_id:this.model.id})[0],a||(Data.presences.add({person_id:this.model.id,presence:"offline"}),a=Data.presences.where({person_id:this.model.id})[0]),a&&(this.presence_view&&
+this.presence_view.remove(),a=this.view("Presence_View",{model:a},a.id,!0),a.render(),this.$(".person_info").before(a.$el),this.presence_view=a)):this.$(".person_info").html("Not yet signed up for Glip."),this.model.get("headshot")&&this.$(".headshot_hint").hide(),(this.model.get("deactivated")||this.model.is_removed_guest())&&this.$(".account-status").show(),this.model.is_guest()&&(a=this.model.is_kip_clone()?"Glip":this.model.get("email").replace(/.*@/,"").replace(/\.com/,""),this.$(".company").text(a),
+Data.user.get("invited_as_guest")||Data.user.get("is_webmail")||this.$el.addClass("guest")),this.model.get("amazon_ses_suppressed")?this.$el.find(".amazon_ses_suppressed").show():this.$el.find(".amazon_ses_suppressed").hide(),this.model.get("has_registered")||this.model.get("amazon_ses_suppressed")||this.model.id===Data.user_id?this.$el.find("#reinvite_person").hide():this.$el.find("#reinvite_person").show(),this.model.get("locked")&&!this.model.is_guest()&&Data.company.current_user_is_admin_strict()?
+this.$el.find("#unlock_account").show():this.$el.find("#unlock_account").hide()),this.model.id!==Data.user_id&&this.$el.attr("title",loc("Go to the conversation with [_person_name]",{person_name:this.model.abbreviation()})),this.delegateEvents())},on_change:function(a){this.animating||this.render(a)},select_person:function(){"people"==Data.state.get("current_plugin")&&(this.$el.hasClass("selected")?this.$el.removeClass("selected"):this.$el.addClass("selected"))},click_person:function(a){if("tour"===
+Data.state.get("current_plugin")||this.model.id===Data.user.id)return!0;a=[this.model.id];var b=this;b.clear_errors();this.$el.removeClass("flip");Data.create_group(a,{success:function(a){Data.save_state({current_plugin:"chat",current_group_id:a.id});b.$el.find("person.selected").removeClass("selected")},error:function(a,d){b.handle_error(b.$el,d,b.cid,{preamble:loc("The conversation could not be started.")});a&&a.destroy()}});return!1},view_profile:function(){this.$el.removeClass("flip");Data.save_state({current_plugin:"person",
+current_person_id:this.model.id});this.$el.trigger("view_profile");return!1},delete_person:function(){Delete_Person(this)},click_amazon_ses_suppressed:function(){Show_Undeliverable(this.model.get("email"));return!1},reinvite_person:function(){var a=this,b=this.$el.find("#reinvite_person");Client.request("/api/reinvite_user/"+this.model.id,{method:"put"},_.bind(function(c){if(c.body)if(c.body.error){var d=c.body.error.validation?null:{preamble:loc("Could not send re-invite email.")};this.handle_error(b,
+c.body.error,this.cid,d)}else ec_confirm({subject:loc("Invitation Sent"),body:loc("Invitation successfully sent to [_email].",{email:"<strong>"+a.model.get("email")+"</strong>"}),buttons:[{label:"OK"}]});else this.handle_error(b,Errors.Invalid_Server_Response(),a.cid,{preamble:loc("Could not send re-invite email.")})},this));return!1},unlock_account:function(){ec_confirm({subject:loc("Unlock Account"),body:loc("[_email] has been locked out due to numerous failed login attempts. Do you want to unlock this account?",
+{email:this.model.get("email")}),buttons:[{label:"OK",action:_.bind(this.confirm_unlock_account,this)},{label:"Cancel"}]});return!1},confirm_unlock_account:function(){var a=this,b=this.$el.find("#unlock_account");Client.request("/api/unlock_account/"+this.model.id,{method:"put"},_.bind(function(c){if(!c.body)this.handle_error(b,Errors.Invalid_Server_Response(),a.cid,{preamble:loc("Could not unlock this account.")});else if(c.body.error){var d=c.body.error.validation?null:{preamble:loc("Could not unlock this account.")};
+this.handle_error(b,c.body.error,this.cid,d)}},this));return!1}}),Person_View=EC_View.extend({id:"profile-page",events:{"click button.upload_headshot":"handle_headshot","click button.change_password":"change_password",keydown:"keydown","blur #person_form":"blur","focus #person_form":"focus"},initialize:function(){var a=Data.state.get("current_person_id");this.model=Data.people.get(a);this.template=JST["named/person.jst"];Data.state.on("change:current_person_id",this.change_person,this);Data.teams.on("change:is_archived",
+this.render,this);Data.teams.on("add",this.render,this);Data.teams.on("change:set_abbreviation",this.render,this);this.model.on("change",this.on_change,this)},blur:function(a){this.clear_errors();Client.has_connected?(this.leaving_target=$(a.target),this.save_person(this.leaving_target)):this.in_disconnect||(this.in_disconnect=!0,this.leaving_target=$(a.target),Client.once("reconnected",_.bind(function(){this.leaving_target.focus();this.in_disconnect=!1},this)))},focus:function(a){if("email"===$(a.target).attr("id")&&
+Data.user.externally_registered_needs_password()){$(a.target).blur();a=this.view("Set_Password_View",{},null,!0);a.render();var b=ec_confirm({subject:loc("Changing your email address will require you to sign in with a password going forward."),buttons:[],wrapper_class:"set-password-block",perform_after:function(){$(".ec_error").fadeOut()},remove_other_modals:!0,body_view:"Body_View"});a.on_finish=function(){b.fade()};b.find(".confirmbody").append(a.$el);return!1}this.current_tab_index=parseInt($(a.target).attr("tabindex"),
+10)},change:function(a){void 0!=$(a.target).attr("data-advanceable")&&this.advance(a)},on_change:function(a){this.render_header();this.saving||this.render()},advance:function(a){this.advance_from_target($(a.target))},advance_from_target:function(a,b){var c=parseInt(a.attr("tabindex"),10),d=this.$el.find("[data-tabbable]").length;b?(c-=1,0==c&&(c=d-1)):c=c%d+1;this.$el.find("[tabindex="+c+"]").focus()},change_person:function(){if("person"==Data.state.get("current_plugin")){var a=Data.state.get("current_person_id");
+this.model&&this.model.off("change",this.on_change,this);this.model=Data.people.get(a);this.model.on("change",this.on_change,this);this.render()}},render:function(a){this.model&&(this.$el.html(this.template({model:this.model})),this.headshot_view=this.view("Headshot_View",{model:this.model},this.model.cid),this.headshot_view.dont_show_card=!0,this.headshot_view.size="100x100",this.$el.find("heads").append(this.headshot_view.$el),this.headshot_view.render(),this.headshot_view.cant_upload_headshot()&&
+this.$el.find("button.upload_headshot").remove(),this.populate_fields(),this.model.id!==Data.user.id&&(this.$("button.change_password").remove(),this.$el.find("input").attr({placeholder:"",disabled:!0}),this.$el.find("input, select").each(function(){$(this).replaceWith($("<value />").text(" "+$(this).val()).attr("id",$(this).attr("id")))})),_.delay(_.bind(function(){this.$el.find("input").trigger("grow")},this),50),(this.current_tab_index=this.current_tab_index||1)&&this.$el.find("[tabindex="+this.current_tab_index+
+"]").focus())},render_header:function(){this.$el.find("h1 .abbreviation").text(this.model.abbreviation())},populate_fields:function(){var a=this.model.id,b=Data.teams.filter(function(b){return b.is_member(a)&&!b.get("is_archived")}).map(function(a){return a.abbreviation()}).join(", "),c={comfortZone:2},d=this.model.get("company_id")!=Data.company.id,e=this.model.get("is_webmail");this.$el.find("#teams").text(b);this.model.is_kip_clone()?this.$el.find("#domain").text("@glip.com"):this.$el.find("#domain").text(d||
+e?"":"@"+this.model.domain());this.$el.find("#first_name").val(this.model.get("first_name")).autoGrowInput(c).trigger("grow");this.$el.find("#last_name").val(this.model.get("last_name")).autoGrowInput(c).trigger("grow");this.model.is_kip_clone()?this.$el.find("#email").val("kip").autoGrowInput(c).trigger("grow"):this.$el.find("#email").val(d||e?this.model.email_for_display():this.model.short_email()).autoGrowInput(c).trigger("grow");this.$el.find("#job_title").val(this.model.get("job_title"));this.$el.find("#homepage").val(this.model.get("homepage"));
+this.$el.find("#location").val(this.model.get("location"));this.$el.find("#gender").val(this.model.get("gender"));var f=this;this.$el.find("#birthday").val(this.model.get("birthday")).datepicker({dateFormat:"MM d",changeYear:!1,appendTo:this.$el,beforeShow:function(a,b){b.dpDiv.addClass("no-year")},onSelect:function(){$(this).change();f.save_person($(this));f.advance_from_target($(this))},onClose:function(a,b){b.dpDiv.removeClass("no-year")}});this.$el.find("#employee_since").val(this.model.get("employee_since")).datepicker({dateFormat:"m/d/y",
+acceptedDateFormats:["m/d/y","m/d/yy"],appendTo:this.$el,onSelect:function(){$(this).change();f.save_person($(this));f.advance_from_target($(this))}})},end_edit:function(){},handle_headshot:function(a){a.preventDefault();this.headshot_view.file_select()},change_password:function(a){a=Client.view_singleton("Set_Password_View");a.render();this.append_view(a);return!1},save_person:function(a){if(this.model.id==Data.user.id&&!this.saving){var b=this;if(this.in_DOM()){b.clear_errors();var c=a.attr("name"),
+d=this.$el.find("[name=email]"),e=$("#person_form").serializeObject(this);if(e.errors)$("#person_form").mark_errors(e.errors,this.cid);else{var f=this.model.get("company_id")!=Data.company.id,g=this.model.get("is_webmail"),h=f||g?this.model.get("email"):this.model.short_email();if(e.email!=h)d.val(h),h=this.model.domain(e.email),f||g||Data.is_unique_abbreviation(e.email,{company_team_ok:!0,domain:h})?(f=f||g?e.email:e.email+"@"+Data.user.domain(),ec_confirm({subject:"Email Change Request",body:"Please check your INBOX to confirm your new email address.<br><br>Once you confirm it, your address will update on Glip.",
+buttons:[{label:"OK"}]}),Client.request("/api/confirm_email",{parameters:{email:f,user_id:Data.user.id},method:"post"},_.bind(function(a){if(!a.body)this.handle_error(d,Errors.Invalid_Server_Response(),this.cid,{preamble:loc("Could not send confirmation email.")});else if(a.body.error){var b=a.body.error.validation?null:{preamble:loc("Could not send confirmation email.")};this.handle_error(d,a.body.error,this.cid,b)}},this))):setTimeout(function(){d.focus();$(".ui-datepicker").hide();b.handle_error(a,
+Errors.Duplicate_Email(e.email+"@"+_.escape(Data.cuser.domain())),b.cid)},0);else if("email"!=a.attr("name")&&a.val()!=this.model.get(a.attr("name"))){var k=a.val(),l=this.model,s={first_name:e.first_name,last_name:e.last_name,homepage:e.homepage,location:e.location,birthday:e.birthday,gender:e.gender,job_title:e.job_title,employee_since:e.employee_since};_.find(_.keys(s),function(a){return s[a]!=l.get(a)&&!(!l.get(a)&&!s[a])})&&(this.saving=!0,Data.change_object(l,s,{success:function(a){b.saving=
+!1},error:function(d,e){a=b.$el.find("[name="+c+"]");setTimeout(function(){b.handle_error(a,e,b.cid,{preamble:loc("This person could not be changed."),no_error_class:!0})},0);a.val(k);a.focus();b.saving=!1}}))}}return!1}}},keydown:function(a){var b=a.keyCode?a.keyCode:a.which,c=$("*:focus");if(13==b)return!1;if(9==b)return this.advance_from_target(c,a.shiftKey),!1}}),Delete_Person=function(a,b){b||(b=a.model);ec_confirm({subject:b.is_hosted()?loc("Remove Guest"):loc("Remove Person"),body:b.is_hosted()?
+loc("Are you sure you want to remove <b>[_name]</b>?",{name:_.escape(b.abbreviation())}):loc("Are you sure you want to remove <b>[_name]</b> from Glip?",{name:_.escape(b.abbreviation())}),buttons:[{label:"OK",action:function(){var c=function(b,c){a.handle_error(a.$el,c,a.cid,{preamble:b.is_hosted()?loc("This person could not be removed as a guest."):loc("This person could not be removed.")})};b.is_hosted()?Data.remove_guest(b,{error:c}):Data.deactivate_object(b,{error:c})}},{label:"Cancel",post_action:"denied"}]});
+return!1},Undeliverable_Message=function(a){return loc("We are not able to deliver email to [_email]. If this address is incorrect, remove it from the People page. Otherwise, please [_link]contact customer support.</a>",{email:"<strong>"+a+"</strong>",link:'<a target=_blank rel="noreferrer" href="https://glip.zendesk.com/hc/en-us/requests/new">'})},Show_Undeliverable=function(a){ec_confirm({subject:loc("Email undeliverable"),body:Undeliverable_Message(a),buttons:[{label:"OK"}]})},Person_Next_Step_View=
+EC_Model_View.extend({className:"person-next-step",initialize:function(){EC_Model_View.prototype.initialize.call(this);this.template=JST["named/person_next_step.jst"]},render:function(){var a;this.model.get("has_registered")?this.model.get("headshot")?this.model.get("first_name")||(a=loc("Ask [_name] to update their name on their profile.",{name:this.model.abbreviation()})):a=Data.company.id===this.model.get("company_id")?loc("[_name] has registered, but not yet added a headshot. You can add one for them, or ask [_name] to do it by dragging a photo onto their headshot circle.",
+{name:_.escape(this.model.abbreviation())}):loc("[_name] has registered, but not yet added a headshot. Ask [_name] to add one by dragging a photo onto their headshot circle.",{name:_.escape(this.model.abbreviation())}):a=loc("Ask [_name] to check their email for an invitation to Glip. While we wait for them to register, anything you share here, including tasks, events and files, will be forwarded by email so you can get started right away.",{name:_.escape(this.model.abbreviation())});this.$el.html(a)}}),
+Plugin_List_View=EC_View.extend({initialize:function(){Data.plugins.on("add",this.add_plugin,this);Data.plugins.on("remove",this.remove_plugin,this)},render:function(){},plugin_tab:function(a){return this.view("Plugin_Tab_View",{model:a},a.cid)}}),Plugin_Tab_View=EC_View.extend({events:{"click label":"select_tab","click .folder-settings":Folder_Menu},tagName:"div",className:"plugintab section",initialize:function(){_.bindAll(this,"handle_append");this.model.on("change",this.render,this);if(this.model&&
+"account"===this.model.get("name"))Data.user.on("change:first_name change:last_name change:display_name",this.change_name,this);Data.state.on("change:current_plugin",this.change_state,this);Data.state.on("change:plugin_active:"+this.model.get("name"),this.render,this);Data.profile.on("change:feature_add_plugin",this.render,this);this.template=JST["named/plugin_tab.jst"];this.added_accordion_listener={}},render:function(){var a=this.model,b=a.get("name");a.get("no_left_rail")?this.$el.hide():this.$el.show();
+a.get("float")&&this.$el.css("float",a.get("float"));this.$el.html(this.template({model:a,new_items:this.new_items}));this.$el.attr("name",b);this.$el.attr("id","plugin-"+b);"account"===b&&this.$("label").html($("<span class='ico ico-settings'></span><span class='ico ico-arrow-down-2 plus'></span><span>"+_.escape(Data.user.abbreviation())+"</span>"));this.$(".new").hide()},change_name:function(){"account"===this.model.get("name")?this.$("label").html($("<span class='ico ico-settings'></span><span class='ico ico-arrow-down-2 plus'></span><span>"+
+_.escape(Data.user.abbreviation())+"</span>")):this.$("label").html($("<span class='ico ico-settings'></span><span>"+_.escape(Data.user.abbreviation())+"</span>"))},handle_append:function(){this.change_state()},change_state:function(a){if(this.is_active()){this.$el.addClass("selected");var b=this.model,c=b.get("name");if("show"===a)this.$(".accordion").show();else{var d=$(".leftrail");this.$(".accordion").slideDown({duration:500,progress:function(){if("chat"!=c&&"account"!=c&&"account"!=b.get("parent_plugin")){var a=
+$(this),f=a.height(),g=d.scrollTop(),a=a.offset().top+g,h=d.height();h+g<a+f+10&&d.scrollTop(f>h?a+10:a+f+10-h)}}})}}else this.$el.removeClass("selected"),this.$(".accordion").slideUp(500)},check_accordion:function(){var a=this.model.get("name");Data[a].off("add",this.check_accordion,this);this.change_state()},is_active:function(){var a=this.model.get("name"),b=Data.state.get("current_plugin"),c=Data.plugins_by_name[b];return a===b?!0:"chat"!==a||"people"!==b&&"teams"!==b&&"groups"!==b&&"tour"!==
+b&&"favorites"!==b?"chat"===a?!0:"account"===a&&("account_settings"===b||"person"===b&&Data.state.get("current_person_id")==Data.user.id||c&&"account"===c.get("parent_plugin")||"referral"===b)?!0:!1:!0},show_plugin:function(){var a=this.model.get("name");if(Data[a]){Data[a].off("add",this.show_plugin);this.$el.fadeIn();var b=this.model.get("tab_label"),c=this.model.get("item_label_plural")||a,b="<b>Congratulations!</b><br><br>You have unlocked the "+b+" App, which you can use to view and manage all of the "+
+c.toLowerCase()+" in your company, across all conversations.";this.$el.width();Hint(b,this.$el,{id:"help_"+a,top:35,right:43,arrow:"wn"})}},select_tab:function(a){var b=this.model.get("name");"tour"===Data.state.get("current_plugin")||"chat"===b&&$(a.target).closest(".people, .teams, .groups, .favorites").length||((b=this.model.get("select_function"))&&_.isFunction(window[b])?(b=this.view(b),$("body").clear_errors(),$("body").append(b.$el),b.render(a),b.$el.show(),a.stopImmediatePropagation()):Data.save_state({current_plugin:this.model.get("name")}))}}),
+Plugin_Card_View=EC_View.extend({events:{"click input":"add_plugin"},initialize:function(){this.template=JST["named/plugin_card.jst"]},render:function(){$(this.el).html(this.template())},add_plugin:function(){$("#plugin_button_bug").fadeOut();$("plugintab[name=bugs]").fadeIn();$(".rightrail").html("")}}),Plugin_Header=function(a,b,c){var d="<b>",e="";b=Data.get_profile_value(b);_.isArray(b)?("Posted by"==b[0]&&(e=" posted by "+_.escape(b[2])),"Team"==b[0]&&(e=" in "+_.escape(b[2])),"Folder"==b[0]&&
+(e=" in "+_.escape(b[2])),"Person"==b[0]&&(e=" from "+_.escape(b[2])),"Group"==b[0]&&(e=" from "+_.escape(b[2])),"Assigned to"==b[0]&&(e=" assigned to "+_.escape(b[2]))):d="mine"==b?d+"My ":d+"All ";c&&(d+=c);d=_.isArray(b)?d+(a+"</b>"):d+("</b>"+a);return d+e},Post_Menu_View=EC_View.extend({initialize:function(){_.bindAll(this)},render:function(a){var b=Data.get_profile_value("favorite_post_ids");$.inArray(this.model.id,b);this.model.is_liked_by(Data.user_id);Data.get_profile_value("post_show_authors");
+Data.get_profile_value("post_show_timestamps");var b=!this.model.mine(),c=Data.company.current_user_is_admin_strict(),d=Data.groups.get(this.model.get("group_id")),e=c&&d.get("company_id")===Data.user.get("company_id"),f=this.model.get("activity_data")?!0:!1;this.original_event=a;var g=b||this.model.get("parent_id")||f,d=Data.groups.get(this.model.get("group_id")),d=b&&!e;1<$(".postslist > .post.selected").length&&(g=!0);menu=[['<span class="ico ico-move"></span> Move To...',this.move,{disabled:g}]];
+var g=this.model.get("item_ids").reverse()||[],h=g.length;_.each(g,_.bind(function(a,b){var d=Data.objects.get(a);if(d){var e=d.get_plugin();if(e){var f=e.get("is_integration")?"Post":e.get("item_label"),g=e.has("edit_label")?e.get("edit_label"):f;if(1<h){var u=b+1;d.get("name")?u=d.get("name"):d.get("title")&&(u=d.get("title"));f=f+" ("+u+")";g=g+" ("+u+")"}e.get("suppress_view_details")||menu.push(["-"],['<span class="ico ico-info"></span> View Details',this.view_details,{argument:d}]);e.get("edit_function")&&
+window[e.get("edit_function")]&&menu.push(['<span class="ico ico-edit"></span> Edit '+g,e.get("edit_function"),{argument:d,no_event_argument:1,disabled:!d.can_edit(),attributes:[["mid",d.id],["type","edit"]]}]);menu.push(['<span class="ico ico-delete"></span> Delete '+f,this.delete_item,{argument:d,disabled:!d.mine(this.model)&&(!c||d.get("company_id")!=Data.user.get("company_id")),attributes:[["mid",d.id],["type","delete"]]}])}}},this));1<h&&menu.push(["-"],['<span class="ico ico-delete"></span> Delete All',
+this.delete_post,{disabled:d}]);g=this.model.get("text")||"";if(0===h||0<g.length)menu.push(["-"],['<span class="ico ico-edit"></span> Edit Post',this.edit_post,{disabled:b||f}]),0===h&&menu.push(['<span class="ico ico-delete"></span> Delete Post',this.delete_post,{disabled:d}]);Menu(menu,{align:"right",menuClass:1<h?"post_menu scrollable":"post_menu",mark_active:this.options.parent_view.$el,allow_html:!0}).render(a)},mark_favorite:function(){var a=Data.get_profile_value("favorite_post_ids");-1<$.inArray(this.model.id,
+a)?(a=_.without(a,this.model.id),"account"===Data.state.get("current_plugin")&&Analytics.dashboard_unfavorite()):a.unshift(this.model.id);Data.set_profile_value("favorite_post_ids",a);Data.profile.trigger("change:favorite_post_ids",a);Data.save_profile()},mark_like:function(){Like_Post(this.model)},create_task:function(){this.options.parent_view.options.parent_view.options.parent_view.compose_view.create_task(this.model.get("text"))},edit_post:function(a){this.model.trigger("edit_post")},delete_post:function(){if(!this.check_locked()){var a;
+a=(a=this.model.get("item_ids"))&&1<a.length?loc("Are you sure you want to delete this post and all attached items?"):loc("Are you sure you want to delete this post?");var b=this;ec_confirm({subject:loc("Delete Post?"),body:a,buttons:[{label:"OK",action:function(){Data.deactivate_object(b.model,{error:function(a,d){b.handle_error(b.options.target||$("#post_menu"),d,b.cid,{preamble:loc("Your post could not be deleted.")})}})}},{label:"Cancel",post_action:"denied"}]})}},delete_item:function(a,b,c){if(!this.check_locked())if((a=
+b.plugin)&&a.get("delete_from_post_method"))b[a.get("delete_from_post_method")](this.model,c);else{var d=this;a=function(){Data.deactivate_object(b,{error:function(a,b){d.handle_error(d.options.target||$("#post_menu"),b,d.cid,{preamble:loc("Your post could not be deleted.")})}})};if(c)return a();ec_confirm({subject:loc("Delete Item?"),body:loc("Are you sure you want to delete this item?"),buttons:[{label:"OK",action:a},{label:"Cancel",post_action:"denied"}]})}},share_multiple:function(a){Select_Group_Menu(a,
 this.share_to_group_multiple,loc("Sharing will create a new post in another conversation that will contain this post."),$(a.target))},move_multiple:function(){},move:function(a){Select_Group_Menu(a,this.move_to_group,loc("Moving a post to another conversation will remove it from this conversation, and add it in the conversation you select."),$(this.original_event.target))},move_to_group:function(a,b){if(!this.check_locked()){var c=this;Data.move_post(c.model,b,{error:function(a){c.handle_error(c.options.target||
 $("#post_menu"),a,c.cid,{preamble:loc("Your post could not be moved.")})},success:function(){}})}},share:function(a){Select_Group_Menu(a,this.share_to_group,loc("Sharing will create a new post in another conversation that will contain this post."),$(this.original_event.target))},share_to_group_multiple:function(a,b){var c=[];$(".postslist > .post.selected").each(function(){c.push(parseInt($(this).attr("mid"),10))});this._share_to_group(a,b,c,this.model.get("group_id"))},share_to_group:function(a,
 b){this._share_to_group(a,b,[this.model.id],this.model.get("group_id"))},_share_to_group:function(a,b,c,d){Data.create_post({group_id:b.id,post_ids:c,from_group_id:d},{error:_.bind(function(a,b){this.handle_error(this.options.target||$("#add_to_group_menu"),b,this.cid,{preamble:loc("Your item could not be shared.")})},this),success:_.bind(function(a){a.connect(_.bind(function(){a.trigger("change:items")},this))},this)});$(".post.selected").removeClass("selected")},view_details:function(a,b){return Item_View_Omni(b,
@@ -977,17 +977,17 @@ handle_new_import_item:function(a){this.render_inprogress_imports()},handle_stat
 events:{click:"click_import_item"},initialize:function(){this.template=JST["plugins/import_items/import-item-row.jst"];_.bindAll(this)},render:function(){this.$el.html(this.template({model:this.model}));this.$el.attr("sort",this.model.item_label)},click_import_item:function(a){$("body").clear_errors();a=this.model.get("first_time_setup_view");window[a]&&(this.$(".model_row").hasClass("active")?this.options.parent_view.deactivate_all():(a=this.view(a,{model:this.model}),a.render(),this.append_view(a,
 {target:this.$(".details").hide()}),this.options.parent_view.deactivate_all(),this.$(".details").slideDown(),this.$(".model_row").addClass("active"),$(".content").scrollTo(this.$(".model_row"),{duration:0})))}}),Import_Item_Setup_View=EC_View.extend({events:{"click .choose-file":"choose_file"},initialize:function(){this.template=JST["plugins/import_items/add-import.jst"];_.bindAll(this)},render:function(){this.$el.html(this.template({model:this.model}));this.$(".progress").hide()},choose_file:function(a){Client.can_XHR_upload()?
 (a=$("<input type=file />"),a.on("change",this.handle_file),a.trigger("click")):(this.$(".choose-file").hide(),Client.ie_upload_form({subject:loc("Upload Import File"),single:!0},this.file_complete));return!1},handle_file:function(a){a=a&&a.target&&a.target.files?a.target.files[0]:{};var b=this.$(".add-import-form");b.clear_errors();a&&a.name&&a.name.match(/\.zip$/i)?(this.$(".choose-file").hide(),this.initialize_file_progress(a),this.file=a,Client.upload_file(a,this.file_progress,this.file_complete)):
-b.mark_errors([{selector:".choose-file",error:{message:"Invalid File"}}],this)},initialize_file_progress:function(a){var b=this.$(".progress");b.html(a.name);b.attr("original_style",b.attr("style")||" ");b.show();b.css("box-shadow","inset 0px 0px 7px #0000cc")},file_progress:function(a){a.lengthComputable&&(a=Math.ceil((a.position||a.loaded)/(a.totalSize||a.total)*100),Client.show_progress(this.$(".progress"),a))},file_complete:function(a,b){var c=this.$(".progress");c.attr("style",c.attr("original_style"));
+b.mark_errors([{selector:".choose-file",error:{message:"Invalid File"}}],this)},initialize_file_progress:function(a){var b=this.$(".progress");b.html(_.escape(a.name));b.attr("original_style",b.attr("style")||" ");b.show();b.css("box-shadow","inset 0px 0px 7px #0000cc")},file_progress:function(a){a.lengthComputable&&(a=Math.ceil((a.position||a.loaded)/(a.totalSize||a.total)*100),Client.show_progress(this.$(".progress"),a))},file_complete:function(a,b){var c=this.$(".progress");c.attr("style",c.attr("original_style"));
 Client.hide_progress(c);if(a)return this.handle_error(this.$el,a,".choose-file",{no_error_class:!0,preamble:loc("The file could not be uploaded.")}),console.warn("Failed to upload:",a);var c=b[0],d=Data.groups.find(function(a){return a.is_me_group()});d?(c={group_id:d.id,no_post:!0,status:"submitted",file_id:c._id,source_file_uri:c.download_url,size:c.size,type:this.model.get("name")},Data.create_item("import_items",c,{no_post:!0})):console.warn("NO ME GROUP")}}),Existing_Import_Row_View=EC_View.extend({className:"integration import_item",
 events:{click:"show_setup","click .ico-settings":"show_menu"},initialize:function(){_.bindAll(this);this.plugin=Data.plugins_by_name[this.model.get("type")];this.template=JST["plugins/import_items/existing-import-row.jst"];this.listenTo(this.model,"remove",this.on_remove);this.listenTo(this.model,"change:status",this.update_status)},render:function(){this.$el.html(this.template({model:this.model,plugin:this.plugin}))},show_setup:function(a){a=this.plugin.get("setup_instructions_view");console.warn("SHOWING SETUP FOR",
-a);window[a]&&!this.$(".details").is(":visible")&&(a=this.view(a,{model:this.model}),a.render(),this.append_view(a,{target:this.$(".details").hide()}),this.options.parent_view.deactivate_all(),this.$(".details").slideDown(),this.$(".model_row").addClass("active"))},show_menu:function(a){},on_remove:function(a){},update_status:function(a){this.$(".integration-status").html(a.status_pretty[a.get("status")])}}),Import_Setup_Instructions_View=EC_View.extend({className:"import_setup_instructions",events:{"submit form":"submit_form"},
-templates:{submitted:"plugins/import_items/submitted.jst",processing:"plugins/import_items/processing.jst",waiting_for_user:"plugins/import_items/waiting-for-user.jst",updated_by_user:"plugins/import_items/submitted.jst",finishing:"plugins/import_items/processing.jst",error:"plugins/import_items/setup-error.jst",complete:"plugins/import_items/complete.jst"},initialize:function(){this.listenTo(this.model,"change:status",this.render);this.user_map_options="<option value='new_user'>New User</option><option value='do_not_import'>Do not import</option>"+
+a);window[a]&&!this.$(".details").is(":visible")&&(a=this.view(a,{model:this.model}),a.render(),this.append_view(a,{target:this.$(".details").hide()}),this.options.parent_view.deactivate_all(),this.$(".details").slideDown(),this.$(".model_row").addClass("active"))},show_menu:function(a){},on_remove:function(a){},update_status:function(a){this.$(".integration-status").html(_.escape(a.status_pretty[a.get("status")]))}}),Import_Setup_Instructions_View=EC_View.extend({className:"import_setup_instructions",
+events:{"submit form":"submit_form"},templates:{submitted:"plugins/import_items/submitted.jst",processing:"plugins/import_items/processing.jst",waiting_for_user:"plugins/import_items/waiting-for-user.jst",updated_by_user:"plugins/import_items/submitted.jst",finishing:"plugins/import_items/processing.jst",error:"plugins/import_items/setup-error.jst",complete:"plugins/import_items/complete.jst"},initialize:function(){this.listenTo(this.model,"change:status",this.render);this.user_map_options="<option value='new_user'>New User</option><option value='do_not_import'>Do not import</option>"+
 Data.people.filter(function(a){return!a.get("deactivated")&&!a.get("kip_for_company_id")}).map(function(a){return"<option value='"+a.id+"'>"+a.get("display_name")+" ("+a.get("email")+")</option>"}).join("");_.bindAll(this)},render:function(a){this.$el.empty();this.$el.html(JST[this.templates[this.model.get("status")]]({view:this}));this.render_users();this.render_channels()},channels:function(){},users:function(){},render_users:function(){var a=this.users()||[];if(0===a.length)this.$("#import_users").hide();
 else{var b=this;_.each(a,function(a){a=b.view(b.import_user_row_def,{model:a},b.foreign_user_id(a));a.user_map_options=b.user_map_options;a.render();b.append_view(a,{target:b.$("#import_users_list")})})}},render_channels:function(){var a=this.channels();if(0===a.length)this.$("#import_channels").hide();else{var b=this;_.each(a,function(a){a=b.view(b.import_channel_row_def,{model:a},b.foreign_channel_id(a));a.render();b.append_view(a,{target:b.$("#import_channels_list")})})}},submit_form:function(a){a.stopPropagation();
 a.stopImmediatePropagation();a=this.$("form").serializeObject();var b=this;Data.change_object(this.model,{user_prefs:a,status:"updated_by_user"},{error:function(a,d){console.warn("ERROR SAVING",d);b.handle_error(b.$("input[type=submit]"),d,b.cid,{no_error_class:!0})},success:function(a){console.warn("Saved")}});return!1},foreign_user_id:function(a){return a.id},foreign_channel_id:function(a){return a.id}}),User_Import_Row=EC_View.extend({className:"inputrow",events:{"click .change_link":"remove_match",
 "change .users_selector":"change_user"},initialize:function(){var a=Data.people.where({email:this.email()});0<a.length&&(this.match=a[0]);this.template=JST["plugins/import_items/waiting-for-user-user-row.jst"]},user_id:function(){return this.model.id},email:function(){return this.model.email},name:function(){return this.model.name},render:function(){this.$el.empty();this.$el.html(this.template({view:this,match:this.match,user_map_options:this.user_map_options}));this.show_match()},show_match:function(){if(this.match){var a=
-this.view("Headshot_View",{model:this.match});this.$(".heads").append(a.$el);this.$(".match_description").html(this.match.get("display_name"));a.render();a.delegateEvents()}},remove_match:function(){delete this.match;this.render()},change_user:function(a){a=this.$(".users_selector option:selected").val();"new_user"!==a&&"do_not_import"!==a&&(this.match=Data.people.get(a),this.render())}}),Channel_Import_Row=EC_View.extend({className:"inputrow",events:{},initialize:function(){this.template=JST["plugins/import_items/waiting-for-user-channel-row.jst"]},
-render:function(){this.$el.empty();this.$el.html(this.template({view:this}));this.$(".channel_name").val(this.model.name)},channel_name:function(){return this.model.name}}),Integration_Item=Item.extend({urlRoot:"/integration_item"});Integration_Item.prototype.activity=function(){return this.get("activity")};Integration_Item.prototype.title=function(){return this.get("title")};Integration_Item.prototype.body=function(){return this.get("body")};
+this.view("Headshot_View",{model:this.match});this.$(".heads").append(a.$el);this.$(".match_description").html(_.escape(this.match.get("display_name")));a.render();a.delegateEvents()}},remove_match:function(){delete this.match;this.render()},change_user:function(a){a=this.$(".users_selector option:selected").val();"new_user"!==a&&"do_not_import"!==a&&(this.match=Data.people.get(a),this.render())}}),Channel_Import_Row=EC_View.extend({className:"inputrow",events:{},initialize:function(){this.template=
+JST["plugins/import_items/waiting-for-user-channel-row.jst"]},render:function(){this.$el.empty();this.$el.html(this.template({view:this}));this.$(".channel_name").val(this.model.name)},channel_name:function(){return this.model.name}}),Integration_Item=Item.extend({urlRoot:"/integration_item"});Integration_Item.prototype.activity=function(){return this.get("activity")};Integration_Item.prototype.title=function(){return this.get("title")};Integration_Item.prototype.body=function(){return this.get("body")};
 Integration_Item.prototype.bare_activity=function(){return Remove_Markdown(this.activity()||"")};Integration_Item.prototype.bare_title=function(){return Remove_Markdown(this.title()||"")};Integration_Item.prototype.bare_body=function(){return Remove_Markdown(this.body()||"")};Integration_Item.prototype.match_fields=Item.prototype.match_fields.concat([{name:"title",index_for_at_mention:!0},"activity","body"]);Integration_Item.prototype.get_at_mention_text=function(){return _.unescape(Remove_Markdown(this.get("title")))};
 Integration_Item.prototype.notification_text=function(){return this.get_at_mention_text()};Integration_Item.prototype.title_for_display=function(a){return Markdown(this.searchable_field_for_display(a,"title"))};Integration_Item.prototype.body_for_display=function(a){return Markdown(this.searchable_field_for_display(a,"body"))};
 Integration_Item.prototype.attribute_validations=_.extend({},Item.prototype.attribute_validations,{icon:{validate:Integration_Item.prototype.validate_url,null_ok:!0},email:{validate:Integration_Item.prototype.validate_email,null_ok:!0},link:null,name:{validate:Integration_Item.prototype.validate_long_string,null_ok:!0},title:{validate:Integration_Item.prototype.validate_long_string},body:null,payload:null,integration_owner_id:null,activity:null,integration_id:null});
@@ -1045,8 +1045,8 @@ this.options.parent_view.select_compose_type("chat","select")}return!1}}),Asana_
 Asana_Instructions_View=Integration_Setup_View.extend({events:_.extend({"change select[name=workspaces]":"change_workspace","click input[type=checkbox]":"toggle_box"},Integration_Setup_View.prototype.events),render:function(){Integration_Setup_View.prototype.render.call(this);this.change_workspace()},save_settings:function(a){a&&a.preventDefault&&a.preventDefault();a=this.$('[name="workspaces"]').val()||this.model.get("settings").workspace;var b=_.map(this.$('[type="checkbox"]:checked'),function(a){return $(a).val()}),
 c=this;Data.change_object(this.model,{settings:{workspace:a,events:b}},{success:function(a){c.options.parent_view.hide_setup()}});return!1},toggle_box:function(a){a=$(a.target);var b=a.attr("checktype");"workspace"===b&&a.prop("checked")?this.$("input[checktype=project]").prop("checked",!1):"project"===b&&a.prop("checked")&&this.$("input[checktype=workspace]").prop("checked",!1)},change_workspace:function(){this.$(".section_holder").hide();console.warn(this.$("select[name=workspaces]").val());this.$("#holder-"+
 this.$("select[name=workspaces]").val()).show()},projects_by_workspace:function(){var a=this.model.get("config"),b=a.projects;return a.workspaces.data.map(function(a){a.projects=b[a.id];return a})}});var Bitbucket_Item=Integration_Item.extend({}),Bitbucket_Items=Integration_Items.extend({url:"/bitbucket_items",type_id:Type_IDs.TYPE_ID_BITBUCKET_ITEM,model:Bitbucket_Item,model_name:"Bitbucket_Item"});
-Bitbucket_Instructions_View=Integration_Setup_View.extend({can_setup:function(){var a=this.model.get("config");if(!a)return!1;var b=a.repos;if(b&&b.length)return!0;b="No repos found";a.user&&a.user.user&&a.user.user.display_name&&(b+=" for user: <b>"+a.user.user.display_name+"</b>");this.$(".error").html(b);this.$(".error").show();return!1},save_settings:function(a){a&&a.preventDefault&&a.preventDefault();var b=this;a=this.$('[name="repository"]').val()||this.model.get("settings").repo;Data.change_object(this.model,
-{settings:{repo:a}},{success:function(a){b.options.parent_view.hide_setup()}});return!1}});var Show_Chat_Compose=function(a){if(_.isUndefined(a)||!_.isFunction(a.$))a=window;a.$("#compose_forms form").hide();a.$("#compose_chat").show();a.$("#compose_chat_input").focus();a.$(".postslist").trigger("resize")};
+Bitbucket_Instructions_View=Integration_Setup_View.extend({can_setup:function(){var a=this.model.get("config");if(!a)return!1;var b=a.repos;if(b&&b.length)return!0;b="No repos found";a.user&&a.user.user&&a.user.user.display_name&&(b+=" for user: <b>"+_.escape(a.user.user.display_name)+"</b>");this.$(".error").html(b);this.$(".error").show();return!1},save_settings:function(a){a&&a.preventDefault&&a.preventDefault();var b=this;a=this.$('[name="repository"]').val()||this.model.get("settings").repo;
+Data.change_object(this.model,{settings:{repo:a}},{success:function(a){b.options.parent_view.hide_setup()}});return!1}});var Show_Chat_Compose=function(a){if(_.isUndefined(a)||!_.isFunction(a.$))a=window;a.$("#compose_forms form").hide();a.$("#compose_chat").show();a.$("#compose_chat_input").focus();a.$(".postslist").trigger("resize")};
 (function(a){if("object"==typeof exports&&"object"==typeof module)module.exports=a();else{if("function"==typeof define&&define.amd)return define([],a);this.CodeMirror=a()}})(function(){function a(c,d){if(!(this instanceof a))return new a(c,d);this.options=d=d||{};Ac(nf,d,!1);v(d);var xa=d.value;"string"==typeof xa&&(xa=new Ra(xa,d.mode));this.doc=xa;var e=this.display=new b(c,xa);e.wrapper.CodeMirror=this;l(this);h(this);d.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap");d.autofocus&&
 !Ed&&R(this);this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,cutIncoming:!1,draggingText:!1,highlight:new Fd};Z&&11>la&&setTimeout(hb(ha,this,!0),20);Ya(this);ne||(of(),ne=!0);var qa=this;B(this,function(){qa.curOp.forceUpdate=!0;oe(qa,xa);d.autofocus&&!Ed||xb()==e.input?setTimeout(hb(Gd,qa),20):ib(qa);for(var a in kc)if(kc.hasOwnProperty(a))kc[a](qa,d[a],pe);C(qa);for(a=0;a<Hd.length;++a)Hd[a](qa)})}function b(a,b){var c=this.input=I("textarea",
 null,null,"position: absolute; padding: 0; width: 1px; height: 1em; outline: none");Ha?c.style.width="1000px":c.setAttribute("wrap","off");Bc&&(c.style.border="1px solid black");c.setAttribute("autocorrect","off");c.setAttribute("autocapitalize","off");c.setAttribute("spellcheck","false");this.inputDiv=I("div",[c],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");this.scrollbarH=I("div",[I("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");this.scrollbarV=
@@ -1570,7 +1570,7 @@ File.prototype.version_number=function(a){for(var b=_.filter(this.get("versions"
 File.prototype.click_handler=function(a){var b=a&&a.show_details,c=a&&a.download_original;if(!b){if("gdrive"==this.get("type"))return this.gdrive_click_handler();if("dropbox"==this.get("type"))return this.dropbox_click_handler();if("box"==this.get("type"))return this.box_click_handler();if("evernote"==this.get("type"))return this.evernote_click_handler()}c?this.download_original(a):this.latest_version()&&this.is_photo()?this.render_details_view(a):b?this.render_omni_view(a):this.download_original(a)};
 File.prototype.download_original=function(a){if(version=this.latest_version())a=version&&version.download_url?this.download_url(version.download_url):this.download_url(),Client.is_desktop_app()?macgap.app.open(a):$("<iframe>",{id:"idown",src:a}).hide().appendTo("body")};File.prototype.render_details_view=function(a){delete a.view;var b=this.details_view({key:this.cid+JSON.stringify(a)});if(b)return a&&_.extend(b,a),b.render(),$("body").append(b.$el),b.delegateEvents(),b};
 File.prototype.details_view=function(a){if(this.is_glip_photo())return Client.view_singleton("Body_View").view("Photo_Viewer",{model:this},a&&a.key?a.key:this.cid,!0)};File.prototype.render_omni_view=function(a){Item_View_Omni(this,a.post,a.view)};File.prototype.get_at_mention_text=function(){return this.get("name")};File.prototype.filename_for_display=function(a){return Markdown_For_Search(this.searchable_field_for_display(a,"filename"))};
-File.prototype.validate_filename=function(a){if(a){var b=a.replace(/^\s+/,"").replace(/.*?\s+$/,"");if(!_.isString(b)||2500<a.length||0===b.length)return Errors.Invalid_Filename()}};File.prototype.notification_text=function(){return this.get("name")};File.prototype.created_at_for_latest_version=function(){var a=this.get("versions");return a?_.max(a.map(function(a){return a.date}))||9999999999999:this.get("created_at")||9999999999999};
+File.prototype.validate_filename=function(a){if(a){var b=a.replace(/^\s+/,"").replace(/.*?\s+$/,"");return _.isString(b)&&0!==b.length?File.prototype.validate_string(a,2500):Errors.Invalid_Filename()}};File.prototype.notification_text=function(){return this.get("name")};File.prototype.created_at_for_latest_version=function(){var a=this.get("versions");return a?_.max(a.map(function(a){return a.date}))||9999999999999:this.get("created_at")||9999999999999};
 File.prototype.attribute_validations=_.extend({},Item.prototype.attribute_validations,{name:{required:!0,validate:File.prototype.validate_filename},type:{validate:File.prototype.validate_long_string,null_ok:!0},last_modified:{validate:File.prototype.validate_positive_integer},versions:{required:!0,validate:File.prototype.validate_file_versions},stored_file_id:{validate:File.prototype.validate_positive_integer},date:{validate:File.prototype.validate_short_string},size:{validate:File.prototype.validate_positive_integer},
 url:{validate:File.prototype.validate_long_string},download_url:{validate:File.prototype.validate_long_string},stored_version:{validate:File.prototype.validate_positive_integer},gdrive_data:null,dropbox_data:null,box_data:null,evernote_data:null,source:null,deactivate_version:null});File.prototype._make_validation_functions(File.prototype);var Files=Items.extend({url:"/file",type_id:Type_IDs.TYPE_ID_FILE,model:File,model_name:"File"});
 Files.prototype.set_comparator=function(a){this.comparator="date"===a?function(a){return-a.get("created_at")}:"name"===a?function(a){return a.get("name").toLowerCase()}:"conversation"===a?function(a){return a.group_abbreviation(Data.user_id).toLowerCase()}:function(b){return b.get(a)}};
@@ -1644,7 +1644,7 @@ ec_confirm({subject:"Upload Progress - "+a.name,body:"<div id='version_upload_pr
 b.trigger("click")):Client.ie_upload_form({subject:loc("Choose File")},this.ie_upload_complete.bind(this))},view_in_tab:function(){Client.is_desktop_app()?macgap.app.open(this.img_src):Client.is_windows_desktop_app()||window.open(this.img_src,"_blank")},delete_item:function(){this.deleting=!0;var a=this;this.model.confirm_delete_version(this.current_version_index(),function(){a.remove_popup();a.deleting=!1},function(){a.deleting=!1})},jump_to_version:function(){this.rendered=!1;this.hide_active_annotation(!0);
 this.remove_markers();this.remove_bindings();this.$image.off("load",this.use_loaded_image_dimensions);delete this.active_annotation;delete this.no_hide;delete this.clicked_annotation_shown;delete this.caller_view;delete this.post;this.skip_remove=this.skip_fade=this.skip_template=!0;this.render();this.$(".actions .ico").show();this.disable_nonapplicable_action_buttons()},add_bindings:function(){$(document).on("keydown",this.handle_keydown)},remove_bindings:function(){$(document).off("keydown",this.handle_keydown)},
 prev_version:function(){var a=this.version_index;this.version_index=this.model.prev_version_index(this.current_version_index());this.version_index!==a&&this.jump_to_version()},next_version:function(){var a=this.version_index;this.version_index=this.model.next_version_index(this.current_version_index());this.version_index!==a&&this.jump_to_version()},handle_keydown:function(a){if(!(this.active_annotation||a&&a.target&&"conversation"===$(a.target).attr("id")))return a=a.keyCode,37===a?this.prev():39===
-a?this.next():38===a?this.prev_version():40===a?this.next_version():27===a&&this.remove_popup(),!1},edit_photo:function(){this.remove_popup();this.edit_item()},update_name:function(){this.$(".info .title").html(this.model.get("name"))},remove_popup:function(a){if(Client.at_mention_popup)return!1;delete Client.popup_compose_view;this.$el.fadeOut(200,this.$el.remove.bind(this.$el));this.rendered=!1;this.hide_active_annotation(!0);this.remove_markers();this.remove_bindings();this.model.off("change:at_mentioning_post_ids",
+a?this.next():38===a?this.prev_version():40===a?this.next_version():27===a&&this.remove_popup(),!1},edit_photo:function(){this.remove_popup();this.edit_item()},update_name:function(){this.$(".info .title").html(_.escape(this.model.get("name")))},remove_popup:function(a){if(Client.at_mention_popup)return!1;delete Client.popup_compose_view;this.$el.fadeOut(200,this.$el.remove.bind(this.$el));this.rendered=!1;this.hide_active_annotation(!0);this.remove_markers();this.remove_bindings();this.model.off("change:at_mentioning_post_ids",
 this.update_markers);this.model.off("change:versions",this.change_versions);this.model.off("remove",this.remove_popup);this.$image.off("load",this.use_loaded_image_dimensions);this.group.posts.off("add",this.handle_post_add);this.group.posts.off("remove",this.handle_post_remove);Client.view_singleton("Body_View").off("escape",this.remove_popup);"files"===Data.state.get("current_plugin")?(Data.files.off("add",this.set_siblings),Data.files.off("remove",this.set_siblings)):this.group&&this.group.files&&
 (this.group.files.off("add",this.set_siblings),this.group.files.off("remove",this.set_siblings));this.remove();delete this.active_annotation;delete this.no_hide;delete this.clicked_annotation_shown;delete this.version_index;delete this.caller_view}}),Files_View=Centerrail_View.extend({className:"centerrail",id:"files-page",events:{"dragenter .files":"file_drag_enter","dragexit .files":"file_drag_exit","dragleave .files":"file_drag_exit","dragover .files":"file_drag_over","drop .files":"file_drop",
 "click #create":"show_compose_menu_for_files"},initialize:function(){this.template=JST["plugins/files/index.jst"];Data.profile.on("change:show_files",this.render_header.bind(this))},render:function(){this.$el.html(this.template());this.drag_target=this.$(".fileslist");this.$header=this.$("h1.page-header");this.render_options();this.render_files();this.render_header();var a=this.view("Video_Tutorial_View",{title:loc("Glip Files"),video_id:"Ex8zHj8voUk"});a.render();this.append_rightrail("Files from all projects and conversations are collected here.<br><br>Quickly upload your own by dragging a file from your desktop onto this page.<div class='video_tutorial'></div>");
@@ -1721,7 +1721,7 @@ g.click(function(){f(c.notes[0].notebookGuid,h)}),b.append(g))},h=function(a){b.
 File.prototype.evernote_link=function(a){a=a||this.get("evernote_data");return a.shard_id&&a.share_key?"https://"+(a.sandbox?"sandbox":"www")+".evernote.com/shard/"+a.shard_id+"/sh/"+a.guid+"/"+a.share_key:"https://"+(a.sandbox?"sandbox":"www")+".evernote.com/Home.action?#b="+a.notebookGuid+"&st=p&n="+a.guid};Profile.prototype.default_values.layout_files="thumbnails";Profile.prototype.default_values.thumbnail_size=0.35;Profile.prototype.default_values.show_files="all";
 Profile.prototype.default_values.sort_files="date";Profile.prototype.default_values.sort_files_rightrail="recent";
 var Files_Compose_View=EC_Compose_View.extend({events:{"submit #compose_files":"new_file","blur #compose_file_input":"check_file","keyup #compose_file_input":"keyup_file","keypress #compose_file_input":"changed","change #compose_file_input":"changed",keydown:"keydown_compose"},initialize:function(){this.template=JST["plugins/files/compose.jst"]},render:function(){this.clear_errors();this.$el.html(this.template({model:this.model}));this.init_values();this.set_group()},init_values:function(){this.model&&
-this.$('input[name="filename"]').val(this.model.filename())},validate_filename:function(a,b){return File.prototype.validate_filename(a)},new_file:function(a){var b=this,c=this.$("#compose_files"),d;this.clear_errors();d=c.serializeObject(this);d.errors?c.mark_errors(d.errors,this.cid):(c={name:d.filename},b.has_changed=!1,b.model?b.change_model(c,function(){b.cancel()},function(a){b.handle_error($("body"),a,b.cid,{preamble:a.validation})}):b.cancel());a.preventDefault();return!1},validate_file:function(a,
+this.$('input[name="filename"]').val(this.model.filename())},validate_filename:function(a,b){return File.prototype.validate_filename(a)},new_file:function(a){var b=this,c=this.$("#compose_files"),d;this.clear_errors();d=c.serializeObject(this);d.errors?c.mark_errors(d.errors,this.cid):(c={name:d.filename},b.has_changed=!1,b.model?b.change_model(c,function(){b.cancel()},function(a,c){b.handle_error($("body"),c,b.cid,{preamble:c.validation})}):b.cancel());a.preventDefault();return!1},validate_file:function(a,
 b){if(0<a.length||b)return EC_Model.prototype.validate_url(a)},check_file:function(a,b){var c=$(a.target),d=c.val().trim();d?(d=this.validate_file(d))?c.closest("form").mark_errors([{name:c.prop("name"),error:d,if_exists:b}],this.cid):this.clear_errors():this.clear_errors()},keyup_file:function(a){13!=a.which&&this.check_file(a,!0)},changed:function(){var a=$('#compose_files [name="filename"]');a.length&&a.val().length&&(this.has_changed=!0)}});
 Edit_File=function(a){pez(a);pez("got a file");a=Client.view_singleton("Body_View").view("Compose_Popup_View",{model:a},null,!0);a.plugin=Data.plugins.where({name:"files"})[0];a.render();$("body").append(a.$el);a.handle_append()};
 var Photo_Viewer_Annotation=Annotation.extend({move_to_position:function(){if(this.anno_offset.y_percent&&this.anno_offset.x_percent){var a=50<this.anno_offset.x_percent,b=50<this.anno_offset.y_percent,c=this.$main.offset(),d=this.$(".replies-div").outerHeight();b||this.$(".compose").css({"max-height":this.$window.height()-c.top-d-20+"px"});this.$(".advanced").css({"max-height":this.$window.height()-c.top-d-20+"px"});c=a?this.anno_offset.x-this.$main.width()-35:this.anno_offset.x+35;c+=this.image_offset.left;
@@ -1735,10 +1735,11 @@ var Gmail_Contact_Import=function(a){Data.gmail_imports.$confirm_box=ec_confirm(
 scope:"https://www.google.com/m8/feeds"};window.open("https://accounts.google.com/o/oauth2/auth?"+Object.keys(b).map(function(a){return a+"="+encodeURIComponent(b[a])}).join("&"))},Gmail_Oauth_Callback=function(a){Data.gmail_imports.$confirm_box.fade();"canceled"!==a&&(Data.gmail_imports.auth_token=a,Data.gmail_imports.display_contacts())},Gmail_Chooser_View=People_View.extend({tagName:"div",events:{"click #toggle_selection li":"toggle_selection","click #add_google_contacts_btn":"add_contacts"},initialize:function(){this.template=
 JST["plugins/gmail_imports/chooser.jst"]},render:function(){this.$el.html(this.template());this.render_contacts();this.delegateEvents()},render_contacts:function(){var a=this;if(!this.contacts||0===this.contacts.length)return this.no_contacts();this.contact_views=[];var b={},c=[];Data.people.each(function(a){b[a.get("email")]=!0});var d=Data.user.domain();_.each(this.contacts.sort(function(a,b){if(Data.user.get("is_webmail"))return a.name.localeCompare(b.name);adomain=a.email.replace(/^.*?@/,"");
 bdomain=b.email.replace(/^.*?@/,"");return adomain===bdomain?a.name.localeCompare(b.name):adomain===d?-1:bdomain===d?1:a.name.localeCompare(b.name)}),function(d){d.email.replace(/^.*?@/,"");if(b[d.email])c.push(d);else if(d.email!==Data.user.get("email")){d=new Backbone.Model(d);var e=a.view("Gmail_Chooser_Row",{model:d});e.contact=d;a.$("#chooser_rows").append(e.$el);e.render();a.contact_views.push(e)}});if(0===this.contact_views.length)return this.no_contacts();var e=c.length;if(0<e){var f="";1===
-e?f="<span class=contact>"+c[0].name+"</span> has already joined.":2===e?f=c.map(function(a){return"<span class=contact>"+a.name+"</span>"}).join(" and ")+" have already joined":3===e?f="<span class=contact>"+c[0].name+"</span>, <span class=contact>"+c[1].name+"</span>, and <span class=contact>"+c[2].name+"</span> have already joined":3<e&&(e-=3,f="<span class=contact>"+c[0].name+"</span>, <span class=contact>"+c[1].name+"</span>, <span class=contact>"+c[2].name+"</span> and "+e+" "+(1===e?"other":
-"others")+" have already joined");this.$(".existing_membership").html(f)}12<this.contact_views.length&&(a=this,_.defer(function(){a.$(".select-none").click()}));this.size_chooser()},no_contacts:function(){this.$el.html("<div class=error>We couldn't find your co-workers in your contacts.</div>");$("#add_gmail_contacts").hide()},size_chooser:function(){this.$("#chooser_rows").css({"max-height":$(window).height()-400+"px"})},add_contacts:function(){var a=this;ASync.forEachSeries(_.filter(this.contact_views,
-function(a){return a.checked()}).map(function(a){return a.contact.attributes}),function(b,c){a.add_person_from_hash({person:b,suppress_ga:!0},!1,$.noop,c)},function(a,c){a&&console.warn(a)});Analytics.gmail_contact_import("tour"===Data.state.get("current_plugin")?"Tour":"People",this.contact_views.length);Data.gmail_imports.$chooser&&Data.gmail_imports.$chooser.actions.confirmed()},toggle_selection:function(a){$target=$(a.target);$target.addClass("active").siblings().removeClass("active");var b=$target.hasClass("select-all")?
-"true":"";_.each(this.contact_views,function(a){a.$("input").prop("checked",b)})}}),Gmail_Chooser_Row=EC_View.extend({tagName:"div",className:"gmail_chooser_row",initialize:function(){this.template=JST["plugins/gmail_imports/chooser_row.jst"]},render:function(){this.$el.html(this.template({contact:this.contact}))},checked:function(){return this.$("input").is(":checked")}});
+e?f="<span class=contact>"+_.escape(c[0].name)+"</span> has already joined.":2===e?f=c.map(function(a){return"<span class=contact>"+_.escape(a.name)+"</span>"}).join(" and ")+" have already joined":3===e?f="<span class=contact>"+_.escape(c[0].name)+"</span>, <span class=contact>"+_.escape(c[1].name)+"</span>, and <span class=contact>"+_.escape(c[2].name)+"</span> have already joined":3<e&&(e-=3,f="<span class=contact>"+_.escape(c[0].name)+"</span>, <span class=contact>"+_.escape(c[1].name)+"</span>, <span class=contact>"+
+_.escape(c[2].name)+"</span> and "+e+" "+(1===e?"other":"others")+" have already joined");this.$(".existing_membership").html(f)}12<this.contact_views.length&&(a=this,_.defer(function(){a.$(".select-none").click()}));this.size_chooser()},no_contacts:function(){this.$el.html("<div class=error>We couldn't find your co-workers in your contacts.</div>");$("#add_gmail_contacts").hide()},size_chooser:function(){this.$("#chooser_rows").css({"max-height":$(window).height()-400+"px"})},add_contacts:function(){var a=
+this;console.warn("ADDING CONTACTS:",this);ASync.forEachSeries(_.filter(this.contact_views,function(a){console.warn("IS VIEW CHECKED?",a.checked(),a.contact.attributes);return a.checked()}).map(function(a){return a.contact.attributes}),function(b,c){console.warn("cALLING ADD PERSON FROM HASH:",b);a.add_person_from_hash({person:b,suppress_ga:!0},!1,$.noop,c)},function(a,c){a&&console.warn(a)});Analytics.gmail_contact_import("tour"===Data.state.get("current_plugin")?"Tour":"People",this.contact_views.length);
+Data.gmail_imports.$chooser&&Data.gmail_imports.$chooser.actions.confirmed()},toggle_selection:function(a){$target=$(a.target);$target.addClass("active").siblings().removeClass("active");var b=$target.hasClass("select-all")?"true":"";_.each(this.contact_views,function(a){a.$("input").prop("checked",b)})}}),Gmail_Chooser_Row=EC_View.extend({tagName:"div",className:"gmail_chooser_row",initialize:function(){this.template=JST["plugins/gmail_imports/chooser_row.jst"]},render:function(){this.$el.html(this.template({contact:this.contact}))},
+checked:function(){return this.$("input").is(":checked")}});
 Gmail_Imports=Items.extend({url:"/gmail_imports",model:Gmail_Import,model_name:"Gmail_Import",credentials:{dev:{client:"352526805671-n39vmeuo0s4s7i5c6shr9tgjbkg4n5c6.apps.googleusercontent.com",email:"352526805671-n39vmeuo0s4s7i5c6shr9tgjbkg4n5c6@developer.gserviceaccount.com"},qa:{client:"352526805671-9jjnpjv8da0u5mlejslk43gjlqj8f325.apps.googleusercontent.com",email:"352526805671-9jjnpjv8da0u5mlejslk43gjlqj8f325@developer.gserviceaccount.com"},prod:{client:"352526805671-o8kgf1ehmtmqsujoo7o2f2m52kglrls9.apps.googleusercontent.com",
 email:"352526805671-o8kgf1ehmtmqsujoo7o2f2m52kglrls9@developer.gserviceaccount.com"}}});Gmail_Imports.prototype.can_import=function(){return!0};Gmail_Imports.prototype.redirect_uri=function(){return"https://"+window.location.host+"/api/gmail-contacts-callback"};Gmail_Imports.prototype.client_id=function(){return this.credentials[Data.ec_env.toLowerCase()].client};
 Gmail_Imports.prototype.display_contacts=function(){var a=this;this.$chooser=ec_confirm({subject:loc("Add Your Co-Workers"),wrapper_class:"google_contacts_modal no-padding is-scrollable-y",body:"<div id=gmail_chooser>Loading Contacts</div>",buttons:[{label:"Add Selected",id:"add_gmail_contacts",post_action:"confirmed",action:function(){a.chooser_view.add_contacts()}},{label:"Cancel",post_action:"denied",apply_class:"cancel red"}]});this.$chooser_body=this.$chooser.find("#gmail_chooser");this.fetch_contacts()};
@@ -2358,7 +2359,7 @@ Task_Right_Rail_View=EC_Item_View.extend({tagName:"p",my_template:"plugins/tasks
 this);this.model.on("change:complete_type",this.toggle_complete,this);this.model.on("change:complete",this.toggle_complete,this);this.model.on("change:text",this.change_text,this);this.model.on("change:due",this.change_due,this);this.model.on("change:assigned_to_ids",this.change_assignees,this);this.model.get_assignees({},_.bind(function(a){this.assignees=a;a.on("change",this.update_assignees,this)},this));Data.profile.on("change:sort_tasks_me",this.render,this);Data.profile.on("change:sort_tasks_rightrail",
 this.render,this)},handle_resize:function(){this.set_size();this.trigger("resize")},set_size:function(){this.in_DOM()&&this.$(".text").width(this.$(".item").width()-this.$(".ico").width()-this.$(".rightgray").width()-30)},handle_append:function(){this.set_size()},render:function(a,b,c){this.sort_profile_key="sort_tasks_rightrail";var d=Data.state.current_group();d&&d.is_me_group()&&(this.sort_profile_key="sort_tasks_me");this.assigned_to_ids=JSON.stringify(this.model.get("assigned_to_ids"));this.$task_check=
 this.$el.find(".taskcheck");this.$task_text=this.$el.find(".text");EC_Item_View.prototype.render.call(this,a,b,c)&&(this.set_complete(),this.change_text(),this.delegateEvents());this.set_size()},set_complete:function(){},toggle_complete:function(a){this.model.get("deactivated")||-1===this.model.get("group_ids").indexOf(Data.state.get("current_group_id"))||(1===this.model.complete()?Data.get_profile_value("tasks_rightrail_show_completed")||(this.fade_timeout&&clearTimeout(this.fade_timeout),this.fade_timeout=
-setTimeout(_.bind(function(){this.model.complete()&&this.options.parent_view.remove_view(this)},this),Task.prototype.fade_timeout)):(this.fade_timeout&&clearTimeout(this.fade_timeout),this.options.parent_view.add_model(this.model,!0)))},change_text:function(a){this.in_DOM()&&this.$task_text.html(this.options.search_selection||this.model.get("text"))},change_due:function(a){"due"==Data.get_profile_value(this.sort_key)&&this.options.parent_view.render_models()},update_assignees:function(){this.$(".assignees").text(this.model.assignees_pretty())},
+setTimeout(_.bind(function(){this.model.complete()&&this.options.parent_view.remove_view(this)},this),Task.prototype.fade_timeout)):(this.fade_timeout&&clearTimeout(this.fade_timeout),this.options.parent_view.add_model(this.model,!0)))},change_text:function(a){this.in_DOM()&&this.$task_text.html(this.options.search_selection||_.escape(this.model.get("text")))},change_due:function(a){"due"==Data.get_profile_value(this.sort_key)&&this.options.parent_view.render_models()},update_assignees:function(){this.$(".assignees").text(this.model.assignees_pretty())},
 change_assignees:function(a){a=JSON.stringify(a.get("assigned_to_ids"));a!=this.assigned_to_ids&&(this.assigned_to_ids=a,"assignee"==Data.get_profile_value(this.sort_key)?this.options.parent_view.render_models():this.model.get_assignees({existing_collection:this.assignees},$.noop))},check_task:function(){var a=1==this.model.complete()?0:1;this.change_model({complete_boolean:a})},edit_task:function(){Edit_Task(this.model)}});Profile.prototype.default_values.sort_tasks="conversation";
 Profile.prototype.default_values.sort_tasks_rightrail="section";Profile.prototype.default_values.sort_tasks_me="section";Profile.prototype.default_values.show_tasks="pending";Profile.prototype.default_values.whose_tasks="all";Profile.prototype.default_values.tasks_new_task_complete_type="boolean";Profile.prototype.default_values.gantt_columns="index complete text assignee due section conversation attachments".split(" ");Profile.prototype.default_values.hideable_gantt_columns="index assignee start due due_time days section conversation".split(" ");
 Profile.prototype.default_values.all_gantt_columns="index complete text assignee start due due_time days section conversation attachments".split(" ");
diff --git a/minified-assets-prod/named-scripts.js-raw b/minified-assets-prod/named-scripts.js-raw
index e3b1753..6f00218 100644
--- a/minified-assets-prod/named-scripts.js-raw
+++ b/minified-assets-prod/named-scripts.js-raw
@@ -2067,7 +2067,7 @@ var Conversation_Switch_View = Popup_Dialog_View.extend({
 	render: function() {
 		this.$el.html(this.template());
 		if (this.options.message) {
-			this.$('#message').html(this.options.message).show();
+			this.$('#message').text(this.options.message).show();
 		}
 		this.render_groups('');
 	},
@@ -10900,6 +10900,7 @@ var People_View = Centerrail_View.extend({
 	add_person_from_hash: function(options, skip_subscription_warning, callback, server_response_callback) {
 		var that = this;
 		var person_hash = options.person;
+		console.warn("ADDING PERSON FROM HASH:", options, skip_subscription_warning);
 		if (!person_hash.email) {
 			return callback();
 		}
@@ -12210,7 +12211,6 @@ var Person_View = EC_View.extend({
 							view.saving = false;
 						},
 						error: function(model, error) {
-							view.saving = false;
 							target = view.$el.find('[name=' + target_name + ']');
 							setTimeout(function() {
 								view.handle_error(target, error, view.cid, {
@@ -12220,6 +12220,7 @@ var Person_View = EC_View.extend({
 							}, 0);
 							target.val(value);
 							target.focus();
+							view.saving = false;
 						}
 					});
 				}
@@ -23297,7 +23298,7 @@ var Import_Item_Setup_View = EC_View.extend({
 	},
 	initialize_file_progress: function(file) {
 		var $progress = this.$('.progress');
-		$progress.html(file.name);
+		$progress.html(_.escape(file.name));
 		$progress.attr('original_style', $progress.attr('style') || ' ');
 		$progress.show();
 		$progress.css('box-shadow', 'inset 0px 0px 7px #0000cc');
@@ -23381,7 +23382,7 @@ var Existing_Import_Row_View = EC_View.extend({
 
 	},
 	update_status: function(model) {
-		this.$('.integration-status').html(model.status_pretty[model.get('status')]);
+		this.$('.integration-status').html(_.escape(model.status_pretty[model.get('status')]));
 	}
 });
 
@@ -23524,7 +23525,7 @@ var User_Import_Row = EC_View.extend({
 		if (this.match) {
 			var headshot_view = this.view('Headshot_View', { model: this.match })
 			this.$('.heads').append(headshot_view.$el);
-			this.$('.match_description').html(this.match.get('display_name'));
+			this.$('.match_description').html(_.escape(this.match.get('display_name')));
 			headshot_view.render();
 			headshot_view.delegateEvents();
 		}
@@ -24842,7 +24843,7 @@ Bitbucket_Instructions_View = Integration_Setup_View.extend({
 		}
 		var text = "No repos found";
 		if (config.user && config.user.user && config.user.user.display_name) {
-			text += " for user: <b>" + config.user.user.display_name + "</b>";
+			text += " for user: <b>" + _.escape(config.user.user.display_name) + "</b>";
 		}
 		this.$('.error').html(text);
 		this.$('.error').show();
@@ -42649,15 +42650,8 @@ File.prototype.validate_filename = function(filename) {
 	if (!filename) { return; }
 	var trimmed_filename = filename.replace(/^\s+/,'').replace(/.*?\s+$/,'');
 	if (!_.isString(trimmed_filename)) return Errors.Invalid_Filename();
-	if (filename.length > 2500) return Errors.Invalid_Filename();
 	if (trimmed_filename.length === 0) return Errors.Invalid_Filename();
-// WTF, filenames do not have to have extensions
-// if (filename == 'Test' || filename == 'webstorm' || filename.match(/^(.+?)\.(.+?)$/)) {
-		return;
-//	}
-//	else {
-//		return Errors.Invalid_Filename();
-//	}
+	return File.prototype.validate_string(filename, 2500);
 };
 
 File.prototype.notification_text = function() {
@@ -44494,7 +44488,7 @@ var Photo_Viewer = Item_Details_View.extend({
 		this.edit_item();
 	},
 	update_name: function() {
-		this.$('.info .title').html(this.model.get('name'));
+		this.$('.info .title').html(_.escape(this.model.get('name')));
 	},
 	remove_popup: function(event) {
 		if (Client.at_mention_popup) {
@@ -46489,7 +46483,7 @@ var Files_Compose_View = EC_Compose_View.extend({
 					function() {
 						that.cancel();
 					},
-					function(error) {
+					function(model, error) {
 						that.handle_error($('body'), error, that.cid, {
 							preamble: error.validation
 						});
@@ -46864,19 +46858,23 @@ var Gmail_Chooser_View = People_View.extend({
 		if (on_glip_length > 0) {
 			var on_glip_text = '';
 			if (on_glip_length === 1) {
-				on_glip_text = "<span class=contact>" + on_glip_and_contact[0].name + "</span> has already joined.";
+				on_glip_text = "<span class=contact>" + _.escape(on_glip_and_contact[0].name) + "</span> has already joined.";
 			}
 			else if (on_glip_length === 2) {
 				on_glip_text = on_glip_and_contact.map(function(contact) {
-					return "<span class=contact>" + contact.name + "</span>";
+					return "<span class=contact>" + _.escape(contact.name) + "</span>";
 				}).join(" and ") + " have already joined";
 			}
 			else if (on_glip_length === 3) {
-				on_glip_text = "<span class=contact>" + on_glip_and_contact[0].name + "</span>, <span class=contact>" + on_glip_and_contact[1].name + "</span>, and <span class=contact>" + on_glip_and_contact[2].name + "</span> have already joined";
+				on_glip_text = "<span class=contact>" + _.escape(on_glip_and_contact[0].name) + "</span>, <span class=contact>" + 
+					_.escape(on_glip_and_contact[1].name) + "</span>, and <span class=contact>" + 
+					_.escape(on_glip_and_contact[2].name) + "</span> have already joined";
 			}
 			else if (on_glip_length > 3) {
 				var others = on_glip_length - 3;
-				on_glip_text = "<span class=contact>" + on_glip_and_contact[0].name + "</span>, <span class=contact>" + on_glip_and_contact[1].name + "</span>, <span class=contact>" + on_glip_and_contact[2].name + "</span> and " + others + " " + (others === 1 ? 'other' : 'others') + " have already joined";
+				on_glip_text = "<span class=contact>" + _.escape(on_glip_and_contact[0].name) + "</span>, <span class=contact>" + 
+					_.escape(on_glip_and_contact[1].name) + "</span>, <span class=contact>" + 
+					_.escape(on_glip_and_contact[2].name) + "</span> and " + others + " " + (others === 1 ? 'other' : 'others') + " have already joined";
 			}
 			this.$('.existing_membership').html(on_glip_text);
 		}
@@ -46895,16 +46893,19 @@ var Gmail_Chooser_View = People_View.extend({
 	},
 	add_contacts: function() {
 		var that = this;
+		console.warn("ADDING CONTACTS:", this);
 		ASync.forEachSeries(
 			_.filter(
 				this.contact_views,
 				function(view) {
+					console.warn("IS VIEW CHECKED?", view.checked(), view.contact.attributes);
 					return view.checked();
 				}
 			).map(function(view) {
 				return view.contact.attributes;
 			}), 
 			function(contact, callback) {
+				console.warn("cALLING ADD PERSON FROM HASH:", contact);
 				that.add_person_from_hash({ 
 					person: contact,
 					suppress_ga: true
@@ -63779,7 +63780,7 @@ var Task_Right_Rail_View = EC_Item_View.extend({
 	},
 	change_text: function(event) {
 		if (this.in_DOM()) {
-			this.$task_text.html(this.options.search_selection || this.model.get('text'));
+			this.$task_text.html(this.options.search_selection || _.escape(this.model.get('text')));
 		}
 	},
 	change_due: function(event) {
diff --git a/minified-assets-prod/private-scripts.js b/minified-assets-prod/private-scripts.js
index 2653a0c..8bd7f1c 100644
--- a/minified-assets-prod/private-scripts.js
+++ b/minified-assets-prod/private-scripts.js
@@ -72,12 +72,12 @@ _id:196620},{storage_url:"https://glip-demo.s3.amazonaws.com/web/customer_files/
 do_demo2_step=function(k,c){var a="dev"==Data.ec_env?STORED_FILES_BY_ENV["dev-"+Data.user.short_email()]||STORED_FILES_BY_ENV.prod:STORED_FILES_BY_ENV[Data.ec_env];c||(c=++demo_step);1==c?demo_type_post("let's nail a launch date for the project. next week is good."):2==c?demo_type_post("how is the marketing plan coming along?"):3==c?demo_new_post("claudio","we are in good shape.  we are in negotiations with an SEM partner, marinsoftware.com","http://marinsoftware.com"):4==c?demo_new_files("claudio",
 a[c],"and I've completed the backgrounder and FAQ.  Here they are."):5==c?demo_type_post("let\u2019s set up a meeting to review the materials tomorrow, does 3pm work for everyone?"):6==c?demo_new_post("patrick","sure"):7==c?demo_new_post("claudio","sounds good"):8==c?(a=(new Date).setHours(0,0,0,0)+1404E5,demo_new_event("claudio","Review backgrounder and faq",a)):9==c?demo_new_post("claudio","We need to get some of the materials gathered into a press kit.  Patrick, are the bios and photos ready to share?"):
 10==c?demo_new_post("patrick","i need to check"):11==c?(a=(new Date).getTime()+1728E5,demo_new_task("claudio","Finalize bios and press kit photos","patrick",a)):12==c?demo_type_post("we also still need the logos, who has them?"):13==c?(a=(new Date).getTime()+1728E5,demo_new_task("patrick","Upload glip logos","dalton",a)):14==c?demo_new_files("dalton",a[c],"I've got them. Here are our logomarks..."):15==c?demo_new_files("dalton",a[c],"...a couple of logos, and a screen grab "):16==c&&demo_type_post("cool. it looks like everything is in order for the launch. great job guys!")},
-demo_new_file=function(k,c){var a=demo_find_person(k),a={name:c,type:"jpg",versions:[],stored_file_id:1E3,url:"http://imgur.com/SpecsV1.doc",download_url:"http://doesntwork.com",stored_version:1,group_id:Data.state.get("current_group_id"),creator_id:a.id};Data.create_item("files",a,{error:function(a,c){}})},demo_new_files=function(k,c,a){var f=demo_find_person(k),g=[];ASync.forEach(c,function(a,m){var e={stored_file_id:a._id,url:a.storage_url,download_url:a.download_url,date:Date_Utilities.prototype.pretty_date(Date.now()),
-size:a.size},l=File.prototype.filename(a.storage_url),h=File.prototype.extension(l);console.warn("ABOUT TO CREATE A FILE: "+l+" - "+h);e={group_ids:[Data.state.get("current_group_id")],versions:[e],name:l,type:h,last_modified:a.last_modified,no_post:!0};Data.create_item("files",e,{no_post:!0,success:function(d){g.push(d.id);ASync.nextTick(m)},error:function(d,b){console.warn("Error creating file:");console.warn(b);ASync.nextTick(m)}})},function(){var c={creator_id:f.id,group_id:Data.state.get("current_group_id"),
-item_ids:g,text:a};Data.create_post(c,{error:function(a,e){console.warn("Error creating post:");console.warn(e)}})})},demo_type_post=function(k){demo_letters=k.split("");demo_type_in_letters()},demo_type_in_letters=function(){if(0==demo_letters.length)$("#compose_chat").submit();else{var k=$("#compose_chat textarea").val();$("#compose_chat textarea").val(k+demo_letters.shift());$("#compose_chat textarea").trigger("keypress");$('#compose_chat [name="body"]').trigger("autosize");setTimeout(demo_type_in_letters,
-100*Math.random())}},demo_new_post=function(k,c,a){k=demo_find_person(k);c={group_id:Data.state.get("current_group_id"),creator_id:k.id,text:c};a&&(c.links=[{url:a,needs_embedly:!0}]);Data.create_post(c,{error:function(a,c){console.warn(c)}})},demo_new_link=function(k,c,a,f,g){k=demo_find_person(k);c={group_id:Data.state.get("current_group_id"),creator_id:k.id,url:c,title:a,image:f,summary:g};var n=$('#compose_links [name="body"]'),m=this;Data.create_item("links",c,{error:function(e,l){e.trigger("creation_error",
-{error:l,has_changed:m.has_changed,element:n,owner:m.cid,preamble:loc("Your link could not be shared."),callback:function(h){h&&n.val(e.get("url")).focus()}})}})},demo_new_event=function(k,c,a,f){k=demo_find_person(k);c={group_id:Data.state.get("current_group_id"),creator_id:k.id,text:c,all_day:f,start:a,invitee_ids:[]};console.log("CREATING EVENT: "+JSON.stringify(c));var g=this;Data.create_item("events",c,{error:function(a,m){g.handle_error($("compose_chat"),m,g.cid)}})},demo_new_task=function(k,
-c,a,f){k=demo_find_person(k);a=demo_find_person(a);c={group_id:Data.state.get("current_group_id"),creator_id:k.id,text:c,assigned_to_ids:[a.id],due:f};var g=this;Data.create_item("tasks",c,{error:function(a,m){g.handle_error($("compose_chat"),m,g.cid)}})},demo_find_person=function(k){return Data.people.find(function(c){var a=RegExp(k);return c.get("email").match(a)})};EC_Data.prototype.additional_initialization=function(k){this.init_sexio_data(k)};
+demo_new_file=function(k,c){var a=demo_find_person(k),a={name:c,type:"jpg",versions:[],stored_file_id:1E3,url:"http://imgur.com/SpecsV1.doc",download_url:"http://doesntwork.com",stored_version:1,group_id:Data.state.get("current_group_id"),creator_id:a.id};Data.create_item("files",a,{error:function(a,c){}})},demo_new_files=function(k,c,a){var f=demo_find_person(k),h=[];ASync.forEach(c,function(a,m){var e={stored_file_id:a._id,url:a.storage_url,download_url:a.download_url,date:Date_Utilities.prototype.pretty_date(Date.now()),
+size:a.size},l=File.prototype.filename(a.storage_url),g=File.prototype.extension(l);console.warn("ABOUT TO CREATE A FILE: "+l+" - "+g);e={group_ids:[Data.state.get("current_group_id")],versions:[e],name:l,type:g,last_modified:a.last_modified,no_post:!0};Data.create_item("files",e,{no_post:!0,success:function(d){h.push(d.id);ASync.nextTick(m)},error:function(d,b){console.warn("Error creating file:");console.warn(b);ASync.nextTick(m)}})},function(){var c={creator_id:f.id,group_id:Data.state.get("current_group_id"),
+item_ids:h,text:a};Data.create_post(c,{error:function(a,e){console.warn("Error creating post:");console.warn(e)}})})},demo_type_post=function(k){demo_letters=k.split("");demo_type_in_letters()},demo_type_in_letters=function(){if(0==demo_letters.length)$("#compose_chat").submit();else{var k=$("#compose_chat textarea").val();$("#compose_chat textarea").val(k+demo_letters.shift());$("#compose_chat textarea").trigger("keypress");$('#compose_chat [name="body"]').trigger("autosize");setTimeout(demo_type_in_letters,
+100*Math.random())}},demo_new_post=function(k,c,a){k=demo_find_person(k);c={group_id:Data.state.get("current_group_id"),creator_id:k.id,text:c};a&&(c.links=[{url:a,needs_embedly:!0}]);Data.create_post(c,{error:function(a,c){console.warn(c)}})},demo_new_link=function(k,c,a,f,h){k=demo_find_person(k);c={group_id:Data.state.get("current_group_id"),creator_id:k.id,url:c,title:a,image:f,summary:h};var n=$('#compose_links [name="body"]'),m=this;Data.create_item("links",c,{error:function(e,l){e.trigger("creation_error",
+{error:l,has_changed:m.has_changed,element:n,owner:m.cid,preamble:loc("Your link could not be shared."),callback:function(g){g&&n.val(e.get("url")).focus()}})}})},demo_new_event=function(k,c,a,f){k=demo_find_person(k);c={group_id:Data.state.get("current_group_id"),creator_id:k.id,text:c,all_day:f,start:a,invitee_ids:[]};console.log("CREATING EVENT: "+JSON.stringify(c));var h=this;Data.create_item("events",c,{error:function(a,m){h.handle_error($("compose_chat"),m,h.cid)}})},demo_new_task=function(k,
+c,a,f){k=demo_find_person(k);a=demo_find_person(a);c={group_id:Data.state.get("current_group_id"),creator_id:k.id,text:c,assigned_to_ids:[a.id],due:f};var h=this;Data.create_item("tasks",c,{error:function(a,m){h.handle_error($("compose_chat"),m,h.cid)}})},demo_find_person=function(k){return Data.people.find(function(c){var a=RegExp(k);return c.get("email").match(a)})};EC_Data.prototype.additional_initialization=function(k){this.init_sexio_data(k)};
 EC_Data.prototype.init_sexio_data=function(k){if(k.sexio_data){k=k.sexio_data;var c=[],a;for(a in k.servers)c.push({name:a,status:k.servers[a]});Data.sexio_servers=new Backbone.Collection(c)}};window.Content_View&&(Content_View.prototype.view_map.sexio_status="Sexio_Status_View");
 var Private_Menu=EC_View.extend({id:"private_menu",events:{click:"private_menu"},initialize:function(){this.template=JST["private/menu.jst"]},render:function(){this.$el.html(this.template())},toggle_feature:function(k,c){Data.set_profile_value("feature_"+c,!Data.get_profile_value("feature_"+c));Data.save_profile()},is_hubspot_on:function(){return"true"===$.cookie("enable_hubspot_registration")},toggle_hubspot:function(){"true"===$.cookie("enable_hubspot_registration")?$.cookie("enable_hubspot_registration",
 "false"):$.cookie("enable_hubspot_registration","true")},is_unsupported_browser_on:function(){return"true"===$.cookie("feature_unsupported_browser_testing")},toggle_unsupported_browser:function(){"true"===$.cookie("feature_unsupported_browser_testing")?$.cookie("feature_unsupported_browser_testing","false"):$.cookie("feature_unsupported_browser_testing","true")},socket_io_debug:function(){return"true"===$.cookie("feature_socketio_debug")},toggle_socketio_debug:function(){"true"===$.cookie("feature_socketio_debug")?
@@ -87,141 +87,142 @@ a)},is_store_logging_on:function(k){var c=this.get_store_logging_settings();k=k.
 10);k.set_store_logging("_number_of_lines",c)}},{label:"Cancel"}]})},private_menu:function(k){var c=[["Show Add Button",this.toggle_feature,{argument:"add_plugin",checked:Data.get_profile_value("feature_add_plugin")}],["Enable Demo",this.toggle_feature,{argument:"demo",checked:Data.get_profile_value("feature_demo")}],["Enable Polls & Code",this.toggle_feature,{argument:"polls_code",checked:Data.get_profile_value("feature_polls_code")}],["Enable Error Testing",this.toggle_feature,{argument:"error_testing",
 checked:Data.get_profile_value("feature_error_testing")}],["Enable Email Testing",this.toggle_feature,{argument:"email_testing",checked:Data.get_profile_value("feature_email_testing")}],["Enable User Deletion",this.toggle_feature,{argument:"user_deletion",checked:Data.get_profile_value("feature_user_deletion")}],["Enable Hubspot Testing",this.toggle_hubspot,{checked:this.is_hubspot_on()}],["Enable Unsupported Browser",this.toggle_unsupported_browser,{checked:this.is_unsupported_browser_on()}],["Enable Socket.IO Debug",
 this.toggle_socketio_debug,{checked:this.socket_io_debug()}],["Enable Zendesk",this.toggle_feature,{argument:"zendesk_preview",checked:Data.get_profile_value("feature_zendesk_preview")}],["Always Show Glip Logo in LR",this.toggle_feature,{argument:"glip_logo_in_header",checked:Data.get_profile_value("feature_glip_logo_in_header")}]],a=_.bind(this.toggle_logging,this),f=[["All On",a,{argument:"all",checked:this.is_logging_on("all")}],["-"],["Console Log",a,{argument:"info",checked:this.is_logging_on("info")}],
-["Console Warn",a,{argument:"warn",checked:this.is_logging_on("warn")}],["-"],["Analytics",a,{argument:"analytics",checked:this.is_logging_on("analytics")}],["Benchmarking",a,{argument:"benchmark",checked:this.is_logging_on("benchmark")}],["Requests",a,{argument:"request",checked:this.is_logging_on("request")}],["-"]],g=_.bind(this.toggle_store_logging,this),n=[["Number of Lines: "+this.is_store_logging_on("_number_of_lines"),_.bind(this.enter_store_logging_lines,this)],["Revert to Defaults",_.bind(this.revert_to_store_logging_defaults,
-this)],["-"],["All On",g,{argument:"all",checked:this.is_store_logging_on("all")}],["-"],["Console Log",g,{argument:"info",checked:this.is_store_logging_on("info")}],["Console Warn",g,{argument:"warn",checked:this.is_store_logging_on("warn")}],["-"],["Analytics",g,{argument:"analytics",checked:this.is_store_logging_on("analytics")}],["Benchmarking",g,{argument:"benchmark",checked:this.is_store_logging_on("benchmark")}],["-"]],m=[];Data.sexio_servers&&Data.sexio_servers.each(_.bind(function(e){m.push([e.get("name"),
-this.show_sexio_status,{argument:e}])},this));_.each("beams colin dalton jeff jj paden pez trevis".split(" "),_.bind(function(e){f.push([e,a,{argument:e,checked:this.is_logging_on(e)}]);n.push([e,g,{argument:e,checked:this.is_store_logging_on(e)}])},this));c=[["Become another user",_.bind(this.become_another_user,this)],["Deactivate user",_.bind(this.deactivate_user,this)],["Reactivate user",_.bind(this.reactivate_user,this)],["Change password",_.bind(this.change_password,this)],["Unlock account",
+["Console Warn",a,{argument:"warn",checked:this.is_logging_on("warn")}],["-"],["Analytics",a,{argument:"analytics",checked:this.is_logging_on("analytics")}],["Benchmarking",a,{argument:"benchmark",checked:this.is_logging_on("benchmark")}],["Requests",a,{argument:"request",checked:this.is_logging_on("request")}],["-"]],h=_.bind(this.toggle_store_logging,this),n=[["Number of Lines: "+this.is_store_logging_on("_number_of_lines"),_.bind(this.enter_store_logging_lines,this)],["Revert to Defaults",_.bind(this.revert_to_store_logging_defaults,
+this)],["-"],["All On",h,{argument:"all",checked:this.is_store_logging_on("all")}],["-"],["Console Log",h,{argument:"info",checked:this.is_store_logging_on("info")}],["Console Warn",h,{argument:"warn",checked:this.is_store_logging_on("warn")}],["-"],["Analytics",h,{argument:"analytics",checked:this.is_store_logging_on("analytics")}],["Benchmarking",h,{argument:"benchmark",checked:this.is_store_logging_on("benchmark")}],["-"]],m=[];Data.sexio_servers&&Data.sexio_servers.each(_.bind(function(e){m.push([e.get("name"),
+this.show_sexio_status,{argument:e}])},this));_.each("beams colin dalton jeff jj paden pez trevis".split(" "),_.bind(function(e){f.push([e,a,{argument:e,checked:this.is_logging_on(e)}]);n.push([e,h,{argument:e,checked:this.is_store_logging_on(e)}])},this));c=[["Become another user",_.bind(this.become_another_user,this)],["Deactivate user",_.bind(this.deactivate_user,this)],["Reactivate user",_.bind(this.reactivate_user,this)],["Change password",_.bind(this.change_password,this)],["Unlock account",
 _.bind(this.unlock_account,this)],["Change email",_.bind(this.change_email,this)],["Remove from Amazon suppression",_.bind(this.remove_from_amazon_suppression,this)],["Delete company",_.bind(this.delete_company,this)],["Configure Tophat",_.bind(this.configure_tophat,this)],["-"],["See company stats",this.company_stats,{disabled:1}],["Capture state to JIRA",this.capture_to_jira,{disabled:1}],["Logging",null,{submenu:f}],["Store Logging",null,{submenu:n}],["Sexio Status",null,{submenu:m}],["-"],["Features",
 null,{submenu:c}],["-"],["Leave private mode",_.bind(this.leave_private_mode,this)]];Menu(c).render(k)},show_sexio_status:function(k,c){k.stopImmediatePropagation();Data.save_state({current_plugin:"sexio_status",current_group_id:null,current_status_server:c.get("name")});return!1},configure_tophat:function(k){var c=new Tophat_Configuration_View;k=ec_confirm({subject:loc("Tophat Configuration"),body:"<div id=tophat_config_holder></div>",buttons:[{label:"Save",action:function(){c.save()}},{label:"Cancel"}]});
 c.render();k.find(".confirmbody").append(c.$el);c.delegateEvents()},become_another_user:function(k){var c=this;ec_confirm({subject:loc("Enter email"),body:"<input type=text id=login_as_email style=width:300px>",buttons:[{label:"Login",action:function(){c.become_another_user_request({email:$("#login_as_email").val()})}},{label:"Cancel"}]})},become_another_user_request:function(k){Client.request("/api/become_user",{parameters:k,method:"post"},function(c){console.warn(c);200!==c.request.status_code?
 ec_confirm({subject:"Unable to locate any such user "+(k.email||k.user_id),buttons:[{label:"OK"}]}):document.location="/?user="+(k.email||k.user_id)+"&"+ +new Date})},change_password:function(k){ec_confirm({subject:loc("Enter user and password"),body:"<input type=text id=change_password_email style=width:300px><br/><input type=password id=change_password_password style=width:300px>",buttons:[{label:"Set Password",action:function(){Client.request("/api/set_password",{parameters:{email:$("#change_password_email").val(),
-password:$("#change_password_password").val(),password_confirm:$("#change_password_password").val()},method:"post"},function(c){console.warn(c);200!==c.request.status_code&&ec_confirm({subject:"Error setting password for "+$("#change_password_email").val()+": "+(c.body&&c.body.error&&c.body.error.message||"???"),buttons:[{label:"OK"}]})})}},{label:"Cancel"}]})},unlock_account:function(k){ec_confirm({subject:loc("Enter email"),body:"<input type=text id=unlock_account style=width:300px>",buttons:[{label:"Unlock",
-action:function(){$("#unlock_account").val();Client.request(url,{method:"put"},function(c){if(200!==c.request.status_code){var a="Unexpected error";c&&c.body&&c.body.error&&c.body.error.message&&(a=c.body.error.message);ec_confirm({subject:a,buttons:[{label:"OK"}]})}})}},{label:"Cancel"}]})},change_email:function(k){ec_confirm({subject:loc("Enter old email and new email"),body:"<input type=text id=old_email style=width:300px><br/><input id=new_email style=width:300px>",buttons:[{label:"Change user email",
-action:function(){Client.request("/api/change_email",{parameters:{old_email:$("#old_email").val(),new_email:$("#new_email").val()},method:"put"},function(c){console.warn(c);200!==c.request.status_code&&ec_confirm({subject:"Error changing email for "+$("#old_email").val()+": "+(c.body&&c.body.error&&c.body.error.message||"???"),buttons:[{label:"OK"}]})})}},{label:"Cancel"}]})},reactivate_user:function(k){console.warn("reactivate user");ec_confirm({subject:loc("Enter email"),body:"<input type=text id=reactivate_email style=width:300px>",
-buttons:[{label:"Reactivate",action:function(){Client.request("/api/reactivate_user",{parameters:{email:$("#reactivate_email").val()},method:"put"},function(c){if(200!==c.request.status_code){var a="Unexpected error";c&&c.body&&c.body.error&&c.body.error.message&&(a=c.body.error.message);ec_confirm({subject:a,buttons:[{label:"OK"}]})}})}},{label:"Cancel"}]})},deactivate_user:function(k){console.warn("deactivate user");ec_confirm({subject:loc("Enter email"),body:"<input type=text id=deactivate_email style=width:300px>",
-buttons:[{label:"Deactivate",action:function(){Client.request("/api/deactivate_user",{parameters:{email:$("#deactivate_email").val()},method:"put"},function(c){if(200!==c.request.status_code){var a="Unexpected error";c&&c.body&&c.body.error&&c.body.error.message&&(a=c.body.error.message);ec_confirm({subject:a,buttons:[{label:"OK"}]})}})}},{label:"Cancel"}]})},delete_company:function(){var k=this;ec_confirm({subject:loc("Delete company"),body:loc("<strong>All groups, people, posts, and items for this company will be permanently deleted!</strong><br >Are you absolutely sure you wish to delete this company?"),
-buttons:[{label:"Yes, delete this company",action:function(){ec_confirm({subject:loc("Delete company"),body:loc("<strong>You are about to DELETE a whole COMPANY!</strong> Are you really really <strong><i>really</i ></strong> sure you want to do this?"),buttons:[{label:"Yes let me do it",action:function(){Client.request("/api/company/"+Data.company.id,{method:"delete"},function(c){c.body?c.body.error?k.handle_error(k.$el,c.body.error,null,{preamble:loc("Unable to delete company")}):Client.force_logout(!0):
-k.handle_error(k.$el,Errors.Invalid_Server_Response(),null,{preamble:loc("Unable to delete company")})})}},{label:"No -- stop!!!",post_action:"denied"}]})}},{label:"Cancel",post_action:"denied"}]})},remove_from_amazon_suppression:function(k){ec_confirm({subject:loc("Enter email"),body:"<input type=text id=remove_from_amazon_suppression_email style=width:300px>",buttons:[{label:"Remove",action:function(){Client.request("/api/no-auth/amazon_ses_suppressed",{parameters:{email:$("#remove_from_amazon_suppression_email").val(),
-suppressed:0},method:"post"},function(c){if(200!==c.request.status_code){var a="Unexpected error";c&&c.body&&c.body.error&&c.body.error.message&&(a=c.body.error.message);ec_confirm({subject:a,buttons:[{label:"OK"}]})}})}},{label:"Cancel"}]})},leave_private_mode:function(){$.cookie("private",null);setTimeout(function(){Client.unset_onbeforeunload();window.location=""},1E3)}});
+password:$("#change_password_password").val(),password_confirm:$("#change_password_password").val()},method:"post"},function(c){console.warn(c);200!==c.request.status_code&&ec_confirm({subject:"Error setting password for "+$("#change_password_email").val()+": "+(c.body&&c.body.error&&c.body.error.message||"???"),buttons:[{label:"OK"}]})})}},{label:"Cancel"}]})},unlock_account:function(k){ec_confirm({subject:loc("Enter email"),body:"<input type=text id=private_menu_unlock_account style=width:300px>",
+buttons:[{label:"Unlock",action:function(){var c=$("#private_menu_unlock_account").val(),c="/api/unlock_account/"+encodeURIComponent(c);Client.request(c,{method:"put"},function(a){if(200!==a.request.status_code){var c="Unexpected error";a&&a.body&&a.body.error&&a.body.error.message&&(c=a.body.error.message);ec_confirm({subject:c,buttons:[{label:"OK"}]})}})}},{label:"Cancel"}]})},change_email:function(k){ec_confirm({subject:loc("Enter old email and new email"),body:"<input type=text id=old_email style=width:300px><br/><input id=new_email style=width:300px>",
+buttons:[{label:"Change user email",action:function(){Client.request("/api/change_email",{parameters:{old_email:$("#old_email").val(),new_email:$("#new_email").val()},method:"put"},function(c){console.warn(c);200!==c.request.status_code&&ec_confirm({subject:"Error changing email for "+$("#old_email").val()+": "+(c.body&&c.body.error&&c.body.error.message||"???"),buttons:[{label:"OK"}]})})}},{label:"Cancel"}]})},reactivate_user:function(k){console.warn("reactivate user");ec_confirm({subject:loc("Enter email"),
+body:"<input type=text id=reactivate_email style=width:300px>",buttons:[{label:"Reactivate",action:function(){Client.request("/api/reactivate_user",{parameters:{email:$("#reactivate_email").val()},method:"put"},function(c){if(200!==c.request.status_code){var a="Unexpected error";c&&c.body&&c.body.error&&c.body.error.message&&(a=c.body.error.message);ec_confirm({subject:a,buttons:[{label:"OK"}]})}})}},{label:"Cancel"}]})},deactivate_user:function(k){console.warn("deactivate user");ec_confirm({subject:loc("Enter email"),
+body:"<input type=text id=deactivate_email style=width:300px>",buttons:[{label:"Deactivate",action:function(){Client.request("/api/deactivate_user",{parameters:{email:$("#deactivate_email").val()},method:"put"},function(c){if(200!==c.request.status_code){var a="Unexpected error";c&&c.body&&c.body.error&&c.body.error.message&&(a=c.body.error.message);ec_confirm({subject:a,buttons:[{label:"OK"}]})}})}},{label:"Cancel"}]})},delete_company:function(){var k=this;ec_confirm({subject:loc("Delete company"),
+body:loc("<strong>All groups, people, posts, and items for this company will be permanently deleted!</strong><br >Are you absolutely sure you wish to delete this company?"),buttons:[{label:"Yes, delete this company",action:function(){ec_confirm({subject:loc("Delete company"),body:loc("<strong>You are about to DELETE a whole COMPANY!</strong> Are you really really <strong><i>really</i ></strong> sure you want to do this?"),buttons:[{label:"Yes let me do it",action:function(){Client.request("/api/company/"+
+Data.company.id,{method:"delete"},function(c){c.body?c.body.error?k.handle_error(k.$el,c.body.error,null,{preamble:loc("Unable to delete company")}):Client.force_logout(!0):k.handle_error(k.$el,Errors.Invalid_Server_Response(),null,{preamble:loc("Unable to delete company")})})}},{label:"No -- stop!!!",post_action:"denied"}]})}},{label:"Cancel",post_action:"denied"}]})},remove_from_amazon_suppression:function(k){ec_confirm({subject:loc("Enter email"),body:"<input type=text id=remove_from_amazon_suppression_email style=width:300px>",
+buttons:[{label:"Remove",action:function(){Client.request("/api/no-auth/amazon_ses_suppressed",{parameters:{email:$("#remove_from_amazon_suppression_email").val(),suppressed:0},method:"post"},function(c){if(200!==c.request.status_code){var a="Unexpected error";c&&c.body&&c.body.error&&c.body.error.message&&(a=c.body.error.message);ec_confirm({subject:a,buttons:[{label:"OK"}]})}})}},{label:"Cancel"}]})},leave_private_mode:function(){$.cookie("private",null);setTimeout(function(){Client.unset_onbeforeunload();
+window.location=""},1E3)}});
 Sexio_Status_View=EC_View.extend({events:{},initialize:function(){this.template=JST["private/sexio_status.jst"];this.model=new Backbone.Model;this.model.on("change",this.render,this);this.interval=setInterval(_.bind(this.fetch_server_status,this),1E3);this.fetch_server_status()},render:function(k){this.$el.html(this.template({status:this.model,server:this.server}))},fetch_server_status:function(){this.in_DOM()&&(this.server=Data.state.get("current_status_server"),this.fetch_lock||(this.fetch_lock=
 !0,$.ajax({url:"https://"+this.server+"/private/server_status",type:"GET",xhr:function(){return $.ajaxSettings.xhr()},xhrFields:{withCredentials:!0},processData:!1,cache:!1,success:_.bind(this.set_server_status,this),error:_.bind(function(k){this.fetch_lock=!1;console.warn(k)},this)})))},set_server_status:function(k){this.fetch_lock=!1;var c=JSON.stringify(k);this.old_data!=c&&(this.model.set(k),this.old_data=c)}});
 var Tophat_Configuration_View=EC_View.extend({id:"tophat_configuration",events:{"change select[name=create_or_remove]":"toggle_create"},initialize:function(){this.template=JST["private/tophat_configuration.jst"]},render:function(){this.$el.html(this.template())},toggle_create:function(){"create"===this.$("form").serializeObject(this).create_or_remove?this.$("#tophat_create_options").show():this.$("#tophat_create_options").hide()},save:function(){var k=this.$("form"),c=k.serializeObject(this);console.warn(c);
 c.errors?k.mark_errors(c.errors,this.cid):Client.request("/private/set_tophat",{method:"POST",parameters:c})}});
-(function(){function k(c){var a=k.resolve(c),f=k.modules[a];if(!f)throw Error('failed to require "'+c+'"');f.exports||(f.exports={},f.call(f.exports,f,f.exports,k.relative(a)));return f.exports}k.modules={};k.resolve=function(c){var a=c+".js",f=c+"/index.js";return k.modules[a]&&a||k.modules[f]&&f||c};k.register=function(c,a){k.modules[c]=a};k.relative=function(c){return function(a){if("."!=a.charAt(0))return k(a);var f=c.split("/");a=a.split("/");f.pop();for(var g=0;g<a.length;g++){var n=a[g];".."==
-n?f.pop():"."!=n&&f.push(n)}return k(f.join("/"))}};k.register("browser/debug.js",function(c,a,f){c.exports=function(a){return function(){}}});k.register("browser/diff.js",function(c,a,f){a=function(){function a(b){for(var d=[],h=0;h<b.length;h++)b[h]&&d.push(b[h]);return d}function c(b){b=b.replace(/&/g,"&amp;");b=b.replace(/</g,"&lt;");b=b.replace(/>/g,"&gt;");return b=b.replace(/"/g,"&quot;")}var m=function(b){this.ignoreWhitespace=b};m.prototype={diff:function(b,d){if(d==b)return[{value:d}];if(!d)return[{value:b,
-removed:!0}];if(!b)return[{value:d,added:!0}];d=this.tokenize(d);b=this.tokenize(b);var h=d.length,e=b.length,l=h+e,a=[{newPos:-1,components:[]}],m=this.extractCommon(a[0],d,b,0);if(a[0].newPos+1>=h&&m+1>=e)return a[0].components;for(var c=1;c<=l;c++)for(var f=-1*c;f<=c;f+=2){var g;g=a[f-1];var n=a[f+1],m=(n?n.newPos:0)-f;g&&(a[f-1]=void 0);var k=g&&g.newPos+1<h,q=n&&0<=m&&m<e;if(k||q){!k||q&&g.newPos<n.newPos?(g={newPos:n.newPos,components:n.components.slice(0)},this.pushComponent(g.components,b[m],
-void 0,!0)):(g={newPos:g.newPos,components:g.components.slice(0)},g.newPos++,this.pushComponent(g.components,d[g.newPos],!0,void 0));m=this.extractCommon(g,d,b,f);if(g.newPos+1>=h&&m+1>=e)return g.components;a[f]=g}else a[f]=void 0}},pushComponent:function(b,d,h,e){var a=b[b.length-1];a&&a.added===h&&a.removed===e?b[b.length-1]={value:this.join(a.value,d),added:h,removed:e}:b.push({value:d,added:h,removed:e})},extractCommon:function(b,d,h,e){var a=d.length,l=h.length,m=b.newPos;for(e=m-e;m+1<a&&e+
-1<l&&this.equals(d[m+1],h[e+1]);)m++,e++,this.pushComponent(b.components,d[m],void 0,void 0);b.newPos=m;return e},equals:function(b,d){var h=/\S/;return!this.ignoreWhitespace||h.test(b)||h.test(d)?b==d:!0},join:function(b,d){return b+d},tokenize:function(b){return b}};var e=new m,l=new m(!0);l.tokenize=function(b){return a(b.split(/(\s+|\b)/))};var h=new m(!0);h.tokenize=function(b){return a(b.split(/([{}:;,]|\s+)/))};var d=new m;d.tokenize=function(b){return b.split(/^/m)};return{diffChars:function(b,
-d){return e.diff(b,d)},diffWords:function(b,d){return l.diff(b,d)},diffLines:function(b,p){return d.diff(b,p)},diffCss:function(b,d){return h.diff(b,d)},createPatch:function(b,p,h,e,a){function l(b){return b.map(function(b){return" "+b})}function m(b,d,p){var h=g[g.length-2],e=d===g.length-2;d=d===g.length-3&&(p.added===!h.added||p.removed===!h.removed);/\n$/.test(p.value)||!e&&!d||b.push("\\ No newline at end of file")}var c=[];c.push("Index: "+b);c.push("===================================================================");
-c.push("--- "+b+("undefined"===typeof e?"":"\t"+e));c.push("+++ "+b+("undefined"===typeof a?"":"\t"+a));var g=d.diff(p,h);g[g.length-1].value||g.pop();g.push({value:"",lines:[]});p=b=0;h=[];a=e=1;for(var f=0;f<g.length;f++){var n=g[f],k=n.lines||n.value.replace(/\n$/,"").split("\n");n.lines=k;if(n.added||n.removed){if(!b){var q=g[f-1];b=e;p=a;q&&(h=l(q.lines.slice(-4)),b-=h.length,p-=h.length)}h.push.apply(h,k.map(function(b){return(n.added?"+":"-")+b}));m(h,f,n);n.added?a+=k.length:e+=k.length}else b&&
-(8>=k.length&&f<g.length-2?h.push.apply(h,l(k)):(q=Math.min(k.length,4),c.push("@@ -"+b+","+(e-b+q)+" +"+p+","+(a-p+q)+" @@"),c.push.apply(c,h),c.push.apply(c,l(k.slice(0,q))),4>=k.length&&m(c,f,n),p=b=0,h=[])),e+=k.length,a+=k.length}return c.join("\n")+"\n"},convertChangesToXML:function(b){for(var d=[],h=0;h<b.length;h++){var e=b[h];e.added?d.push("<ins>"):e.removed&&d.push("<del>");d.push(c(e.value));e.added?d.push("</ins>"):e.removed&&d.push("</del>")}return d.join("")}}}();"undefined"!==typeof c&&
-(c.exports=a)});k.register("browser/events.js",function(c,a,f){function g(a){return"[object Array]"=={}.toString.call(a)}function n(){}a.EventEmitter=n;n.prototype.on=function(a,e){this.$events||(this.$events={});this.$events[a]?g(this.$events[a])?this.$events[a].push(e):this.$events[a]=[this.$events[a],e]:this.$events[a]=e;return this};n.prototype.addListener=n.prototype.on;n.prototype.once=function(a,e){function l(){h.removeListener(a,l);e.apply(this,arguments)}var h=this;l.listener=e;this.on(a,
-l);return this};n.prototype.removeListener=function(a,e){if(this.$events&&this.$events[a]){var l=this.$events[a];if(g(l)){for(var h=-1,d=0,b=l.length;d<b;d++)if(l[d]===e||l[d].listener&&l[d].listener===e){h=d;break}if(0>h)return this;l.splice(h,1);l.length||delete this.$events[a]}else(l===e||l.listener&&l.listener===e)&&delete this.$events[a]}return this};n.prototype.removeAllListeners=function(a){if(void 0===a)return this.$events={},this;this.$events&&this.$events[a]&&(this.$events[a]=null);return this};
-n.prototype.listeners=function(a){this.$events||(this.$events={});this.$events[a]||(this.$events[a]=[]);g(this.$events[a])||(this.$events[a]=[this.$events[a]]);return this.$events[a]};n.prototype.emit=function(a){if(!this.$events)return!1;var e=this.$events[a];if(!e)return!1;var l=[].slice.call(arguments,1);if("function"==typeof e)e.apply(this,l);else if(g(e))for(var e=e.slice(),h=0,d=e.length;h<d;h++)e[h].apply(this,l);else return!1;return!0}});k.register("browser/fs.js",function(c,a,f){});k.register("browser/path.js",
-function(c,a,f){});k.register("browser/progress.js",function(c,a,f){function g(){this.percent=0;this.size(0);this.fontSize(11);this.font("helvetica, arial, sans-serif")}c.exports=g;g.prototype.size=function(a){this._size=a;return this};g.prototype.text=function(a){this._text=a;return this};g.prototype.fontSize=function(a){this._fontSize=a;return this};g.prototype.font=function(a){this._font=a;return this};g.prototype.update=function(a){this.percent=a;return this};g.prototype.draw=function(a){var c=
-Math.min(this.percent,100),e=this._size,l=e/2,h=l-1,d=this._fontSize;a.font=d+"px "+this._font;var b=c/100*Math.PI*2;a.clearRect(0,0,e,e);a.strokeStyle="#9f9f9f";a.beginPath();a.arc(l,l,h,0,b,!1);a.stroke();a.strokeStyle="#eee";a.beginPath();a.arc(l,l,h-1,0,b,!0);a.stroke();c=this._text||(c|0)+"%";e=a.measureText(c).width;a.fillText(c,l-e/2+1,l+d/2-1);return this}});k.register("browser/tty.js",function(c,a,f){a.isatty=function(){return!0};a.getWindowSize=function(){return[window.innerHeight,window.innerWidth]}});
-k.register("context.js",function(c,a,f){function g(){}c.exports=g;g.prototype.runnable=function(a){if(0==arguments.length)return this._runnable;this.test=this._runnable=a;return this};g.prototype.timeout=function(a){this.runnable().timeout(a);return this};g.prototype.slow=function(a){this.runnable().slow(a);return this};g.prototype.inspect=function(){return JSON.stringify(this,function(a,c){if("_runnable"!=a&&"test"!=a)return c},2)}});k.register("hook.js",function(c,a,f){function g(e,a){m.call(this,
-e,a);this.type="hook"}function n(){}var m=f("./runnable");c.exports=g;n.prototype=m.prototype;g.prototype=new n;g.prototype.constructor=g;g.prototype.error=function(e){if(0==arguments.length)return e=this._error,this._error=null,e;this._error=e}});k.register("interfaces/bdd.js",function(c,a,f){var g=f("../suite"),n=f("../test");c.exports=function(a){var e=[a];a.on("pre-require",function(a,h,d){a.before=function(b){e[0].beforeAll(b)};a.after=function(b){e[0].afterAll(b)};a.beforeEach=function(b){e[0].beforeEach(b)};
-a.afterEach=function(b){e[0].afterEach(b)};a.describe=a.context=function(b,d){var h=g.create(e[0],b);e.unshift(h);d.call(h);e.shift();return h};a.xdescribe=a.xcontext=a.describe.skip=function(b,d){var h=g.create(e[0],b);h.pending=!0;e.unshift(h);d.call(h);e.shift()};a.describe.only=function(b,p){var h=a.describe(b,p);d.grep(h.fullTitle())};a.it=a.specify=function(b,d){var h=e[0];h.pending&&(d=null);var a=new n(b,d);h.addTest(a);return a};a.it.only=function(b,p){var h=a.it(b,p);d.grep(h.fullTitle())};
-a.xit=a.xspecify=a.it.skip=function(b){a.it(b)}})}});k.register("interfaces/exports.js",function(c,a,f){var g=f("../suite"),n=f("../test");c.exports=function(a){function e(h){var d,b;for(b in h)if("function"==typeof h[b])switch(d=h[b],b){case "before":l[0].beforeAll(d);break;case "after":l[0].afterAll(d);break;case "beforeEach":l[0].beforeEach(d);break;case "afterEach":l[0].afterEach(d);break;default:l[0].addTest(new n(b,d))}else d=g.create(l[0],b),l.unshift(d),e(h[b]),l.shift()}var l=[a];a.on("require",
-e)}});k.register("interfaces/index.js",function(c,a,f){a.bdd=f("./bdd");a.tdd=f("./tdd");a.qunit=f("./qunit");a.exports=f("./exports")});k.register("interfaces/qunit.js",function(c,a,f){var g=f("../suite"),n=f("../test");c.exports=function(a){var e=[a];a.on("pre-require",function(a){a.before=function(h){e[0].beforeAll(h)};a.after=function(h){e[0].afterAll(h)};a.beforeEach=function(h){e[0].beforeEach(h)};a.afterEach=function(h){e[0].afterEach(h)};a.suite=function(h){1<e.length&&e.shift();h=g.create(e[0],
-h);e.unshift(h)};a.test=function(h,d){e[0].addTest(new n(h,d))}})}});k.register("interfaces/tdd.js",function(c,a,f){var g=f("../suite"),n=f("../test");c.exports=function(a){var e=[a];a.on("pre-require",function(a,h,d){a.setup=function(b){e[0].beforeEach(b)};a.teardown=function(b){e[0].afterEach(b)};a.suiteSetup=function(b){e[0].beforeAll(b)};a.suiteTeardown=function(b){e[0].afterAll(b)};a.suite=function(b,d){var a=g.create(e[0],b);e.unshift(a);d.call(a);e.shift();return a};a.suite.only=function(b,
-p){var h=a.suite(b,p);d.grep(h.fullTitle())};a.test=function(b,d){var a=new n(b,d);e[0].addTest(a);return a};a.test.only=function(b,p){var h=a.test(b,p);d.grep(h.fullTitle())};a.test.skip=function(b){a.test(b)}})}});k.register("mocha.js",function(c,a,f){function g(e){e=e||{};this.files=[];this.options=e;this.grep(e.grep);this.suite=new a.Suite("",new a.Context);this.ui(e.ui);this.bail(e.bail);this.reporter(e.reporter);e.timeout&&this.timeout(e.timeout);e.slow&&this.slow(e.slow)}var n=f("browser/path"),
-m=f("./utils");a=c.exports=g;a.utils=m;a.interfaces=f("./interfaces");a.reporters=f("./reporters");a.Runnable=f("./runnable");a.Context=f("./context");a.Runner=f("./runner");a.Suite=f("./suite");a.Hook=f("./hook");a.Test=f("./test");g.prototype.bail=function(a){0==arguments.length&&(a=!0);this.suite.bail(a);return this};g.prototype.addFile=function(a){this.files.push(a);return this};g.prototype.reporter=function(a){if("function"==typeof a)this._reporter=a;else{a=a||"dot";try{this._reporter=f("./reporters/"+
-a)}catch(c){this._reporter=f(a)}if(!this._reporter)throw Error('invalid reporter "'+a+'"');}return this};g.prototype.ui=function(e){e=e||"bdd";this._ui=a.interfaces[e];if(!this._ui)throw Error('invalid interface "'+e+'"');this._ui=this._ui(this.suite);return this};g.prototype.loadFiles=function(a){var c=this,h=this.suite,d=this.files.length;this.files.forEach(function(b){b=n.resolve(b);h.emit("pre-require",global,b,c);h.emit("require",f(b),b,c);h.emit("post-require",global,b,c);--d||a&&a()})};g.prototype._growl=
-function(a,c){var h=f("growl");a.on("end",function(){var d=c.stats;d.failures?h(d.failures+" of "+a.total+" tests failed",{name:"mocha",title:"Failed",image:__dirname+"/../images/error.png"}):h(d.passes+" tests passed in "+d.duration+"ms",{name:"mocha",title:"Passed",image:__dirname+"/../images/ok.png"})})};g.prototype.grep=function(a){this.options.grep="string"==typeof a?RegExp(m.escapeRegexp(a)):a;return this};g.prototype.invert=function(){this.options.invert=!0;return this};g.prototype.ignoreLeaks=
-function(){this.options.ignoreLeaks=!0;return this};g.prototype.checkLeaks=function(){this.options.ignoreLeaks=!1;return this};g.prototype.growl=function(){this.options.growl=!0;return this};g.prototype.globals=function(a){this.options.globals=(this.options.globals||[]).concat(a);return this};g.prototype.timeout=function(a){this.suite.timeout(a);return this};g.prototype.slow=function(a){this.suite.slow(a);return this};g.prototype.asyncOnly=function(){this.options.asyncOnly=!0;return this};g.prototype.run=
-function(e){this.files.length&&this.loadFiles();var c=this.options,h=new a.Runner(this.suite),d=new this._reporter(h);h.ignoreLeaks=c.ignoreLeaks;h.asyncOnly=c.asyncOnly;c.grep&&h.grep(c.grep,c.invert);c.globals&&h.globals(c.globals);c.growl&&this._growl(h,d);return h.run(e)}});k.register("ms.js",function(c,a,f){function g(a){if(a=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(a)){var c=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case "years":case "year":case "y":return 315576E5*
-c;case "days":case "day":case "d":return 864E5*c;case "hours":case "hour":case "h":return 36E5*c;case "minutes":case "minute":case "m":return 6E4*c;case "seconds":case "second":case "s":return 1E3*c;case "ms":return c}}}c.exports=function(a){return"string"==typeof a?g(a):864E5==a?Math.round(a/864E5)+" day":864E5<a?Math.round(a/864E5)+" days":36E5==a?Math.round(a/36E5)+" hour":36E5<a?Math.round(a/36E5)+" hours":6E4==a?Math.round(a/6E4)+" minute":6E4<a?Math.round(a/6E4)+" minutes":1E3==a?Math.round(a/
-1E3)+" second":1E3<a?Math.round(a/1E3)+" seconds":a+" ms"}});k.register("reporters/base.js",function(c,a,f){function g(b){var a=this.stats={suites:0,tests:0,passes:0,pending:0,failures:0},h=this.failures=[];b&&(this.runner=b,b.stats=a,b.on("start",function(){a.start=new d}),b.on("suite",function(b){a.suites=a.suites||0;b.root||a.suites++}),b.on("test end",function(b){a.tests=a.tests||0;a.tests++}),b.on("pass",function(b){a.passes=a.passes||0;var d=b.slow()/2;b.speed=b.duration>b.slow()?"slow":b.duration>
-d?"medium":"fast";a.passes++}),b.on("fail",function(b,d){a.failures=a.failures||0;a.failures++;b.err=d;h.push(b)}),b.on("end",function(){a.end=new d;a.duration=new d-a.start}),b.on("pending",function(){a.pending++}))}function n(b,d,a){return l["diff"+d](b.actual,b.expected).map(function(b){a&&(b.value=b.value.replace(/\t/g,"<tab>").replace(/\r/g,"<CR>").replace(/\n/g,"<LF>\n"));return b.added?m("diff added",b.value):b.removed?m("diff removed",b.value):b.value}).join("")}function m(d,a){return a.split("\n").map(function(a){return b(d,
-a)}).join("\n")}var e=f("browser/tty"),l=f("browser/diff"),h=f("../ms"),d=global.Date;f=e.isatty(1)&&e.isatty(2);a=c.exports=g;a.useColors=f;a.colors={pass:90,fail:31,"bright pass":92,"bright fail":91,"bright yellow":93,pending:36,suite:0,"error title":0,"error message":31,"error stack":90,checkmark:32,fast:90,medium:33,slow:31,green:32,light:90,"diff gutter":90,"diff added":42,"diff removed":41};a.symbols={ok:"\u2713",err:"\u2716",dot:"\u2024"};"win32"==process.platform&&(a.symbols.ok="\u221a",a.symbols.err=
+(function(){function k(c){var a=k.resolve(c),f=k.modules[a];if(!f)throw Error('failed to require "'+c+'"');f.exports||(f.exports={},f.call(f.exports,f,f.exports,k.relative(a)));return f.exports}k.modules={};k.resolve=function(c){var a=c+".js",f=c+"/index.js";return k.modules[a]&&a||k.modules[f]&&f||c};k.register=function(c,a){k.modules[c]=a};k.relative=function(c){return function(a){if("."!=a.charAt(0))return k(a);var f=c.split("/");a=a.split("/");f.pop();for(var h=0;h<a.length;h++){var n=a[h];".."==
+n?f.pop():"."!=n&&f.push(n)}return k(f.join("/"))}};k.register("browser/debug.js",function(c,a,f){c.exports=function(a){return function(){}}});k.register("browser/diff.js",function(c,a,f){a=function(){function a(b){for(var d=[],g=0;g<b.length;g++)b[g]&&d.push(b[g]);return d}function c(b){b=b.replace(/&/g,"&amp;");b=b.replace(/</g,"&lt;");b=b.replace(/>/g,"&gt;");return b=b.replace(/"/g,"&quot;")}var m=function(b){this.ignoreWhitespace=b};m.prototype={diff:function(b,d){if(d==b)return[{value:d}];if(!d)return[{value:b,
+removed:!0}];if(!b)return[{value:d,added:!0}];d=this.tokenize(d);b=this.tokenize(b);var g=d.length,e=b.length,a=g+e,l=[{newPos:-1,components:[]}],m=this.extractCommon(l[0],d,b,0);if(l[0].newPos+1>=g&&m+1>=e)return l[0].components;for(var c=1;c<=a;c++)for(var f=-1*c;f<=c;f+=2){var h;h=l[f-1];var n=l[f+1],m=(n?n.newPos:0)-f;h&&(l[f-1]=void 0);var k=h&&h.newPos+1<g,q=n&&0<=m&&m<e;if(k||q){!k||q&&h.newPos<n.newPos?(h={newPos:n.newPos,components:n.components.slice(0)},this.pushComponent(h.components,b[m],
+void 0,!0)):(h={newPos:h.newPos,components:h.components.slice(0)},h.newPos++,this.pushComponent(h.components,d[h.newPos],!0,void 0));m=this.extractCommon(h,d,b,f);if(h.newPos+1>=g&&m+1>=e)return h.components;l[f]=h}else l[f]=void 0}},pushComponent:function(b,d,g,e){var l=b[b.length-1];l&&l.added===g&&l.removed===e?b[b.length-1]={value:this.join(l.value,d),added:g,removed:e}:b.push({value:d,added:g,removed:e})},extractCommon:function(b,d,g,e){var l=d.length,a=g.length,m=b.newPos;for(e=m-e;m+1<l&&e+
+1<a&&this.equals(d[m+1],g[e+1]);)m++,e++,this.pushComponent(b.components,d[m],void 0,void 0);b.newPos=m;return e},equals:function(b,d){var g=/\S/;return!this.ignoreWhitespace||g.test(b)||g.test(d)?b==d:!0},join:function(b,d){return b+d},tokenize:function(b){return b}};var e=new m,l=new m(!0);l.tokenize=function(b){return a(b.split(/(\s+|\b)/))};var g=new m(!0);g.tokenize=function(b){return a(b.split(/([{}:;,]|\s+)/))};var d=new m;d.tokenize=function(b){return b.split(/^/m)};return{diffChars:function(b,
+d){return e.diff(b,d)},diffWords:function(b,d){return l.diff(b,d)},diffLines:function(b,p){return d.diff(b,p)},diffCss:function(b,d){return g.diff(b,d)},createPatch:function(b,p,g,e,l){function a(b){return b.map(function(b){return" "+b})}function m(b,d,p){var g=h[h.length-2],e=d===h.length-2;d=d===h.length-3&&(p.added===!g.added||p.removed===!g.removed);/\n$/.test(p.value)||!e&&!d||b.push("\\ No newline at end of file")}var c=[];c.push("Index: "+b);c.push("===================================================================");
+c.push("--- "+b+("undefined"===typeof e?"":"\t"+e));c.push("+++ "+b+("undefined"===typeof l?"":"\t"+l));var h=d.diff(p,g);h[h.length-1].value||h.pop();h.push({value:"",lines:[]});p=b=0;g=[];l=e=1;for(var f=0;f<h.length;f++){var n=h[f],k=n.lines||n.value.replace(/\n$/,"").split("\n");n.lines=k;if(n.added||n.removed){if(!b){var q=h[f-1];b=e;p=l;q&&(g=a(q.lines.slice(-4)),b-=g.length,p-=g.length)}g.push.apply(g,k.map(function(b){return(n.added?"+":"-")+b}));m(g,f,n);n.added?l+=k.length:e+=k.length}else b&&
+(8>=k.length&&f<h.length-2?g.push.apply(g,a(k)):(q=Math.min(k.length,4),c.push("@@ -"+b+","+(e-b+q)+" +"+p+","+(l-p+q)+" @@"),c.push.apply(c,g),c.push.apply(c,a(k.slice(0,q))),4>=k.length&&m(c,f,n),p=b=0,g=[])),e+=k.length,l+=k.length}return c.join("\n")+"\n"},convertChangesToXML:function(b){for(var d=[],g=0;g<b.length;g++){var e=b[g];e.added?d.push("<ins>"):e.removed&&d.push("<del>");d.push(c(e.value));e.added?d.push("</ins>"):e.removed&&d.push("</del>")}return d.join("")}}}();"undefined"!==typeof c&&
+(c.exports=a)});k.register("browser/events.js",function(c,a,f){function h(a){return"[object Array]"=={}.toString.call(a)}function n(){}a.EventEmitter=n;n.prototype.on=function(a,e){this.$events||(this.$events={});this.$events[a]?h(this.$events[a])?this.$events[a].push(e):this.$events[a]=[this.$events[a],e]:this.$events[a]=e;return this};n.prototype.addListener=n.prototype.on;n.prototype.once=function(a,e){function l(){g.removeListener(a,l);e.apply(this,arguments)}var g=this;l.listener=e;this.on(a,
+l);return this};n.prototype.removeListener=function(a,e){if(this.$events&&this.$events[a]){var l=this.$events[a];if(h(l)){for(var g=-1,d=0,b=l.length;d<b;d++)if(l[d]===e||l[d].listener&&l[d].listener===e){g=d;break}if(0>g)return this;l.splice(g,1);l.length||delete this.$events[a]}else(l===e||l.listener&&l.listener===e)&&delete this.$events[a]}return this};n.prototype.removeAllListeners=function(a){if(void 0===a)return this.$events={},this;this.$events&&this.$events[a]&&(this.$events[a]=null);return this};
+n.prototype.listeners=function(a){this.$events||(this.$events={});this.$events[a]||(this.$events[a]=[]);h(this.$events[a])||(this.$events[a]=[this.$events[a]]);return this.$events[a]};n.prototype.emit=function(a){if(!this.$events)return!1;var e=this.$events[a];if(!e)return!1;var l=[].slice.call(arguments,1);if("function"==typeof e)e.apply(this,l);else if(h(e))for(var e=e.slice(),g=0,d=e.length;g<d;g++)e[g].apply(this,l);else return!1;return!0}});k.register("browser/fs.js",function(c,a,f){});k.register("browser/path.js",
+function(c,a,f){});k.register("browser/progress.js",function(c,a,f){function h(){this.percent=0;this.size(0);this.fontSize(11);this.font("helvetica, arial, sans-serif")}c.exports=h;h.prototype.size=function(a){this._size=a;return this};h.prototype.text=function(a){this._text=a;return this};h.prototype.fontSize=function(a){this._fontSize=a;return this};h.prototype.font=function(a){this._font=a;return this};h.prototype.update=function(a){this.percent=a;return this};h.prototype.draw=function(a){var c=
+Math.min(this.percent,100),e=this._size,l=e/2,g=l-1,d=this._fontSize;a.font=d+"px "+this._font;var b=c/100*Math.PI*2;a.clearRect(0,0,e,e);a.strokeStyle="#9f9f9f";a.beginPath();a.arc(l,l,g,0,b,!1);a.stroke();a.strokeStyle="#eee";a.beginPath();a.arc(l,l,g-1,0,b,!0);a.stroke();c=this._text||(c|0)+"%";e=a.measureText(c).width;a.fillText(c,l-e/2+1,l+d/2-1);return this}});k.register("browser/tty.js",function(c,a,f){a.isatty=function(){return!0};a.getWindowSize=function(){return[window.innerHeight,window.innerWidth]}});
+k.register("context.js",function(c,a,f){function h(){}c.exports=h;h.prototype.runnable=function(a){if(0==arguments.length)return this._runnable;this.test=this._runnable=a;return this};h.prototype.timeout=function(a){this.runnable().timeout(a);return this};h.prototype.slow=function(a){this.runnable().slow(a);return this};h.prototype.inspect=function(){return JSON.stringify(this,function(a,c){if("_runnable"!=a&&"test"!=a)return c},2)}});k.register("hook.js",function(c,a,f){function h(e,a){m.call(this,
+e,a);this.type="hook"}function n(){}var m=f("./runnable");c.exports=h;n.prototype=m.prototype;h.prototype=new n;h.prototype.constructor=h;h.prototype.error=function(e){if(0==arguments.length)return e=this._error,this._error=null,e;this._error=e}});k.register("interfaces/bdd.js",function(c,a,f){var h=f("../suite"),n=f("../test");c.exports=function(a){var e=[a];a.on("pre-require",function(a,g,d){a.before=function(b){e[0].beforeAll(b)};a.after=function(b){e[0].afterAll(b)};a.beforeEach=function(b){e[0].beforeEach(b)};
+a.afterEach=function(b){e[0].afterEach(b)};a.describe=a.context=function(b,d){var g=h.create(e[0],b);e.unshift(g);d.call(g);e.shift();return g};a.xdescribe=a.xcontext=a.describe.skip=function(b,d){var g=h.create(e[0],b);g.pending=!0;e.unshift(g);d.call(g);e.shift()};a.describe.only=function(b,p){var g=a.describe(b,p);d.grep(g.fullTitle())};a.it=a.specify=function(b,d){var g=e[0];g.pending&&(d=null);var a=new n(b,d);g.addTest(a);return a};a.it.only=function(b,p){var g=a.it(b,p);d.grep(g.fullTitle())};
+a.xit=a.xspecify=a.it.skip=function(b){a.it(b)}})}});k.register("interfaces/exports.js",function(c,a,f){var h=f("../suite"),n=f("../test");c.exports=function(a){function e(g){var d,b;for(b in g)if("function"==typeof g[b])switch(d=g[b],b){case "before":l[0].beforeAll(d);break;case "after":l[0].afterAll(d);break;case "beforeEach":l[0].beforeEach(d);break;case "afterEach":l[0].afterEach(d);break;default:l[0].addTest(new n(b,d))}else d=h.create(l[0],b),l.unshift(d),e(g[b]),l.shift()}var l=[a];a.on("require",
+e)}});k.register("interfaces/index.js",function(c,a,f){a.bdd=f("./bdd");a.tdd=f("./tdd");a.qunit=f("./qunit");a.exports=f("./exports")});k.register("interfaces/qunit.js",function(c,a,f){var h=f("../suite"),n=f("../test");c.exports=function(a){var e=[a];a.on("pre-require",function(a){a.before=function(g){e[0].beforeAll(g)};a.after=function(g){e[0].afterAll(g)};a.beforeEach=function(g){e[0].beforeEach(g)};a.afterEach=function(g){e[0].afterEach(g)};a.suite=function(g){1<e.length&&e.shift();g=h.create(e[0],
+g);e.unshift(g)};a.test=function(g,d){e[0].addTest(new n(g,d))}})}});k.register("interfaces/tdd.js",function(c,a,f){var h=f("../suite"),n=f("../test");c.exports=function(a){var e=[a];a.on("pre-require",function(a,g,d){a.setup=function(b){e[0].beforeEach(b)};a.teardown=function(b){e[0].afterEach(b)};a.suiteSetup=function(b){e[0].beforeAll(b)};a.suiteTeardown=function(b){e[0].afterAll(b)};a.suite=function(b,d){var g=h.create(e[0],b);e.unshift(g);d.call(g);e.shift();return g};a.suite.only=function(b,
+p){var g=a.suite(b,p);d.grep(g.fullTitle())};a.test=function(b,d){var g=new n(b,d);e[0].addTest(g);return g};a.test.only=function(b,p){var g=a.test(b,p);d.grep(g.fullTitle())};a.test.skip=function(b){a.test(b)}})}});k.register("mocha.js",function(c,a,f){function h(e){e=e||{};this.files=[];this.options=e;this.grep(e.grep);this.suite=new a.Suite("",new a.Context);this.ui(e.ui);this.bail(e.bail);this.reporter(e.reporter);e.timeout&&this.timeout(e.timeout);e.slow&&this.slow(e.slow)}var n=f("browser/path"),
+m=f("./utils");a=c.exports=h;a.utils=m;a.interfaces=f("./interfaces");a.reporters=f("./reporters");a.Runnable=f("./runnable");a.Context=f("./context");a.Runner=f("./runner");a.Suite=f("./suite");a.Hook=f("./hook");a.Test=f("./test");h.prototype.bail=function(a){0==arguments.length&&(a=!0);this.suite.bail(a);return this};h.prototype.addFile=function(a){this.files.push(a);return this};h.prototype.reporter=function(a){if("function"==typeof a)this._reporter=a;else{a=a||"dot";try{this._reporter=f("./reporters/"+
+a)}catch(l){this._reporter=f(a)}if(!this._reporter)throw Error('invalid reporter "'+a+'"');}return this};h.prototype.ui=function(e){e=e||"bdd";this._ui=a.interfaces[e];if(!this._ui)throw Error('invalid interface "'+e+'"');this._ui=this._ui(this.suite);return this};h.prototype.loadFiles=function(a){var l=this,g=this.suite,d=this.files.length;this.files.forEach(function(b){b=n.resolve(b);g.emit("pre-require",global,b,l);g.emit("require",f(b),b,l);g.emit("post-require",global,b,l);--d||a&&a()})};h.prototype._growl=
+function(a,l){var g=f("growl");a.on("end",function(){var d=l.stats;d.failures?g(d.failures+" of "+a.total+" tests failed",{name:"mocha",title:"Failed",image:__dirname+"/../images/error.png"}):g(d.passes+" tests passed in "+d.duration+"ms",{name:"mocha",title:"Passed",image:__dirname+"/../images/ok.png"})})};h.prototype.grep=function(a){this.options.grep="string"==typeof a?RegExp(m.escapeRegexp(a)):a;return this};h.prototype.invert=function(){this.options.invert=!0;return this};h.prototype.ignoreLeaks=
+function(){this.options.ignoreLeaks=!0;return this};h.prototype.checkLeaks=function(){this.options.ignoreLeaks=!1;return this};h.prototype.growl=function(){this.options.growl=!0;return this};h.prototype.globals=function(a){this.options.globals=(this.options.globals||[]).concat(a);return this};h.prototype.timeout=function(a){this.suite.timeout(a);return this};h.prototype.slow=function(a){this.suite.slow(a);return this};h.prototype.asyncOnly=function(){this.options.asyncOnly=!0;return this};h.prototype.run=
+function(e){this.files.length&&this.loadFiles();var l=this.options,g=new a.Runner(this.suite),d=new this._reporter(g);g.ignoreLeaks=l.ignoreLeaks;g.asyncOnly=l.asyncOnly;l.grep&&g.grep(l.grep,l.invert);l.globals&&g.globals(l.globals);l.growl&&this._growl(g,d);return g.run(e)}});k.register("ms.js",function(c,a,f){function h(a){if(a=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(a)){var c=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case "years":case "year":case "y":return 315576E5*
+c;case "days":case "day":case "d":return 864E5*c;case "hours":case "hour":case "h":return 36E5*c;case "minutes":case "minute":case "m":return 6E4*c;case "seconds":case "second":case "s":return 1E3*c;case "ms":return c}}}c.exports=function(a){return"string"==typeof a?h(a):864E5==a?Math.round(a/864E5)+" day":864E5<a?Math.round(a/864E5)+" days":36E5==a?Math.round(a/36E5)+" hour":36E5<a?Math.round(a/36E5)+" hours":6E4==a?Math.round(a/6E4)+" minute":6E4<a?Math.round(a/6E4)+" minutes":1E3==a?Math.round(a/
+1E3)+" second":1E3<a?Math.round(a/1E3)+" seconds":a+" ms"}});k.register("reporters/base.js",function(c,a,f){function h(b){var a=this.stats={suites:0,tests:0,passes:0,pending:0,failures:0},g=this.failures=[];b&&(this.runner=b,b.stats=a,b.on("start",function(){a.start=new d}),b.on("suite",function(b){a.suites=a.suites||0;b.root||a.suites++}),b.on("test end",function(b){a.tests=a.tests||0;a.tests++}),b.on("pass",function(b){a.passes=a.passes||0;var d=b.slow()/2;b.speed=b.duration>b.slow()?"slow":b.duration>
+d?"medium":"fast";a.passes++}),b.on("fail",function(b,d){a.failures=a.failures||0;a.failures++;b.err=d;g.push(b)}),b.on("end",function(){a.end=new d;a.duration=new d-a.start}),b.on("pending",function(){a.pending++}))}function n(b,d,a){return l["diff"+d](b.actual,b.expected).map(function(b){a&&(b.value=b.value.replace(/\t/g,"<tab>").replace(/\r/g,"<CR>").replace(/\n/g,"<LF>\n"));return b.added?m("diff added",b.value):b.removed?m("diff removed",b.value):b.value}).join("")}function m(d,a){return a.split("\n").map(function(a){return b(d,
+a)}).join("\n")}var e=f("browser/tty"),l=f("browser/diff"),g=f("../ms"),d=global.Date;f=e.isatty(1)&&e.isatty(2);a=c.exports=h;a.useColors=f;a.colors={pass:90,fail:31,"bright pass":92,"bright fail":91,"bright yellow":93,pending:36,suite:0,"error title":0,"error message":31,"error stack":90,checkmark:32,fast:90,medium:33,slow:31,green:32,light:90,"diff gutter":90,"diff added":42,"diff removed":41};a.symbols={ok:"\u2713",err:"\u2716",dot:"\u2024"};"win32"==process.platform&&(a.symbols.ok="\u221a",a.symbols.err=
 "\u00d7",a.symbols.dot=".");var b=a.color=function(b,d){return a.useColors?"\u001b["+a.colors[b]+"m"+d+"\u001b[0m":d};a.window={width:f?process.stdout.getWindowSize?process.stdout.getWindowSize(1)[0]:e.getWindowSize()[1]:75};a.cursor={hide:function(){process.stdout.write("\u001b[?25l")},show:function(){process.stdout.write("\u001b[?25h")},deleteLine:function(){process.stdout.write("\u001b[2K")},beginningOfLine:function(){process.stdout.write("\u001b[0G")},CR:function(){a.cursor.deleteLine();a.cursor.beginningOfLine()}};
-a.list=function(d){console.error();d.forEach(function(d,a){var p=b("error title","  %s) %s:\n")+b("error message","     %s")+b("error stack","\n%s\n"),h=d.err,e=h.message||"",c=h.stack||e,e=c.indexOf(e)+e.length,l=c.slice(0,e),g=h.actual,m=h.expected,f=!0;h.showDiff&&(f=!1,h.actual=g=JSON.stringify(g,null,2),h.expected=m=JSON.stringify(m,null,2));if("string"==typeof g&&"string"==typeof m){l=20>Math.max(g.length,m.length)?n(h,"Chars",f):n(h,"Words",f);p=l.split("\n");if(4<p.length)var k=String(p.length).length,
-l=p.map(function(b,d){var a=++d,a=String(a);return Array(k-a.length+1).join(" ")+a+" | "+b}).join("\n");l="\n"+b("diff removed","actual")+" "+b("diff added","expected")+"\n\n"+l+"\n";l=l.replace(/^/gm,"      ");p=b("error title","  %s) %s:\n%s")+b("error stack","\n%s\n")}c=c.slice(e?e+1:e).replace(/^/gm,"  ");console.error(p,a+1,d.fullTitle(),l,c)})};g.prototype.epilogue=function(){var d=this.stats,e;console.log();d.failures?(e=b("bright fail","  "+a.symbols.err)+b("fail"," %d of %d %s failed")+b("light",
-":"),console.error(e,d.failures,this.runner.total,1==this.runner.total?"test":"tests"),g.list(this.failures),console.error()):(e=b("bright pass"," ")+b("green"," %d %s complete")+b("light"," (%s)"),console.log(e,d.tests||0,1==d.tests?"test":"tests",h(d.duration)),d.pending&&(e=b("pending"," ")+b("pending"," %d %s pending"),console.log(e,d.pending,1==d.pending?"test":"tests")),console.log())}});k.register("reporters/doc.js",function(c,a,f){var g=f("./base"),n=f("../utils");c.exports=function(a){function e(){return Array(c).join("  ")}
-g.call(this,a);var c=2;a.on("suite",function(a){a.root||(++c,console.log('%s<section class="suite">',e()),++c,console.log("%s<h1>%s</h1>",e(),n.escape(a.title)),console.log("%s<dl>",e()))});a.on("suite end",function(a){a.root||(console.log("%s</dl>",e()),--c,console.log("%s</section>",e()),--c)});a.on("pass",function(a){console.log("%s  <dt>%s</dt>",e(),n.escape(a.title));a=n.escape(n.clean(a.fn.toString()));console.log("%s  <dd><pre><code>%s</code></pre></dd>",e(),a)})}});k.register("reporters/dot.js",
-function(c,a,f){function g(a){m.call(this,a);var h=this,d=0.75*m.window.width|0,b=0;a.on("start",function(){process.stdout.write("\n  ")});a.on("pending",function(b){process.stdout.write(e("pending",m.symbols.dot))});a.on("pass",function(a){0==++b%d&&process.stdout.write("\n  ");"slow"==a.speed?process.stdout.write(e("bright yellow",m.symbols.dot)):process.stdout.write(e(a.speed,m.symbols.dot))});a.on("fail",function(a,h){0==++b%d&&process.stdout.write("\n  ");process.stdout.write(e("fail",m.symbols.dot))});
-a.on("end",function(){console.log();h.epilogue()})}function n(){}var m=f("./base"),e=m.color;c.exports=g;n.prototype=m.prototype;g.prototype=new n;g.prototype.constructor=g});k.register("reporters/html-cov.js",function(c,a,f){function g(a){return 75<=a?"high":50<=a?"medium":25<=a?"low":"terrible"}var n=f("./json-cov"),m=f("browser/fs");c.exports=function(a){var c=f("jade"),h=__dirname+"/templates/coverage.jade",d=m.readFileSync(h,"utf8"),b=c.compile(d,{filename:h}),p=this;n.call(this,a,!1);a.on("end",
-function(){process.stdout.write(b({cov:p.cov,coverageClass:g}))})}});k.register("reporters/html.js",function(c,a,f){function g(b){var d=arguments,a=document.createElement("div"),h=1;a.innerHTML=b.replace(/%([se])/g,function(b,a){switch(a){case "s":return String(d[h++]);case "e":return p(d[h++])}});return a.firstChild}function n(b){for(var d=document.getElementsByClassName("suite"),a=0;a<d.length;a++)0==d[a].getElementsByClassName(b).length&&(d[a].className+=" hidden")}function m(){for(var b=document.getElementsByClassName("suite hidden"),
-d=0;d<b.length;++d)b[d].className=b[d].className.replace("suite hidden","suite")}function e(b,d){b.textContent?b.textContent=d:b.innerText=d}function l(b,d,a){b.addEventListener?b.addEventListener(d,a,!1):b.attachEvent("on"+d,a)}var h=f("./base"),d=f("../utils"),b=f("../browser/progress"),p=d.escape,t=global.Date;c.exports=function(a,c){h.call(this,a);var f=this.stats,k=g(v),u=k.getElementsByTagName("li"),w=u[1].getElementsByTagName("em")[0],x=u[1].getElementsByTagName("a")[0],r=u[2].getElementsByTagName("em")[0],
-q=u[2].getElementsByTagName("a")[0],z=u[3].getElementsByTagName("em")[0],u=k.getElementsByTagName("canvas")[0],y=g('<ul id="mocha-report"></ul>'),B=[y],E,G;c=c||document.getElementById("mocha");if(u.getContext){var F=window.devicePixelRatio||1;u.style.width=u.width;u.style.height=u.height;u.width*=F;u.height*=F;G=u.getContext("2d");G.scale(F,F);E=new b}c?(l(x,"click",function(){m();var b=/pass/.test(y.className)?"":" pass";y.className=y.className.replace(/fail|pass/g,"")+b;y.className.trim()&&n("test pass")}),
-l(q,"click",function(){m();var b=/fail/.test(y.className)?"":" fail";y.className=y.className.replace(/fail|pass/g,"")+b;y.className.trim()&&n("test fail")}),c.appendChild(k),c.appendChild(y),E&&E.size(40),a.on("suite",function(b){if(!b.root){var d="?grep="+encodeURIComponent(b.fullTitle());b=g('<li class="suite"><h1><a href="%s">%s</a></h1></li>',d,p(b.title));B[0].appendChild(b);B.unshift(document.createElement("ul"));b.appendChild(B[0])}}),a.on("suite end",function(b){b.root||B.shift()}),a.on("fail",
-function(b,d){"hook"==b.type&&a.emit("test end",b)}),a.on("test end",function(b){window.scrollTo(0,document.body.scrollHeight);var a=f.tests/this.total*100|0;E&&E.update(a).draw(G);a=new t-f.start;e(w,f.passes);e(r,f.failures);e(z,(a/1E3).toFixed(2));if("passed"==b.state)a=g('<li class="test pass %e"><h2>%e<span class="duration">%ems</span> <a href="?grep=%e" class="replay">\u2023</a></h2></li>',b.speed,b.title,b.duration,encodeURIComponent(b.fullTitle()));else if(b.pending)a=g('<li class="test pass pending"><h2>%e</h2></li>',
-b.title);else{var a=g('<li class="test fail"><h2>%e <a href="?grep=%e" class="replay">\u2023</a></h2></li>',b.title,encodeURIComponent(b.fullTitle())),p=b.err.stack||b.err.toString();~p.indexOf(b.err.message)||(p=b.err.message+"\n"+p);"[object Error]"==p&&(p=b.err.message);!b.err.stack&&b.err.sourceURL&&void 0!==b.err.line&&(p+="\n("+b.err.sourceURL+":"+b.err.line+")");a.appendChild(g('<pre class="error">%e</pre>',p))}if(!b.pending){p=a.getElementsByTagName("h2")[0];l(p,"click",function(){h.style.display=
-"none"==h.style.display?"block":"none"});var h=g("<pre><code>%e</code></pre>",d.clean(b.fn.toString()));a.appendChild(h);h.style.display="none"}B[0]&&B[0].appendChild(a)})):document.body.appendChild(g('<div id="mocha-error">%s</div>',"#mocha div missing, add it to your document"))};var v='<ul id="mocha-stats"><li class="progress"><canvas width="40" height="40"></canvas></li><li class="passes"><a href="#">passes:</a> <em>0</em></li><li class="failures"><a href="#">failures:</a> <em>0</em></li><li class="duration">duration: <em>0</em>s</li></ul>'});
-k.register("reporters/index.js",function(c,a,f){a.Base=f("./base");a.Dot=f("./dot");a.Doc=f("./doc");a.TAP=f("./tap");a.JSON=f("./json");a.HTML=f("./html");a.List=f("./list");a.Min=f("./min");a.Spec=f("./spec");a.Nyan=f("./nyan");a.XUnit=f("./xunit");a.Markdown=f("./markdown");a.Progress=f("./progress");a.Landing=f("./landing");a.JSONCov=f("./json-cov");a.HTMLCov=f("./html-cov");a.JSONStream=f("./json-stream");a.Teamcity=f("./teamcity")});k.register("reporters/json-cov.js",function(c,a,f){function g(a){var h=
-{instrumentation:"node-jscoverage",sloc:0,hits:0,misses:0,coverage:0,files:[]},d;for(d in a){var b=n(d,a[d]);h.files.push(b);h.hits+=b.hits;h.misses+=b.misses;h.sloc+=b.sloc}h.files.sort(function(b,d){return b.filename.localeCompare(d.filename)});0<h.sloc&&(h.coverage=h.hits/h.sloc*100);return h}function n(a,h){var d={filename:a,coverage:0,hits:0,misses:0,sloc:0,source:{}};h.source.forEach(function(b,a){a++;0===h[a]?(d.misses++,d.sloc++):void 0!==h[a]&&(d.hits++,d.sloc++);d.source[a]={source:b,coverage:void 0===
-h[a]?"":h[a]}});d.coverage=d.hits/d.sloc*100;return d}function m(a){return{title:a.title,fullTitle:a.fullTitle(),duration:a.duration}}var e=f("./base");c.exports=function(a,h){var d=this;h=1==arguments.length?!0:h;e.call(this,a);var b=[],p=[],c=[];a.on("test end",function(d){b.push(d)});a.on("pass",function(b){c.push(b)});a.on("fail",function(b){p.push(b)});a.on("end",function(){var a=d.cov=g(global._$jscoverage||{});a.stats=d.stats;a.tests=b.map(m);a.failures=p.map(m);a.passes=c.map(m);h&&process.stdout.write(JSON.stringify(a,
-null,2))})}});k.register("reporters/json-stream.js",function(c,a,f){function g(a){return{title:a.title,fullTitle:a.fullTitle(),duration:a.duration}}var n=f("./base");c.exports=function(a){n.call(this,a);var e=this,c=a.total;a.on("start",function(){console.log(JSON.stringify(["start",{total:c}]))});a.on("pass",function(a){console.log(JSON.stringify(["pass",g(a)]))});a.on("fail",function(a,d){console.log(JSON.stringify(["fail",g(a)]))});a.on("end",function(){process.stdout.write(JSON.stringify(["end",
-e.stats]))})}});k.register("reporters/json.js",function(c,a,f){function g(a){return{title:a.title,fullTitle:a.fullTitle(),duration:a.duration}}var n=f("./base");c.exports=function(a){var e=this;n.call(this,a);var c=[],h=[],d=[];a.on("test end",function(b){c.push(b)});a.on("pass",function(b){d.push(b)});a.on("fail",function(b){h.push(b)});a.on("end",function(){var b={stats:e.stats,tests:c.map(g),failures:h.map(g),passes:d.map(g)};process.stdout.write(JSON.stringify(b,null,2))})}});k.register("reporters/landing.js",
-function(c,a,f){function g(a){function d(){var b=Array(p).join("-");return"  "+l("runway",b)}m.call(this,a);var b=this,p=0.75*m.window.width|0,c=a.total,g=process.stdout,f=l("plane","\u2708"),n=-1,k=0;a.on("start",function(){g.write("\n  ");e.hide()});a.on("test end",function(b){var a=-1==n?p*++k/c|0:n;"failed"==b.state&&(f=l("plane crash","\u2708"),n=a);g.write("\u001b[4F\n\n");g.write(d());g.write("\n  ");g.write(l("runway",Array(a).join("\u22c5")));g.write(f);g.write(l("runway",Array(p-a).join("\u22c5")+
-"\n"));g.write(d());g.write("\u001b[0m")});a.on("end",function(){e.show();console.log();b.epilogue()})}function n(){}var m=f("./base"),e=m.cursor,l=m.color;c.exports=g;m.colors.plane=0;m.colors["plane crash"]=31;m.colors.runway=90;n.prototype=m.prototype;g.prototype=new n;g.prototype.constructor=g});k.register("reporters/list.js",function(c,a,f){function g(a){m.call(this,a);var d=0;a.on("start",function(){console.log()});a.on("test",function(b){process.stdout.write(l("pass","    "+b.fullTitle()+": "))});
-a.on("pending",function(b){var a=l("checkmark","  -")+l("pending"," %s");console.log(a,b.fullTitle())});a.on("pass",function(b){var a=l("checkmark","  "+m.symbols.dot)+l("pass"," %s: ")+l(b.speed,"%dms");e.CR();console.log(a,b.fullTitle(),b.duration)});a.on("fail",function(b,a){e.CR();console.log(l("fail","  %d) %s"),++d,b.fullTitle())});a.on("end",this.epilogue.bind(this))}function n(){}var m=f("./base"),e=m.cursor,l=m.color;c.exports=g;n.prototype=m.prototype;g.prototype=new n;g.prototype.constructor=
-g});k.register("reporters/markdown.js",function(c,a,f){var g=f("./base"),n=f("../utils");c.exports=function(a){function e(b,a){var d=a;a=a[b.title]=a[b.title]||{suite:b};b.suites.forEach(function(b){e(b,a)});return d}function c(b,a){++a;var d="",h,e;for(e in b)"suite"!=e&&(e&&(h=" - ["+e+"](#"+n.slug(b[e].suite.fullTitle())+")\n"),e&&(d+=Array(a).join("  ")+h),d+=c(b[e],a));return d}function h(b){b=e(b,{});return c(b,0)}g.call(this,a);var d=0,b="";h(a.suite);a.on("suite",function(a){++d;var h=n.slug(a.fullTitle()),
-h=b+='<a name="'+h+'"></a>\n';a=a.title;a=Array(d).join("#")+" "+a;b=h+(a+"\n")});a.on("suite end",function(b){--d});a.on("pass",function(a){var d=n.clean(a.fn.toString());b+=a.title+".\n";b+="\n```js\n";b+=d+"\n";b+="```\n\n"});a.on("end",function(){process.stdout.write("# TOC\n");process.stdout.write(h(a.suite));process.stdout.write(b)})}});k.register("reporters/min.js",function(c,a,f){function g(a){m.call(this,a);a.on("start",function(){process.stdout.write("\u001b[2J");process.stdout.write("\u001b[1;3H")});
-a.on("end",this.epilogue.bind(this))}function n(){}var m=f("./base");c.exports=g;n.prototype=m.prototype;g.prototype=new n;g.prototype.constructor=g});k.register("reporters/nyan.js",function(c,a,f){function g(a){e.call(this,a);var h=this,d=0.75*e.window.width|0;this.rainbowColors=h.generateColors();this.colorIndex=0;this.numberOfLines=4;this.trajectories=[[],[],[],[]];var b=this.nyanCatWidth=11;this.trajectoryWidthMax=d-b;this.scoreboardWidth=5;this.tick=0;a.on("start",function(){e.cursor.hide();
-h.draw("start")});a.on("pending",function(b){h.draw("pending")});a.on("pass",function(b){h.draw("pass")});a.on("fail",function(b,a){h.draw("fail")});a.on("end",function(){e.cursor.show();for(var b=0;b<h.numberOfLines;b++)n("\n");h.epilogue()})}function n(a){process.stdout.write(a)}function m(){}var e=f("./base");c.exports=g;g.prototype.draw=function(a){this.appendRainbow();this.drawScoreboard();this.drawRainbow();this.drawNyanCat(a);this.tick=!this.tick};g.prototype.drawScoreboard=function(){function a(b,
-d){n(" ");n("\u001b["+b+"m"+d+"\u001b[0m");n("\n")}var h=this.stats,d=e.colors;a(d.green,h.passes);a(d.fail,h.failures);a(d.pending,h.pending);n("\n");this.cursorUp(this.numberOfLines)};g.prototype.appendRainbow=function(){for(var a=this.rainbowify(this.tick?"_":"-"),h=0;h<this.numberOfLines;h++){var d=this.trajectories[h];d.length>=this.trajectoryWidthMax&&d.shift();d.push(a)}};g.prototype.drawRainbow=function(){var a=this;this.trajectories.forEach(function(h,d){n("\u001b["+a.scoreboardWidth+"C");
-n(h.join(""));n("\n")});this.cursorUp(this.numberOfLines)};g.prototype.drawNyanCat=function(a){var h=this,d=this.scoreboardWidth+this.trajectories[0].length;[0,1,2,3].forEach(function(b){n("\u001b["+d+"C");switch(b){case 0:n("_,------,");n("\n");break;case 1:b=h.tick?"  ":"   ";n("_|"+b+"/\\_/\\ ");n("\n");break;case 2:b=h.tick?"_":"__";var p=h.tick?"~":"^",e;switch(a){case "pass":e="( ^ .^)";break;case "fail":e="( o .o)";break;default:e="( - .-)"}n(p+"|"+b+e+" ");n("\n");break;case 3:b=h.tick?" ":
-"  ",n(b+'""  "" '),n("\n")}});this.cursorUp(this.numberOfLines)};g.prototype.cursorUp=function(a){n("\u001b["+a+"A")};g.prototype.cursorDown=function(a){n("\u001b["+a+"B")};g.prototype.generateColors=function(){for(var a=[],h=0;42>h;h++){var d=Math.floor(Math.PI/3),b=1/6*h,p=Math.floor(3*Math.sin(b)+3),e=Math.floor(3*Math.sin(b+2*d)+3),d=Math.floor(3*Math.sin(b+4*d)+3);a.push(36*p+6*e+d+16)}return a};g.prototype.rainbowify=function(a){var h=this.rainbowColors[this.colorIndex%this.rainbowColors.length];
-this.colorIndex+=1;return"\u001b[38;5;"+h+"m"+a+"\u001b[0m"};m.prototype=e.prototype;g.prototype=new m;g.prototype.constructor=g});k.register("reporters/progress.js",function(c,a,f){function g(a,d){m.call(this,a);var b=this;d=d||{};var p=0.5*m.window.width|0,c=a.total,g=0;d.open=d.open||"[";d.complete=d.complete||"\u25ac";d.incomplete=d.incomplete||m.symbols.dot;d.close=d.close||"]";d.verbose=!1;a.on("start",function(){console.log();e.hide()});a.on("test end",function(){g++;var b=g/c*p|0,a=p-b;e.CR();
-process.stdout.write("\u001b[J");process.stdout.write(l("progress","  "+d.open));process.stdout.write(Array(b).join(d.complete));process.stdout.write(Array(a).join(d.incomplete));process.stdout.write(l("progress",d.close));d.verbose&&process.stdout.write(l("progress"," "+g+" of "+c))});a.on("end",function(){e.show();console.log();b.epilogue()})}function n(){}var m=f("./base"),e=m.cursor,l=m.color;c.exports=g;m.colors.progress=90;n.prototype=m.prototype;g.prototype=new n;g.prototype.constructor=g});
-k.register("reporters/spec.js",function(c,a,f){function g(a){function d(){return Array(b).join("  ")}m.call(this,a);var b=0,p=0;a.on("start",function(){console.log()});a.on("suite",function(a){++b;console.log(l("suite","%s%s"),d(),a.title)});a.on("suite end",function(a){--b;1==b&&console.log()});a.on("test",function(b){process.stdout.write(d()+l("pass","  \u25e6 "+b.title+": "))});a.on("pending",function(b){var a=d()+l("pending","  - %s");console.log(a,b.title)});a.on("pass",function(b){if("fast"==
-b.speed){var a=d()+l("checkmark","  "+m.symbols.ok)+l("pass"," %s ");e.CR();console.log(a,b.title)}else a=d()+l("checkmark","  "+m.symbols.ok)+l("pass"," %s ")+l(b.speed,"(%dms)"),e.CR(),console.log(a,b.title,b.duration)});a.on("fail",function(b,a){e.CR();console.log(d()+l("fail","  %d) %s"),++p,b.title)});a.on("end",this.epilogue.bind(this))}function n(){}var m=f("./base"),e=m.cursor,l=m.color;c.exports=g;n.prototype=m.prototype;g.prototype=new n;g.prototype.constructor=g});k.register("reporters/tap.js",
-function(c,a,f){var g=f("./base");c.exports=function(a){g.call(this,a);var c=1,e=0,f=0;a.on("start",function(){var h=a.grepTotal(a.suite);console.log("%d..%d",1,h)});a.on("test end",function(){++c});a.on("pending",function(a){console.log("ok %d %s # SKIP -",c,a.fullTitle().replace(/#/g,""))});a.on("pass",function(a){e++;console.log("ok %d %s",c,a.fullTitle().replace(/#/g,""))});a.on("fail",function(a,d){f++;console.log("not ok %d %s",c,a.fullTitle().replace(/#/g,""));d.stack&&console.log(d.stack.replace(/^/gm,
-"  "))});a.on("end",function(){console.log("# tests "+(e+f));console.log("# pass "+e);console.log("# fail "+f)})}});k.register("reporters/teamcity.js",function(c,a,f){function g(a){return a.replace(/\|/g,"||").replace(/\n/g,"|n").replace(/\r/g,"|r").replace(/\[/g,"|[").replace(/\]/g,"|]").replace(/\u0085/g,"|x").replace(/\u2028/g,"|l").replace(/\u2029/g,"|p").replace(/'/g,"|'")}var n=f("./base");c.exports=function(a){n.call(this,a);var e=this.stats;a.on("start",function(){console.log("##teamcity[testSuiteStarted name='mocha.suite']")});
-a.on("test",function(a){console.log("##teamcity[testStarted name='"+g(a.fullTitle())+"']")});a.on("fail",function(a,h){console.log("##teamcity[testFailed name='"+g(a.fullTitle())+"' message='"+g(h.message)+"']")});a.on("pending",function(a){console.log("##teamcity[testIgnored name='"+g(a.fullTitle())+"' message='pending']")});a.on("test end",function(a){console.log("##teamcity[testFinished name='"+g(a.fullTitle())+"' duration='"+a.duration+"']")});a.on("end",function(){console.log("##teamcity[testSuiteFinished name='mocha.suite' duration='"+
-e.duration+"']")})}});k.register("reporters/xunit.js",function(c,a,f){function g(b){l.call(this,b);var a=this.stats,h=[];b.on("pass",function(b){h.push(b)});b.on("fail",function(b){h.push(b)});b.on("end",function(){console.log(e("testsuite",{name:"Mocha Tests",tests:a.tests,failures:a.failures,errors:a.failures,skip:a.tests-a.failures-a.passes,timestamp:(new d).toUTCString(),time:a.duration/1E3},!1));h.forEach(m);console.log("</testsuite>")})}function n(){}function m(b){var a={classname:b.parent.fullTitle(),
-name:b.title,time:b.duration/1E3};"failed"==b.state?(b=b.err,a.message=h(b.message),console.log(e("testcase",a,!1,e("failure",a,!1,"<![CDATA["+h(b.stack)+"]]\x3e")))):b.pending?console.log(e("testcase",a,!1,e("skipped",{},!0))):console.log(e("testcase",a,!0))}function e(b,a,d,e){d=d?"/>":">";var c=[],g;for(g in a)c.push(g+'="'+h(a[g])+'"');a="<"+b+(c.length?" "+c.join(" "):"")+d;e&&(a+=e+"</"+b+d);return a}var l=f("./base"),h=f("../utils").escape,d=global.Date;c.exports=g;n.prototype=l.prototype;
-g.prototype=new n;g.prototype.constructor=g});k.register("runnable.js",function(c,a,f){function g(b,a){this.title=b;this.async=(this.fn=a)&&a.length;this.sync=!this.async;this._timeout=2E3;this._slow=75;this.timedOut=!1}function n(){}a=f("browser/events").EventEmitter;var m=f("browser/debug")("mocha:runnable"),e=f("./ms"),l=global.Date,h=global.setTimeout,d=global.clearTimeout,b=Object.prototype.toString;c.exports=g;n.prototype=a.prototype;g.prototype=new n;g.prototype.constructor=g;g.prototype.timeout=
-function(b){if(0==arguments.length)return this._timeout;"string"==typeof b&&(b=e(b));m("timeout %d",b);this._timeout=b;this.timer&&this.resetTimeout();return this};g.prototype.slow=function(b){if(0===arguments.length)return this._slow;"string"==typeof b&&(b=e(b));m("timeout %d",b);this._slow=b;return this};g.prototype.fullTitle=function(){return this.parent.fullTitle()+" "+this.title};g.prototype.clearTimeout=function(){d(this.timer)};g.prototype.inspect=function(){return JSON.stringify(this,function(b,
-a){if("_"!=b[0])return"parent"==b?"#<Suite>":"ctx"==b?"#<Context>":a},2)};g.prototype.resetTimeout=function(){var b=this,a=this.timeout();this.clearTimeout();a&&(this.timer=h(function(){b.callback(Error("timeout of "+a+"ms exceeded"));b.timedOut=!0},a))};g.prototype.run=function(a){function d(b){e.timedOut||(m?n||(n=!0,e.emit("error",b||Error("done() called multiple times"))):(e.clearTimeout(),e.duration=new l-g,m=!0,a(b)))}var e=this,c=this.timeout(),g=new l,f=this.ctx,m,n;f&&f.runnable(this);this.async&&
-c&&(this.timer=h(function(){d(Error("timeout of "+c+"ms exceeded"));e.timedOut=!0},c));this.callback=d;if(this.async)try{this.fn.call(f,function(a){if(a instanceof Error||"[object Error]"===b.call(a))return d(a);if(null!=a)return d(Error("done() invoked with non-Error: "+a));d()})}catch(k){d(k)}else{if(this.asyncOnly)return d(Error("--async-only option in use without declaring `done()`"));try{this.pending||this.fn.call(f),this.duration=new l-g,a()}catch(x){a(x)}}}});k.register("runner.js",function(c,
-a,f){function g(b){var a=this;this._globals=[];this.suite=b;this.total=b.total();this.failures=0;this.on("test end",function(b){a.checkGlobals(b)});this.on("hook end",function(b){a.checkGlobals(b)});this.grep(/.*/);this.globals(this.globalProps().concat(["errno"]))}function n(){}function m(b,a){return h(a,function(a){return 0==h(b,function(b){return~b.indexOf("*")?0==a.indexOf(b.split("*")[0]):/^mocha-/.test(a)?!0:a==b}).length&&(!global.navigator||"onerror"!==a)})}a=f("browser/events").EventEmitter;
-var e=f("browser/debug")("mocha:runner");f("./test");var l=f("./utils"),h=l.filter,d="setTimeout clearTimeout setInterval clearInterval XMLHttpRequest Date".split(" ");c.exports=g;n.prototype=a.prototype;g.prototype=new n;g.prototype.constructor=g;g.prototype.grep=function(b,a){e("grep %s",b);this._grep=b;this._invert=a;this.total=this.grepTotal(this.suite);return this};g.prototype.grepTotal=function(b){var a=this,d=0;b.eachTest(function(b){b=a._grep.test(b.fullTitle());a._invert&&(b=!b);b&&d++});
-return d};g.prototype.globalProps=function(){for(var b=l.keys(global),a=0;a<d.length;++a)~l.indexOf(b,d[a])||b.push(d[a]);return b};g.prototype.globals=function(b){if(0==arguments.length)return this._globals;e("globals %j",b);l.forEach(b,function(b){this._globals.push(b)},this);return this};g.prototype.checkGlobals=function(b){if(!this.ignoreLeaks){var a=this._globals,d=this.globalProps();process.kill&&1==a.length-d.length||2==a.length-d.length||(a=m(a,d),this._globals=this._globals.concat(a),1<a.length?
-this.fail(b,Error("global leaks detected: "+a.join(", ")+"")):a.length&&this.fail(b,Error("global leak detected: "+a[0])))}};g.prototype.fail=function(b,a){++this.failures;b.state="failed";"string"==typeof a&&(a=Error('the string "'+a+'" was thrown, throw an Error :)'));this.emit("fail",b,a)};g.prototype.failHook=function(b,a){this.fail(b,a);this.emit("end")};g.prototype.hook=function(b,a){function d(b){var c=h[b];if(!c)return a();e.currentRunnable=c;e.emit("hook",c);c.on("error",function(b){e.failHook(c,
-b)});c.run(function(a){c.removeAllListeners("error");var h=c.error();h&&e.fail(e.test,h);if(a)return e.failHook(c,a);e.emit("hook end",c);d(++b)})}var h=this.suite["_"+b],e=this;process.nextTick(function(){d(0)})};g.prototype.hooks=function(b,a,d){function h(g){e.suite=g;if(!g)return e.suite=c,d();e.hook(b,function(b){if(b)return e.suite=c,d(b);h(a.pop())})}var e=this,c=this.suite;h(a.pop())};g.prototype.hookUp=function(b,a){var d=[this.suite].concat(this.parents()).reverse();this.hooks(b,d,a)};g.prototype.hookDown=
-function(b,a){var d=[this.suite].concat(this.parents());this.hooks(b,d,a)};g.prototype.parents=function(){for(var b=this.suite,a=[];b=b.parent;)a.push(b);return a};g.prototype.runTest=function(b){var a=this.test,d=this;this.asyncOnly&&(a.asyncOnly=!0);try{a.on("error",function(b){d.fail(a,b)}),a.run(b)}catch(h){b(h)}};g.prototype.runTests=function(b,a){function d(g){if(h.failures&&b._bail)return a();c=e.shift();if(!c)return a();g=h._grep.test(c.fullTitle());h._invert&&(g=!g);if(!g)return d();if(c.pending)return h.emit("pending",
-c),h.emit("test end",c),d();h.emit("test",h.test=c);h.hookDown("beforeEach",function(){h.currentRunnable=h.test;h.runTest(function(b){c=h.test;if(b)return h.fail(c,b),h.emit("test end",c),h.hookUp("afterEach",d);c.state="passed";h.emit("pass",c);h.emit("test end",c);h.hookUp("afterEach",d)})})}var h=this,e=b.tests.slice(),c;this.next=d;d()};g.prototype.runSuite=function(b,a){function d(){var a=b.suites[f++];if(!a)return h();g.runSuite(a,d)}function h(){g.suite=b;g.hook("afterAll",function(){g.emit("suite end",
-b);a()})}var c=this.grepTotal(b),g=this,f=0;e("run suite %s",b.fullTitle());if(!c)return a();this.emit("suite",this.suite=b);this.hook("beforeAll",function(){g.runTests(b,d)})};g.prototype.uncaught=function(b){e("uncaught exception %s",b.message);var a=this.currentRunnable;a&&"failed"!=a.state&&(a.clearTimeout(),b.uncaught=!0,this.fail(a,b),"test"==a.type?(this.emit("test end",a),this.hookUp("afterEach",this.next)):this.emit("end"))};g.prototype.run=function(b){var a=this;b=b||function(){};e("start");
-this.on("end",function(){e("end");process.removeListener("uncaughtException",function(b){a.uncaught(b)});b(a.failures)});this.emit("start");this.runSuite(this.suite,function(){e("finished running");a.emit("end")});process.on("uncaughtException",function(b){a.uncaught(b)});return this}});k.register("suite.js",function(c,a,f){function g(b,a){this.title=b;this.ctx=a;this.suites=[];this.tests=[];this.pending=!1;this._beforeEach=[];this._beforeAll=[];this._afterEach=[];this._afterAll=[];this.root=!b;this._timeout=
-2E3;this._slow=75;this._bail=!1}function n(){}var m=f("browser/events").EventEmitter,e=f("browser/debug")("mocha:suite"),l=f("./ms"),h=f("./utils"),d=f("./hook");a=c.exports=g;a.create=function(b,a){var d=new g(a,b.ctx);d.parent=b;b.pending&&(d.pending=!0);d.fullTitle();b.addSuite(d);return d};n.prototype=m.prototype;g.prototype=new n;g.prototype.constructor=g;g.prototype.clone=function(){var b=new g(this.title);e("clone");b.ctx=this.ctx;b.timeout(this.timeout());b.slow(this.slow());b.bail(this.bail());
-return b};g.prototype.timeout=function(b){if(0==arguments.length)return this._timeout;"string"==typeof b&&(b=l(b));e("timeout %d",b);this._timeout=parseInt(b,10);return this};g.prototype.slow=function(b){if(0===arguments.length)return this._slow;"string"==typeof b&&(b=l(b));e("slow %d",b);this._slow=b;return this};g.prototype.bail=function(b){if(0==arguments.length)return this._bail;e("bail %s",b);this._bail=b;return this};g.prototype.beforeAll=function(b){if(this.pending)return this;b=new d('"before all" hook',
-b);b.parent=this;b.timeout(this.timeout());b.slow(this.slow());b.ctx=this.ctx;this._beforeAll.push(b);this.emit("beforeAll",b);return this};g.prototype.afterAll=function(b){if(this.pending)return this;b=new d('"after all" hook',b);b.parent=this;b.timeout(this.timeout());b.slow(this.slow());b.ctx=this.ctx;this._afterAll.push(b);this.emit("afterAll",b);return this};g.prototype.beforeEach=function(b){if(this.pending)return this;b=new d('"before each" hook',b);b.parent=this;b.timeout(this.timeout());
-b.slow(this.slow());b.ctx=this.ctx;this._beforeEach.push(b);this.emit("beforeEach",b);return this};g.prototype.afterEach=function(b){if(this.pending)return this;b=new d('"after each" hook',b);b.parent=this;b.timeout(this.timeout());b.slow(this.slow());b.ctx=this.ctx;this._afterEach.push(b);this.emit("afterEach",b);return this};g.prototype.addSuite=function(b){b.parent=this;b.timeout(this.timeout());b.slow(this.slow());b.bail(this.bail());this.suites.push(b);this.emit("suite",b);return this};g.prototype.addTest=
-function(b){b.parent=this;b.timeout(this.timeout());b.slow(this.slow());b.ctx=this.ctx;this.tests.push(b);this.emit("test",b);return this};g.prototype.fullTitle=function(){if(this.parent){var b=this.parent.fullTitle();if(b)return b+" "+this.title}return this.title};g.prototype.total=function(){return h.reduce(this.suites,function(b,a){return b+a.total()},0)+this.tests.length};g.prototype.eachTest=function(b){h.forEach(this.tests,b);h.forEach(this.suites,function(a){a.eachTest(b)});return this}});
-k.register("test.js",function(c,a,f){function g(a,c){m.call(this,a,c);this.pending=!c;this.type="test"}function n(){}var m=f("./runnable");c.exports=g;n.prototype=m.prototype;g.prototype=new n;g.prototype.constructor=g});k.register("utils.js",function(c,a,f){function g(a){return!~l.indexOf(a)}var n=f("browser/fs"),m=f("browser/path").join,e=f("browser/debug")("mocha:watch"),l=["node_modules",".git"];a.escape=function(a){return String(a).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,
-"&gt;")};a.forEach=function(a,d,b){for(var e=0,c=a.length;e<c;e++)d.call(b,a[e],e)};a.indexOf=function(a,d,b){b=b||0;for(var e=a.length;b<e;b++)if(a[b]===d)return b;return-1};a.reduce=function(a,d,b){for(var e=0,c=a.length;e<c;e++)b=d(b,a[e],e,a);return b};a.filter=function(a,d){for(var b=[],e=0,c=a.length;e<c;e++){var g=a[e];d(g,e,a)&&b.push(g)}return b};a.keys=Object.keys||function(a){var d=[],b=Object.prototype.hasOwnProperty,e;for(e in a)b.call(a,e)&&d.push(e);return d};a.watch=function(a,d){var b=
-{interval:100};a.forEach(function(a){e("file %s",a);n.watchFile(a,b,function(b,e){e.mtime<b.mtime&&d(a)})})};a.files=function(e,d){d=d||[];n.readdirSync(e).filter(g).forEach(function(b){b=m(e,b);n.statSync(b).isDirectory()?a.files(b,d):b.match(/\.(js|coffee)$/)&&d.push(b)});return d};a.slug=function(a){return a.toLowerCase().replace(/ +/g,"-").replace(/[^-\w]/g,"")};a.clean=function(e){e=e.replace(/^function *\(.*\) *{/,"").replace(/\s+\}$/,"");var d=e.match(/^\n?( *)/)[1].length;e=e.replace(RegExp("^ {"+
-d+"}","gm"),"");return a.trim(e)};a.escapeRegexp=function(a){return a.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")};a.trim=function(a){return a.replace(/^\s+|\s+$/g,"")};a.parseQuery=function(e){return a.reduce(e.replace("?","").split("&"),function(a,b){var e=b.indexOf("="),h=b.slice(0,e),e=b.slice(++e);a[h]=decodeURIComponent(e);return a},{})};a.highlightTags=function(a){a=document.getElementsByTagName(a);for(var d=0,b=a.length;d<b;++d)a[d].innerHTML=a[d].innerHTML.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\/\/(.*)/gm,
+a.list=function(d){console.error();d.forEach(function(d,a){var p=b("error title","  %s) %s:\n")+b("error message","     %s")+b("error stack","\n%s\n"),g=d.err,e=g.message||"",l=g.stack||e,e=l.indexOf(e)+e.length,c=l.slice(0,e),h=g.actual,m=g.expected,f=!0;g.showDiff&&(f=!1,g.actual=h=JSON.stringify(h,null,2),g.expected=m=JSON.stringify(m,null,2));if("string"==typeof h&&"string"==typeof m){c=20>Math.max(h.length,m.length)?n(g,"Chars",f):n(g,"Words",f);p=c.split("\n");if(4<p.length)var k=String(p.length).length,
+c=p.map(function(b,d){var a=++d,a=String(a);return Array(k-a.length+1).join(" ")+a+" | "+b}).join("\n");c="\n"+b("diff removed","actual")+" "+b("diff added","expected")+"\n\n"+c+"\n";c=c.replace(/^/gm,"      ");p=b("error title","  %s) %s:\n%s")+b("error stack","\n%s\n")}l=l.slice(e?e+1:e).replace(/^/gm,"  ");console.error(p,a+1,d.fullTitle(),c,l)})};h.prototype.epilogue=function(){var d=this.stats,e;console.log();d.failures?(e=b("bright fail","  "+a.symbols.err)+b("fail"," %d of %d %s failed")+b("light",
+":"),console.error(e,d.failures,this.runner.total,1==this.runner.total?"test":"tests"),h.list(this.failures),console.error()):(e=b("bright pass"," ")+b("green"," %d %s complete")+b("light"," (%s)"),console.log(e,d.tests||0,1==d.tests?"test":"tests",g(d.duration)),d.pending&&(e=b("pending"," ")+b("pending"," %d %s pending"),console.log(e,d.pending,1==d.pending?"test":"tests")),console.log())}});k.register("reporters/doc.js",function(c,a,f){var h=f("./base"),n=f("../utils");c.exports=function(a){function e(){return Array(l).join("  ")}
+h.call(this,a);var l=2;a.on("suite",function(a){a.root||(++l,console.log('%s<section class="suite">',e()),++l,console.log("%s<h1>%s</h1>",e(),n.escape(a.title)),console.log("%s<dl>",e()))});a.on("suite end",function(a){a.root||(console.log("%s</dl>",e()),--l,console.log("%s</section>",e()),--l)});a.on("pass",function(a){console.log("%s  <dt>%s</dt>",e(),n.escape(a.title));a=n.escape(n.clean(a.fn.toString()));console.log("%s  <dd><pre><code>%s</code></pre></dd>",e(),a)})}});k.register("reporters/dot.js",
+function(c,a,f){function h(a){m.call(this,a);var g=this,d=0.75*m.window.width|0,b=0;a.on("start",function(){process.stdout.write("\n  ")});a.on("pending",function(b){process.stdout.write(e("pending",m.symbols.dot))});a.on("pass",function(a){0==++b%d&&process.stdout.write("\n  ");"slow"==a.speed?process.stdout.write(e("bright yellow",m.symbols.dot)):process.stdout.write(e(a.speed,m.symbols.dot))});a.on("fail",function(a,g){0==++b%d&&process.stdout.write("\n  ");process.stdout.write(e("fail",m.symbols.dot))});
+a.on("end",function(){console.log();g.epilogue()})}function n(){}var m=f("./base"),e=m.color;c.exports=h;n.prototype=m.prototype;h.prototype=new n;h.prototype.constructor=h});k.register("reporters/html-cov.js",function(c,a,f){function h(a){return 75<=a?"high":50<=a?"medium":25<=a?"low":"terrible"}var n=f("./json-cov"),m=f("browser/fs");c.exports=function(a){var c=f("jade"),g=__dirname+"/templates/coverage.jade",d=m.readFileSync(g,"utf8"),b=c.compile(d,{filename:g}),p=this;n.call(this,a,!1);a.on("end",
+function(){process.stdout.write(b({cov:p.cov,coverageClass:h}))})}});k.register("reporters/html.js",function(c,a,f){function h(b){var d=arguments,a=document.createElement("div"),g=1;a.innerHTML=b.replace(/%([se])/g,function(b,a){switch(a){case "s":return String(d[g++]);case "e":return p(d[g++])}});return a.firstChild}function n(b){for(var d=document.getElementsByClassName("suite"),a=0;a<d.length;a++)0==d[a].getElementsByClassName(b).length&&(d[a].className+=" hidden")}function m(){for(var b=document.getElementsByClassName("suite hidden"),
+d=0;d<b.length;++d)b[d].className=b[d].className.replace("suite hidden","suite")}function e(b,d){b.textContent?b.textContent=d:b.innerText=d}function l(b,d,a){b.addEventListener?b.addEventListener(d,a,!1):b.attachEvent("on"+d,a)}var g=f("./base"),d=f("../utils"),b=f("../browser/progress"),p=d.escape,u=global.Date;c.exports=function(a,c){g.call(this,a);var f=this.stats,k=h(t),v=k.getElementsByTagName("li"),w=v[1].getElementsByTagName("em")[0],x=v[1].getElementsByTagName("a")[0],r=v[2].getElementsByTagName("em")[0],
+q=v[2].getElementsByTagName("a")[0],z=v[3].getElementsByTagName("em")[0],v=k.getElementsByTagName("canvas")[0],y=h('<ul id="mocha-report"></ul>'),B=[y],E,G;c=c||document.getElementById("mocha");if(v.getContext){var F=window.devicePixelRatio||1;v.style.width=v.width;v.style.height=v.height;v.width*=F;v.height*=F;G=v.getContext("2d");G.scale(F,F);E=new b}c?(l(x,"click",function(){m();var b=/pass/.test(y.className)?"":" pass";y.className=y.className.replace(/fail|pass/g,"")+b;y.className.trim()&&n("test pass")}),
+l(q,"click",function(){m();var b=/fail/.test(y.className)?"":" fail";y.className=y.className.replace(/fail|pass/g,"")+b;y.className.trim()&&n("test fail")}),c.appendChild(k),c.appendChild(y),E&&E.size(40),a.on("suite",function(b){if(!b.root){var d="?grep="+encodeURIComponent(b.fullTitle());b=h('<li class="suite"><h1><a href="%s">%s</a></h1></li>',d,p(b.title));B[0].appendChild(b);B.unshift(document.createElement("ul"));b.appendChild(B[0])}}),a.on("suite end",function(b){b.root||B.shift()}),a.on("fail",
+function(b,d){"hook"==b.type&&a.emit("test end",b)}),a.on("test end",function(b){window.scrollTo(0,document.body.scrollHeight);var a=f.tests/this.total*100|0;E&&E.update(a).draw(G);a=new u-f.start;e(w,f.passes);e(r,f.failures);e(z,(a/1E3).toFixed(2));if("passed"==b.state)a=h('<li class="test pass %e"><h2>%e<span class="duration">%ems</span> <a href="?grep=%e" class="replay">\u2023</a></h2></li>',b.speed,b.title,b.duration,encodeURIComponent(b.fullTitle()));else if(b.pending)a=h('<li class="test pass pending"><h2>%e</h2></li>',
+b.title);else{var a=h('<li class="test fail"><h2>%e <a href="?grep=%e" class="replay">\u2023</a></h2></li>',b.title,encodeURIComponent(b.fullTitle())),p=b.err.stack||b.err.toString();~p.indexOf(b.err.message)||(p=b.err.message+"\n"+p);"[object Error]"==p&&(p=b.err.message);!b.err.stack&&b.err.sourceURL&&void 0!==b.err.line&&(p+="\n("+b.err.sourceURL+":"+b.err.line+")");a.appendChild(h('<pre class="error">%e</pre>',p))}if(!b.pending){p=a.getElementsByTagName("h2")[0];l(p,"click",function(){g.style.display=
+"none"==g.style.display?"block":"none"});var g=h("<pre><code>%e</code></pre>",d.clean(b.fn.toString()));a.appendChild(g);g.style.display="none"}B[0]&&B[0].appendChild(a)})):document.body.appendChild(h('<div id="mocha-error">%s</div>',"#mocha div missing, add it to your document"))};var t='<ul id="mocha-stats"><li class="progress"><canvas width="40" height="40"></canvas></li><li class="passes"><a href="#">passes:</a> <em>0</em></li><li class="failures"><a href="#">failures:</a> <em>0</em></li><li class="duration">duration: <em>0</em>s</li></ul>'});
+k.register("reporters/index.js",function(c,a,f){a.Base=f("./base");a.Dot=f("./dot");a.Doc=f("./doc");a.TAP=f("./tap");a.JSON=f("./json");a.HTML=f("./html");a.List=f("./list");a.Min=f("./min");a.Spec=f("./spec");a.Nyan=f("./nyan");a.XUnit=f("./xunit");a.Markdown=f("./markdown");a.Progress=f("./progress");a.Landing=f("./landing");a.JSONCov=f("./json-cov");a.HTMLCov=f("./html-cov");a.JSONStream=f("./json-stream");a.Teamcity=f("./teamcity")});k.register("reporters/json-cov.js",function(c,a,f){function h(a){var g=
+{instrumentation:"node-jscoverage",sloc:0,hits:0,misses:0,coverage:0,files:[]},d;for(d in a){var b=n(d,a[d]);g.files.push(b);g.hits+=b.hits;g.misses+=b.misses;g.sloc+=b.sloc}g.files.sort(function(b,d){return b.filename.localeCompare(d.filename)});0<g.sloc&&(g.coverage=g.hits/g.sloc*100);return g}function n(a,g){var d={filename:a,coverage:0,hits:0,misses:0,sloc:0,source:{}};g.source.forEach(function(b,a){a++;0===g[a]?(d.misses++,d.sloc++):void 0!==g[a]&&(d.hits++,d.sloc++);d.source[a]={source:b,coverage:void 0===
+g[a]?"":g[a]}});d.coverage=d.hits/d.sloc*100;return d}function m(a){return{title:a.title,fullTitle:a.fullTitle(),duration:a.duration}}var e=f("./base");c.exports=function(a,g){var d=this;g=1==arguments.length?!0:g;e.call(this,a);var b=[],p=[],c=[];a.on("test end",function(d){b.push(d)});a.on("pass",function(b){c.push(b)});a.on("fail",function(b){p.push(b)});a.on("end",function(){var a=d.cov=h(global._$jscoverage||{});a.stats=d.stats;a.tests=b.map(m);a.failures=p.map(m);a.passes=c.map(m);g&&process.stdout.write(JSON.stringify(a,
+null,2))})}});k.register("reporters/json-stream.js",function(c,a,f){function h(a){return{title:a.title,fullTitle:a.fullTitle(),duration:a.duration}}var n=f("./base");c.exports=function(a){n.call(this,a);var e=this,c=a.total;a.on("start",function(){console.log(JSON.stringify(["start",{total:c}]))});a.on("pass",function(a){console.log(JSON.stringify(["pass",h(a)]))});a.on("fail",function(a,d){console.log(JSON.stringify(["fail",h(a)]))});a.on("end",function(){process.stdout.write(JSON.stringify(["end",
+e.stats]))})}});k.register("reporters/json.js",function(c,a,f){function h(a){return{title:a.title,fullTitle:a.fullTitle(),duration:a.duration}}var n=f("./base");c.exports=function(a){var e=this;n.call(this,a);var c=[],g=[],d=[];a.on("test end",function(b){c.push(b)});a.on("pass",function(b){d.push(b)});a.on("fail",function(b){g.push(b)});a.on("end",function(){var b={stats:e.stats,tests:c.map(h),failures:g.map(h),passes:d.map(h)};process.stdout.write(JSON.stringify(b,null,2))})}});k.register("reporters/landing.js",
+function(c,a,f){function h(a){function d(){var b=Array(p).join("-");return"  "+l("runway",b)}m.call(this,a);var b=this,p=0.75*m.window.width|0,c=a.total,h=process.stdout,f=l("plane","\u2708"),n=-1,k=0;a.on("start",function(){h.write("\n  ");e.hide()});a.on("test end",function(b){var a=-1==n?p*++k/c|0:n;"failed"==b.state&&(f=l("plane crash","\u2708"),n=a);h.write("\u001b[4F\n\n");h.write(d());h.write("\n  ");h.write(l("runway",Array(a).join("\u22c5")));h.write(f);h.write(l("runway",Array(p-a).join("\u22c5")+
+"\n"));h.write(d());h.write("\u001b[0m")});a.on("end",function(){e.show();console.log();b.epilogue()})}function n(){}var m=f("./base"),e=m.cursor,l=m.color;c.exports=h;m.colors.plane=0;m.colors["plane crash"]=31;m.colors.runway=90;n.prototype=m.prototype;h.prototype=new n;h.prototype.constructor=h});k.register("reporters/list.js",function(c,a,f){function h(a){m.call(this,a);var d=0;a.on("start",function(){console.log()});a.on("test",function(b){process.stdout.write(l("pass","    "+b.fullTitle()+": "))});
+a.on("pending",function(b){var d=l("checkmark","  -")+l("pending"," %s");console.log(d,b.fullTitle())});a.on("pass",function(b){var d=l("checkmark","  "+m.symbols.dot)+l("pass"," %s: ")+l(b.speed,"%dms");e.CR();console.log(d,b.fullTitle(),b.duration)});a.on("fail",function(b,a){e.CR();console.log(l("fail","  %d) %s"),++d,b.fullTitle())});a.on("end",this.epilogue.bind(this))}function n(){}var m=f("./base"),e=m.cursor,l=m.color;c.exports=h;n.prototype=m.prototype;h.prototype=new n;h.prototype.constructor=
+h});k.register("reporters/markdown.js",function(c,a,f){var h=f("./base"),n=f("../utils");c.exports=function(a){function e(b,d){var a=d;d=d[b.title]=d[b.title]||{suite:b};b.suites.forEach(function(b){e(b,d)});return a}function c(b,d){++d;var a="",g,e;for(e in b)"suite"!=e&&(e&&(g=" - ["+e+"](#"+n.slug(b[e].suite.fullTitle())+")\n"),e&&(a+=Array(d).join("  ")+g),a+=c(b[e],d));return a}function g(b){b=e(b,{});return c(b,0)}h.call(this,a);var d=0,b="";g(a.suite);a.on("suite",function(a){++d;var g=n.slug(a.fullTitle()),
+g=b+='<a name="'+g+'"></a>\n';a=a.title;a=Array(d).join("#")+" "+a;b=g+(a+"\n")});a.on("suite end",function(b){--d});a.on("pass",function(d){var a=n.clean(d.fn.toString());b+=d.title+".\n";b+="\n```js\n";b+=a+"\n";b+="```\n\n"});a.on("end",function(){process.stdout.write("# TOC\n");process.stdout.write(g(a.suite));process.stdout.write(b)})}});k.register("reporters/min.js",function(c,a,f){function h(a){m.call(this,a);a.on("start",function(){process.stdout.write("\u001b[2J");process.stdout.write("\u001b[1;3H")});
+a.on("end",this.epilogue.bind(this))}function n(){}var m=f("./base");c.exports=h;n.prototype=m.prototype;h.prototype=new n;h.prototype.constructor=h});k.register("reporters/nyan.js",function(c,a,f){function h(a){e.call(this,a);var g=this,d=0.75*e.window.width|0;this.rainbowColors=g.generateColors();this.colorIndex=0;this.numberOfLines=4;this.trajectories=[[],[],[],[]];var b=this.nyanCatWidth=11;this.trajectoryWidthMax=d-b;this.scoreboardWidth=5;this.tick=0;a.on("start",function(){e.cursor.hide();
+g.draw("start")});a.on("pending",function(b){g.draw("pending")});a.on("pass",function(b){g.draw("pass")});a.on("fail",function(b,a){g.draw("fail")});a.on("end",function(){e.cursor.show();for(var b=0;b<g.numberOfLines;b++)n("\n");g.epilogue()})}function n(a){process.stdout.write(a)}function m(){}var e=f("./base");c.exports=h;h.prototype.draw=function(a){this.appendRainbow();this.drawScoreboard();this.drawRainbow();this.drawNyanCat(a);this.tick=!this.tick};h.prototype.drawScoreboard=function(){function a(b,
+d){n(" ");n("\u001b["+b+"m"+d+"\u001b[0m");n("\n")}var g=this.stats,d=e.colors;a(d.green,g.passes);a(d.fail,g.failures);a(d.pending,g.pending);n("\n");this.cursorUp(this.numberOfLines)};h.prototype.appendRainbow=function(){for(var a=this.rainbowify(this.tick?"_":"-"),g=0;g<this.numberOfLines;g++){var d=this.trajectories[g];d.length>=this.trajectoryWidthMax&&d.shift();d.push(a)}};h.prototype.drawRainbow=function(){var a=this;this.trajectories.forEach(function(g,d){n("\u001b["+a.scoreboardWidth+"C");
+n(g.join(""));n("\n")});this.cursorUp(this.numberOfLines)};h.prototype.drawNyanCat=function(a){var g=this,d=this.scoreboardWidth+this.trajectories[0].length;[0,1,2,3].forEach(function(b){n("\u001b["+d+"C");switch(b){case 0:n("_,------,");n("\n");break;case 1:b=g.tick?"  ":"   ";n("_|"+b+"/\\_/\\ ");n("\n");break;case 2:b=g.tick?"_":"__";var p=g.tick?"~":"^",e;switch(a){case "pass":e="( ^ .^)";break;case "fail":e="( o .o)";break;default:e="( - .-)"}n(p+"|"+b+e+" ");n("\n");break;case 3:b=g.tick?" ":
+"  ",n(b+'""  "" '),n("\n")}});this.cursorUp(this.numberOfLines)};h.prototype.cursorUp=function(a){n("\u001b["+a+"A")};h.prototype.cursorDown=function(a){n("\u001b["+a+"B")};h.prototype.generateColors=function(){for(var a=[],g=0;42>g;g++){var d=Math.floor(Math.PI/3),b=1/6*g,p=Math.floor(3*Math.sin(b)+3),e=Math.floor(3*Math.sin(b+2*d)+3),d=Math.floor(3*Math.sin(b+4*d)+3);a.push(36*p+6*e+d+16)}return a};h.prototype.rainbowify=function(a){var g=this.rainbowColors[this.colorIndex%this.rainbowColors.length];
+this.colorIndex+=1;return"\u001b[38;5;"+g+"m"+a+"\u001b[0m"};m.prototype=e.prototype;h.prototype=new m;h.prototype.constructor=h});k.register("reporters/progress.js",function(c,a,f){function h(a,d){m.call(this,a);var b=this;d=d||{};var p=0.5*m.window.width|0,c=a.total,h=0;d.open=d.open||"[";d.complete=d.complete||"\u25ac";d.incomplete=d.incomplete||m.symbols.dot;d.close=d.close||"]";d.verbose=!1;a.on("start",function(){console.log();e.hide()});a.on("test end",function(){h++;var b=h/c*p|0,a=p-b;e.CR();
+process.stdout.write("\u001b[J");process.stdout.write(l("progress","  "+d.open));process.stdout.write(Array(b).join(d.complete));process.stdout.write(Array(a).join(d.incomplete));process.stdout.write(l("progress",d.close));d.verbose&&process.stdout.write(l("progress"," "+h+" of "+c))});a.on("end",function(){e.show();console.log();b.epilogue()})}function n(){}var m=f("./base"),e=m.cursor,l=m.color;c.exports=h;m.colors.progress=90;n.prototype=m.prototype;h.prototype=new n;h.prototype.constructor=h});
+k.register("reporters/spec.js",function(c,a,f){function h(a){function d(){return Array(b).join("  ")}m.call(this,a);var b=0,p=0;a.on("start",function(){console.log()});a.on("suite",function(a){++b;console.log(l("suite","%s%s"),d(),a.title)});a.on("suite end",function(a){--b;1==b&&console.log()});a.on("test",function(b){process.stdout.write(d()+l("pass","  \u25e6 "+b.title+": "))});a.on("pending",function(b){var a=d()+l("pending","  - %s");console.log(a,b.title)});a.on("pass",function(b){if("fast"==
+b.speed){var a=d()+l("checkmark","  "+m.symbols.ok)+l("pass"," %s ");e.CR();console.log(a,b.title)}else a=d()+l("checkmark","  "+m.symbols.ok)+l("pass"," %s ")+l(b.speed,"(%dms)"),e.CR(),console.log(a,b.title,b.duration)});a.on("fail",function(b,a){e.CR();console.log(d()+l("fail","  %d) %s"),++p,b.title)});a.on("end",this.epilogue.bind(this))}function n(){}var m=f("./base"),e=m.cursor,l=m.color;c.exports=h;n.prototype=m.prototype;h.prototype=new n;h.prototype.constructor=h});k.register("reporters/tap.js",
+function(c,a,f){var h=f("./base");c.exports=function(a){h.call(this,a);var c=1,e=0,l=0;a.on("start",function(){var g=a.grepTotal(a.suite);console.log("%d..%d",1,g)});a.on("test end",function(){++c});a.on("pending",function(a){console.log("ok %d %s # SKIP -",c,a.fullTitle().replace(/#/g,""))});a.on("pass",function(a){e++;console.log("ok %d %s",c,a.fullTitle().replace(/#/g,""))});a.on("fail",function(a,d){l++;console.log("not ok %d %s",c,a.fullTitle().replace(/#/g,""));d.stack&&console.log(d.stack.replace(/^/gm,
+"  "))});a.on("end",function(){console.log("# tests "+(e+l));console.log("# pass "+e);console.log("# fail "+l)})}});k.register("reporters/teamcity.js",function(c,a,f){function h(a){return a.replace(/\|/g,"||").replace(/\n/g,"|n").replace(/\r/g,"|r").replace(/\[/g,"|[").replace(/\]/g,"|]").replace(/\u0085/g,"|x").replace(/\u2028/g,"|l").replace(/\u2029/g,"|p").replace(/'/g,"|'")}var n=f("./base");c.exports=function(a){n.call(this,a);var e=this.stats;a.on("start",function(){console.log("##teamcity[testSuiteStarted name='mocha.suite']")});
+a.on("test",function(a){console.log("##teamcity[testStarted name='"+h(a.fullTitle())+"']")});a.on("fail",function(a,g){console.log("##teamcity[testFailed name='"+h(a.fullTitle())+"' message='"+h(g.message)+"']")});a.on("pending",function(a){console.log("##teamcity[testIgnored name='"+h(a.fullTitle())+"' message='pending']")});a.on("test end",function(a){console.log("##teamcity[testFinished name='"+h(a.fullTitle())+"' duration='"+a.duration+"']")});a.on("end",function(){console.log("##teamcity[testSuiteFinished name='mocha.suite' duration='"+
+e.duration+"']")})}});k.register("reporters/xunit.js",function(c,a,f){function h(b){l.call(this,b);var a=this.stats,g=[];b.on("pass",function(b){g.push(b)});b.on("fail",function(b){g.push(b)});b.on("end",function(){console.log(e("testsuite",{name:"Mocha Tests",tests:a.tests,failures:a.failures,errors:a.failures,skip:a.tests-a.failures-a.passes,timestamp:(new d).toUTCString(),time:a.duration/1E3},!1));g.forEach(m);console.log("</testsuite>")})}function n(){}function m(b){var a={classname:b.parent.fullTitle(),
+name:b.title,time:b.duration/1E3};"failed"==b.state?(b=b.err,a.message=g(b.message),console.log(e("testcase",a,!1,e("failure",a,!1,"<![CDATA["+g(b.stack)+"]]\x3e")))):b.pending?console.log(e("testcase",a,!1,e("skipped",{},!0))):console.log(e("testcase",a,!0))}function e(b,a,d,e){d=d?"/>":">";var c=[],h;for(h in a)c.push(h+'="'+g(a[h])+'"');a="<"+b+(c.length?" "+c.join(" "):"")+d;e&&(a+=e+"</"+b+d);return a}var l=f("./base"),g=f("../utils").escape,d=global.Date;c.exports=h;n.prototype=l.prototype;
+h.prototype=new n;h.prototype.constructor=h});k.register("runnable.js",function(c,a,f){function h(b,a){this.title=b;this.async=(this.fn=a)&&a.length;this.sync=!this.async;this._timeout=2E3;this._slow=75;this.timedOut=!1}function n(){}a=f("browser/events").EventEmitter;var m=f("browser/debug")("mocha:runnable"),e=f("./ms"),l=global.Date,g=global.setTimeout,d=global.clearTimeout,b=Object.prototype.toString;c.exports=h;n.prototype=a.prototype;h.prototype=new n;h.prototype.constructor=h;h.prototype.timeout=
+function(b){if(0==arguments.length)return this._timeout;"string"==typeof b&&(b=e(b));m("timeout %d",b);this._timeout=b;this.timer&&this.resetTimeout();return this};h.prototype.slow=function(b){if(0===arguments.length)return this._slow;"string"==typeof b&&(b=e(b));m("timeout %d",b);this._slow=b;return this};h.prototype.fullTitle=function(){return this.parent.fullTitle()+" "+this.title};h.prototype.clearTimeout=function(){d(this.timer)};h.prototype.inspect=function(){return JSON.stringify(this,function(b,
+a){if("_"!=b[0])return"parent"==b?"#<Suite>":"ctx"==b?"#<Context>":a},2)};h.prototype.resetTimeout=function(){var b=this,a=this.timeout();this.clearTimeout();a&&(this.timer=g(function(){b.callback(Error("timeout of "+a+"ms exceeded"));b.timedOut=!0},a))};h.prototype.run=function(a){function d(b){e.timedOut||(m?n||(n=!0,e.emit("error",b||Error("done() called multiple times"))):(e.clearTimeout(),e.duration=new l-h,m=!0,a(b)))}var e=this,c=this.timeout(),h=new l,f=this.ctx,m,n;f&&f.runnable(this);this.async&&
+c&&(this.timer=g(function(){d(Error("timeout of "+c+"ms exceeded"));e.timedOut=!0},c));this.callback=d;if(this.async)try{this.fn.call(f,function(a){if(a instanceof Error||"[object Error]"===b.call(a))return d(a);if(null!=a)return d(Error("done() invoked with non-Error: "+a));d()})}catch(k){d(k)}else{if(this.asyncOnly)return d(Error("--async-only option in use without declaring `done()`"));try{this.pending||this.fn.call(f),this.duration=new l-h,a()}catch(x){a(x)}}}});k.register("runner.js",function(c,
+a,f){function h(b){var a=this;this._globals=[];this.suite=b;this.total=b.total();this.failures=0;this.on("test end",function(b){a.checkGlobals(b)});this.on("hook end",function(b){a.checkGlobals(b)});this.grep(/.*/);this.globals(this.globalProps().concat(["errno"]))}function n(){}function m(b,a){return g(a,function(a){return 0==g(b,function(b){return~b.indexOf("*")?0==a.indexOf(b.split("*")[0]):/^mocha-/.test(a)?!0:a==b}).length&&(!global.navigator||"onerror"!==a)})}a=f("browser/events").EventEmitter;
+var e=f("browser/debug")("mocha:runner");f("./test");var l=f("./utils"),g=l.filter,d="setTimeout clearTimeout setInterval clearInterval XMLHttpRequest Date".split(" ");c.exports=h;n.prototype=a.prototype;h.prototype=new n;h.prototype.constructor=h;h.prototype.grep=function(b,a){e("grep %s",b);this._grep=b;this._invert=a;this.total=this.grepTotal(this.suite);return this};h.prototype.grepTotal=function(b){var a=this,d=0;b.eachTest(function(b){b=a._grep.test(b.fullTitle());a._invert&&(b=!b);b&&d++});
+return d};h.prototype.globalProps=function(){for(var b=l.keys(global),a=0;a<d.length;++a)~l.indexOf(b,d[a])||b.push(d[a]);return b};h.prototype.globals=function(b){if(0==arguments.length)return this._globals;e("globals %j",b);l.forEach(b,function(b){this._globals.push(b)},this);return this};h.prototype.checkGlobals=function(b){if(!this.ignoreLeaks){var a=this._globals,d=this.globalProps();process.kill&&1==a.length-d.length||2==a.length-d.length||(a=m(a,d),this._globals=this._globals.concat(a),1<a.length?
+this.fail(b,Error("global leaks detected: "+a.join(", ")+"")):a.length&&this.fail(b,Error("global leak detected: "+a[0])))}};h.prototype.fail=function(b,a){++this.failures;b.state="failed";"string"==typeof a&&(a=Error('the string "'+a+'" was thrown, throw an Error :)'));this.emit("fail",b,a)};h.prototype.failHook=function(b,a){this.fail(b,a);this.emit("end")};h.prototype.hook=function(b,a){function d(b){var c=g[b];if(!c)return a();e.currentRunnable=c;e.emit("hook",c);c.on("error",function(b){e.failHook(c,
+b)});c.run(function(a){c.removeAllListeners("error");var g=c.error();g&&e.fail(e.test,g);if(a)return e.failHook(c,a);e.emit("hook end",c);d(++b)})}var g=this.suite["_"+b],e=this;process.nextTick(function(){d(0)})};h.prototype.hooks=function(b,a,d){function g(h){e.suite=h;if(!h)return e.suite=c,d();e.hook(b,function(b){if(b)return e.suite=c,d(b);g(a.pop())})}var e=this,c=this.suite;g(a.pop())};h.prototype.hookUp=function(b,a){var d=[this.suite].concat(this.parents()).reverse();this.hooks(b,d,a)};h.prototype.hookDown=
+function(b,a){var d=[this.suite].concat(this.parents());this.hooks(b,d,a)};h.prototype.parents=function(){for(var b=this.suite,a=[];b=b.parent;)a.push(b);return a};h.prototype.runTest=function(b){var a=this.test,d=this;this.asyncOnly&&(a.asyncOnly=!0);try{a.on("error",function(b){d.fail(a,b)}),a.run(b)}catch(g){b(g)}};h.prototype.runTests=function(b,a){function d(h){if(g.failures&&b._bail)return a();c=e.shift();if(!c)return a();h=g._grep.test(c.fullTitle());g._invert&&(h=!h);if(!h)return d();if(c.pending)return g.emit("pending",
+c),g.emit("test end",c),d();g.emit("test",g.test=c);g.hookDown("beforeEach",function(){g.currentRunnable=g.test;g.runTest(function(b){c=g.test;if(b)return g.fail(c,b),g.emit("test end",c),g.hookUp("afterEach",d);c.state="passed";g.emit("pass",c);g.emit("test end",c);g.hookUp("afterEach",d)})})}var g=this,e=b.tests.slice(),c;this.next=d;d()};h.prototype.runSuite=function(b,a){function d(){var a=b.suites[f++];if(!a)return g();h.runSuite(a,d)}function g(){h.suite=b;h.hook("afterAll",function(){h.emit("suite end",
+b);a()})}var c=this.grepTotal(b),h=this,f=0;e("run suite %s",b.fullTitle());if(!c)return a();this.emit("suite",this.suite=b);this.hook("beforeAll",function(){h.runTests(b,d)})};h.prototype.uncaught=function(b){e("uncaught exception %s",b.message);var a=this.currentRunnable;a&&"failed"!=a.state&&(a.clearTimeout(),b.uncaught=!0,this.fail(a,b),"test"==a.type?(this.emit("test end",a),this.hookUp("afterEach",this.next)):this.emit("end"))};h.prototype.run=function(b){var a=this;b=b||function(){};e("start");
+this.on("end",function(){e("end");process.removeListener("uncaughtException",function(b){a.uncaught(b)});b(a.failures)});this.emit("start");this.runSuite(this.suite,function(){e("finished running");a.emit("end")});process.on("uncaughtException",function(b){a.uncaught(b)});return this}});k.register("suite.js",function(c,a,f){function h(b,a){this.title=b;this.ctx=a;this.suites=[];this.tests=[];this.pending=!1;this._beforeEach=[];this._beforeAll=[];this._afterEach=[];this._afterAll=[];this.root=!b;this._timeout=
+2E3;this._slow=75;this._bail=!1}function n(){}var m=f("browser/events").EventEmitter,e=f("browser/debug")("mocha:suite"),l=f("./ms"),g=f("./utils"),d=f("./hook");a=c.exports=h;a.create=function(b,a){var d=new h(a,b.ctx);d.parent=b;b.pending&&(d.pending=!0);d.fullTitle();b.addSuite(d);return d};n.prototype=m.prototype;h.prototype=new n;h.prototype.constructor=h;h.prototype.clone=function(){var b=new h(this.title);e("clone");b.ctx=this.ctx;b.timeout(this.timeout());b.slow(this.slow());b.bail(this.bail());
+return b};h.prototype.timeout=function(b){if(0==arguments.length)return this._timeout;"string"==typeof b&&(b=l(b));e("timeout %d",b);this._timeout=parseInt(b,10);return this};h.prototype.slow=function(b){if(0===arguments.length)return this._slow;"string"==typeof b&&(b=l(b));e("slow %d",b);this._slow=b;return this};h.prototype.bail=function(b){if(0==arguments.length)return this._bail;e("bail %s",b);this._bail=b;return this};h.prototype.beforeAll=function(b){if(this.pending)return this;b=new d('"before all" hook',
+b);b.parent=this;b.timeout(this.timeout());b.slow(this.slow());b.ctx=this.ctx;this._beforeAll.push(b);this.emit("beforeAll",b);return this};h.prototype.afterAll=function(b){if(this.pending)return this;b=new d('"after all" hook',b);b.parent=this;b.timeout(this.timeout());b.slow(this.slow());b.ctx=this.ctx;this._afterAll.push(b);this.emit("afterAll",b);return this};h.prototype.beforeEach=function(b){if(this.pending)return this;b=new d('"before each" hook',b);b.parent=this;b.timeout(this.timeout());
+b.slow(this.slow());b.ctx=this.ctx;this._beforeEach.push(b);this.emit("beforeEach",b);return this};h.prototype.afterEach=function(b){if(this.pending)return this;b=new d('"after each" hook',b);b.parent=this;b.timeout(this.timeout());b.slow(this.slow());b.ctx=this.ctx;this._afterEach.push(b);this.emit("afterEach",b);return this};h.prototype.addSuite=function(b){b.parent=this;b.timeout(this.timeout());b.slow(this.slow());b.bail(this.bail());this.suites.push(b);this.emit("suite",b);return this};h.prototype.addTest=
+function(b){b.parent=this;b.timeout(this.timeout());b.slow(this.slow());b.ctx=this.ctx;this.tests.push(b);this.emit("test",b);return this};h.prototype.fullTitle=function(){if(this.parent){var b=this.parent.fullTitle();if(b)return b+" "+this.title}return this.title};h.prototype.total=function(){return g.reduce(this.suites,function(b,a){return b+a.total()},0)+this.tests.length};h.prototype.eachTest=function(b){g.forEach(this.tests,b);g.forEach(this.suites,function(a){a.eachTest(b)});return this}});
+k.register("test.js",function(c,a,f){function h(a,c){m.call(this,a,c);this.pending=!c;this.type="test"}function n(){}var m=f("./runnable");c.exports=h;n.prototype=m.prototype;h.prototype=new n;h.prototype.constructor=h});k.register("utils.js",function(c,a,f){function h(a){return!~l.indexOf(a)}var n=f("browser/fs"),m=f("browser/path").join,e=f("browser/debug")("mocha:watch"),l=["node_modules",".git"];a.escape=function(a){return String(a).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,
+"&gt;")};a.forEach=function(a,d,b){for(var e=0,c=a.length;e<c;e++)d.call(b,a[e],e)};a.indexOf=function(a,d,b){b=b||0;for(var e=a.length;b<e;b++)if(a[b]===d)return b;return-1};a.reduce=function(a,d,b){for(var e=0,c=a.length;e<c;e++)b=d(b,a[e],e,a);return b};a.filter=function(a,d){for(var b=[],e=0,c=a.length;e<c;e++){var h=a[e];d(h,e,a)&&b.push(h)}return b};a.keys=Object.keys||function(a){var d=[],b=Object.prototype.hasOwnProperty,e;for(e in a)b.call(a,e)&&d.push(e);return d};a.watch=function(a,d){var b=
+{interval:100};a.forEach(function(a){e("file %s",a);n.watchFile(a,b,function(b,e){e.mtime<b.mtime&&d(a)})})};a.files=function(e,d){d=d||[];n.readdirSync(e).filter(h).forEach(function(b){b=m(e,b);n.statSync(b).isDirectory()?a.files(b,d):b.match(/\.(js|coffee)$/)&&d.push(b)});return d};a.slug=function(a){return a.toLowerCase().replace(/ +/g,"-").replace(/[^-\w]/g,"")};a.clean=function(e){e=e.replace(/^function *\(.*\) *{/,"").replace(/\s+\}$/,"");var d=e.match(/^\n?( *)/)[1].length;e=e.replace(RegExp("^ {"+
+d+"}","gm"),"");return a.trim(e)};a.escapeRegexp=function(a){return a.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")};a.trim=function(a){return a.replace(/^\s+|\s+$/g,"")};a.parseQuery=function(e){return a.reduce(e.replace("?","").split("&"),function(a,b){var e=b.indexOf("="),g=b.slice(0,e),e=b.slice(++e);a[g]=decodeURIComponent(e);return a},{})};a.highlightTags=function(a){a=document.getElementsByTagName(a);for(var d=0,b=a.length;d<b;++d)a[d].innerHTML=a[d].innerHTML.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\/\/(.*)/gm,
 '<span class="comment">//$1</span>').replace(/('.*?')/gm,'<span class="string">$1</span>').replace(/(\d+\.\d+)/gm,'<span class="number">$1</span>').replace(/(\d+)/gm,'<span class="number">$1</span>').replace(/\bnew *(\w+)/gm,'<span class="keyword">new</span> <span class="init">$1</span>').replace(/\b(function|new|throw|return|var|if|else)\b/gm,'<span class="keyword">$1</span>')}});process={exit:function(c){},stdout:{}};global=window;process.nextTick=function(){if(window.ActiveXObject||!window.postMessage)return function(a){a()};
-var c=[];window.addEventListener("message",function(a){a.source==window&&"mocha-zero-timeout"==a.data&&(a.stopPropagation&&a.stopPropagation(),c.length&&c.shift()())},!0);return function(a){c.push(a);window.postMessage("mocha-zero-timeout","*")}}();process.removeListener=function(c){"uncaughtException"==c&&(window.onerror=null)};process.on=function(c,a){"uncaughtException"==c&&(window.onerror=function(c,g,n){a(Error(c+" ("+g+":"+n+")"))})};(function(){var c=window.Mocha=k("mocha"),a=window.mocha=
-new c({reporter:"html"});a.ui=function(a){c.prototype.ui.call(this,a);this.suite.emit("pre-require",window,null,this);return this};a.setup=function(a){"string"==typeof a&&(a={ui:a});for(var c in a)this[c](a[c]);return this};a.run=function(f){a.globals("location");var g=c.utils.parseQuery(window.location.search||"");g.grep&&a.grep(g.grep);g.invert&&a.invert();return c.prototype.run.call(a,function(){c.utils.highlightTags("code");f&&f()})}})();mocha.setup("bdd")})();
+var c=[];window.addEventListener("message",function(a){a.source==window&&"mocha-zero-timeout"==a.data&&(a.stopPropagation&&a.stopPropagation(),c.length&&c.shift()())},!0);return function(a){c.push(a);window.postMessage("mocha-zero-timeout","*")}}();process.removeListener=function(c){"uncaughtException"==c&&(window.onerror=null)};process.on=function(c,a){"uncaughtException"==c&&(window.onerror=function(c,h,n){a(Error(c+" ("+h+":"+n+")"))})};(function(){var c=window.Mocha=k("mocha"),a=window.mocha=
+new c({reporter:"html"});a.ui=function(a){c.prototype.ui.call(this,a);this.suite.emit("pre-require",window,null,this);return this};a.setup=function(a){"string"==typeof a&&(a={ui:a});for(var c in a)this[c](a[c]);return this};a.run=function(f){a.globals("location");var h=c.utils.parseQuery(window.location.search||"");h.grep&&a.grep(h.grep);h.invert&&a.invert();return c.prototype.run.call(a,function(){c.utils.highlightTags("code");f&&f()})}})();mocha.setup("bdd")})();
 !function(k,c,a){"function"===typeof require&&"object"===typeof exports&&"object"===typeof module?module.exports=a():"function"===typeof define&&"object"===typeof define.amd?define(function(){return a()}):c[k]=a()}("chai",this,function(){function k(c){var a=k.resolve(c),f=k.modules[a];if(!f)throw Error('failed to require "'+c+'"');f.exports||(f.exports={},f.call(f.exports,f,f.exports,k.relative(a)));return f.exports}k.modules={};k.resolve=function(c){var a=c+".js",f=c+"/index.js";return k.modules[a]&&
-a||k.modules[f]&&f||c};k.register=function(c,a){k.modules[c]=a};k.relative=function(c){return function(a){if("."!=a.charAt(0))return k(a);var f=c.split("/");a=a.split("/");f.pop();for(var g=0;g<a.length;g++){var n=a[g];".."==n?f.pop():"."!=n&&f.push(n)}return k(f.join("/"))}};k.alias=function(c,a){k.modules[a]=k.modules[c]};k.register("chai.js",function(c,a,f){var g=[];a=c.exports={};a.version="1.5.0";a.Assertion=f("./chai/assertion");a.AssertionError=f("./chai/error");var n=f("./chai/utils");a.use=
-function(a){~g.indexOf(a)||(a(this,n),g.push(a));return this};c=f("./chai/core/assertions");a.use(c);c=f("./chai/interface/expect");a.use(c);c=f("./chai/interface/should");a.use(c);f=f("./chai/interface/assert");a.use(f)});k.register("chai/assertion.js",function(c,a,f){function g(a,h,d){e(this,"ssfi",d||arguments.callee);e(this,"object",a);e(this,"message",h)}var n=f("./error"),m=f("./utils"),e=m.flag;c.exports=g;g.includeStack=!1;g.showDiff=!0;g.addProperty=function(a,e){m.addProperty(this.prototype,
-a,e)};g.addMethod=function(a,e){m.addMethod(this.prototype,a,e)};g.addChainableMethod=function(a,e,d){m.addChainableMethod(this.prototype,a,e,d)};g.overwriteProperty=function(a,e){m.overwriteProperty(this.prototype,a,e)};g.overwriteMethod=function(a,e){m.overwriteMethod(this.prototype,a,e)};g.prototype.assert=function(a,h,d,b,c,f){var v=m.test(this,arguments);!0!==f&&(f=!1);!0!==g.showDiff&&(f=!1);if(!v)throw h=m.getMessage(this,arguments),v=m.getActual(this,arguments),new n({message:h,actual:v,expected:b,
-stackStartFunction:g.includeStack?this.assert:e(this,"ssfi"),showDiff:f});};Object.defineProperty(g.prototype,"_obj",{get:function(){return e(this,"object")},set:function(a){e(this,"object",a)}})});k.register("chai/core/assertions.js",function(c,a,f){c.exports=function(a,c){function f(b,a){a&&q(this,"message",a);b=b.toLowerCase();var d=q(this,"object"),e=~["a","e","i","o","u"].indexOf(b.charAt(0))?"an ":"a ";this.assert(b===c.type(d),"expected #{this} to be "+e+b,"expected #{this} not to be "+e+b)}
-function e(){q(this,"contains",!0)}function l(b,a){a&&q(this,"message",a);var d=q(this,"object");this.assert(~d.indexOf(b),"expected #{this} to include "+c.inspect(b),"expected #{this} to not include "+c.inspect(b))}function h(){var b=q(this,"object"),b=Object.prototype.toString.call(b);this.assert("[object Arguments]"===b,"expected #{this} to be arguments but got "+b,"expected #{this} to not be arguments")}function d(b,a){a&&q(this,"message",a);var d=q(this,"object");if(q(this,"deep"))return this.eql(b);
+a||k.modules[f]&&f||c};k.register=function(c,a){k.modules[c]=a};k.relative=function(c){return function(a){if("."!=a.charAt(0))return k(a);var f=c.split("/");a=a.split("/");f.pop();for(var h=0;h<a.length;h++){var n=a[h];".."==n?f.pop():"."!=n&&f.push(n)}return k(f.join("/"))}};k.alias=function(c,a){k.modules[a]=k.modules[c]};k.register("chai.js",function(c,a,f){var h=[];a=c.exports={};a.version="1.5.0";a.Assertion=f("./chai/assertion");a.AssertionError=f("./chai/error");var n=f("./chai/utils");a.use=
+function(a){~h.indexOf(a)||(a(this,n),h.push(a));return this};c=f("./chai/core/assertions");a.use(c);c=f("./chai/interface/expect");a.use(c);c=f("./chai/interface/should");a.use(c);f=f("./chai/interface/assert");a.use(f)});k.register("chai/assertion.js",function(c,a,f){function h(a,g,d){e(this,"ssfi",d||arguments.callee);e(this,"object",a);e(this,"message",g)}var n=f("./error"),m=f("./utils"),e=m.flag;c.exports=h;h.includeStack=!1;h.showDiff=!0;h.addProperty=function(a,e){m.addProperty(this.prototype,
+a,e)};h.addMethod=function(a,e){m.addMethod(this.prototype,a,e)};h.addChainableMethod=function(a,e,d){m.addChainableMethod(this.prototype,a,e,d)};h.overwriteProperty=function(a,e){m.overwriteProperty(this.prototype,a,e)};h.overwriteMethod=function(a,e){m.overwriteMethod(this.prototype,a,e)};h.prototype.assert=function(a,g,d,b,c,f){var t=m.test(this,arguments);!0!==f&&(f=!1);!0!==h.showDiff&&(f=!1);if(!t)throw g=m.getMessage(this,arguments),t=m.getActual(this,arguments),new n({message:g,actual:t,expected:b,
+stackStartFunction:h.includeStack?this.assert:e(this,"ssfi"),showDiff:f});};Object.defineProperty(h.prototype,"_obj",{get:function(){return e(this,"object")},set:function(a){e(this,"object",a)}})});k.register("chai/core/assertions.js",function(c,a,f){c.exports=function(a,c){function f(b,a){a&&q(this,"message",a);b=b.toLowerCase();var d=q(this,"object"),e=~["a","e","i","o","u"].indexOf(b.charAt(0))?"an ":"a ";this.assert(b===c.type(d),"expected #{this} to be "+e+b,"expected #{this} not to be "+e+b)}
+function e(){q(this,"contains",!0)}function l(b,a){a&&q(this,"message",a);var d=q(this,"object");this.assert(~d.indexOf(b),"expected #{this} to include "+c.inspect(b),"expected #{this} to not include "+c.inspect(b))}function g(){var b=q(this,"object"),b=Object.prototype.toString.call(b);this.assert("[object Arguments]"===b,"expected #{this} to be arguments but got "+b,"expected #{this} to not be arguments")}function d(b,a){a&&q(this,"message",a);var d=q(this,"object");if(q(this,"deep"))return this.eql(b);
 this.assert(b===d,"expected #{this} to equal #{exp}","expected #{this} to not equal #{exp}",b,this._obj,!0)}function b(b,a){a&&q(this,"message",a);this.assert(c.eql(b,q(this,"object")),"expected #{this} to deeply equal #{exp}","expected #{this} to not deeply equal #{exp}",b,this._obj,!0)}function p(b,a){a&&q(this,"message",a);var d=q(this,"object");q(this,"doLength")?((new r(d,a)).to.have.property("length"),d=d.length,this.assert(d>b,"expected #{this} to have a length above #{exp} but got #{act}",
-"expected #{this} to not have a length above #{exp}",b,d)):this.assert(d>b,"expected #{this} to be above "+b,"expected #{this} to be at most "+b)}function t(b,a){a&&q(this,"message",a);var d=q(this,"object");q(this,"doLength")?((new r(d,a)).to.have.property("length"),d=d.length,this.assert(d>=b,"expected #{this} to have a length at least #{exp} but got #{act}","expected #{this} to have a length below #{exp}",b,d)):this.assert(d>=b,"expected #{this} to be at least "+b,"expected #{this} to be below "+
-b)}function v(b,a){a&&q(this,"message",a);var d=q(this,"object");q(this,"doLength")?((new r(d,a)).to.have.property("length"),d=d.length,this.assert(d<b,"expected #{this} to have a length below #{exp} but got #{act}","expected #{this} to not have a length below #{exp}",b,d)):this.assert(d<b,"expected #{this} to be below "+b,"expected #{this} to be at least "+b)}function k(b,a){a&&q(this,"message",a);var d=q(this,"object");q(this,"doLength")?((new r(d,a)).to.have.property("length"),d=d.length,this.assert(d<=
+"expected #{this} to not have a length above #{exp}",b,d)):this.assert(d>b,"expected #{this} to be above "+b,"expected #{this} to be at most "+b)}function u(b,a){a&&q(this,"message",a);var d=q(this,"object");q(this,"doLength")?((new r(d,a)).to.have.property("length"),d=d.length,this.assert(d>=b,"expected #{this} to have a length at least #{exp} but got #{act}","expected #{this} to have a length below #{exp}",b,d)):this.assert(d>=b,"expected #{this} to be at least "+b,"expected #{this} to be below "+
+b)}function t(b,a){a&&q(this,"message",a);var d=q(this,"object");q(this,"doLength")?((new r(d,a)).to.have.property("length"),d=d.length,this.assert(d<b,"expected #{this} to have a length below #{exp} but got #{act}","expected #{this} to not have a length below #{exp}",b,d)):this.assert(d<b,"expected #{this} to be below "+b,"expected #{this} to be at least "+b)}function k(b,a){a&&q(this,"message",a);var d=q(this,"object");q(this,"doLength")?((new r(d,a)).to.have.property("length"),d=d.length,this.assert(d<=
 b,"expected #{this} to have a length at most #{exp} but got #{act}","expected #{this} to have a length above #{exp}",b,d)):this.assert(d<=b,"expected #{this} to be at most "+b,"expected #{this} to be above "+b)}function s(b,a){a&&q(this,"message",a);var d=c.getName(b);this.assert(q(this,"object")instanceof b,"expected #{this} to be an instance of "+d,"expected #{this} to not be an instance of "+d)}function C(b,a){a&&q(this,"message",a);var d=q(this,"object");this.assert(d.hasOwnProperty(b),"expected #{this} to have own property "+
-c.inspect(b),"expected #{this} to not have own property "+c.inspect(b))}function D(){q(this,"doLength",!0)}function u(b,a){a&&q(this,"message",a);var d=q(this,"object");(new r(d,a)).to.have.property("length");d=d.length;this.assert(d==b,"expected #{this} to have a length of #{exp} but got #{act}","expected #{this} to not have a length of #{act}",b,d)}function w(b){var a=q(this,"object"),d,e=!0;b=b instanceof Array?b:Array.prototype.slice.call(arguments);if(!b.length)throw Error("keys required");var h=
-Object.keys(a),a=b.length,e=b.every(function(b){return~h.indexOf(b)});q(this,"negate")||q(this,"contains")||(e=e&&b.length==h.length);1<a?(b=b.map(function(b){return c.inspect(b)}),d=b.pop(),d=b.join(", ")+", and "+d):d=c.inspect(b[0]);d=(1<a?"keys ":"key ")+d;d=(q(this,"contains")?"contain ":"have ")+d;this.assert(e,"expected #{this} to "+d,"expected #{this} to not "+d)}function x(b,a,d){d&&q(this,"message",d);var e=q(this,"object");(new r(e,d)).is.a("function");var h=!1,p=null,g=null,f=null;0===
-arguments.length?b=a=null:b&&(b instanceof RegExp||"string"===typeof b)?(a=b,b=null):b&&b instanceof Error?(p=b,a=b=null):"function"===typeof b?g=(new b).name:b=null;try{e()}catch(m){if(p)return this.assert(m===p,"expected #{this} to throw #{exp} but #{act} was thrown","expected #{this} to not throw #{exp}",p,m),this;if(b&&(this.assert(m instanceof b,"expected #{this} to throw #{exp} but #{act} was thrown","expected #{this} to not throw #{exp} but #{act} was thrown",g,m),!a))return this;h="object"===
-c.type(m)&&"message"in m?m.message:""+m;if(null!=h&&a&&a instanceof RegExp)return this.assert(a.exec(h),"expected #{this} to throw error matching #{exp} but got #{act}","expected #{this} to throw error not matching #{exp}",a,h),this;if(null!=h&&a&&"string"===typeof a)return this.assert(~h.indexOf(a),"expected #{this} to throw error including #{exp} but got #{act}","expected #{this} to throw error not including #{act}",a,h),this;h=!0;f=m}e="";g=null!==g?g:p?"#{exp}":"an error";h&&(e=" but #{act} was thrown");
-this.assert(!0===h,"expected #{this} to throw "+g+e,"expected #{this} to not throw "+g+e,p,f)}var r=a.Assertion,q=c.flag;"to be been is and have with that at of".split(" ").forEach(function(b){r.addProperty(b,function(){return this})});r.addProperty("not",function(){q(this,"negate",!0)});r.addProperty("deep",function(){q(this,"deep",!0)});r.addChainableMethod("an",f);r.addChainableMethod("a",f);r.addChainableMethod("include",l,e);r.addChainableMethod("contain",l,e);r.addProperty("ok",function(){this.assert(q(this,
+c.inspect(b),"expected #{this} to not have own property "+c.inspect(b))}function D(){q(this,"doLength",!0)}function v(b,a){a&&q(this,"message",a);var d=q(this,"object");(new r(d,a)).to.have.property("length");d=d.length;this.assert(d==b,"expected #{this} to have a length of #{exp} but got #{act}","expected #{this} to not have a length of #{act}",b,d)}function w(b){var a=q(this,"object"),d,e=!0;b=b instanceof Array?b:Array.prototype.slice.call(arguments);if(!b.length)throw Error("keys required");var g=
+Object.keys(a),a=b.length,e=b.every(function(b){return~g.indexOf(b)});q(this,"negate")||q(this,"contains")||(e=e&&b.length==g.length);1<a?(b=b.map(function(b){return c.inspect(b)}),d=b.pop(),d=b.join(", ")+", and "+d):d=c.inspect(b[0]);d=(1<a?"keys ":"key ")+d;d=(q(this,"contains")?"contain ":"have ")+d;this.assert(e,"expected #{this} to "+d,"expected #{this} to not "+d)}function x(b,a,d){d&&q(this,"message",d);var e=q(this,"object");(new r(e,d)).is.a("function");var g=!1,p=null,h=null,f=null;0===
+arguments.length?b=a=null:b&&(b instanceof RegExp||"string"===typeof b)?(a=b,b=null):b&&b instanceof Error?(p=b,a=b=null):"function"===typeof b?h=(new b).name:b=null;try{e()}catch(l){if(p)return this.assert(l===p,"expected #{this} to throw #{exp} but #{act} was thrown","expected #{this} to not throw #{exp}",p,l),this;if(b&&(this.assert(l instanceof b,"expected #{this} to throw #{exp} but #{act} was thrown","expected #{this} to not throw #{exp} but #{act} was thrown",h,l),!a))return this;g="object"===
+c.type(l)&&"message"in l?l.message:""+l;if(null!=g&&a&&a instanceof RegExp)return this.assert(a.exec(g),"expected #{this} to throw error matching #{exp} but got #{act}","expected #{this} to throw error not matching #{exp}",a,g),this;if(null!=g&&a&&"string"===typeof a)return this.assert(~g.indexOf(a),"expected #{this} to throw error including #{exp} but got #{act}","expected #{this} to throw error not including #{act}",a,g),this;g=!0;f=l}e="";h=null!==h?h:p?"#{exp}":"an error";g&&(e=" but #{act} was thrown");
+this.assert(!0===g,"expected #{this} to throw "+h+e,"expected #{this} to not throw "+h+e,p,f)}var r=a.Assertion,q=c.flag;"to be been is and have with that at of".split(" ").forEach(function(b){r.addProperty(b,function(){return this})});r.addProperty("not",function(){q(this,"negate",!0)});r.addProperty("deep",function(){q(this,"deep",!0)});r.addChainableMethod("an",f);r.addChainableMethod("a",f);r.addChainableMethod("include",l,e);r.addChainableMethod("contain",l,e);r.addProperty("ok",function(){this.assert(q(this,
 "object"),"expected #{this} to be truthy","expected #{this} to be falsy")});r.addProperty("true",function(){this.assert(!0===q(this,"object"),"expected #{this} to be true","expected #{this} to be false",this.negate?!1:!0)});r.addProperty("false",function(){this.assert(!1===q(this,"object"),"expected #{this} to be false","expected #{this} to be true",this.negate?!0:!1)});r.addProperty("null",function(){this.assert(null===q(this,"object"),"expected #{this} to be null","expected #{this} not to be null")});
 r.addProperty("undefined",function(){this.assert(void 0===q(this,"object"),"expected #{this} to be undefined","expected #{this} not to be undefined")});r.addProperty("exist",function(){this.assert(null!=q(this,"object"),"expected #{this} to exist","expected #{this} to not exist")});r.addProperty("empty",function(){var b=q(this,"object"),a=b;Array.isArray(b)||"string"===typeof object?a=b.length:"object"===typeof b&&(a=Object.keys(b).length);this.assert(!a,"expected #{this} to be empty","expected #{this} not to be empty")});
-r.addProperty("arguments",h);r.addProperty("Arguments",h);r.addMethod("equal",d);r.addMethod("equals",d);r.addMethod("eq",d);r.addMethod("eql",b);r.addMethod("eqls",b);r.addMethod("above",p);r.addMethod("gt",p);r.addMethod("greaterThan",p);r.addMethod("least",t);r.addMethod("gte",t);r.addMethod("below",v);r.addMethod("lt",v);r.addMethod("lessThan",v);r.addMethod("most",k);r.addMethod("lte",k);r.addMethod("within",function(b,a,d){d&&q(this,"message",d);var e=q(this,"object"),c=b+".."+a;q(this,"doLength")?
-((new r(e,d)).to.have.property("length"),d=e.length,this.assert(d>=b&&d<=a,"expected #{this} to have a length within "+c,"expected #{this} to not have a length within "+c)):this.assert(e>=b&&e<=a,"expected #{this} to be within "+c,"expected #{this} to not be within "+c)});r.addMethod("instanceof",s);r.addMethod("instanceOf",s);r.addMethod("property",function(b,a,d){d&&q(this,"message",d);var e=q(this,"deep")?"deep property ":"property ",h=q(this,"negate"),p=q(this,"object"),g=q(this,"deep")?c.getPathValue(b,
-p):p[b];if(h&&void 0!==a){if(void 0===g)throw Error((null!=d?d+": ":"")+c.inspect(p)+" has no "+e+c.inspect(b));}else this.assert(void 0!==g,"expected #{this} to have a "+e+c.inspect(b),"expected #{this} to not have "+e+c.inspect(b));void 0!==a&&this.assert(a===g,"expected #{this} to have a "+e+c.inspect(b)+" of #{exp}, but got #{act}","expected #{this} to not have a "+e+c.inspect(b)+" of #{act}",a,g);q(this,"object",g)});r.addMethod("ownProperty",C);r.addMethod("haveOwnProperty",C);r.addChainableMethod("length",
-u,D);r.addMethod("lengthOf",u,D);r.addMethod("match",function(b,a){a&&q(this,"message",a);var d=q(this,"object");this.assert(b.exec(d),"expected #{this} to match "+b,"expected #{this} not to match "+b)});r.addMethod("string",function(b,a){a&&q(this,"message",a);var d=q(this,"object");(new r(d,a)).is.a("string");this.assert(~d.indexOf(b),"expected #{this} to contain "+c.inspect(b),"expected #{this} to not contain "+c.inspect(b))});r.addMethod("keys",w);r.addMethod("key",w);r.addMethod("throw",x);r.addMethod("throws",
+r.addProperty("arguments",g);r.addProperty("Arguments",g);r.addMethod("equal",d);r.addMethod("equals",d);r.addMethod("eq",d);r.addMethod("eql",b);r.addMethod("eqls",b);r.addMethod("above",p);r.addMethod("gt",p);r.addMethod("greaterThan",p);r.addMethod("least",u);r.addMethod("gte",u);r.addMethod("below",t);r.addMethod("lt",t);r.addMethod("lessThan",t);r.addMethod("most",k);r.addMethod("lte",k);r.addMethod("within",function(b,a,d){d&&q(this,"message",d);var e=q(this,"object"),g=b+".."+a;q(this,"doLength")?
+((new r(e,d)).to.have.property("length"),d=e.length,this.assert(d>=b&&d<=a,"expected #{this} to have a length within "+g,"expected #{this} to not have a length within "+g)):this.assert(e>=b&&e<=a,"expected #{this} to be within "+g,"expected #{this} to not be within "+g)});r.addMethod("instanceof",s);r.addMethod("instanceOf",s);r.addMethod("property",function(b,a,d){d&&q(this,"message",d);var e=q(this,"deep")?"deep property ":"property ",g=q(this,"negate"),p=q(this,"object"),h=q(this,"deep")?c.getPathValue(b,
+p):p[b];if(g&&void 0!==a){if(void 0===h)throw Error((null!=d?d+": ":"")+c.inspect(p)+" has no "+e+c.inspect(b));}else this.assert(void 0!==h,"expected #{this} to have a "+e+c.inspect(b),"expected #{this} to not have "+e+c.inspect(b));void 0!==a&&this.assert(a===h,"expected #{this} to have a "+e+c.inspect(b)+" of #{exp}, but got #{act}","expected #{this} to not have a "+e+c.inspect(b)+" of #{act}",a,h);q(this,"object",h)});r.addMethod("ownProperty",C);r.addMethod("haveOwnProperty",C);r.addChainableMethod("length",
+v,D);r.addMethod("lengthOf",v,D);r.addMethod("match",function(b,a){a&&q(this,"message",a);var d=q(this,"object");this.assert(b.exec(d),"expected #{this} to match "+b,"expected #{this} not to match "+b)});r.addMethod("string",function(b,a){a&&q(this,"message",a);var d=q(this,"object");(new r(d,a)).is.a("string");this.assert(~d.indexOf(b),"expected #{this} to contain "+c.inspect(b),"expected #{this} to not contain "+c.inspect(b))});r.addMethod("keys",w);r.addMethod("key",w);r.addMethod("throw",x);r.addMethod("throws",
 x);r.addMethod("Throw",x);r.addMethod("respondTo",function(b,a){a&&q(this,"message",a);var d=q(this,"object"),e=q(this,"itself"),d="function"!==c.type(d)||e?d[b]:d.prototype[b];this.assert("function"===typeof d,"expected #{this} to respond to "+c.inspect(b),"expected #{this} to not respond to "+c.inspect(b))});r.addProperty("itself",function(){q(this,"itself",!0)});r.addMethod("satisfy",function(b,a){a&&q(this,"message",a);var d=q(this,"object");this.assert(b(d),"expected #{this} to satisfy "+c.objDisplay(b),
-"expected #{this} to not satisfy"+c.objDisplay(b),this.negate?!1:!0,b(d))});r.addMethod("closeTo",function(b,a,d){d&&q(this,"message",d);d=q(this,"object");this.assert(Math.abs(d-b)<=a,"expected #{this} to be close to "+b+" +/- "+a,"expected #{this} not to be close to "+b+" +/- "+a)})}});k.register("chai/error.js",function(c,a,f){function g(a){a=a||{};this.message=a.message;this.actual=a.actual;this.expected=a.expected;this.operator=a.operator;this.showDiff=a.showDiff;a.stackStartFunction&&Error.captureStackTrace&&
-Error.captureStackTrace(this,a.stackStartFunction)}c.exports=g;g.prototype=Object.create(Error.prototype);g.prototype.name="AssertionError";g.prototype.constructor=g;g.prototype.toString=function(){return this.message}});k.register("chai/interface/assert.js",function(c,a,f){c.exports=function(a,c){var f=a.Assertion,e=c.flag,l=a.assert=function(a,d){(new f(null)).assert(a,d,"[ negation message unavailable ]")};l.fail=function(e,d,b,c){throw new a.AssertionError({actual:e,expected:d,message:b,operator:c,
+"expected #{this} to not satisfy"+c.objDisplay(b),this.negate?!1:!0,b(d))});r.addMethod("closeTo",function(b,a,d){d&&q(this,"message",d);d=q(this,"object");this.assert(Math.abs(d-b)<=a,"expected #{this} to be close to "+b+" +/- "+a,"expected #{this} not to be close to "+b+" +/- "+a)})}});k.register("chai/error.js",function(c,a,f){function h(a){a=a||{};this.message=a.message;this.actual=a.actual;this.expected=a.expected;this.operator=a.operator;this.showDiff=a.showDiff;a.stackStartFunction&&Error.captureStackTrace&&
+Error.captureStackTrace(this,a.stackStartFunction)}c.exports=h;h.prototype=Object.create(Error.prototype);h.prototype.name="AssertionError";h.prototype.constructor=h;h.prototype.toString=function(){return this.message}});k.register("chai/interface/assert.js",function(c,a,f){c.exports=function(a,c){var f=a.Assertion,e=c.flag,l=a.assert=function(a,d){(new f(null)).assert(a,d,"[ negation message unavailable ]")};l.fail=function(e,d,b,c){throw new a.AssertionError({actual:e,expected:d,message:b,operator:c,
 stackStartFunction:l.fail});};l.ok=function(a,d){(new f(a,d)).is.ok};l.equal=function(a,d,b){b=new f(a,b);b.assert(d==e(b,"object"),"expected #{this} to equal #{exp}","expected #{this} to not equal #{act}",d,a)};l.notEqual=function(a,d,b){b=new f(a,b);b.assert(d!=e(b,"object"),"expected #{this} to not equal #{exp}","expected #{this} to equal #{act}",d,a)};l.strictEqual=function(a,d,b){(new f(a,b)).to.equal(d)};l.notStrictEqual=function(a,d,b){(new f(a,b)).to.not.equal(d)};l.deepEqual=function(a,d,
 b){(new f(a,b)).to.eql(d)};l.notDeepEqual=function(a,d,b){(new f(a,b)).to.not.eql(d)};l.isTrue=function(a,d){(new f(a,d)).is["true"]};l.isFalse=function(a,d){(new f(a,d)).is["false"]};l.isNull=function(a,d){(new f(a,d)).to.equal(null)};l.isNotNull=function(a,d){(new f(a,d)).to.not.equal(null)};l.isUndefined=function(a,d){(new f(a,d)).to.equal(void 0)};l.isDefined=function(a,d){(new f(a,d)).to.not.equal(void 0)};l.isFunction=function(a,d){(new f(a,d)).to.be.a("function")};l.isNotFunction=function(a,
 d){(new f(a,d)).to.not.be.a("function")};l.isObject=function(a,d){(new f(a,d)).to.be.a("object")};l.isNotObject=function(a,d){(new f(a,d)).to.not.be.a("object")};l.isArray=function(a,d){(new f(a,d)).to.be.an("array")};l.isNotArray=function(a,d){(new f(a,d)).to.not.be.an("array")};l.isString=function(a,d){(new f(a,d)).to.be.a("string")};l.isNotString=function(a,d){(new f(a,d)).to.not.be.a("string")};l.isNumber=function(a,d){(new f(a,d)).to.be.a("number")};l.isNotNumber=function(a,d){(new f(a,d)).to.not.be.a("number")};
@@ -230,144 +231,144 @@ d,b){(new f(a,b)).to.match(d)};l.notMatch=function(a,d,b){(new f(a,b)).to.not.ma
 b)};l.deepPropertyVal=function(a,d,b,e){(new f(a,e)).to.have.deep.property(d,b)};l.deepPropertyNotVal=function(a,d,b,e){(new f(a,e)).to.not.have.deep.property(d,b)};l.lengthOf=function(a,d,b){(new f(a,b)).to.have.length(d)};l.Throw=function(a,d,b,e){if("string"===typeof d||d instanceof RegExp)b=d,d=null;(new f(a,e)).to.Throw(d,b)};l.doesNotThrow=function(a,d,b){"string"===typeof d&&(b=d,d=null);(new f(a,b)).to.not.Throw(d)};l.operator=function(a,d,b,p){if(!~"== === > >= < <= != !==".split(" ").indexOf(d))throw Error('Invalid operator "'+
 d+'"');p=new f(eval(a+d+b),p);p.assert(!0===e(p,"object"),"expected "+c.inspect(a)+" to be "+d+" "+c.inspect(b),"expected "+c.inspect(a)+" to not be "+d+" "+c.inspect(b))};l.closeTo=function(a,d,b,e){(new f(a,e)).to.be.closeTo(d,b)};l.ifError=function(a,d){(new f(a,d)).to.not.be.ok};(function d(a,e){l[e]=l[a];return d})("Throw","throw")("Throw","throws")}});k.register("chai/interface/expect.js",function(c,a,f){c.exports=function(a,c){a.expect=function(c,e){return new a.Assertion(c,e)}}});k.register("chai/interface/should.js",
 function(c,a,f){c.exports=function(a,c){function f(){Object.defineProperty(Object.prototype,"should",{set:function(a){Object.defineProperty(this,"should",{value:a,enumerable:!0,configurable:!0,writable:!0})},get:function(){return this instanceof String||this instanceof Number?new e(this.constructor(this)):this instanceof Boolean?new e(!0==this):new e(this)},configurable:!0});var a={equal:function(a,d,b){(new e(a,b)).to.equal(d)},Throw:function(a,d,b,c){(new e(a,c)).to.Throw(d,b)},exist:function(a,
-d){(new e(a,d)).to.exist},not:{}};a.not.equal=function(a,d,b){(new e(a,b)).to.not.equal(d)};a.not.Throw=function(a,d,b,c){(new e(a,c)).to.not.Throw(d,b)};a.not.exist=function(a,d){(new e(a,d)).to.not.exist};a["throw"]=a.Throw;a.not["throw"]=a.not.Throw;return a}var e=a.Assertion;a.should=f;a.Should=f}});k.register("chai/utils/addChainableMethod.js",function(c,a,f){var g=f("./transferFlags"),n="__proto__"in Object,m=/^(?:length|name|arguments|caller)$/;c.exports=function(a,c,h,d){"function"!==typeof d&&
-(d=function(){});Object.defineProperty(a,c,{get:function(){d.call(this);var b=function(){var a=h.apply(this,arguments);return void 0===a?this:a};n?b.__proto__=this:Object.getOwnPropertyNames(a).forEach(function(d){if(!m.test(d)){var c=Object.getOwnPropertyDescriptor(a,d);Object.defineProperty(b,d,c)}});g(this,b);return b},configurable:!0})}});k.register("chai/utils/addMethod.js",function(c,a,f){c.exports=function(a,c,f){a[c]=function(){var a=f.apply(this,arguments);return void 0===a?this:a}}});k.register("chai/utils/addProperty.js",
-function(c,a,f){c.exports=function(a,c,f){Object.defineProperty(a,c,{get:function(){var a=f.call(this);return void 0===a?this:a},configurable:!0})}});k.register("chai/utils/eql.js",function(c,a,f){function g(a,b,e){if(a===b)return!0;if(l.isBuffer(a)&&l.isBuffer(b)){if(a.length!=b.length)return!1;for(e=0;e<a.length;e++)if(a[e]!==b[e])return!1;return!0}return a instanceof Date&&b instanceof Date?a.getTime()===b.getTime():"object"!=typeof a&&"object"!=typeof b?a===b:m(a,b,e)}function n(a){return"[object Arguments]"==
-Object.prototype.toString.call(a)}function m(a,b,c){if(null===a||void 0===a||null===b||void 0===b||a.prototype!==b.prototype)return!1;var h;if(c)for(h=0;h<c.length;h++){if(c[h][0]===a&&c[h][1]===b||c[h][0]===b&&c[h][1]===a)return!0}else c=[];if(n(a)){if(!n(b))return!1;a=pSlice.call(a);b=pSlice.call(b);return g(a,b,c)}try{var f=e(a),l=e(b)}catch(m){return!1}if(f.length!=l.length)return!1;f.sort();l.sort();for(h=f.length-1;0<=h;h--)if(f[h]!=l[h])return!1;c.push([a,b]);for(h=f.length-1;0<=h;h--)if(l=
-f[h],!g(a[l],b[l],c))return!1;return!0}c.exports=g;var e=f("./getEnumerableProperties"),l;try{l=f("buffer").Buffer}catch(h){l={isBuffer:function(){return!1}}}});k.register("chai/utils/flag.js",function(c,a,f){c.exports=function(a,c,f){var e=a.__flags||(a.__flags=Object.create(null));if(3===arguments.length)e[c]=f;else return e[c]}});k.register("chai/utils/getActual.js",function(c,a,f){c.exports=function(a,c){var f=c[4];return"undefined"!==typeof f?f:a._obj}});k.register("chai/utils/getEnumerableProperties.js",
-function(c,a,f){c.exports=function(a){var c=[],f;for(f in a)c.push(f);return c}});k.register("chai/utils/getMessage.js",function(c,a,f){var g=f("./flag"),n=f("./getActual");f("./inspect");var m=f("./objDisplay");c.exports=function(a,c){var h=g(a,"negate"),d=g(a,"object"),b=c[3],f=n(a,c),h=h?c[2]:c[1],t=g(a,"message"),h=(h||"").replace(/#{this}/g,m(d)).replace(/#{act}/g,m(f)).replace(/#{exp}/g,m(b));return t?t+": "+h:h}});k.register("chai/utils/getName.js",function(c,a,f){c.exports=function(a){return a.name?
-a.name:(a=/^\s?function ([^(]*)\(/.exec(a))&&a[1]?a[1]:""}});k.register("chai/utils/getPathValue.js",function(c,a,f){function g(a){return a.replace(/\[/g,".[").match(/(\\\.|[^.]+?)+/g).map(function(a){var e=/\[(\d+)\]$/.exec(a);return e?{i:parseFloat(e[1])}:{p:a}})}c.exports=function(a,c){for(var e=g(a),f=c,h,d=0,b=e.length;d<b;d++){var p=e[d];f?("undefined"!==typeof p.p?f=f[p.p]:"undefined"!==typeof p.i&&(f=f[p.i]),d==b-1&&(h=f)):h=void 0}return h}});k.register("chai/utils/getProperties.js",function(c,
+d){(new e(a,d)).to.exist},not:{}};a.not.equal=function(a,d,b){(new e(a,b)).to.not.equal(d)};a.not.Throw=function(a,d,b,c){(new e(a,c)).to.not.Throw(d,b)};a.not.exist=function(a,d){(new e(a,d)).to.not.exist};a["throw"]=a.Throw;a.not["throw"]=a.not.Throw;return a}var e=a.Assertion;a.should=f;a.Should=f}});k.register("chai/utils/addChainableMethod.js",function(c,a,f){var h=f("./transferFlags"),n="__proto__"in Object,m=/^(?:length|name|arguments|caller)$/;c.exports=function(a,c,g,d){"function"!==typeof d&&
+(d=function(){});Object.defineProperty(a,c,{get:function(){d.call(this);var b=function(){var a=g.apply(this,arguments);return void 0===a?this:a};n?b.__proto__=this:Object.getOwnPropertyNames(a).forEach(function(d){if(!m.test(d)){var c=Object.getOwnPropertyDescriptor(a,d);Object.defineProperty(b,d,c)}});h(this,b);return b},configurable:!0})}});k.register("chai/utils/addMethod.js",function(c,a,f){c.exports=function(a,c,f){a[c]=function(){var a=f.apply(this,arguments);return void 0===a?this:a}}});k.register("chai/utils/addProperty.js",
+function(c,a,f){c.exports=function(a,c,f){Object.defineProperty(a,c,{get:function(){var a=f.call(this);return void 0===a?this:a},configurable:!0})}});k.register("chai/utils/eql.js",function(c,a,f){function h(a,b,e){if(a===b)return!0;if(l.isBuffer(a)&&l.isBuffer(b)){if(a.length!=b.length)return!1;for(e=0;e<a.length;e++)if(a[e]!==b[e])return!1;return!0}return a instanceof Date&&b instanceof Date?a.getTime()===b.getTime():"object"!=typeof a&&"object"!=typeof b?a===b:m(a,b,e)}function n(a){return"[object Arguments]"==
+Object.prototype.toString.call(a)}function m(a,b,c){if(null===a||void 0===a||null===b||void 0===b||a.prototype!==b.prototype)return!1;var g;if(c)for(g=0;g<c.length;g++){if(c[g][0]===a&&c[g][1]===b||c[g][0]===b&&c[g][1]===a)return!0}else c=[];if(n(a)){if(!n(b))return!1;a=pSlice.call(a);b=pSlice.call(b);return h(a,b,c)}try{var f=e(a),l=e(b)}catch(m){return!1}if(f.length!=l.length)return!1;f.sort();l.sort();for(g=f.length-1;0<=g;g--)if(f[g]!=l[g])return!1;c.push([a,b]);for(g=f.length-1;0<=g;g--)if(l=
+f[g],!h(a[l],b[l],c))return!1;return!0}c.exports=h;var e=f("./getEnumerableProperties"),l;try{l=f("buffer").Buffer}catch(g){l={isBuffer:function(){return!1}}}});k.register("chai/utils/flag.js",function(c,a,f){c.exports=function(a,c,f){var e=a.__flags||(a.__flags=Object.create(null));if(3===arguments.length)e[c]=f;else return e[c]}});k.register("chai/utils/getActual.js",function(c,a,f){c.exports=function(a,c){var f=c[4];return"undefined"!==typeof f?f:a._obj}});k.register("chai/utils/getEnumerableProperties.js",
+function(c,a,f){c.exports=function(a){var c=[],f;for(f in a)c.push(f);return c}});k.register("chai/utils/getMessage.js",function(c,a,f){var h=f("./flag"),n=f("./getActual");f("./inspect");var m=f("./objDisplay");c.exports=function(a,c){var g=h(a,"negate"),d=h(a,"object"),b=c[3],f=n(a,c),g=g?c[2]:c[1],u=h(a,"message"),g=(g||"").replace(/#{this}/g,m(d)).replace(/#{act}/g,m(f)).replace(/#{exp}/g,m(b));return u?u+": "+g:g}});k.register("chai/utils/getName.js",function(c,a,f){c.exports=function(a){return a.name?
+a.name:(a=/^\s?function ([^(]*)\(/.exec(a))&&a[1]?a[1]:""}});k.register("chai/utils/getPathValue.js",function(c,a,f){function h(a){return a.replace(/\[/g,".[").match(/(\\\.|[^.]+?)+/g).map(function(a){var e=/\[(\d+)\]$/.exec(a);return e?{i:parseFloat(e[1])}:{p:a}})}c.exports=function(a,c){for(var e=h(a),f=c,g,d=0,b=e.length;d<b;d++){var p=e[d];f?("undefined"!==typeof p.p?f=f[p.p]:"undefined"!==typeof p.i&&(f=f[p.i]),d==b-1&&(g=f)):g=void 0}return g}});k.register("chai/utils/getProperties.js",function(c,
 a,f){c.exports=function(a){function c(a){-1===f.indexOf(a)&&f.push(a)}var f=Object.getOwnPropertyNames(subject);for(a=Object.getPrototypeOf(subject);null!==a;)Object.getOwnPropertyNames(a).forEach(c),a=Object.getPrototypeOf(a);return f}});k.register("chai/utils/index.js",function(c,a,f){a=c.exports={};a.test=f("./test");a.type=f("./type");a.getMessage=f("./getMessage");a.getActual=f("./getActual");a.inspect=f("./inspect");a.objDisplay=f("./objDisplay");a.flag=f("./flag");a.transferFlags=f("./transferFlags");
-a.eql=f("./eql");a.getPathValue=f("./getPathValue");a.getName=f("./getName");a.addProperty=f("./addProperty");a.addMethod=f("./addMethod");a.overwriteProperty=f("./overwriteProperty");a.overwriteMethod=f("./overwriteMethod");a.addChainableMethod=f("./addChainableMethod")});k.register("chai/utils/inspect.js",function(c,a,f){function g(c,f,g){if(f&&"function"===typeof f.inspect&&f.inspect!==a.inspect&&(!f.constructor||f.constructor.prototype!==f))return f.inspect(g);var w=n(c,f);if(w)return w;w="object"===
-typeof HTMLElement?f instanceof HTMLElement:f&&"object"===typeof f&&1===f.nodeType&&"string"===typeof f.nodeName;if(w)return s(f);var x=k(f),r=c.showHidden?v(f):x;if(0===r.length||p(f)&&(1===r.length&&"stack"===r[0]||2===r.length&&"description"===r[0]&&"stack"===r[1])){if("function"===typeof f){var q=t(f);return c.stylize("[Function"+(q?": "+q:"")+"]","special")}if(d(f))return c.stylize(RegExp.prototype.toString.call(f),"regexp");if(b(f))return c.stylize(Date.prototype.toUTCString.call(f),"date");
-if(p(f))return"["+Error.prototype.toString.call(f)+"]"}var q="",z=!1,w=["{","}"];h(f)&&(z=!0,w=["[","]"]);"function"===typeof f&&(q=t(f),q=" [Function"+(q?": "+q:"")+"]");d(f)&&(q=" "+RegExp.prototype.toString.call(f));b(f)&&(q=" "+Date.prototype.toUTCString.call(f));if(p(f))return"["+Error.prototype.toString.call(f)+"]";if(0===r.length&&(!z||0==f.length))return w[0]+q+w[1];if(0>g)return d(f)?c.stylize(RegExp.prototype.toString.call(f),"regexp"):c.stylize("[Object]","special");c.seen.push(f);r=z?
-m(c,f,g,x,r):r.map(function(a){return e(c,f,g,x,a,z)});c.seen.pop();return l(r,q,w)}function n(a,b){switch(typeof b){case "undefined":return a.stylize("undefined","undefined");case "string":var d="'"+JSON.stringify(b).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return a.stylize(d,"string");case "number":return a.stylize(""+b,"number");case "boolean":return a.stylize(""+b,"boolean")}if(null===b)return a.stylize("null","null")}function m(a,b,d,c,f){for(var h=[],p=0,g=b.length;p<
-g;++p)Object.prototype.hasOwnProperty.call(b,String(p))?h.push(e(a,b,d,c,String(p),!0)):h.push("");f.forEach(function(f){f.match(/^\d+$/)||h.push(e(a,b,d,c,f,!0))});return h}function e(a,b,d,e,c,f){var h,p;b.__lookupGetter__&&(b.__lookupGetter__(c)?p=b.__lookupSetter__(c)?a.stylize("[Getter/Setter]","special"):a.stylize("[Getter]","special"):b.__lookupSetter__(c)&&(p=a.stylize("[Setter]","special")));0>e.indexOf(c)&&(h="["+c+"]");p||(0>a.seen.indexOf(b[c])?(p=null===d?g(a,b[c],null):g(a,b[c],d-1),
--1<p.indexOf("\n")&&(p=f?p.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+p.split("\n").map(function(a){return"   "+a}).join("\n"))):p=a.stylize("[Circular]","special"));if("undefined"===typeof h){if(f&&c.match(/^\d+$/))return p;h=JSON.stringify(""+c);h.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(h=h.substr(1,h.length-2),h=a.stylize(h,"name")):(h=h.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),h=a.stylize(h,"string"))}return h+": "+p}function l(a,b,d){var c=0;return 60<
-a.reduce(function(a,b){c++;0<=b.indexOf("\n")&&c++;return a+b.length+1},0)?d[0]+(""===b?"":b+"\n ")+" "+a.join(",\n  ")+" "+d[1]:d[0]+b+" "+a.join(", ")+" "+d[1]}function h(a){return Array.isArray(a)||"object"===typeof a&&"[object Array]"===Object.prototype.toString.call(a)}function d(a){return"object"===typeof a&&"[object RegExp]"===Object.prototype.toString.call(a)}function b(a){return"object"===typeof a&&"[object Date]"===Object.prototype.toString.call(a)}function p(a){return"object"===typeof a&&
-"[object Error]"===Object.prototype.toString.call(a)}var t=f("./getName"),v=f("./getProperties"),k=f("./getEnumerableProperties");c.exports=function(a,b,d,c){return g({showHidden:b,seen:[],stylize:function(a){return a}},a,"undefined"===typeof d?2:d)};var s=function(a){if("outerHTML"in a)return a.outerHTML;var b=document.createElementNS("http://www.w3.org/1999/xhtml","_"),d=new XMLSerializer;if(document.xmlVersion)return d.serializeToString(a);b.appendChild(a.cloneNode(!1));a=b.innerHTML.replace("><",
-">"+a.innerHTML+"<");b.innerHTML="";return a}});k.register("chai/utils/objDisplay.js",function(c,a,f){var g=f("./inspect");c.exports=function(a){var c=g(a),e=Object.prototype.toString.call(a);if(40<=c.length){if("[object Function]"===e)return a.name&&""!==a.name?"[Function: "+a.name+"]":"[Function]";if("[object Array]"===e)return"[ Array("+a.length+") ]";if("[object Object]"===e)return a=Object.keys(a),"{ Object ("+(2<a.length?a.splice(0,2).join(", ")+", ...":a.join(", "))+") }"}return c}});k.register("chai/utils/overwriteMethod.js",
+a.eql=f("./eql");a.getPathValue=f("./getPathValue");a.getName=f("./getName");a.addProperty=f("./addProperty");a.addMethod=f("./addMethod");a.overwriteProperty=f("./overwriteProperty");a.overwriteMethod=f("./overwriteMethod");a.addChainableMethod=f("./addChainableMethod")});k.register("chai/utils/inspect.js",function(c,a,f){function h(c,f,h){if(f&&"function"===typeof f.inspect&&f.inspect!==a.inspect&&(!f.constructor||f.constructor.prototype!==f))return f.inspect(h);var w=n(c,f);if(w)return w;w="object"===
+typeof HTMLElement?f instanceof HTMLElement:f&&"object"===typeof f&&1===f.nodeType&&"string"===typeof f.nodeName;if(w)return s(f);var x=k(f),r=c.showHidden?t(f):x;if(0===r.length||p(f)&&(1===r.length&&"stack"===r[0]||2===r.length&&"description"===r[0]&&"stack"===r[1])){if("function"===typeof f){var q=u(f);return c.stylize("[Function"+(q?": "+q:"")+"]","special")}if(d(f))return c.stylize(RegExp.prototype.toString.call(f),"regexp");if(b(f))return c.stylize(Date.prototype.toUTCString.call(f),"date");
+if(p(f))return"["+Error.prototype.toString.call(f)+"]"}var q="",z=!1,w=["{","}"];g(f)&&(z=!0,w=["[","]"]);"function"===typeof f&&(q=u(f),q=" [Function"+(q?": "+q:"")+"]");d(f)&&(q=" "+RegExp.prototype.toString.call(f));b(f)&&(q=" "+Date.prototype.toUTCString.call(f));if(p(f))return"["+Error.prototype.toString.call(f)+"]";if(0===r.length&&(!z||0==f.length))return w[0]+q+w[1];if(0>h)return d(f)?c.stylize(RegExp.prototype.toString.call(f),"regexp"):c.stylize("[Object]","special");c.seen.push(f);r=z?
+m(c,f,h,x,r):r.map(function(a){return e(c,f,h,x,a,z)});c.seen.pop();return l(r,q,w)}function n(a,b){switch(typeof b){case "undefined":return a.stylize("undefined","undefined");case "string":var d="'"+JSON.stringify(b).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return a.stylize(d,"string");case "number":return a.stylize(""+b,"number");case "boolean":return a.stylize(""+b,"boolean")}if(null===b)return a.stylize("null","null")}function m(a,b,d,c,f){for(var g=[],p=0,h=b.length;p<
+h;++p)Object.prototype.hasOwnProperty.call(b,String(p))?g.push(e(a,b,d,c,String(p),!0)):g.push("");f.forEach(function(f){f.match(/^\d+$/)||g.push(e(a,b,d,c,f,!0))});return g}function e(a,b,d,e,c,f){var g,p;b.__lookupGetter__&&(b.__lookupGetter__(c)?p=b.__lookupSetter__(c)?a.stylize("[Getter/Setter]","special"):a.stylize("[Getter]","special"):b.__lookupSetter__(c)&&(p=a.stylize("[Setter]","special")));0>e.indexOf(c)&&(g="["+c+"]");p||(0>a.seen.indexOf(b[c])?(p=null===d?h(a,b[c],null):h(a,b[c],d-1),
+-1<p.indexOf("\n")&&(p=f?p.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+p.split("\n").map(function(a){return"   "+a}).join("\n"))):p=a.stylize("[Circular]","special"));if("undefined"===typeof g){if(f&&c.match(/^\d+$/))return p;g=JSON.stringify(""+c);g.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(g=g.substr(1,g.length-2),g=a.stylize(g,"name")):(g=g.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),g=a.stylize(g,"string"))}return g+": "+p}function l(a,b,d){var e=0;return 60<
+a.reduce(function(a,b){e++;0<=b.indexOf("\n")&&e++;return a+b.length+1},0)?d[0]+(""===b?"":b+"\n ")+" "+a.join(",\n  ")+" "+d[1]:d[0]+b+" "+a.join(", ")+" "+d[1]}function g(a){return Array.isArray(a)||"object"===typeof a&&"[object Array]"===Object.prototype.toString.call(a)}function d(a){return"object"===typeof a&&"[object RegExp]"===Object.prototype.toString.call(a)}function b(a){return"object"===typeof a&&"[object Date]"===Object.prototype.toString.call(a)}function p(a){return"object"===typeof a&&
+"[object Error]"===Object.prototype.toString.call(a)}var u=f("./getName"),t=f("./getProperties"),k=f("./getEnumerableProperties");c.exports=function(a,b,d,e){return h({showHidden:b,seen:[],stylize:function(a){return a}},a,"undefined"===typeof d?2:d)};var s=function(a){if("outerHTML"in a)return a.outerHTML;var b=document.createElementNS("http://www.w3.org/1999/xhtml","_"),d=new XMLSerializer;if(document.xmlVersion)return d.serializeToString(a);b.appendChild(a.cloneNode(!1));a=b.innerHTML.replace("><",
+">"+a.innerHTML+"<");b.innerHTML="";return a}});k.register("chai/utils/objDisplay.js",function(c,a,f){var h=f("./inspect");c.exports=function(a){var c=h(a),e=Object.prototype.toString.call(a);if(40<=c.length){if("[object Function]"===e)return a.name&&""!==a.name?"[Function: "+a.name+"]":"[Function]";if("[object Array]"===e)return"[ Array("+a.length+") ]";if("[object Object]"===e)return a=Object.keys(a),"{ Object ("+(2<a.length?a.splice(0,2).join(", ")+", ...":a.join(", "))+") }"}return c}});k.register("chai/utils/overwriteMethod.js",
 function(c,a,f){c.exports=function(a,c,f){var e=a[c],l=function(){return this};e&&"function"===typeof e&&(l=e);a[c]=function(){var a=f(l).apply(this,arguments);return void 0===a?this:a}}});k.register("chai/utils/overwriteProperty.js",function(c,a,f){c.exports=function(a,c,f){var e=Object.getOwnPropertyDescriptor(a,c),l=function(){};e&&"function"===typeof e.get&&(l=e.get);Object.defineProperty(a,c,{get:function(){var a=f(l).call(this);return void 0===a?this:a},configurable:!0})}});k.register("chai/utils/test.js",
-function(c,a,f){var g=f("./flag");c.exports=function(a,c){var e=g(a,"negate"),f=c[0];return e?!f:f}});k.register("chai/utils/transferFlags.js",function(c,a,f){c.exports=function(a,c,f){var e=a.__flags||(a.__flags=Object.create(null));c.__flags||(c.__flags=Object.create(null));f=3===arguments.length?f:!0;for(var l in e)if(f||"object"!==l&&"ssfi"!==l&&"message"!=l)c.__flags[l]=e[l]}});k.register("chai/utils/type.js",function(c,a,f){var g={"[object Arguments]":"arguments","[object Array]":"array","[object Date]":"date",
-"[object Function]":"function","[object Number]":"number","[object RegExp]":"regexp","[object String]":"string"};c.exports=function(a){var c=Object.prototype.toString.call(a);return g[c]?g[c]:null===a?"null":void 0===a?"undefined":a===Object(a)?"object":typeof a}});k.alias("./chai.js","chai");return k("chai")});
-var sinon=function(){var k=function(a,c){var g="function"==typeof require&&"object"==typeof module,k="undefined"!=typeof document&&document.createElement("div"),m=function(){},e={bind:function(a,b){var c="string"==typeof b?a[b]:b,e=Array.prototype.slice.call(arguments,2);return function(){var b=e.concat(Array.prototype.slice.call(arguments));return c.apply(a,b)}},partial:function(a){var b=[].slice.call(arguments,1);return function(){return a.apply(this,b.concat([].slice.call(arguments)))}},create:function(a){m.prototype=
-a;return new m},extend:function(a){if(a){for(var b=1,c=arguments.length,e;b<c;++b)for(e in arguments[b])a[e]=arguments[b][e];return a}},nextTick:function(d){if("undefined"!=typeof process&&process.nextTick)return process.nextTick(d);a(d,0)},functionName:function(a){return a?a.displayName?a.displayName:a.name?a.name:(a=a.toString().match(/function\s+([^\(]+)/m))&&a[1]||"":""},isNode:function(a){if(!k)return!1;try{a.appendChild(k),a.removeChild(k)}catch(b){return!1}return!0},isElement:function(a){return a&&
-1===a.nodeType&&e.isNode(a)},isArray:function(a){return"[object Array]"==Object.prototype.toString.call(a)},flatten:function b(a){var c=[];a=a||[];for(var f=0,h=a.length;f<h;++f)c=c.concat(e.isArray(a[f])?b(a[f]):a[f]);return c},each:function(a,c){for(var e=0,f=a.length;e<f;++e)c(a[e])},map:function(a,c){for(var e=[],f=0,h=a.length;f<h;++f)e.push(c(a[f]));return e},parallel:function(a,c){function e(a,b){"function"==typeof c&&(c(a,b),c=null)}function f(a){return function(b,c){if(b)return e(b);g[a]=
-c;0==--h&&e(null,g)}}if(0==a.length)return e(null,[]);for(var h=a.length,g=[],l=0,m=a.length;l<m;++l)a[l](f(l))},series:function(a,c){function f(){if(0==g.length)"function"==typeof c&&c(null,l);else{var a=g.shift()(h);a&&"function"==typeof a.then&&a.then(e.partial(h,null),h)}}function h(a,b){a?"function"==typeof c&&c(a,void 0):(l.push(b),f())}var g=a.slice(),l=[];f()},countdown:function(a,c){return function(){0==--a&&c()}}};if("object"===typeof process&&"function"===typeof require&&"object"===typeof module){var l=
-require("crypto"),h=require("path");e.tmpFile=function(a){var c=l.createHash("sha1");c.update(a);a=c.digest("hex");return"win32"==process.platform?h.join(process.env.TEMP,a):h.join("/tmp",a)}}e.some=Array.prototype.some?function(a,c,e){return a.some(c,e)}:function(a,c,e){if(null==a)throw new TypeError;a=Object(a);var f=a.length>>>0;if("function"!==typeof c)throw new TypeError;for(var h=0;h<f;h++)if(a.hasOwnProperty(h)&&c.call(e,a[h],h,a))return!0;return!1};e.filter=Array.prototype.filter?function(a,
-c,e){return a.filter(c,e)}:function(a,c){if(null==this)throw new TypeError;var e=Object(this),f=e.length>>>0;if("function"!=typeof a)throw new TypeError;for(var h=[],g=0;g<f;g++)if(g in e){var l=e[g];a.call(c,l,g,e)&&h.push(l)}return h};g&&(module.exports=e,e.eventEmitter=require("./buster-event-emitter"),Object.defineProperty(e,"defineVersionGetter",{get:function(){return require("./define-version-getter")}}));return e.extend(c||{},e)}(setTimeout,k);"undefined"===typeof k&&(k={});"object"===typeof module&&
-"function"===typeof require&&(k=require("buster-core"));k.format=k.format||{};k.format.excludeConstructors=["Object",/^.$/];k.format.quoteStrings=!0;k.format.ascii=function(){function a(a,c){if("object"!=typeof a)return!1;for(var f=0,h=c.length;f<h;++f)if(c[f]===a)return!0;return!1}function c(g,e,l){if("string"==typeof g)return l="boolean"!=typeof this.quoteStrings||this.quoteStrings,e||l?'"'+g+'"':g;if("function"==typeof g&&!(g instanceof RegExp))return c.func(g);e=e||[];if(a(g,e))return"[Circular]";
-if("[object Array]"==Object.prototype.toString.call(g))return c.array.call(this,g,e);if(!g)return""+g;if(k.isElement(g))return c.element(g);if("function"==typeof g.toString&&g.toString!==Object.prototype.toString)return g.toString();for(var h=0,d=n.length;h<d;h++)if(g===n[h].obj)return n[h].value;return c.object.call(this,g,e,l)}var g=Object.prototype.hasOwnProperty,n=[];"undefined"!=typeof global&&n.push({obj:global,value:"[object global]"});"undefined"!=typeof document&&n.push({obj:document,value:"[object HTMLDocument]"});
-"undefined"!=typeof window&&n.push({obj:window,value:"[object Window]"});c.func=function(a){return"function "+k.functionName(a)+"() {}"};c.array=function(a,e){e=e||[];e.push(a);for(var g=[],h=0,d=a.length;h<d;++h)g.push(c.call(this,a[h],e));return"["+g.join(", ")+"]"};c.object=function(m,e,l){e=e||[];e.push(m);l=l||0;var h=[],d,b=Object.keys&&Object.keys(m)||[];if(0==b.length)for(var p in m)g.call(m,p)&&b.push(p);d=b.sort();var t,k,b="";p=3;for(var n=0,s=l;n<s;++n)b+=" ";n=0;for(s=d.length;n<s;++n)t=
-d[n],k=m[t],k=a(k,e)?"[Circular]":c.call(this,k,e,l+2),k=(/\s/.test(t)?'"'+t+'"':t)+": "+k,p+=k.length,h.push(k);m=(m=c.constructorName.call(this,m))?"["+m+"] ":"";return 80<p+l?m+"{\n  "+b+h.join(",\n  "+b)+"\n"+b+"}":m+"{ "+h.join(", ")+" }"};c.element=function(a){for(var c=a.tagName.toLowerCase(),f=a.attributes,h,d=[],b,g=0,t=f.length;g<t;++g)h=f.item(g),b=h.nodeName.toLowerCase().replace("html:",""),("contenteditable"!=b||"inherit"!=h.nodeValue)&&h.nodeValue&&d.push(b+'="'+h.nodeValue+'"');f=
-"<"+c+(0<d.length?" ":"");a=a.innerHTML;20<a.length&&(a=a.substr(0,20)+"[...]");return(f+d.join(" ")+">"+a+"</"+c+">").replace(/ contentEditable="inherit"/,"")};c.constructorName=function(a){a=k.functionName(a&&a.constructor);for(var c=this.excludeConstructors||k.format.excludeConstructors||[],f=0,h=c.length;f<h;++f)if("string"==typeof c[f]&&c[f]==a||c[f].test&&c[f].test(a))return"";return a};return c}();"undefined"!=typeof module&&(module.exports=k.format);var c=function(a){function c(a){var b=!1;
-try{a.appendChild(k),b=k.parentNode==a}catch(d){return!1}finally{try{a.removeChild(k)}catch(e){}}return b}function g(a,b){for(var d in b)m.call(a,d)||(a[d]=b[d])}var k="undefined"!=typeof document&&document.createElement("div"),m=Object.prototype.hasOwnProperty,e={wrapMethod:function(a,b,d){if(!a)throw new TypeError("Should wrap property of object");if("function"!=typeof d)throw new TypeError("Method wrapper should be function");var c=a[b];if(!("function"===typeof c||c&&c.constructor&&c.call&&c.apply))throw new TypeError("Attempted to wrap "+
-typeof c+" property "+b+" as function");if(c.restore&&c.restore.sinon)throw new TypeError("Attempted to wrap "+b+" which is already wrapped");if(c.calledBefore)throw new TypeError("Attempted to wrap "+b+" which is already "+(c.returns?"stubbed":"spied on"));var e=m.call(a,b);a[b]=d;d.displayName=b;d.restore=function(){e||delete a[b];a[b]===d&&(a[b]=c)};d.restore.sinon=!0;g(d,c);return d},extend:function(a){for(var b=1,d=arguments.length;b<d;b+=1)for(var c in arguments[b])arguments[b].hasOwnProperty(c)&&
-(a[c]=arguments[b][c]),arguments[b].hasOwnProperty("toString")&&arguments[b].toString!=a.toString&&(a.toString=arguments[b].toString);return a},create:function(a){var b=function(){};b.prototype=a;return new b},deepEqual:function v(a,b){if(e.match&&e.match.isMatcher(a))return a.test(b);if("object"!=typeof a||"object"!=typeof b||k&&a&&1===a.nodeType&&c(a)||k&&b&&1===b.nodeType&&c(b))return a===b;if(a===b)return!0;if(null===a&&null!==b||null!==a&&null===b)return!1;var d=Object.prototype.toString.call(a);
-if(d!=Object.prototype.toString.call(b))return!1;if("[object Array]"==d){if(a.length!==b.length)return!1;for(var h=0,d=a.length;h<d;h+=1)if(!v(a[h],b[h]))return!1;return!0}var g=d=0;for(h in a)if(d+=1,!v(a[h],b[h]))return!1;for(h in b)g+=1;return d!=g?!1:!0},functionName:function(a){var b=a.displayName||a.name;b||(b=(a=a.toString().match(/function ([^\s\(]+)/))&&a[1]);return b},functionToString:function(){if(this.getCall&&this.callCount)for(var a,b,d=this.callCount;d--;)for(b in a=this.getCall(d).thisValue,
+function(c,a,f){var h=f("./flag");c.exports=function(a,c){var e=h(a,"negate"),f=c[0];return e?!f:f}});k.register("chai/utils/transferFlags.js",function(c,a,f){c.exports=function(a,c,f){var e=a.__flags||(a.__flags=Object.create(null));c.__flags||(c.__flags=Object.create(null));f=3===arguments.length?f:!0;for(var l in e)if(f||"object"!==l&&"ssfi"!==l&&"message"!=l)c.__flags[l]=e[l]}});k.register("chai/utils/type.js",function(c,a,f){var h={"[object Arguments]":"arguments","[object Array]":"array","[object Date]":"date",
+"[object Function]":"function","[object Number]":"number","[object RegExp]":"regexp","[object String]":"string"};c.exports=function(a){var c=Object.prototype.toString.call(a);return h[c]?h[c]:null===a?"null":void 0===a?"undefined":a===Object(a)?"object":typeof a}});k.alias("./chai.js","chai");return k("chai")});
+var sinon=function(){var k=function(a,c){var h="function"==typeof require&&"object"==typeof module,k="undefined"!=typeof document&&document.createElement("div"),m=function(){},e={bind:function(a,b){var e="string"==typeof b?a[b]:b,c=Array.prototype.slice.call(arguments,2);return function(){var b=c.concat(Array.prototype.slice.call(arguments));return e.apply(a,b)}},partial:function(a){var b=[].slice.call(arguments,1);return function(){return a.apply(this,b.concat([].slice.call(arguments)))}},create:function(a){m.prototype=
+a;return new m},extend:function(a){if(a){for(var b=1,e=arguments.length,c;b<e;++b)for(c in arguments[b])a[c]=arguments[b][c];return a}},nextTick:function(d){if("undefined"!=typeof process&&process.nextTick)return process.nextTick(d);a(d,0)},functionName:function(a){return a?a.displayName?a.displayName:a.name?a.name:(a=a.toString().match(/function\s+([^\(]+)/m))&&a[1]||"":""},isNode:function(a){if(!k)return!1;try{a.appendChild(k),a.removeChild(k)}catch(b){return!1}return!0},isElement:function(a){return a&&
+1===a.nodeType&&e.isNode(a)},isArray:function(a){return"[object Array]"==Object.prototype.toString.call(a)},flatten:function b(a){var c=[];a=a||[];for(var f=0,g=a.length;f<g;++f)c=c.concat(e.isArray(a[f])?b(a[f]):a[f]);return c},each:function(a,e){for(var c=0,f=a.length;c<f;++c)e(a[c])},map:function(a,c){for(var e=[],f=0,g=a.length;f<g;++f)e.push(c(a[f]));return e},parallel:function(a,e){function c(a,b){"function"==typeof e&&(e(a,b),e=null)}function f(a){return function(b,e){if(b)return c(b);h[a]=
+e;0==--g&&c(null,h)}}if(0==a.length)return c(null,[]);for(var g=a.length,h=[],l=0,m=a.length;l<m;++l)a[l](f(l))},series:function(a,c){function f(){if(0==h.length)"function"==typeof c&&c(null,l);else{var a=h.shift()(g);a&&"function"==typeof a.then&&a.then(e.partial(g,null),g)}}function g(a,b){a?"function"==typeof c&&c(a,void 0):(l.push(b),f())}var h=a.slice(),l=[];f()},countdown:function(a,c){return function(){0==--a&&c()}}};if("object"===typeof process&&"function"===typeof require&&"object"===typeof module){var l=
+require("crypto"),g=require("path");e.tmpFile=function(a){var c=l.createHash("sha1");c.update(a);a=c.digest("hex");return"win32"==process.platform?g.join(process.env.TEMP,a):g.join("/tmp",a)}}e.some=Array.prototype.some?function(a,c,e){return a.some(c,e)}:function(a,c,e){if(null==a)throw new TypeError;a=Object(a);var f=a.length>>>0;if("function"!==typeof c)throw new TypeError;for(var g=0;g<f;g++)if(a.hasOwnProperty(g)&&c.call(e,a[g],g,a))return!0;return!1};e.filter=Array.prototype.filter?function(a,
+c,e){return a.filter(c,e)}:function(a,c){if(null==this)throw new TypeError;var e=Object(this),f=e.length>>>0;if("function"!=typeof a)throw new TypeError;for(var g=[],h=0;h<f;h++)if(h in e){var l=e[h];a.call(c,l,h,e)&&g.push(l)}return g};h&&(module.exports=e,e.eventEmitter=require("./buster-event-emitter"),Object.defineProperty(e,"defineVersionGetter",{get:function(){return require("./define-version-getter")}}));return e.extend(c||{},e)}(setTimeout,k);"undefined"===typeof k&&(k={});"object"===typeof module&&
+"function"===typeof require&&(k=require("buster-core"));k.format=k.format||{};k.format.excludeConstructors=["Object",/^.$/];k.format.quoteStrings=!0;k.format.ascii=function(){function a(a,c){if("object"!=typeof a)return!1;for(var f=0,g=c.length;f<g;++f)if(c[f]===a)return!0;return!1}function c(h,e,l){if("string"==typeof h)return l="boolean"!=typeof this.quoteStrings||this.quoteStrings,e||l?'"'+h+'"':h;if("function"==typeof h&&!(h instanceof RegExp))return c.func(h);e=e||[];if(a(h,e))return"[Circular]";
+if("[object Array]"==Object.prototype.toString.call(h))return c.array.call(this,h,e);if(!h)return""+h;if(k.isElement(h))return c.element(h);if("function"==typeof h.toString&&h.toString!==Object.prototype.toString)return h.toString();for(var g=0,d=n.length;g<d;g++)if(h===n[g].obj)return n[g].value;return c.object.call(this,h,e,l)}var h=Object.prototype.hasOwnProperty,n=[];"undefined"!=typeof global&&n.push({obj:global,value:"[object global]"});"undefined"!=typeof document&&n.push({obj:document,value:"[object HTMLDocument]"});
+"undefined"!=typeof window&&n.push({obj:window,value:"[object Window]"});c.func=function(a){return"function "+k.functionName(a)+"() {}"};c.array=function(a,e){e=e||[];e.push(a);for(var h=[],g=0,d=a.length;g<d;++g)h.push(c.call(this,a[g],e));return"["+h.join(", ")+"]"};c.object=function(k,e,l){e=e||[];e.push(k);l=l||0;var g=[],d,b=Object.keys&&Object.keys(k)||[];if(0==b.length)for(var p in k)h.call(k,p)&&b.push(p);d=b.sort();var u,t,b="";p=3;for(var n=0,s=l;n<s;++n)b+=" ";n=0;for(s=d.length;n<s;++n)u=
+d[n],t=k[u],t=a(t,e)?"[Circular]":c.call(this,t,e,l+2),t=(/\s/.test(u)?'"'+u+'"':u)+": "+t,p+=t.length,g.push(t);k=(k=c.constructorName.call(this,k))?"["+k+"] ":"";return 80<p+l?k+"{\n  "+b+g.join(",\n  "+b)+"\n"+b+"}":k+"{ "+g.join(", ")+" }"};c.element=function(a){for(var c=a.tagName.toLowerCase(),f=a.attributes,g,d=[],b,h=0,u=f.length;h<u;++h)g=f.item(h),b=g.nodeName.toLowerCase().replace("html:",""),("contenteditable"!=b||"inherit"!=g.nodeValue)&&g.nodeValue&&d.push(b+'="'+g.nodeValue+'"');f=
+"<"+c+(0<d.length?" ":"");a=a.innerHTML;20<a.length&&(a=a.substr(0,20)+"[...]");return(f+d.join(" ")+">"+a+"</"+c+">").replace(/ contentEditable="inherit"/,"")};c.constructorName=function(a){a=k.functionName(a&&a.constructor);for(var c=this.excludeConstructors||k.format.excludeConstructors||[],f=0,g=c.length;f<g;++f)if("string"==typeof c[f]&&c[f]==a||c[f].test&&c[f].test(a))return"";return a};return c}();"undefined"!=typeof module&&(module.exports=k.format);var c=function(a){function c(a){var b=!1;
+try{a.appendChild(k),b=k.parentNode==a}catch(d){return!1}finally{try{a.removeChild(k)}catch(e){}}return b}function h(a,b){for(var d in b)m.call(a,d)||(a[d]=b[d])}var k="undefined"!=typeof document&&document.createElement("div"),m=Object.prototype.hasOwnProperty,e={wrapMethod:function(a,b,d){if(!a)throw new TypeError("Should wrap property of object");if("function"!=typeof d)throw new TypeError("Method wrapper should be function");var c=a[b];if(!("function"===typeof c||c&&c.constructor&&c.call&&c.apply))throw new TypeError("Attempted to wrap "+
+typeof c+" property "+b+" as function");if(c.restore&&c.restore.sinon)throw new TypeError("Attempted to wrap "+b+" which is already wrapped");if(c.calledBefore)throw new TypeError("Attempted to wrap "+b+" which is already "+(c.returns?"stubbed":"spied on"));var e=m.call(a,b);a[b]=d;d.displayName=b;d.restore=function(){e||delete a[b];a[b]===d&&(a[b]=c)};d.restore.sinon=!0;h(d,c);return d},extend:function(a){for(var b=1,d=arguments.length;b<d;b+=1)for(var c in arguments[b])arguments[b].hasOwnProperty(c)&&
+(a[c]=arguments[b][c]),arguments[b].hasOwnProperty("toString")&&arguments[b].toString!=a.toString&&(a.toString=arguments[b].toString);return a},create:function(a){var b=function(){};b.prototype=a;return new b},deepEqual:function t(a,b){if(e.match&&e.match.isMatcher(a))return a.test(b);if("object"!=typeof a||"object"!=typeof b||k&&a&&1===a.nodeType&&c(a)||k&&b&&1===b.nodeType&&c(b))return a===b;if(a===b)return!0;if(null===a&&null!==b||null!==a&&null===b)return!1;var d=Object.prototype.toString.call(a);
+if(d!=Object.prototype.toString.call(b))return!1;if("[object Array]"==d){if(a.length!==b.length)return!1;for(var g=0,d=a.length;g<d;g+=1)if(!t(a[g],b[g]))return!1;return!0}var h=d=0;for(g in a)if(d+=1,!t(a[g],b[g]))return!1;for(g in b)h+=1;return d!=h?!1:!0},functionName:function(a){var b=a.displayName||a.name;b||(b=(a=a.toString().match(/function ([^\s\(]+)/))&&a[1]);return b},functionToString:function(){if(this.getCall&&this.callCount)for(var a,b,d=this.callCount;d--;)for(b in a=this.getCall(d).thisValue,
 a)if(a[b]===this)return b;return this.displayName||"sinon fake"},getConfig:function(a){var b={};a=a||{};var d=e.defaultConfig,c;for(c in d)d.hasOwnProperty(c)&&(b[c]=a.hasOwnProperty(c)?a[c]:d[c]);return b},format:function(a){return""+a},defaultConfig:{injectIntoThis:!0,injectInto:null,properties:"spy stub mock clock server requests".split(" "),useFakeTimers:!0,useFakeServer:!0},timesInWords:function(a){return 1==a&&"once"||2==a&&"twice"||3==a&&"thrice"||(a||0)+" times"},calledInOrder:function(a){for(var b=
 1,d=a.length;b<d;b++)if(!a[b-1].calledBefore(a[b])||!a[b].called)return!1;return!0},orderByFirstCall:function(a){return a.sort(function(a,b){var d=a.getCall(0),c=b.getCall(0);return(d&&d.callId||-1)<(c&&c.callId||-1)?-1:1})},log:function(){},logError:function(a,b){var d=a+" threw exception: ";e.log(d+"["+b.name+"] "+b.message);b.stack&&e.log(b.stack);setTimeout(function(){b.message=d+b.message;throw b;},0)},typeOf:function(a){if(null===a)return"null";if(void 0===a)return"undefined";a=Object.prototype.toString.call(a);
-return a.substring(8,a.length-1).toLowerCase()},createStubInstance:function(a){if("function"!==typeof a)throw new TypeError("The constructor should be a function.");return e.stub(e.create(a.prototype))}},l="object"==typeof module&&"function"==typeof require;if(l){try{a={format:require("buster-format")}}catch(h){}module.exports=e;module.exports.spy=require("./sinon/spy");module.exports.stub=require("./sinon/stub");module.exports.mock=require("./sinon/mock");module.exports.collection=require("./sinon/collection");
+return a.substring(8,a.length-1).toLowerCase()},createStubInstance:function(a){if("function"!==typeof a)throw new TypeError("The constructor should be a function.");return e.stub(e.create(a.prototype))}},l="object"==typeof module&&"function"==typeof require;if(l){try{a={format:require("buster-format")}}catch(g){}module.exports=e;module.exports.spy=require("./sinon/spy");module.exports.stub=require("./sinon/stub");module.exports.mock=require("./sinon/mock");module.exports.collection=require("./sinon/collection");
 module.exports.assert=require("./sinon/assert");module.exports.sandbox=require("./sinon/sandbox");module.exports.test=require("./sinon/test");module.exports.testCase=require("./sinon/test_case");module.exports.assert=require("./sinon/assert");module.exports.match=require("./sinon/match")}if(a){var d=e.create(a.format);d.quoteStrings=!1;e.format=function(){return d.ascii.apply(d,arguments)}}else if(l)try{var b=require("util");e.format=function(a){return"object"==typeof a&&a.toString===Object.prototype.toString?
-b.inspect(a):a}}catch(p){}return e}("object"==typeof k&&k);(function(a){function c(d,b,e){d=a.typeOf(d);if(d!==b)throw new TypeError("Expected type of "+e+" to be "+b+", but was "+d);}function g(a){return l.isPrototypeOf(a)}function k(d,b){if(null===b||void 0===b)return!1;for(var c in d)if(d.hasOwnProperty(c)){var e=d[c],f=b[c];if(h.isMatcher(e)){if(!e.test(f))return!1}else if("object"===a.typeOf(e)){if(!k(e,f))return!1}else if(!a.deepEqual(e,f))return!1}return!0}function m(d,b){return function(e,
-g){c(e,"string","property");var l=1===arguments.length,k=b+'("'+e+'"';l||(k+=", "+g);return h(function(b){return void 0!==b&&null!==b&&d(b,e)?l||a.deepEqual(g,b[e]):!1},k+")")}}var e="object"==typeof module&&"function"==typeof require;!a&&e&&(a=require("../sinon"));if(a){var l={toString:function(){return this.message},or:function(d){if(!g(d))throw new TypeError("Matcher expected");var b=this,c=a.create(l);c.test=function(a){return b.test(a)||d.test(a)};c.message=b.message+".or("+d.message+")";return c},
-and:function(d){if(!g(d))throw new TypeError("Matcher expected");var b=this,c=a.create(l);c.test=function(a){return b.test(a)&&d.test(a)};c.message=b.message+".and("+d.message+")";return c}},h=function(d,b){var c=a.create(l);switch(a.typeOf(d)){case "object":if("function"===typeof d.test)return c.test=function(a){return!0===d.test(a)},c.message="match("+a.functionName(d.test)+")",c;var e=[],f;for(f in d)d.hasOwnProperty(f)&&e.push(f+": "+d[f]);c.test=function(a){return k(d,a)};c.message="match("+
-e.join(", ")+")";break;case "number":c.test=function(a){return d==a};break;case "string":c.test=function(a){return"string"!==typeof a?!1:-1!==a.indexOf(d)};c.message='match("'+d+'")';break;case "regexp":c.test=function(a){return"string"!==typeof a?!1:d.test(a)};break;case "function":c.test=d;c.message=b?b:"match("+a.functionName(d)+")";break;default:c.test=function(b){return a.deepEqual(d,b)}}c.message||(c.message="match("+d+")");return c};h.isMatcher=g;h.any=h(function(){return!0},"any");h.defined=
-h(function(a){return null!==a&&void 0!==a},"defined");h.truthy=h(function(a){return!!a},"truthy");h.falsy=h(function(a){return!a},"falsy");h.same=function(a){return h(function(b){return a===b},"same("+a+")")};h.typeOf=function(d){c(d,"string","type");return h(function(b){return a.typeOf(b)===d},'typeOf("'+d+'")')};h.instanceOf=function(d){c(d,"function","type");return h(function(a){return a instanceof d},"instanceOf("+a.functionName(d)+")")};h.has=m(function(a,b){return"object"===typeof a?b in a:
-void 0!==a[b]},"has");h.hasOwn=m(function(a,b){return a.hasOwnProperty(b)},"hasOwn");h.bool=h.typeOf("boolean");h.number=h.typeOf("number");h.string=h.typeOf("string");h.object=h.typeOf("object");h.func=h.typeOf("function");h.array=h.typeOf("array");h.regexp=h.typeOf("regexp");h.date=h.typeOf("date");e?module.exports=h:a.match=h}})("object"==typeof c&&c||null);(function(a){function c(e,d){return d||"function"!=typeof e?e||d?a.wrapMethod(e,d,c.create(e[d])):c.create(function(){}):c.create(e)}var g=
-"object"==typeof module&&"function"==typeof require,k,m=0,e=[].push,l=Array.prototype.slice;!a&&g&&(a=require("../sinon"));a&&(a.extend(c,function(){function h(a,b,d,c,e){a[b]=function(){if(!this.called)return e?e.apply(this,arguments):!1;for(var a,f=0,h=0,g=this.callCount;h<g;h+=1)if(a=this.getCall(h),a[c||b].apply(a,arguments)&&(f+=1,d))return!0;return f===this.callCount}}function d(a,b,d){if(a)for(var c=0,e=a.length;c<e;c++)if(a[c].matches(b,d))return a[c]}function b(){this.called=!0;this.callCount+=
-1;this.notCalled=!1;this.calledOnce=1==this.callCount;this.calledTwice=2==this.callCount;this.calledThrice=3==this.callCount}function g(){this.firstCall=this.getCall(0);this.secondCall=this.getCall(1);this.thirdCall=this.getCall(2);this.lastCall=this.getCall(this.callCount-1)}function t(a){var b;a.length?eval("p = (function proxy("+v.substring(0,2*a.length-1)+") { return p.invoke(func, this, slice.call(arguments)); });"):b=function(){return b.invoke(a,this,l.call(arguments))};return b}var v="a,b,c,d,e,f,g,h,i,j,k,l",
-A=0,s={reset:function(){this.called=!1;this.notCalled=!0;this.calledThrice=this.calledTwice=this.calledOnce=!1;this.callCount=0;this.lastCall=this.thirdCall=this.secondCall=this.firstCall=null;this.args=[];this.returnValues=[];this.thisValues=[];this.exceptions=[];this.callIds=[];if(this.fakes)for(var a=0;a<this.fakes.length;a++)this.fakes[a].reset()},create:function(b){var d;"function"!=typeof b?b=function(){}:d=a.functionName(b);var e=t(b);a.extend(e,c);delete e.create;a.extend(e,b);e.reset();e.prototype=
-b.prototype;e.displayName=d||"spy";e.toString=a.functionToString;e._create=a.spy.create;e.id="spy#"+A++;return e},invoke:function(a,c,f){var h=d(this.fakes,f),l;b.call(this);e.call(this.thisValues,c);e.call(this.args,f);e.call(this.callIds,m++);try{l=h?h.invoke(a,c,f):(this.func||a).apply(c,f)}catch(k){throw e.call(this.returnValues,void 0),k;}finally{e.call(this.exceptions,void 0)}e.call(this.returnValues,l);g.call(this);return l},getCall:function(a){return 0>a||a>=this.callCount?null:k.create(this,
+b.inspect(a):a}}catch(p){}return e}("object"==typeof k&&k);(function(a){function c(d,b,e){d=a.typeOf(d);if(d!==b)throw new TypeError("Expected type of "+e+" to be "+b+", but was "+d);}function h(a){return l.isPrototypeOf(a)}function k(d,b){if(null===b||void 0===b)return!1;for(var c in d)if(d.hasOwnProperty(c)){var e=d[c],f=b[c];if(g.isMatcher(e)){if(!e.test(f))return!1}else if("object"===a.typeOf(e)){if(!k(e,f))return!1}else if(!a.deepEqual(e,f))return!1}return!0}function m(d,b){return function(e,
+h){c(e,"string","property");var l=1===arguments.length,k=b+'("'+e+'"';l||(k+=", "+h);return g(function(b){return void 0!==b&&null!==b&&d(b,e)?l||a.deepEqual(h,b[e]):!1},k+")")}}var e="object"==typeof module&&"function"==typeof require;!a&&e&&(a=require("../sinon"));if(a){var l={toString:function(){return this.message},or:function(d){if(!h(d))throw new TypeError("Matcher expected");var b=this,c=a.create(l);c.test=function(a){return b.test(a)||d.test(a)};c.message=b.message+".or("+d.message+")";return c},
+and:function(d){if(!h(d))throw new TypeError("Matcher expected");var b=this,c=a.create(l);c.test=function(a){return b.test(a)&&d.test(a)};c.message=b.message+".and("+d.message+")";return c}},g=function(d,b){var c=a.create(l);switch(a.typeOf(d)){case "object":if("function"===typeof d.test)return c.test=function(a){return!0===d.test(a)},c.message="match("+a.functionName(d.test)+")",c;var e=[],f;for(f in d)d.hasOwnProperty(f)&&e.push(f+": "+d[f]);c.test=function(a){return k(d,a)};c.message="match("+
+e.join(", ")+")";break;case "number":c.test=function(a){return d==a};break;case "string":c.test=function(a){return"string"!==typeof a?!1:-1!==a.indexOf(d)};c.message='match("'+d+'")';break;case "regexp":c.test=function(a){return"string"!==typeof a?!1:d.test(a)};break;case "function":c.test=d;c.message=b?b:"match("+a.functionName(d)+")";break;default:c.test=function(b){return a.deepEqual(d,b)}}c.message||(c.message="match("+d+")");return c};g.isMatcher=h;g.any=g(function(){return!0},"any");g.defined=
+g(function(a){return null!==a&&void 0!==a},"defined");g.truthy=g(function(a){return!!a},"truthy");g.falsy=g(function(a){return!a},"falsy");g.same=function(a){return g(function(b){return a===b},"same("+a+")")};g.typeOf=function(d){c(d,"string","type");return g(function(b){return a.typeOf(b)===d},'typeOf("'+d+'")')};g.instanceOf=function(d){c(d,"function","type");return g(function(a){return a instanceof d},"instanceOf("+a.functionName(d)+")")};g.has=m(function(a,b){return"object"===typeof a?b in a:
+void 0!==a[b]},"has");g.hasOwn=m(function(a,b){return a.hasOwnProperty(b)},"hasOwn");g.bool=g.typeOf("boolean");g.number=g.typeOf("number");g.string=g.typeOf("string");g.object=g.typeOf("object");g.func=g.typeOf("function");g.array=g.typeOf("array");g.regexp=g.typeOf("regexp");g.date=g.typeOf("date");e?module.exports=g:a.match=g}})("object"==typeof c&&c||null);(function(a){function c(e,d){return d||"function"!=typeof e?e||d?a.wrapMethod(e,d,c.create(e[d])):c.create(function(){}):c.create(e)}var h=
+"object"==typeof module&&"function"==typeof require,k,m=0,e=[].push,l=Array.prototype.slice;!a&&h&&(a=require("../sinon"));a&&(a.extend(c,function(){function g(a,b,d,c,e){a[b]=function(){if(!this.called)return e?e.apply(this,arguments):!1;for(var a,f=0,g=0,h=this.callCount;g<h;g+=1)if(a=this.getCall(g),a[c||b].apply(a,arguments)&&(f+=1,d))return!0;return f===this.callCount}}function d(a,b,d){if(a)for(var c=0,e=a.length;c<e;c++)if(a[c].matches(b,d))return a[c]}function b(){this.called=!0;this.callCount+=
+1;this.notCalled=!1;this.calledOnce=1==this.callCount;this.calledTwice=2==this.callCount;this.calledThrice=3==this.callCount}function h(){this.firstCall=this.getCall(0);this.secondCall=this.getCall(1);this.thirdCall=this.getCall(2);this.lastCall=this.getCall(this.callCount-1)}function u(a){var b;a.length?eval("p = (function proxy("+t.substring(0,2*a.length-1)+") { return p.invoke(func, this, slice.call(arguments)); });"):b=function(){return b.invoke(a,this,l.call(arguments))};return b}var t="a,b,c,d,e,f,g,h,i,j,k,l",
+A=0,s={reset:function(){this.called=!1;this.notCalled=!0;this.calledThrice=this.calledTwice=this.calledOnce=!1;this.callCount=0;this.lastCall=this.thirdCall=this.secondCall=this.firstCall=null;this.args=[];this.returnValues=[];this.thisValues=[];this.exceptions=[];this.callIds=[];if(this.fakes)for(var a=0;a<this.fakes.length;a++)this.fakes[a].reset()},create:function(b){var d;"function"!=typeof b?b=function(){}:d=a.functionName(b);var e=u(b);a.extend(e,c);delete e.create;a.extend(e,b);e.reset();e.prototype=
+b.prototype;e.displayName=d||"spy";e.toString=a.functionToString;e._create=a.spy.create;e.id="spy#"+A++;return e},invoke:function(a,c,f){var g=d(this.fakes,f),l;b.call(this);e.call(this.thisValues,c);e.call(this.args,f);e.call(this.callIds,m++);try{l=g?g.invoke(a,c,f):(this.func||a).apply(c,f)}catch(k){throw e.call(this.returnValues,void 0),k;}finally{e.call(this.exceptions,void 0)}e.call(this.returnValues,l);h.call(this);return l},getCall:function(a){return 0>a||a>=this.callCount?null:k.create(this,
 this.thisValues[a],this.args[a],this.returnValues[a],this.exceptions[a],this.callIds[a])},calledBefore:function(a){return this.called?a.called?this.callIds[0]<a.callIds[a.callIds.length-1]:!0:!1},calledAfter:function(a){return this.called&&a.called?this.callIds[this.callCount-1]>a.callIds[a.callCount-1]:!1},withArgs:function(){var a=l.call(arguments);if(this.fakes){var c=d(this.fakes,a,!0);if(c)return c}else this.fakes=[];var f=this,c=this._create();c.matchingAguments=a;e.call(this.fakes,c);c.withArgs=
-function(){return f.withArgs.apply(f,arguments)};for(a=0;a<this.args.length;a++)c.matches(this.args[a])&&(b.call(c),e.call(c.thisValues,this.thisValues[a]),e.call(c.args,this.args[a]),e.call(c.returnValues,this.returnValues[a]),e.call(c.exceptions,this.exceptions[a]),e.call(c.callIds,this.callIds[a]));g.call(c);return c},matches:function(b,d){var c=this.matchingAguments;if(c.length<=b.length&&a.deepEqual(c,b.slice(0,c.length)))return!d||c.length==b.length},printf:function(b){var d=this,c=l.call(arguments,
-1),e;return(b||"").replace(/%(.)/g,function(b,f){e=s.formatters[f];return"function"==typeof e?e.call(null,d,c):isNaN(parseInt(f),10)?"%"+f:a.format(c[f-1])})}};h(s,"calledOn",!0);h(s,"alwaysCalledOn",!1,"calledOn");h(s,"calledWith",!0);h(s,"calledWithMatch",!0);h(s,"alwaysCalledWith",!1,"calledWith");h(s,"alwaysCalledWithMatch",!1,"calledWithMatch");h(s,"calledWithExactly",!0);h(s,"alwaysCalledWithExactly",!1,"calledWithExactly");h(s,"neverCalledWith",!1,"notCalledWith",function(){return!0});h(s,
-"neverCalledWithMatch",!1,"notCalledWithMatch",function(){return!0});h(s,"threw",!0);h(s,"alwaysThrew",!1,"threw");h(s,"returned",!0);h(s,"alwaysReturned",!1,"returned");h(s,"calledWithNew",!0);h(s,"alwaysCalledWithNew",!1,"calledWithNew");h(s,"callArg",!1,"callArgWith",function(){throw Error(this.toString()+" cannot call arg since it was not yet invoked.");});s.callArgWith=s.callArg;h(s,"callArgOn",!1,"callArgOnWith",function(){throw Error(this.toString()+" cannot call arg since it was not yet invoked.");
-});s.callArgOnWith=s.callArgOn;h(s,"yield",!1,"yield",function(){throw Error(this.toString()+" cannot yield since it was not yet invoked.");});s.invokeCallback=s.yield;h(s,"yieldOn",!1,"yieldOn",function(){throw Error(this.toString()+" cannot yield since it was not yet invoked.");});h(s,"yieldTo",!1,"yieldTo",function(a){throw Error(this.toString()+" cannot yield to '"+a+"' since it was not yet invoked.");});h(s,"yieldToOn",!1,"yieldToOn",function(a){throw Error(this.toString()+" cannot yield to '"+
-a+"' since it was not yet invoked.");});s.formatters={c:function(b){return a.timesInWords(b.callCount)},n:function(a){return a.toString()},C:function(a){for(var b=[],d=0,c=a.callCount;d<c;++d){var f="    "+a.getCall(d).toString();/\n/.test(b[d-1])&&(f="\n"+f);e.call(b,f)}return 0<b.length?"\n"+b.join("\n"):""},t:function(b){for(var d=[],c=0,f=b.callCount;c<f;++c)e.call(d,a.format(b.thisValues[c]));return d.join(", ")},"*":function(b,d){for(var c=[],f=0,h=d.length;f<h;++f)e.call(c,a.format(d[f]));
-return c.join(", ")}};return s}()),k=function(){function c(b,d,e){b=a.functionName(b)+d;e.length&&(b+=" Received ["+l.call(e).join(", ")+"]");throw Error(b);}var d={create:function(b,d,c,e,f,h){var g=a.create(k);delete g.create;g.proxy=b;g.thisValue=d;g.args=c;g.returnValue=e;g.exception=f;g.callId="number"==typeof h&&h||m++;return g},calledOn:function(b){return a.match&&a.match.isMatcher(b)?b.test(this.thisValue):this.thisValue===b},calledWith:function(){for(var b=0,d=arguments.length;b<d;b+=1)if(!a.deepEqual(arguments[b],
+function(){return f.withArgs.apply(f,arguments)};for(a=0;a<this.args.length;a++)c.matches(this.args[a])&&(b.call(c),e.call(c.thisValues,this.thisValues[a]),e.call(c.args,this.args[a]),e.call(c.returnValues,this.returnValues[a]),e.call(c.exceptions,this.exceptions[a]),e.call(c.callIds,this.callIds[a]));h.call(c);return c},matches:function(b,d){var c=this.matchingAguments;if(c.length<=b.length&&a.deepEqual(c,b.slice(0,c.length)))return!d||c.length==b.length},printf:function(b){var d=this,c=l.call(arguments,
+1),e;return(b||"").replace(/%(.)/g,function(b,f){e=s.formatters[f];return"function"==typeof e?e.call(null,d,c):isNaN(parseInt(f),10)?"%"+f:a.format(c[f-1])})}};g(s,"calledOn",!0);g(s,"alwaysCalledOn",!1,"calledOn");g(s,"calledWith",!0);g(s,"calledWithMatch",!0);g(s,"alwaysCalledWith",!1,"calledWith");g(s,"alwaysCalledWithMatch",!1,"calledWithMatch");g(s,"calledWithExactly",!0);g(s,"alwaysCalledWithExactly",!1,"calledWithExactly");g(s,"neverCalledWith",!1,"notCalledWith",function(){return!0});g(s,
+"neverCalledWithMatch",!1,"notCalledWithMatch",function(){return!0});g(s,"threw",!0);g(s,"alwaysThrew",!1,"threw");g(s,"returned",!0);g(s,"alwaysReturned",!1,"returned");g(s,"calledWithNew",!0);g(s,"alwaysCalledWithNew",!1,"calledWithNew");g(s,"callArg",!1,"callArgWith",function(){throw Error(this.toString()+" cannot call arg since it was not yet invoked.");});s.callArgWith=s.callArg;g(s,"callArgOn",!1,"callArgOnWith",function(){throw Error(this.toString()+" cannot call arg since it was not yet invoked.");
+});s.callArgOnWith=s.callArgOn;g(s,"yield",!1,"yield",function(){throw Error(this.toString()+" cannot yield since it was not yet invoked.");});s.invokeCallback=s.yield;g(s,"yieldOn",!1,"yieldOn",function(){throw Error(this.toString()+" cannot yield since it was not yet invoked.");});g(s,"yieldTo",!1,"yieldTo",function(a){throw Error(this.toString()+" cannot yield to '"+a+"' since it was not yet invoked.");});g(s,"yieldToOn",!1,"yieldToOn",function(a){throw Error(this.toString()+" cannot yield to '"+
+a+"' since it was not yet invoked.");});s.formatters={c:function(b){return a.timesInWords(b.callCount)},n:function(a){return a.toString()},C:function(a){for(var b=[],d=0,c=a.callCount;d<c;++d){var f="    "+a.getCall(d).toString();/\n/.test(b[d-1])&&(f="\n"+f);e.call(b,f)}return 0<b.length?"\n"+b.join("\n"):""},t:function(b){for(var d=[],c=0,f=b.callCount;c<f;++c)e.call(d,a.format(b.thisValues[c]));return d.join(", ")},"*":function(b,d){for(var c=[],f=0,g=d.length;f<g;++f)e.call(c,a.format(d[f]));
+return c.join(", ")}};return s}()),k=function(){function c(b,d,e){b=a.functionName(b)+d;e.length&&(b+=" Received ["+l.call(e).join(", ")+"]");throw Error(b);}var d={create:function(b,d,c,e,f,g){var h=a.create(k);delete h.create;h.proxy=b;h.thisValue=d;h.args=c;h.returnValue=e;h.exception=f;h.callId="number"==typeof g&&g||m++;return h},calledOn:function(b){return a.match&&a.match.isMatcher(b)?b.test(this.thisValue):this.thisValue===b},calledWith:function(){for(var b=0,d=arguments.length;b<d;b+=1)if(!a.deepEqual(arguments[b],
 this.args[b]))return!1;return!0},calledWithMatch:function(){for(var b=0,d=arguments.length;b<d;b+=1){var c=this.args[b],e=arguments[b];if(!a.match||!a.match(e).test(c))return!1}return!0},calledWithExactly:function(){return arguments.length==this.args.length&&this.calledWith.apply(this,arguments)},notCalledWith:function(){return!this.calledWith.apply(this,arguments)},notCalledWithMatch:function(){return!this.calledWithMatch.apply(this,arguments)},returned:function(b){return a.deepEqual(b,this.returnValue)},
 threw:function(a){return"undefined"!=typeof a&&this.exception?"string"==typeof a?this.exception.name==a:this.exception===a:!!this.exception},calledWithNew:function(a){return this.thisValue instanceof this.proxy},calledBefore:function(a){return this.callId<a.callId},calledAfter:function(a){return this.callId>a.callId},callArg:function(a){this.args[a]()},callArgOn:function(a,d){this.args[a].apply(d)},callArgWith:function(a){this.callArgOnWith.apply(this,[a,null].concat(l.call(arguments,1)))},callArgOnWith:function(a,
-d){var c=l.call(arguments,2);this.args[a].apply(d,c)},yield:function(){this.yieldOn.apply(this,[null].concat(l.call(arguments,0)))},yieldOn:function(a){for(var d=this.args,e=0,f=d.length;e<f;++e)if("function"===typeof d[e]){d[e].apply(a,l.call(arguments,1));return}c(this.proxy," cannot yield since no callback was passed.",d)},yieldTo:function(a){this.yieldToOn.apply(this,[a,null].concat(l.call(arguments,1)))},yieldToOn:function(a,d){for(var e=this.args,f=0,g=e.length;f<g;++f)if(e[f]&&"function"===
+d){var c=l.call(arguments,2);this.args[a].apply(d,c)},yield:function(){this.yieldOn.apply(this,[null].concat(l.call(arguments,0)))},yieldOn:function(a){for(var d=this.args,e=0,f=d.length;e<f;++e)if("function"===typeof d[e]){d[e].apply(a,l.call(arguments,1));return}c(this.proxy," cannot yield since no callback was passed.",d)},yieldTo:function(a){this.yieldToOn.apply(this,[a,null].concat(l.call(arguments,1)))},yieldToOn:function(a,d){for(var e=this.args,f=0,h=e.length;f<h;++f)if(e[f]&&"function"===
 typeof e[f][a]){e[f][a].apply(d,l.call(arguments,2));return}c(this.proxy," cannot yield to '"+a+"' since no callback was passed.",e)},toString:function(){for(var b=this.proxy.toString()+"(",d=[],c=0,f=this.args.length;c<f;++c)e.call(d,a.format(this.args[c]));b=b+d.join(", ")+")";"undefined"!=typeof this.returnValue&&(b+=" => "+a.format(this.returnValue));this.exception&&(b+=" !"+this.exception.name,this.exception.message&&(b+="("+this.exception.message+")"));return b}};d.invokeCallback=d.yield;return d}(),
-c.spyCall=k,a.spyCall=k,g?module.exports=c:a.spy=c)})("object"==typeof c&&c||null);(function(a){function c(b,d,e){if(e&&"function"!=typeof e)throw new TypeError("Custom stub should be function");e=e?a.spy&&a.spy.create?a.spy.create(e):e:c.create();if(!b&&!d)return a.stub.create();if(!d&&b&&"object"==typeof b){for(var h in b)"function"===typeof b[h]&&c(b,h);return b}return a.wrapMethod(b,d,e)}function g(a,b){var d=a.callCount-1,c=a[b],d=d in c?c[d]:c[c.length-1];return a[b+"Last"]=d}function k(a,b){var d=
-g(a,"callArgAts");if(0>d){for(var d=g(a,"callArgProps"),c=0,e=b.length;c<e;++c){if(!d&&"function"==typeof b[c])return b[c];if(d&&b[c]&&"function"==typeof b[c][d])return b[c][d]}return null}return b[d]}function m(b,d,c){return 0>b.callArgAtsLast?(b=b.callArgPropsLast?a.functionName(b)+" expected to yield to '"+b.callArgPropsLast+"', but no object with such a property was passed.":a.functionName(b)+" expected to yield, but no callback was passed.",0<c.length&&(b+=" Received ["+h.call(c,", ")+"]"),b):
-"argument at index "+b.callArgAtsLast+" is not a function: "+d}function e(a,b){if(0<a.callArgAts.length){var c=k(a,b);if("function"!=typeof c)throw new TypeError(m(a,c,b));var e=g(a,"callbackArguments"),f=g(a,"callbackContexts");a.callbackAsync?d(function(){c.apply(f,e)}):c.apply(f,e)}}var l="object"==typeof module&&"function"==typeof require;!a&&l&&(a=require("../sinon"));if(a){var h=Array.prototype.join,d=function(){return"object"===typeof process&&"function"===typeof process.nextTick?process.nextTick:
-"function"===typeof setImmediate?setImmediate:function(a){setTimeout(a,0)}}(),b=0;a.extend(c,function(){function d(a,b){"string"==typeof a?(this.exception=Error(b||""),this.exception.name=a):this.exception=a?a:Error("Error");return this}var h=Array.prototype.slice,g;g={create:function(){var d=function(){e(d,arguments);if(d.exception)throw d.exception;return"number"==typeof d.returnArgAt?arguments[d.returnArgAt]:d.returnThis?this:d.returnValue};d.id="stub#"+b++;var h=d,d=a.spy.create(d);d.func=h;d.callArgAts=
+c.spyCall=k,a.spyCall=k,h?module.exports=c:a.spy=c)})("object"==typeof c&&c||null);(function(a){function c(b,d,e){if(e&&"function"!=typeof e)throw new TypeError("Custom stub should be function");e=e?a.spy&&a.spy.create?a.spy.create(e):e:c.create();if(!b&&!d)return a.stub.create();if(!d&&b&&"object"==typeof b){for(var g in b)"function"===typeof b[g]&&c(b,g);return b}return a.wrapMethod(b,d,e)}function h(a,b){var d=a.callCount-1,c=a[b],d=d in c?c[d]:c[c.length-1];return a[b+"Last"]=d}function k(a,b){var d=
+h(a,"callArgAts");if(0>d){for(var d=h(a,"callArgProps"),c=0,e=b.length;c<e;++c){if(!d&&"function"==typeof b[c])return b[c];if(d&&b[c]&&"function"==typeof b[c][d])return b[c][d]}return null}return b[d]}function m(b,d,c){return 0>b.callArgAtsLast?(b=b.callArgPropsLast?a.functionName(b)+" expected to yield to '"+b.callArgPropsLast+"', but no object with such a property was passed.":a.functionName(b)+" expected to yield, but no callback was passed.",0<c.length&&(b+=" Received ["+g.call(c,", ")+"]"),b):
+"argument at index "+b.callArgAtsLast+" is not a function: "+d}function e(a,b){if(0<a.callArgAts.length){var c=k(a,b);if("function"!=typeof c)throw new TypeError(m(a,c,b));var e=h(a,"callbackArguments"),f=h(a,"callbackContexts");a.callbackAsync?d(function(){c.apply(f,e)}):c.apply(f,e)}}var l="object"==typeof module&&"function"==typeof require;!a&&l&&(a=require("../sinon"));if(a){var g=Array.prototype.join,d=function(){return"object"===typeof process&&"function"===typeof process.nextTick?process.nextTick:
+"function"===typeof setImmediate?setImmediate:function(a){setTimeout(a,0)}}(),b=0;a.extend(c,function(){function d(a,b){"string"==typeof a?(this.exception=Error(b||""),this.exception.name=a):this.exception=a?a:Error("Error");return this}var g=Array.prototype.slice,h;h={create:function(){var d=function(){e(d,arguments);if(d.exception)throw d.exception;return"number"==typeof d.returnArgAt?arguments[d.returnArgAt]:d.returnThis?this:d.returnValue};d.id="stub#"+b++;var g=d,d=a.spy.create(d);d.func=g;d.callArgAts=
 [];d.callbackArguments=[];d.callbackContexts=[];d.callArgProps=[];a.extend(d,c);d._create=a.stub.create;d.displayName="stub";d.toString=a.functionToString;return d},resetBehavior:function(){var a;this.callArgAts=[];this.callbackArguments=[];this.callbackContexts=[];this.callArgProps=[];delete this.returnValue;delete this.returnArgAt;this.returnThis=!1;if(this.fakes)for(a=0;a<this.fakes.length;a++)this.fakes[a].resetBehavior()},returns:function(a){this.returnValue=a;return this},returnsArg:function(a){if("number"!=
 typeof a)throw new TypeError("argument index is not number");this.returnArgAt=a;return this},returnsThis:function(){this.returnThis=!0;return this},"throws":d,throwsException:d,callsArg:function(a){if("number"!=typeof a)throw new TypeError("argument index is not number");this.callArgAts.push(a);this.callbackArguments.push([]);this.callbackContexts.push(void 0);this.callArgProps.push(void 0);return this},callsArgOn:function(a,b){if("number"!=typeof a)throw new TypeError("argument index is not number");
-if("object"!=typeof b)throw new TypeError("argument context is not an object");this.callArgAts.push(a);this.callbackArguments.push([]);this.callbackContexts.push(b);this.callArgProps.push(void 0);return this},callsArgWith:function(a){if("number"!=typeof a)throw new TypeError("argument index is not number");this.callArgAts.push(a);this.callbackArguments.push(h.call(arguments,1));this.callbackContexts.push(void 0);this.callArgProps.push(void 0);return this},callsArgOnWith:function(a,b){if("number"!=
-typeof a)throw new TypeError("argument index is not number");if("object"!=typeof b)throw new TypeError("argument context is not an object");this.callArgAts.push(a);this.callbackArguments.push(h.call(arguments,2));this.callbackContexts.push(b);this.callArgProps.push(void 0);return this},yields:function(){this.callArgAts.push(-1);this.callbackArguments.push(h.call(arguments,0));this.callbackContexts.push(void 0);this.callArgProps.push(void 0);return this},yieldsOn:function(a){if("object"!=typeof a)throw new TypeError("argument context is not an object");
-this.callArgAts.push(-1);this.callbackArguments.push(h.call(arguments,1));this.callbackContexts.push(a);this.callArgProps.push(void 0);return this},yieldsTo:function(a){this.callArgAts.push(-1);this.callbackArguments.push(h.call(arguments,1));this.callbackContexts.push(void 0);this.callArgProps.push(a);return this},yieldsToOn:function(a,b){if("object"!=typeof b)throw new TypeError("argument context is not an object");this.callArgAts.push(-1);this.callbackArguments.push(h.call(arguments,2));this.callbackContexts.push(b);
-this.callArgProps.push(a);return this}};for(var l in g)g.hasOwnProperty(l)&&l.match(/^(callsArg|yields|thenYields$)/)&&!l.match(/Async/)&&(g[l+"Async"]=function(a){return function(){this.callbackAsync=!0;return this[a].apply(this,arguments)}}(l));return g}());l?module.exports=c:a.stub=c}})("object"==typeof c&&c||null);(function(a){function c(e){return e?c.create(e):a.expectation.create("Anonymous mock")}var g="object"==typeof module&&"function"==typeof require,k=[].push;!a&&g&&(a=require("../sinon"));
-if(a){a.mock=c;a.extend(c,function(){function e(a,c){if(a)for(var d=0,b=a.length;d<b;d+=1)c(a[d])}return{create:function(e){if(!e)throw new TypeError("object is null");var h=a.extend({},c);h.object=e;delete h.create;return h},expects:function(c){if(!c)throw new TypeError("method is falsy");this.expectations||(this.expectations={},this.proxies=[]);if(!this.expectations[c]){this.expectations[c]=[];var e=this;a.wrapMethod(this.object,c,function(){return e.invokeMethod(c,this,arguments)});k.call(this.proxies,
+if("object"!=typeof b)throw new TypeError("argument context is not an object");this.callArgAts.push(a);this.callbackArguments.push([]);this.callbackContexts.push(b);this.callArgProps.push(void 0);return this},callsArgWith:function(a){if("number"!=typeof a)throw new TypeError("argument index is not number");this.callArgAts.push(a);this.callbackArguments.push(g.call(arguments,1));this.callbackContexts.push(void 0);this.callArgProps.push(void 0);return this},callsArgOnWith:function(a,b){if("number"!=
+typeof a)throw new TypeError("argument index is not number");if("object"!=typeof b)throw new TypeError("argument context is not an object");this.callArgAts.push(a);this.callbackArguments.push(g.call(arguments,2));this.callbackContexts.push(b);this.callArgProps.push(void 0);return this},yields:function(){this.callArgAts.push(-1);this.callbackArguments.push(g.call(arguments,0));this.callbackContexts.push(void 0);this.callArgProps.push(void 0);return this},yieldsOn:function(a){if("object"!=typeof a)throw new TypeError("argument context is not an object");
+this.callArgAts.push(-1);this.callbackArguments.push(g.call(arguments,1));this.callbackContexts.push(a);this.callArgProps.push(void 0);return this},yieldsTo:function(a){this.callArgAts.push(-1);this.callbackArguments.push(g.call(arguments,1));this.callbackContexts.push(void 0);this.callArgProps.push(a);return this},yieldsToOn:function(a,b){if("object"!=typeof b)throw new TypeError("argument context is not an object");this.callArgAts.push(-1);this.callbackArguments.push(g.call(arguments,2));this.callbackContexts.push(b);
+this.callArgProps.push(a);return this}};for(var l in h)h.hasOwnProperty(l)&&l.match(/^(callsArg|yields|thenYields$)/)&&!l.match(/Async/)&&(h[l+"Async"]=function(a){return function(){this.callbackAsync=!0;return this[a].apply(this,arguments)}}(l));return h}());l?module.exports=c:a.stub=c}})("object"==typeof c&&c||null);(function(a){function c(e){return e?c.create(e):a.expectation.create("Anonymous mock")}var h="object"==typeof module&&"function"==typeof require,k=[].push;!a&&h&&(a=require("../sinon"));
+if(a){a.mock=c;a.extend(c,function(){function e(a,c){if(a)for(var d=0,b=a.length;d<b;d+=1)c(a[d])}return{create:function(e){if(!e)throw new TypeError("object is null");var g=a.extend({},c);g.object=e;delete g.create;return g},expects:function(c){if(!c)throw new TypeError("method is falsy");this.expectations||(this.expectations={},this.proxies=[]);if(!this.expectations[c]){this.expectations[c]=[];var e=this;a.wrapMethod(this.object,c,function(){return e.invokeMethod(c,this,arguments)});k.call(this.proxies,
 c)}var d=a.expectation.create(c);k.call(this.expectations[c],d);return d},restore:function(){var a=this.object;e(this.proxies,function(c){"function"==typeof a[c].restore&&a[c].restore()})},verify:function(){var c=this.expectations||{},f=[],d=[];e(this.proxies,function(a){e(c[a],function(a){a.met()?k.call(d,a.toString()):k.call(f,a.toString())})});this.restore();0<f.length?a.expectation.fail(f.concat(d).join("\n")):a.expectation.pass(f.concat(d).join("\n"));return!0},invokeMethod:function(c,e,d){var b=
-this.expectations&&this.expectations[c],f=b&&b.length||0,g;for(g=0;g<f;g+=1)if(!b[g].met()&&b[g].allowsCall(e,d))return b[g].apply(e,d);var m=[],A,s=0;for(g=0;g<f;g+=1)b[g].allowsCall(e,d)?A=A||b[g]:s+=1,k.call(m,"    "+b[g].toString());if(0===s)return A.apply(e,d);m.unshift("Unexpected call: "+a.spyCall.toString.call({proxy:c,args:d}));a.expectation.fail(m.join("\n"))}}}());var m=a.timesInWords;a.expectation=function(){function c(a){return"number"!=typeof a.maxCalls?!1:a.callCount==a.maxCalls}var f=
-Array.prototype.slice,h=a.spy.invoke;return{minCalls:1,maxCalls:1,create:function(d){var b=a.extend(a.stub.create(),a.expectation);delete b.create;b.method=d;return b},invoke:function(a,b,c){this.verifyCallAllowed(b,c);return h.apply(this,arguments)},atLeast:function(a){if("number"!=typeof a)throw new TypeError("'"+a+"' is not number");this.limitsSet||(this.maxCalls=null,this.limitsSet=!0);this.minCalls=a;return this},atMost:function(a){if("number"!=typeof a)throw new TypeError("'"+a+"' is not number");
+this.expectations&&this.expectations[c],f=b&&b.length||0,h;for(h=0;h<f;h+=1)if(!b[h].met()&&b[h].allowsCall(e,d))return b[h].apply(e,d);var m=[],A,s=0;for(h=0;h<f;h+=1)b[h].allowsCall(e,d)?A=A||b[h]:s+=1,k.call(m,"    "+b[h].toString());if(0===s)return A.apply(e,d);m.unshift("Unexpected call: "+a.spyCall.toString.call({proxy:c,args:d}));a.expectation.fail(m.join("\n"))}}}());var m=a.timesInWords;a.expectation=function(){function c(a){return"number"!=typeof a.maxCalls?!1:a.callCount==a.maxCalls}var f=
+Array.prototype.slice,g=a.spy.invoke;return{minCalls:1,maxCalls:1,create:function(d){var b=a.extend(a.stub.create(),a.expectation);delete b.create;b.method=d;return b},invoke:function(a,b,c){this.verifyCallAllowed(b,c);return g.apply(this,arguments)},atLeast:function(a){if("number"!=typeof a)throw new TypeError("'"+a+"' is not number");this.limitsSet||(this.maxCalls=null,this.limitsSet=!0);this.minCalls=a;return this},atMost:function(a){if("number"!=typeof a)throw new TypeError("'"+a+"' is not number");
 this.limitsSet||(this.minCalls=null,this.limitsSet=!0);this.maxCalls=a;return this},never:function(){return this.exactly(0)},once:function(){return this.exactly(1)},twice:function(){return this.exactly(2)},thrice:function(){return this.exactly(3)},exactly:function(a){if("number"!=typeof a)throw new TypeError("'"+a+"' is not a number");this.atLeast(a);return this.atMost(a)},met:function(){var a;if(a=!this.failed)a="number"!=typeof this.minCalls||this.callCount>=this.minCalls;return a},verifyCallAllowed:function(d,
 b){c(this)&&(this.failed=!0,a.expectation.fail(this.method+" already called "+m(this.maxCalls)));"expectedThis"in this&&this.expectedThis!==d&&a.expectation.fail(this.method+" called with "+d+" as thisValue, expected "+this.expectedThis);if("expectedArguments"in this){b||a.expectation.fail(this.method+" received no arguments, expected "+a.format(this.expectedArguments));b.length<this.expectedArguments.length&&a.expectation.fail(this.method+" received too few arguments ("+a.format(b)+"), expected "+
-a.format(this.expectedArguments));this.expectsExactArgCount&&b.length!=this.expectedArguments.length&&a.expectation.fail(this.method+" received too many arguments ("+a.format(b)+"), expected "+a.format(this.expectedArguments));for(var f=0,h=this.expectedArguments.length;f<h;f+=1)a.deepEqual(this.expectedArguments[f],b[f])||a.expectation.fail(this.method+" received wrong arguments "+a.format(b)+", expected "+a.format(this.expectedArguments))}},allowsCall:function(d,b){if(this.met()&&c(this)||"expectedThis"in
-this&&this.expectedThis!==d)return!1;if(!("expectedArguments"in this))return!0;b=b||[];if(b.length<this.expectedArguments.length||this.expectsExactArgCount&&b.length!=this.expectedArguments.length)return!1;for(var f=0,h=this.expectedArguments.length;f<h;f+=1)if(!a.deepEqual(this.expectedArguments[f],b[f]))return!1;return!0},withArgs:function(){this.expectedArguments=f.call(arguments);return this},withExactArgs:function(){this.withArgs.apply(this,arguments);this.expectsExactArgCount=!0;return this},
+a.format(this.expectedArguments));this.expectsExactArgCount&&b.length!=this.expectedArguments.length&&a.expectation.fail(this.method+" received too many arguments ("+a.format(b)+"), expected "+a.format(this.expectedArguments));for(var f=0,g=this.expectedArguments.length;f<g;f+=1)a.deepEqual(this.expectedArguments[f],b[f])||a.expectation.fail(this.method+" received wrong arguments "+a.format(b)+", expected "+a.format(this.expectedArguments))}},allowsCall:function(d,b){if(this.met()&&c(this)||"expectedThis"in
+this&&this.expectedThis!==d)return!1;if(!("expectedArguments"in this))return!0;b=b||[];if(b.length<this.expectedArguments.length||this.expectsExactArgCount&&b.length!=this.expectedArguments.length)return!1;for(var f=0,g=this.expectedArguments.length;f<g;f+=1)if(!a.deepEqual(this.expectedArguments[f],b[f]))return!1;return!0},withArgs:function(){this.expectedArguments=f.call(arguments);return this},withExactArgs:function(){this.withArgs.apply(this,arguments);this.expectsExactArgCount=!0;return this},
 on:function(a){this.expectedThis=a;return this},toString:function(){var d=(this.expectedArguments||[]).slice();this.expectsExactArgCount||k.call(d,"[...]");var d=a.spyCall.toString.call({proxy:this.method||"anonymous mock expectation",args:d}).replace(", [...","[, ...")+" ",b;b=this.minCalls;var c=this.maxCalls;if("number"==typeof b&&"number"==typeof c){var e=m(b);b!=c&&(e="at least "+e+" and at most "+m(c));b=e}else b="number"==typeof b?"at least "+m(b):"at most "+m(c);d+=b;if(this.met())return"Expectation met: "+
-d;d="Expected "+d+" (";b=this.callCount;b=0==b?"never called":"called "+m(b);return d+b+")"},verify:function(){this.met()?a.expectation.pass(this.toString()):a.expectation.fail(this.toString());return!0},pass:function(d){a.assert.pass(d)},fail:function(a){a=Error(a);a.name="ExpectationError";throw a;}}}();g?module.exports=c:a.mock=c}})("object"==typeof c&&c||null);(function(a){function c(a){a.fakes||(a.fakes=[]);return a.fakes}function g(a,d){for(var b=c(a),e=0,g=b.length;e<g;e+=1)if("function"==
-typeof b[e][d])b[e][d]()}var k="object"==typeof module&&"function"==typeof require,m=[].push,e=Object.prototype.hasOwnProperty;!a&&k&&(a=require("../sinon"));if(a){var l={verify:function(){g(this,"verify")},restore:function(){g(this,"restore");for(var a=c(this);0<a.length;)a.splice(0,1)},verifyAndRestore:function(){var a;try{this.verify()}catch(d){a=d}this.restore();if(a)throw a;},add:function(a){m.call(c(this),a);return a},spy:function(){return this.add(a.spy.apply(a,arguments))},stub:function(c,
-d,b){if(d){var f=c[d];if("function"!=typeof f){if(!e.call(c,d))throw new TypeError("Cannot stub non-existent own property "+d);c[d]=b;return this.add({restore:function(){c[d]=f}})}}if(!d&&c&&"object"==typeof c){var g=a.stub.apply(a,arguments),l;for(l in g)"function"===typeof g[l]&&this.add(g[l]);return g}return this.add(a.stub.apply(a,arguments))},mock:function(){return this.add(a.mock.apply(a,arguments))},inject:function(a){var d=this;a.spy=function(){return d.spy.apply(d,arguments)};a.stub=function(){return d.stub.apply(d,
-arguments)};a.mock=function(){return d.mock.apply(d,arguments)};return a}};k?module.exports=l:a.collection=l}})("object"==typeof c&&c||null);"undefined"==typeof c&&(c={});(function(a){function f(a,b){if(0===a.length)throw Error("Function requires at least 1 parameter");var c=l++,e=a[1]||0;this.timeouts||(this.timeouts={});this.timeouts[c]={id:c,func:a[0],callAt:this.now+e,invokeArgs:Array.prototype.slice.call(a,2)};!0===b&&(this.timeouts[c].interval=e);return c}function g(a){if(Object.create)a=Object.create(a);
+d;d="Expected "+d+" (";b=this.callCount;b=0==b?"never called":"called "+m(b);return d+b+")"},verify:function(){this.met()?a.expectation.pass(this.toString()):a.expectation.fail(this.toString());return!0},pass:function(d){a.assert.pass(d)},fail:function(a){a=Error(a);a.name="ExpectationError";throw a;}}}();h?module.exports=c:a.mock=c}})("object"==typeof c&&c||null);(function(a){function c(a){a.fakes||(a.fakes=[]);return a.fakes}function h(a,d){for(var b=c(a),e=0,h=b.length;e<h;e+=1)if("function"==
+typeof b[e][d])b[e][d]()}var k="object"==typeof module&&"function"==typeof require,m=[].push,e=Object.prototype.hasOwnProperty;!a&&k&&(a=require("../sinon"));if(a){var l={verify:function(){h(this,"verify")},restore:function(){h(this,"restore");for(var a=c(this);0<a.length;)a.splice(0,1)},verifyAndRestore:function(){var a;try{this.verify()}catch(d){a=d}this.restore();if(a)throw a;},add:function(a){m.call(c(this),a);return a},spy:function(){return this.add(a.spy.apply(a,arguments))},stub:function(c,
+d,b){if(d){var f=c[d];if("function"!=typeof f){if(!e.call(c,d))throw new TypeError("Cannot stub non-existent own property "+d);c[d]=b;return this.add({restore:function(){c[d]=f}})}}if(!d&&c&&"object"==typeof c){var h=a.stub.apply(a,arguments),l;for(l in h)"function"===typeof h[l]&&this.add(h[l]);return h}return this.add(a.stub.apply(a,arguments))},mock:function(){return this.add(a.mock.apply(a,arguments))},inject:function(a){var d=this;a.spy=function(){return d.spy.apply(d,arguments)};a.stub=function(){return d.stub.apply(d,
+arguments)};a.mock=function(){return d.mock.apply(d,arguments)};return a}};k?module.exports=l:a.collection=l}})("object"==typeof c&&c||null);"undefined"==typeof c&&(c={});(function(a){function f(a,b){if(0===a.length)throw Error("Function requires at least 1 parameter");var c=l++,e=a[1]||0;this.timeouts||(this.timeouts={});this.timeouts[c]={id:c,func:a[0],callAt:this.now+e,invokeArgs:Array.prototype.slice.call(a,2)};!0===b&&(this.timeouts[c].interval=e);return c}function h(a){if(Object.create)a=Object.create(a);
 else{var b=function(){};b.prototype=a;a=new b}return a.Date.clock=a}function k(a,b){b.now?a.now=function(){return a.clock.now}:delete a.now;b.toSource?a.toSource=function(){return b.toSource()}:delete a.toSource;a.toString=function(){return b.toString()};a.prototype=b.prototype;a.parse=b.parse;a.UTC=b.UTC;a.prototype.toUTCString=b.prototype.toUTCString;return a}function m(){for(var d,b=0,c=this.methods.length;b<c;b++)d=this.methods[b],a[d].hadOwnProperty?a[d]=this["_"+d]:delete a[d];this.methods=
-[]}function e(d,b){b[d].hadOwnProperty=Object.prototype.hasOwnProperty.call(a,d);b["_"+d]=a[d];if("Date"==d){var c=k(b[d],a[d]);a[d]=c}else for(c in a[d]=function(){return b[d].apply(b,arguments)},b[d])b[d].hasOwnProperty(c)&&(a[d][c]=b[d][c]);a[d].clock=b}var l=1;c.clock={now:0,create:function(a){var b=g(this);"number"==typeof a&&(b.now=a);if(a&&"object"==typeof a)throw new TypeError("now should be milliseconds since UNIX epoch");return b},setTimeout:function(a,b){return f.call(this,arguments,!1)},
-clearTimeout:function(a){this.timeouts||(this.timeouts=[]);a in this.timeouts&&delete this.timeouts[a]},setInterval:function(a,b){return f.call(this,arguments,!0)},clearInterval:function(a){this.clearTimeout(a)},tick:function(a){var b;if("number"==typeof a)b=a;else if(a){b=a.split(":");var c=b.length,e=c,f=0,h;if(3<c||!/^(\d\d:){0,2}\d\d?$/.test(a))throw Error("tick only understands numbers and 'h:m:s'");for(;e--;){h=parseInt(b[e],10);if(60<=h)throw Error("Invalid time "+a);f+=h*Math.pow(60,c-e-1)}b=
-1E3*f}else b=0;a=this.now;b=this.now+b;for(var c=this.now,e=this.firstTimerInRange(a,b),g;e&&a<=b;){if(this.timeouts[e.id]){a=this.now=e.callAt;try{this.callTimer(e)}catch(l){g=g||l}}e=this.firstTimerInRange(c,b);c=a}this.now=b;if(g)throw g;return this.now},firstTimerInRange:function(a,b){var c,e,f;for(f in this.timeouts)!this.timeouts.hasOwnProperty(f)||this.timeouts[f].callAt<a||this.timeouts[f].callAt>b||e&&!(this.timeouts[f].callAt<e)||(e=this.timeouts[f].callAt,c={func:this.timeouts[f].func,
-callAt:this.timeouts[f].callAt,interval:this.timeouts[f].interval,id:this.timeouts[f].id,invokeArgs:this.timeouts[f].invokeArgs});return c||null},callTimer:function(a){"number"==typeof a.interval?this.timeouts[a.id].callAt+=a.interval:delete this.timeouts[a.id];try{"function"==typeof a.func?a.func.apply(null,a.invokeArgs):eval(a.func)}catch(b){var c=b}if(c)throw c;},reset:function(){this.timeouts={}},Date:function(){function a(c,e,f,h,g,l,k){switch(arguments.length){case 0:return new b(a.clock.now);
-case 1:return new b(c);case 2:return new b(c,e);case 3:return new b(c,e,f);case 4:return new b(c,e,f,h);case 5:return new b(c,e,f,h,g);case 6:return new b(c,e,f,h,g,l);default:return new b(c,e,f,h,g,l,k)}}var b=Date;return k(a,b)}()};var h=["Date","setTimeout","setInterval","clearTimeout","clearInterval"];c.useFakeTimers=function(a){var b=c.clock.create(a);b.restore=m;b.methods=Array.prototype.slice.call(arguments,"number"==typeof a?1:0);0===b.methods.length&&(b.methods=h);for(var f=0,g=b.methods.length;f<
-g;f++)e(b.methods[f],b);return b}})("undefined"!=typeof global&&"function"!==typeof global?global:this);c.timers={setTimeout:setTimeout,clearTimeout:clearTimeout,setInterval:setInterval,clearInterval:clearInterval,Date:Date};"object"==typeof module&&"function"==typeof require&&(module.exports=c);"undefined"==typeof c&&(this.sinon={});(function(){var a=[].push;c.Event=function(a,c,k){this.initEvent(a,c,k)};c.Event.prototype={initEvent:function(a,c,k){this.type=a;this.bubbles=c;this.cancelable=k},stopPropagation:function(){},
-preventDefault:function(){this.defaultPrevented=!0}};c.EventTarget={addEventListener:function(c,g,k){this.eventListeners=this.eventListeners||{};this.eventListeners[c]=this.eventListeners[c]||[];a.call(this.eventListeners[c],g)},removeEventListener:function(a,c,k){a=this.eventListeners&&this.eventListeners[a]||[];k=0;for(var m=a.length;k<m;++k)if(a[k]==c)return a.splice(k,1)},dispatchEvent:function(a){for(var c=a.type,c=this.eventListeners&&this.eventListeners[c]||[],k=0;k<c.length;k++)"function"==
-typeof c[k]?c[k].call(this,a):c[k].handleEvent(a);return!!a.defaultPrevented}}})();"undefined"==typeof c&&(this.sinon={});c.xhr={XMLHttpRequest:this.XMLHttpRequest};(function(a){function f(){this.readyState=f.UNSENT;this.requestHeaders={};this.requestBody=null;this.status=0;this.statusText="";if("function"==typeof f.onCreate)f.onCreate(this)}function g(a){if(a.readyState!==f.OPENED)throw Error("INVALID_STATE_ERR");if(a.sendFlag)throw Error("INVALID_STATE_ERR");}function k(a,c){if(a)for(var d=0,e=
+[]}function e(d,b){b[d].hadOwnProperty=Object.prototype.hasOwnProperty.call(a,d);b["_"+d]=a[d];if("Date"==d){var c=k(b[d],a[d]);a[d]=c}else for(c in a[d]=function(){return b[d].apply(b,arguments)},b[d])b[d].hasOwnProperty(c)&&(a[d][c]=b[d][c]);a[d].clock=b}var l=1;c.clock={now:0,create:function(a){var b=h(this);"number"==typeof a&&(b.now=a);if(a&&"object"==typeof a)throw new TypeError("now should be milliseconds since UNIX epoch");return b},setTimeout:function(a,b){return f.call(this,arguments,!1)},
+clearTimeout:function(a){this.timeouts||(this.timeouts=[]);a in this.timeouts&&delete this.timeouts[a]},setInterval:function(a,b){return f.call(this,arguments,!0)},clearInterval:function(a){this.clearTimeout(a)},tick:function(a){var b;if("number"==typeof a)b=a;else if(a){b=a.split(":");var c=b.length,e=c,f=0,g;if(3<c||!/^(\d\d:){0,2}\d\d?$/.test(a))throw Error("tick only understands numbers and 'h:m:s'");for(;e--;){g=parseInt(b[e],10);if(60<=g)throw Error("Invalid time "+a);f+=g*Math.pow(60,c-e-1)}b=
+1E3*f}else b=0;a=this.now;b=this.now+b;for(var c=this.now,e=this.firstTimerInRange(a,b),h;e&&a<=b;){if(this.timeouts[e.id]){a=this.now=e.callAt;try{this.callTimer(e)}catch(l){h=h||l}}e=this.firstTimerInRange(c,b);c=a}this.now=b;if(h)throw h;return this.now},firstTimerInRange:function(a,b){var c,e,f;for(f in this.timeouts)!this.timeouts.hasOwnProperty(f)||this.timeouts[f].callAt<a||this.timeouts[f].callAt>b||e&&!(this.timeouts[f].callAt<e)||(e=this.timeouts[f].callAt,c={func:this.timeouts[f].func,
+callAt:this.timeouts[f].callAt,interval:this.timeouts[f].interval,id:this.timeouts[f].id,invokeArgs:this.timeouts[f].invokeArgs});return c||null},callTimer:function(a){"number"==typeof a.interval?this.timeouts[a.id].callAt+=a.interval:delete this.timeouts[a.id];try{"function"==typeof a.func?a.func.apply(null,a.invokeArgs):eval(a.func)}catch(b){var c=b}if(c)throw c;},reset:function(){this.timeouts={}},Date:function(){function a(c,e,f,g,h,l,k){switch(arguments.length){case 0:return new b(a.clock.now);
+case 1:return new b(c);case 2:return new b(c,e);case 3:return new b(c,e,f);case 4:return new b(c,e,f,g);case 5:return new b(c,e,f,g,h);case 6:return new b(c,e,f,g,h,l);default:return new b(c,e,f,g,h,l,k)}}var b=Date;return k(a,b)}()};var g=["Date","setTimeout","setInterval","clearTimeout","clearInterval"];c.useFakeTimers=function(a){var b=c.clock.create(a);b.restore=m;b.methods=Array.prototype.slice.call(arguments,"number"==typeof a?1:0);0===b.methods.length&&(b.methods=g);for(var f=0,h=b.methods.length;f<
+h;f++)e(b.methods[f],b);return b}})("undefined"!=typeof global&&"function"!==typeof global?global:this);c.timers={setTimeout:setTimeout,clearTimeout:clearTimeout,setInterval:setInterval,clearInterval:clearInterval,Date:Date};"object"==typeof module&&"function"==typeof require&&(module.exports=c);"undefined"==typeof c&&(this.sinon={});(function(){var a=[].push;c.Event=function(a,c,k){this.initEvent(a,c,k)};c.Event.prototype={initEvent:function(a,c,k){this.type=a;this.bubbles=c;this.cancelable=k},stopPropagation:function(){},
+preventDefault:function(){this.defaultPrevented=!0}};c.EventTarget={addEventListener:function(c,h,k){this.eventListeners=this.eventListeners||{};this.eventListeners[c]=this.eventListeners[c]||[];a.call(this.eventListeners[c],h)},removeEventListener:function(a,c,k){a=this.eventListeners&&this.eventListeners[a]||[];k=0;for(var m=a.length;k<m;++k)if(a[k]==c)return a.splice(k,1)},dispatchEvent:function(a){for(var c=a.type,c=this.eventListeners&&this.eventListeners[c]||[],k=0;k<c.length;k++)"function"==
+typeof c[k]?c[k].call(this,a):c[k].handleEvent(a);return!!a.defaultPrevented}}})();"undefined"==typeof c&&(this.sinon={});c.xhr={XMLHttpRequest:this.XMLHttpRequest};(function(a){function f(){this.readyState=f.UNSENT;this.requestHeaders={};this.requestBody=null;this.status=0;this.statusText="";if("function"==typeof f.onCreate)f.onCreate(this)}function h(a){if(a.readyState!==f.OPENED)throw Error("INVALID_STATE_ERR");if(a.sendFlag)throw Error("INVALID_STATE_ERR");}function k(a,c){if(a)for(var d=0,e=
 a.length;d<e;d+=1)c(a[d])}function m(a,c){for(var d=0;d<a.length;d++)if(!0===c(a[d]))return!0;return!1}var e=c.xhr;e.GlobalXMLHttpRequest=a.XMLHttpRequest;e.GlobalActiveXObject=a.ActiveXObject;e.supportsActiveX="undefined"!=typeof e.GlobalActiveXObject;e.supportsXHR="undefined"!=typeof e.GlobalXMLHttpRequest;e.workingXHR=e.supportsXHR?e.GlobalXMLHttpRequest:e.supportsActiveX?function(){return new e.GlobalActiveXObject("MSXML2.XMLHTTP.3.0")}:!1;var l={"Accept-Charset":!0,"Accept-Encoding":!0,Connection:!0,
-"Content-Length":!0,Cookie:!0,Cookie2:!0,"Content-Transfer-Encoding":!0,Date:!0,Expect:!0,Host:!0,"Keep-Alive":!0,Referer:!0,TE:!0,Trailer:!0,"Transfer-Encoding":!0,Upgrade:!0,"User-Agent":!0,Via:!0},h=function(a,c,d){switch(d.length){case 0:return a[c]();case 1:return a[c](d[0]);case 2:return a[c](d[0],d[1]);case 3:return a[c](d[0],d[1],d[2]);case 4:return a[c](d[0],d[1],d[2],d[3]);case 5:return a[c](d[0],d[1],d[2],d[3],d[4])}};f.filters=[];f.addFilter=function(a){this.filters.push(a)};var d=/MSIE 6/;
-f.defake=function(a,e){var g=new c.xhr.workingXHR;k("open setRequestHeader send abort getResponseHeader getAllResponseHeaders addEventListener overrideMimeType removeEventListener".split(" "),function(c){a[c]=function(){return h(g,c,arguments)}});var l=function(c){k(c,function(c){try{a[c]=g[c]}catch(e){if(!d.test(navigator.userAgent))throw e;}})},m=function(){a.readyState=g.readyState;g.readyState>=f.HEADERS_RECEIVED&&l(["status","statusText"]);g.readyState>=f.LOADING&&l(["responseText"]);g.readyState===
-f.DONE&&l(["responseXML"]);a.onreadystatechange&&a.onreadystatechange.call(a)};if(g.addEventListener){for(var s in a.eventListeners)a.eventListeners.hasOwnProperty(s)&&k(a.eventListeners[s],function(a){g.addEventListener(s,a)});g.addEventListener("readystatechange",m)}else g.onreadystatechange=m;h(g,"open",e)};f.useFilters=!1;c.extend(f.prototype,c.EventTarget,{async:!0,open:function(a,d,e,h,g){this.method=a;this.url=d;this.async="boolean"==typeof e?e:!0;this.username=h;this.password=g;this.responseXML=
+"Content-Length":!0,Cookie:!0,Cookie2:!0,"Content-Transfer-Encoding":!0,Date:!0,Expect:!0,Host:!0,"Keep-Alive":!0,Referer:!0,TE:!0,Trailer:!0,"Transfer-Encoding":!0,Upgrade:!0,"User-Agent":!0,Via:!0},g=function(a,c,d){switch(d.length){case 0:return a[c]();case 1:return a[c](d[0]);case 2:return a[c](d[0],d[1]);case 3:return a[c](d[0],d[1],d[2]);case 4:return a[c](d[0],d[1],d[2],d[3]);case 5:return a[c](d[0],d[1],d[2],d[3],d[4])}};f.filters=[];f.addFilter=function(a){this.filters.push(a)};var d=/MSIE 6/;
+f.defake=function(a,e){var h=new c.xhr.workingXHR;k("open setRequestHeader send abort getResponseHeader getAllResponseHeaders addEventListener overrideMimeType removeEventListener".split(" "),function(d){a[d]=function(){return g(h,d,arguments)}});var l=function(c){k(c,function(c){try{a[c]=h[c]}catch(e){if(!d.test(navigator.userAgent))throw e;}})},m=function(){a.readyState=h.readyState;h.readyState>=f.HEADERS_RECEIVED&&l(["status","statusText"]);h.readyState>=f.LOADING&&l(["responseText"]);h.readyState===
+f.DONE&&l(["responseXML"]);a.onreadystatechange&&a.onreadystatechange.call(a)};if(h.addEventListener){for(var s in a.eventListeners)a.eventListeners.hasOwnProperty(s)&&k(a.eventListeners[s],function(a){h.addEventListener(s,a)});h.addEventListener("readystatechange",m)}else h.onreadystatechange=m;g(h,"open",e)};f.useFilters=!1;c.extend(f.prototype,c.EventTarget,{async:!0,open:function(a,d,e,g,h){this.method=a;this.url=d;this.async="boolean"==typeof e?e:!0;this.username=g;this.password=h;this.responseXML=
 this.responseText=null;this.requestHeaders={};this.sendFlag=!1;if(!0===c.FakeXMLHttpRequest.useFilters){var l=arguments;if(m(f.filters,function(a){return a.apply(this,l)}))return c.FakeXMLHttpRequest.defake(this,arguments)}this.readyStateChange(f.OPENED)},readyStateChange:function(a){this.readyState=a;if("function"==typeof this.onreadystatechange)try{this.onreadystatechange()}catch(d){c.logError("Fake XHR onreadystatechange handler",d)}this.dispatchEvent(new c.Event("readystatechange"))},setRequestHeader:function(a,
-c){g(this);if(l[a]||/^(Sec-|Proxy-)/.test(a))throw Error('Refused to set unsafe header "'+a+'"');this.requestHeaders[a]=this.requestHeaders[a]?this.requestHeaders[a]+(","+c):c},setResponseHeaders:function(a){this.responseHeaders={};for(var c in a)a.hasOwnProperty(c)&&(this.responseHeaders[c]=a[c]);this.async?this.readyStateChange(f.HEADERS_RECEIVED):this.readyState=f.HEADERS_RECEIVED},send:function(a){g(this);if(!/^(get|head)$/i.test(this.method)){if(this.requestHeaders["Content-Type"]){var c=this.requestHeaders["Content-Type"].split(";");
-this.requestHeaders["Content-Type"]=c[0]+";charset=utf-8"}else this.requestHeaders["Content-Type"]="text/plain;charset=utf-8";this.requestBody=a}this.errorFlag=!1;this.sendFlag=this.async;this.readyStateChange(f.OPENED);if("function"==typeof this.onSend)this.onSend(this)},abort:function(){this.aborted=!0;this.responseText=null;this.errorFlag=!0;this.requestHeaders={};this.readyState>c.FakeXMLHttpRequest.UNSENT&&this.sendFlag&&(this.readyStateChange(c.FakeXMLHttpRequest.DONE),this.sendFlag=!1);this.readyState=
-c.FakeXMLHttpRequest.UNSENT},getResponseHeader:function(a){if(this.readyState<f.HEADERS_RECEIVED||/^Set-Cookie2?$/i.test(a))return null;a=a.toLowerCase();for(var c in this.responseHeaders)if(c.toLowerCase()==a)return this.responseHeaders[c];return null},getAllResponseHeaders:function(){if(this.readyState<f.HEADERS_RECEIVED)return"";var a="",c;for(c in this.responseHeaders)this.responseHeaders.hasOwnProperty(c)&&!/^Set-Cookie2?$/i.test(c)&&(a+=c+": "+this.responseHeaders[c]+"\r\n");return a},setResponseBody:function(a){if(this.readyState==
-f.DONE)throw Error("Request done");if(this.async&&this.readyState!=f.HEADERS_RECEIVED)throw Error("No headers received");if("string"!=typeof a)throw a=Error("Attempted to respond to fake XMLHttpRequest with "+a+", which is not a string."),a.name="InvalidBodyException",a;var c=this.chunkSize||10,d=0;this.responseText="";do this.async&&this.readyStateChange(f.LOADING),this.responseText+=a.substring(d,d+c),d+=c;while(d<a.length);a=this.getResponseHeader("Content-Type");if(this.responseText&&(!a||/(text\/xml)|(application\/xml)|(\+xml)/.test(a)))try{this.responseXML=
-f.parseXML(this.responseText)}catch(e){}this.async?this.readyStateChange(f.DONE):this.readyState=f.DONE},respond:function(a,c,d){this.setResponseHeaders(c||{});this.status="number"==typeof a?a:200;this.statusText=f.statusCodes[this.status];this.setResponseBody(d||"")}});c.extend(f,{UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4});f.parseXML=function(a){var c;"undefined"!=typeof DOMParser?c=(new DOMParser).parseFromString(a,"text/xml"):(c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",
-c.loadXML(a));return c};f.statusCodes={100:"Continue",101:"Switching Protocols",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",300:"Multiple Choice",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",
+d){h(this);if(l[a]||/^(Sec-|Proxy-)/.test(a))throw Error('Refused to set unsafe header "'+a+'"');this.requestHeaders[a]=this.requestHeaders[a]?this.requestHeaders[a]+(","+d):d},setResponseHeaders:function(a){this.responseHeaders={};for(var d in a)a.hasOwnProperty(d)&&(this.responseHeaders[d]=a[d]);this.async?this.readyStateChange(f.HEADERS_RECEIVED):this.readyState=f.HEADERS_RECEIVED},send:function(a){h(this);if(!/^(get|head)$/i.test(this.method)){if(this.requestHeaders["Content-Type"]){var d=this.requestHeaders["Content-Type"].split(";");
+this.requestHeaders["Content-Type"]=d[0]+";charset=utf-8"}else this.requestHeaders["Content-Type"]="text/plain;charset=utf-8";this.requestBody=a}this.errorFlag=!1;this.sendFlag=this.async;this.readyStateChange(f.OPENED);if("function"==typeof this.onSend)this.onSend(this)},abort:function(){this.aborted=!0;this.responseText=null;this.errorFlag=!0;this.requestHeaders={};this.readyState>c.FakeXMLHttpRequest.UNSENT&&this.sendFlag&&(this.readyStateChange(c.FakeXMLHttpRequest.DONE),this.sendFlag=!1);this.readyState=
+c.FakeXMLHttpRequest.UNSENT},getResponseHeader:function(a){if(this.readyState<f.HEADERS_RECEIVED||/^Set-Cookie2?$/i.test(a))return null;a=a.toLowerCase();for(var d in this.responseHeaders)if(d.toLowerCase()==a)return this.responseHeaders[d];return null},getAllResponseHeaders:function(){if(this.readyState<f.HEADERS_RECEIVED)return"";var a="",d;for(d in this.responseHeaders)this.responseHeaders.hasOwnProperty(d)&&!/^Set-Cookie2?$/i.test(d)&&(a+=d+": "+this.responseHeaders[d]+"\r\n");return a},setResponseBody:function(a){if(this.readyState==
+f.DONE)throw Error("Request done");if(this.async&&this.readyState!=f.HEADERS_RECEIVED)throw Error("No headers received");if("string"!=typeof a)throw a=Error("Attempted to respond to fake XMLHttpRequest with "+a+", which is not a string."),a.name="InvalidBodyException",a;var d=this.chunkSize||10,c=0;this.responseText="";do this.async&&this.readyStateChange(f.LOADING),this.responseText+=a.substring(c,c+d),c+=d;while(c<a.length);a=this.getResponseHeader("Content-Type");if(this.responseText&&(!a||/(text\/xml)|(application\/xml)|(\+xml)/.test(a)))try{this.responseXML=
+f.parseXML(this.responseText)}catch(e){}this.async?this.readyStateChange(f.DONE):this.readyState=f.DONE},respond:function(a,d,c){this.setResponseHeaders(d||{});this.status="number"==typeof a?a:200;this.statusText=f.statusCodes[this.status];this.setResponseBody(c||"")}});c.extend(f,{UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4});f.parseXML=function(a){var d;"undefined"!=typeof DOMParser?d=(new DOMParser).parseFromString(a,"text/xml"):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",
+d.loadXML(a));return d};f.statusCodes={100:"Continue",101:"Switching Protocols",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",300:"Multiple Choice",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",
 408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported"};c.useFakeXMLHttpRequest=function(){c.FakeXMLHttpRequest.restore=function(b){e.supportsXHR&&
 (a.XMLHttpRequest=e.GlobalXMLHttpRequest);e.supportsActiveX&&(a.ActiveXObject=e.GlobalActiveXObject);delete c.FakeXMLHttpRequest.restore;!0!==b&&delete c.FakeXMLHttpRequest.onCreate};e.supportsXHR&&(a.XMLHttpRequest=c.FakeXMLHttpRequest);e.supportsActiveX&&(a.ActiveXObject=function(a){return"Microsoft.XMLHTTP"==a||/^Msxml2\.XMLHTTP/i.test(a)?new c.FakeXMLHttpRequest:new e.GlobalActiveXObject(a)});return c.FakeXMLHttpRequest};c.FakeXMLHttpRequest=f})(this);"object"==typeof module&&"function"==typeof require&&
-(module.exports=c);"undefined"==typeof c&&(c={});c.fakeServer=function(){function a(){}function f(a){var c=a;"[object Array]"!=Object.prototype.toString.call(a)&&(c=[200,{},a]);if("string"!=typeof c[2])throw new TypeError("Fake server response body should be string, but was "+typeof c[2]);return c}var g=[].push,k="undefined"!==typeof window?window.location:{},m=RegExp("^"+k.protocol+"//"+k.host);return{create:function(){var e;a.prototype=this;e=new a;this.xhr=c.useFakeXMLHttpRequest();e.requests=
-[];this.xhr.onCreate=function(a){e.addRequest(a)};return e},addRequest:function(a){var c=this;g.call(this.requests,a);a.onSend=function(){c.handleRequest(this)};this.autoRespond&&!this.responding&&(setTimeout(function(){c.responding=!1;c.respond()},this.autoRespondAfter||10),this.responding=!0)},getHTTPMethod:function(a){if(this.fakeHTTPMethods&&/post/i.test(a.method)){var c=(a.requestBody||"").match(/_method=([^\b;]+)/);return c?c[1]:a.method}return a.method},handleRequest:function(a){a.async?(this.queue||
-(this.queue=[]),g.call(this.queue,a)):this.processRequest(a)},respondWith:function(a,c,h){1==arguments.length&&"function"!=typeof a?this.response=f(a):(this.responses||(this.responses=[]),1==arguments.length&&(h=a,c=a=null),2==arguments.length&&(h=c,c=a,a=null),g.call(this.responses,{method:a,url:c,response:"function"==typeof h?h:f(h)}))},respond:function(){0<arguments.length&&this.respondWith.apply(this,arguments);for(var a=this.queue||[],c;c=a.shift();)this.processRequest(c)},processRequest:function(a){try{if(!a.aborted){var f=
-this.response||[404,{},""];if(this.responses)for(var h=0,d=this.responses.length;h<d;h++){var b;var g=this.responses[h],k=a;this.getHTTPMethod(k);var n=k.url;if(!/^https?:\/\//.test(n)||m.test(n))n=n.replace(m,"");var A=g,s=this.getHTTPMethod(k),C=n,D=A.method,u=!D||D.toLowerCase()==s.toLowerCase(),w=A.url,x=!w||w==C||"function"==typeof w.test&&w.test(C);if(u&&x)if("function"==typeof g.response){var r=g.url,q=[k].concat(r?n.match(r).slice(1):[]);b=g.response.apply(g,q)}else b=!0;else b=!1;if(b){f=
-this.responses[h].response;break}}if(4!=a.readyState){var h=f,z;z="Request:\n"+c.format(a)+"\n\n";z+="Response:\n"+c.format(h)+"\n\n";c.log(z);a.respond(f[0],f[1],f[2])}}}catch(y){c.logError("Fake server request processing",y)}},restore:function(){return this.xhr.restore&&this.xhr.restore.apply(this.xhr,arguments)}}}();"object"==typeof module&&"function"==typeof require&&(module.exports=c);(function(){function a(){}a.prototype=c.fakeServer;c.fakeServerWithClock=new a;c.fakeServerWithClock.addRequest=
-function(a){if(a.async&&("object"==typeof setTimeout.clock?this.clock=setTimeout.clock:(this.clock=c.useFakeTimers(),this.resetClock=!0),!this.longestTimeout)){var g=this.clock.setTimeout,k=this.clock.setInterval,m=this;this.clock.setTimeout=function(a,c){m.longestTimeout=Math.max(c,m.longestTimeout||0);return g.apply(this,arguments)};this.clock.setInterval=function(a,c){m.longestTimeout=Math.max(c,m.longestTimeout||0);return k.apply(this,arguments)}}return c.fakeServer.addRequest.call(this,a)};c.fakeServerWithClock.respond=
+(module.exports=c);"undefined"==typeof c&&(c={});c.fakeServer=function(){function a(){}function f(a){var c=a;"[object Array]"!=Object.prototype.toString.call(a)&&(c=[200,{},a]);if("string"!=typeof c[2])throw new TypeError("Fake server response body should be string, but was "+typeof c[2]);return c}var h=[].push,k="undefined"!==typeof window?window.location:{},m=RegExp("^"+k.protocol+"//"+k.host);return{create:function(){var e;a.prototype=this;e=new a;this.xhr=c.useFakeXMLHttpRequest();e.requests=
+[];this.xhr.onCreate=function(a){e.addRequest(a)};return e},addRequest:function(a){var c=this;h.call(this.requests,a);a.onSend=function(){c.handleRequest(this)};this.autoRespond&&!this.responding&&(setTimeout(function(){c.responding=!1;c.respond()},this.autoRespondAfter||10),this.responding=!0)},getHTTPMethod:function(a){if(this.fakeHTTPMethods&&/post/i.test(a.method)){var c=(a.requestBody||"").match(/_method=([^\b;]+)/);return c?c[1]:a.method}return a.method},handleRequest:function(a){a.async?(this.queue||
+(this.queue=[]),h.call(this.queue,a)):this.processRequest(a)},respondWith:function(a,c,g){1==arguments.length&&"function"!=typeof a?this.response=f(a):(this.responses||(this.responses=[]),1==arguments.length&&(g=a,c=a=null),2==arguments.length&&(g=c,c=a,a=null),h.call(this.responses,{method:a,url:c,response:"function"==typeof g?g:f(g)}))},respond:function(){0<arguments.length&&this.respondWith.apply(this,arguments);for(var a=this.queue||[],c;c=a.shift();)this.processRequest(c)},processRequest:function(a){try{if(!a.aborted){var f=
+this.response||[404,{},""];if(this.responses)for(var g=0,d=this.responses.length;g<d;g++){var b;var h=this.responses[g],k=a;this.getHTTPMethod(k);var n=k.url;if(!/^https?:\/\//.test(n)||m.test(n))n=n.replace(m,"");var A=h,s=this.getHTTPMethod(k),C=n,D=A.method,v=!D||D.toLowerCase()==s.toLowerCase(),w=A.url,x=!w||w==C||"function"==typeof w.test&&w.test(C);if(v&&x)if("function"==typeof h.response){var r=h.url,q=[k].concat(r?n.match(r).slice(1):[]);b=h.response.apply(h,q)}else b=!0;else b=!1;if(b){f=
+this.responses[g].response;break}}if(4!=a.readyState){var g=f,z;z="Request:\n"+c.format(a)+"\n\n";z+="Response:\n"+c.format(g)+"\n\n";c.log(z);a.respond(f[0],f[1],f[2])}}}catch(y){c.logError("Fake server request processing",y)}},restore:function(){return this.xhr.restore&&this.xhr.restore.apply(this.xhr,arguments)}}}();"object"==typeof module&&"function"==typeof require&&(module.exports=c);(function(){function a(){}a.prototype=c.fakeServer;c.fakeServerWithClock=new a;c.fakeServerWithClock.addRequest=
+function(a){if(a.async&&("object"==typeof setTimeout.clock?this.clock=setTimeout.clock:(this.clock=c.useFakeTimers(),this.resetClock=!0),!this.longestTimeout)){var h=this.clock.setTimeout,k=this.clock.setInterval,m=this;this.clock.setTimeout=function(a,c){m.longestTimeout=Math.max(c,m.longestTimeout||0);return h.apply(this,arguments)};this.clock.setInterval=function(a,c){m.longestTimeout=Math.max(c,m.longestTimeout||0);return k.apply(this,arguments)}}return c.fakeServer.addRequest.call(this,a)};c.fakeServerWithClock.respond=
 function(){var a=c.fakeServer.respond.apply(this,arguments);this.clock&&(this.clock.tick(this.longestTimeout||0),this.longestTimeout=0,this.resetClock&&(this.clock.restore(),this.resetClock=!1));return a};c.fakeServerWithClock.restore=function(){this.clock&&this.clock.restore();return c.fakeServer.restore.apply(this,arguments)}})();"object"==typeof module&&"function"==typeof require&&(c=require("../sinon"),c.extend(c,require("./util/fake_timers")));(function(){var a=[].push;c.sandbox=c.extend(c.create(c.collection),
-{useFakeTimers:function(){this.clock=c.useFakeTimers.apply(c,arguments);return this.add(this.clock)},serverPrototype:c.fakeServer,useFakeServer:function(){var a=this.serverPrototype||c.fakeServer;if(!a||!a.create)return null;this.server=a.create();return this.add(this.server)},inject:function(a){c.collection.inject.call(this,a);this.clock&&(a.clock=this.clock);this.server&&(a.server=this.server,a.requests=this.server.requests);return a},create:function(f){if(!f)return c.create(c.sandbox);var g=c.create(c.sandbox);
-f.useFakeServer&&("object"==typeof f.useFakeServer&&(g.serverPrototype=f.useFakeServer),g.useFakeServer());f.useFakeTimers&&("object"==typeof f.useFakeTimers?g.useFakeTimers.apply(g,f.useFakeTimers):g.useFakeTimers());g.args=g.args||[];var k,m,e=g.inject({});if(f.properties)for(var l=0,h=f.properties.length;l<h;l++){k=f.properties[l];m=e[k]||"sandbox"==k&&g;var d=g;m&&(f.injectInto?f.injectInto[k]=m:a.call(d.args,m))}else(k=m)&&(f.injectInto?f.injectInto.sandbox=k:a.call(g.args,k));return g}});c.sandbox.useFakeXMLHttpRequest=
-c.sandbox.useFakeServer;"object"==typeof module&&"function"==typeof require&&(module.exports=c.sandbox)})();(function(a){function c(f){var g=typeof f;if("function"!=g)throw new TypeError("sinon.test needs to wrap a test function, got "+g);return function(){var c=a.getConfig(a.config);c.injectInto=c.injectIntoThis&&this||c.injectInto;var c=a.sandbox.create(c),g,h,d=Array.prototype.slice.call(arguments).concat(c.args);try{h=f.apply(this,d)}catch(b){g=b}if("undefined"!==typeof g)throw c.restore(),g;
-c.verifyAndRestore();return h}}var g="object"==typeof module&&"function"==typeof require;!a&&g&&(a=require("../sinon"));a&&(c.config={injectIntoThis:!0,injectInto:null,properties:"spy stub mock clock server requests".split(" "),useFakeTimers:!0,useFakeServer:!0},g?module.exports=c:a.test=c)})("object"==typeof c&&c||null);(function(a){function c(a,e,f){return function(){e&&e.apply(this,arguments);var c,d;try{d=a.apply(this,arguments)}catch(b){c=b}f&&f.apply(this,arguments);if(c)throw c;return d}}function g(g,
-e){if(!g||"object"!=typeof g)throw new TypeError("sinon.testCase needs an object with test functions");var k=RegExp("^"+(e||"test")),h={},d,b,p,n=g.setUp,v=g.tearDown;for(d in g)if(g.hasOwnProperty(d)&&(b=g[d],!/^(setUp|tearDown)$/.test(d)))if("function"==typeof b&&k.test(d)){p=b;if(n||v)p=c(b,n,v);h[d]=a.test(p)}else h[d]=g[d];return h}var k="object"==typeof module&&"function"==typeof require;!a&&k&&(a=require("../sinon"));a&&Object.prototype.hasOwnProperty&&(k?module.exports=g:a.testCase=g)})("object"==
-typeof c&&c||null);(function(a,c){function g(){for(var a,b=0,c=arguments.length;b<c;++b)(a=arguments[b])||h.fail("fake is not a spy"),"function"!=typeof a&&h.fail(a+" is not a function"),"function"!=typeof a.getCall&&h.fail(a+" is not stubbed")}function k(a,b){a=a||c;(a.fail||h.fail).call(a,b)}function m(a,b,c){2==arguments.length&&(c=b,b=a);h[a]=function(e){g(e);var f=l.call(arguments,1),m=!1;(m="function"==typeof b?!b(e):"function"==typeof e[b]?!e[b].apply(e,f):!e[b])?k(this,e.printf.apply(e,[c].concat(f))):
-h.pass(a)}}var e="object"==typeof module&&"function"==typeof require,l=Array.prototype.slice,h;!a&&e&&(a=require("../sinon"));a&&(h={failException:"AssertError",fail:function(a){a=Error(a);a.name=this.failException||h.failException;throw a;},pass:function(a){},callOrder:function(){g.apply(null,arguments);var c="",b="";if(a.calledInOrder(arguments))h.pass("callOrder");else{try{c=[].join.call(arguments,", "),b=a.orderByFirstCall(l.call(arguments)).join(", ")}catch(e){}k(this,"expected "+c+" to be called in order but were called as "+
-b)}},callCount:function(c,b){g(c);if(c.callCount!=b){var e="expected %n to be called "+a.timesInWords(b)+" but was called %c%C";k(this,c.printf(e))}else h.pass("callCount")},expose:function(a,b){if(!a)throw new TypeError("target is null or undefined");var c=b||{},e="undefined"==typeof c.prefix&&"assert"||c.prefix,c="undefined"==typeof c.includeFail||!!c.includeFail,f;for(f in this)if("export"!=f&&(c||!/^(fail)/.test(f))){var g=a,h;h=e;var k=f;h=!h||/^fail/.test(k)?k:h+k.slice(0,1).toUpperCase()+k.slice(1);
-g[h]=this[f]}return a}},m("called","expected %n to have been called at least once but was never called"),m("notCalled",function(a){return!a.called},"expected %n to not have been called but was called %c%C"),m("calledOnce","expected %n to be called once but was called %c%C"),m("calledTwice","expected %n to be called twice but was called %c%C"),m("calledThrice","expected %n to be called thrice but was called %c%C"),m("calledOn","expected %n to be called with %1 as this but was called with %t"),m("alwaysCalledOn",
+{useFakeTimers:function(){this.clock=c.useFakeTimers.apply(c,arguments);return this.add(this.clock)},serverPrototype:c.fakeServer,useFakeServer:function(){var a=this.serverPrototype||c.fakeServer;if(!a||!a.create)return null;this.server=a.create();return this.add(this.server)},inject:function(a){c.collection.inject.call(this,a);this.clock&&(a.clock=this.clock);this.server&&(a.server=this.server,a.requests=this.server.requests);return a},create:function(f){if(!f)return c.create(c.sandbox);var h=c.create(c.sandbox);
+f.useFakeServer&&("object"==typeof f.useFakeServer&&(h.serverPrototype=f.useFakeServer),h.useFakeServer());f.useFakeTimers&&("object"==typeof f.useFakeTimers?h.useFakeTimers.apply(h,f.useFakeTimers):h.useFakeTimers());h.args=h.args||[];var k,m,e=h.inject({});if(f.properties)for(var l=0,g=f.properties.length;l<g;l++){k=f.properties[l];m=e[k]||"sandbox"==k&&h;var d=h;m&&(f.injectInto?f.injectInto[k]=m:a.call(d.args,m))}else(k=m)&&(f.injectInto?f.injectInto.sandbox=k:a.call(h.args,k));return h}});c.sandbox.useFakeXMLHttpRequest=
+c.sandbox.useFakeServer;"object"==typeof module&&"function"==typeof require&&(module.exports=c.sandbox)})();(function(a){function c(f){var h=typeof f;if("function"!=h)throw new TypeError("sinon.test needs to wrap a test function, got "+h);return function(){var c=a.getConfig(a.config);c.injectInto=c.injectIntoThis&&this||c.injectInto;var c=a.sandbox.create(c),h,g,d=Array.prototype.slice.call(arguments).concat(c.args);try{g=f.apply(this,d)}catch(b){h=b}if("undefined"!==typeof h)throw c.restore(),h;
+c.verifyAndRestore();return g}}var h="object"==typeof module&&"function"==typeof require;!a&&h&&(a=require("../sinon"));a&&(c.config={injectIntoThis:!0,injectInto:null,properties:"spy stub mock clock server requests".split(" "),useFakeTimers:!0,useFakeServer:!0},h?module.exports=c:a.test=c)})("object"==typeof c&&c||null);(function(a){function c(a,e,f){return function(){e&&e.apply(this,arguments);var c,d;try{d=a.apply(this,arguments)}catch(b){c=b}f&&f.apply(this,arguments);if(c)throw c;return d}}function h(h,
+e){if(!h||"object"!=typeof h)throw new TypeError("sinon.testCase needs an object with test functions");var l=RegExp("^"+(e||"test")),g={},d,b,k,n=h.setUp,t=h.tearDown;for(d in h)if(h.hasOwnProperty(d)&&(b=h[d],!/^(setUp|tearDown)$/.test(d)))if("function"==typeof b&&l.test(d)){k=b;if(n||t)k=c(b,n,t);g[d]=a.test(k)}else g[d]=h[d];return g}var k="object"==typeof module&&"function"==typeof require;!a&&k&&(a=require("../sinon"));a&&Object.prototype.hasOwnProperty&&(k?module.exports=h:a.testCase=h)})("object"==
+typeof c&&c||null);(function(a,c){function h(){for(var a,b=0,c=arguments.length;b<c;++b)(a=arguments[b])||g.fail("fake is not a spy"),"function"!=typeof a&&g.fail(a+" is not a function"),"function"!=typeof a.getCall&&g.fail(a+" is not stubbed")}function k(a,b){a=a||c;(a.fail||g.fail).call(a,b)}function m(a,b,c){2==arguments.length&&(c=b,b=a);g[a]=function(e){h(e);var f=l.call(arguments,1),m=!1;(m="function"==typeof b?!b(e):"function"==typeof e[b]?!e[b].apply(e,f):!e[b])?k(this,e.printf.apply(e,[c].concat(f))):
+g.pass(a)}}var e="object"==typeof module&&"function"==typeof require,l=Array.prototype.slice,g;!a&&e&&(a=require("../sinon"));a&&(g={failException:"AssertError",fail:function(a){a=Error(a);a.name=this.failException||g.failException;throw a;},pass:function(a){},callOrder:function(){h.apply(null,arguments);var c="",b="";if(a.calledInOrder(arguments))g.pass("callOrder");else{try{c=[].join.call(arguments,", "),b=a.orderByFirstCall(l.call(arguments)).join(", ")}catch(e){}k(this,"expected "+c+" to be called in order but were called as "+
+b)}},callCount:function(c,b){h(c);if(c.callCount!=b){var e="expected %n to be called "+a.timesInWords(b)+" but was called %c%C";k(this,c.printf(e))}else g.pass("callCount")},expose:function(a,b){if(!a)throw new TypeError("target is null or undefined");var c=b||{},e="undefined"==typeof c.prefix&&"assert"||c.prefix,c="undefined"==typeof c.includeFail||!!c.includeFail,f;for(f in this)if("export"!=f&&(c||!/^(fail)/.test(f))){var h=a,g;g=e;var k=f;g=!g||/^fail/.test(k)?k:g+k.slice(0,1).toUpperCase()+k.slice(1);
+h[g]=this[f]}return a}},m("called","expected %n to have been called at least once but was never called"),m("notCalled",function(a){return!a.called},"expected %n to not have been called but was called %c%C"),m("calledOnce","expected %n to be called once but was called %c%C"),m("calledTwice","expected %n to be called twice but was called %c%C"),m("calledThrice","expected %n to be called thrice but was called %c%C"),m("calledOn","expected %n to be called with %1 as this but was called with %t"),m("alwaysCalledOn",
 "expected %n to always be called with %1 as this but was called with %t"),m("calledWithNew","expected %n to be called with new"),m("alwaysCalledWithNew","expected %n to always be called with new"),m("calledWith","expected %n to be called with arguments %*%C"),m("calledWithMatch","expected %n to be called with match %*%C"),m("alwaysCalledWith","expected %n to always be called with arguments %*%C"),m("alwaysCalledWithMatch","expected %n to always be called with match %*%C"),m("calledWithExactly","expected %n to be called with exact arguments %*%C"),
-m("alwaysCalledWithExactly","expected %n to always be called with exact arguments %*%C"),m("neverCalledWith","expected %n to never be called with arguments %*%C"),m("neverCalledWithMatch","expected %n to never be called with match %*%C"),m("threw","%n did not throw exception%C"),m("alwaysThrew","%n did not always throw exception%C"),e?module.exports=h:a.assert=h)})("object"==typeof c&&c||null,"undefined"!=typeof window?window:global);return c}.call("undefined"!=typeof window&&window||{});
-(function(){(function(k){return"function"===typeof require&&"object"===typeof exports&&"object"===typeof module?module.exports=k:"function"===typeof define&&define.amd?define(function(){return k}):chai.use(k)})(function(k,c){var a,f,g,n,m,e,l,h;e=c.flag;k.Assertion.addMethod("when",function(a,b){var c,f,g,h,k,l=this;null==b&&(b={});f=e(this,"whenActions")||[];h=e(this,"object");e(this,"whenObject",h);h=0;for(k=f.length;h<k;h++)c=f[h],"function"===typeof c.before&&c.before(this);k=a();if("object"===
-typeof k&&"function"===typeof k.then)return g=null!=b?b.notify:void 0,null==g&&(g=function(){}),h=function(){var a,b;try{a=0;for(b=f.length;a<b;a++)c=f[a],"function"===typeof c.after&&c.after(l);return g()}catch(d){throw g(d),d;}},h=k.then(h,h);h=0;for(k=f.length;h<k;h++)c=f[h],"function"===typeof c.after&&c.after(this);return this});h=function(a){var b,f,g,h,k;if(e(a,"no-change"))return f=e(a,"negate"),e(a,"negate",this.negate),g=e(a,"whenObject"),k=e(a,"changeStart"),b=g(),h=!c.eql(b,k),a.assert(h,
+m("alwaysCalledWithExactly","expected %n to always be called with exact arguments %*%C"),m("neverCalledWith","expected %n to never be called with arguments %*%C"),m("neverCalledWithMatch","expected %n to never be called with match %*%C"),m("threw","%n did not throw exception%C"),m("alwaysThrew","%n did not always throw exception%C"),e?module.exports=g:a.assert=g)})("object"==typeof c&&c||null,"undefined"!=typeof window?window:global);return c}.call("undefined"!=typeof window&&window||{});
+(function(){(function(k){return"function"===typeof require&&"object"===typeof exports&&"object"===typeof module?module.exports=k:"function"===typeof define&&define.amd?define(function(){return k}):chai.use(k)})(function(k,c){var a,f,h,n,m,e,l,g;e=c.flag;k.Assertion.addMethod("when",function(a,b){var c,f,h,g,k,l=this;null==b&&(b={});f=e(this,"whenActions")||[];g=e(this,"object");e(this,"whenObject",g);g=0;for(k=f.length;g<k;g++)c=f[g],"function"===typeof c.before&&c.before(this);k=a();if("object"===
+typeof k&&"function"===typeof k.then)return h=null!=b?b.notify:void 0,null==h&&(h=function(){}),g=function(){var a,b;try{a=0;for(b=f.length;a<b;a++)c=f[a],"function"===typeof c.after&&c.after(l);return h()}catch(d){throw h(d),d;}},g=k.then(g,g);g=0;for(k=f.length;g<k;g++)c=f[g],"function"===typeof c.after&&c.after(this);return this});g=function(a){var b,f,g,h,k;if(e(a,"no-change"))return f=e(a,"negate"),e(a,"negate",this.negate),g=e(a,"whenObject"),k=e(a,"changeStart"),b=g(),h=!c.eql(b,k),a.assert(h,
 "expected `"+l(g)+"` to change, but it stayed "+c.inspect(k),"expected `"+l(g)+"` not to change, but it changed from "+c.inspect(k)+" to "+c.inspect(b)),e(a,"negate",f)};a=function(a){var b,c,f;c=e(a,"negate");e(a,"negate",this.negate);f=e(a,"whenObject");b=e(a,"changeStart");b=f()-b;a.assert(this.expectedDelta===b,"expected `"+l(f)+"` to change by "+this.expectedDelta+", but it changed by "+b,"expected `"+l(f)+"` not to change by "+this.expectedDelta+", but it did");return e(a,"negate",c)};m=function(a){var b,
 f,g,h;b=e(a,"negate");e(a,"negate",this.negate);f=e(a,"whenObject");h=f();e(a,"changeToStart",h);g=!c.eql(h,this.expectedEndValue);b&&(g=!g);a.assert(g,"expected `"+l(f)+"` to change to "+c.inspect(this.expectedEndValue)+", but it was already "+c.inspect(h),"not supported");return e(a,"negate",b)};n=function(a){var b,f,g,h,k;g=e(a,"negate");e(a,"negate",this.negate);h=e(a,"whenObject");k=e(a,"changeToStart");f=h();g||(b=!c.eql(k,f),a.assert(b,"expected `"+l(h)+"` to change to "+c.inspect(this.expectedEndValue)+
-", but it did not change from "+c.inspect(k),"not supported"));b=c.eql(f,this.expectedEndValue);a.assert(b,"expected `"+l(h)+"` to change to "+c.inspect(this.expectedEndValue)+", but it changed to "+c.inspect(f),"expected `"+l(h)+"` not to change to "+c.inspect(this.expectedEndValue)+", but it did");return e(a,"negate",g)};g=function(a){var b,f,g,h;b=e(a,"negate");e(a,"negate",this.negate);f=e(a,"whenObject");h=f();g=c.eql(h,this.expectedStartValue);a.assert(g,"expected the change of `"+l(f)+"` to start from "+
+", but it did not change from "+c.inspect(k),"not supported"));b=c.eql(f,this.expectedEndValue);a.assert(b,"expected `"+l(h)+"` to change to "+c.inspect(this.expectedEndValue)+", but it changed to "+c.inspect(f),"expected `"+l(h)+"` not to change to "+c.inspect(this.expectedEndValue)+", but it did");return e(a,"negate",g)};h=function(a){var b,f,g,h;b=e(a,"negate");e(a,"negate",this.negate);f=e(a,"whenObject");h=f();g=c.eql(h,this.expectedStartValue);a.assert(g,"expected the change of `"+l(f)+"` to start from "+
 c.inspect(this.expectedStartValue)+", but it started from "+c.inspect(h),"expected the change of `"+l(f)+"` not to start from "+c.inspect(this.expectedStartValue)+", but it did");return e(a,"negate",b)};f=function(a){var b,f,g,h;f=e(a,"negate");e(a,"negate",this.negate);g=e(a,"whenObject");h=e(a,"changeStart");b=g();b=!c.eql(h,b);f&&(b=!b);a.assert(b,"expected `"+l(g)+"` to change from "+c.inspect(this.expectedStartValue)+", but it did not change","not supported");return e(a,"negate",f)};k.Assertion.addProperty("change",
-function(){var a;e(this,"no-change",!0);a=e(this,"whenActions")||[];a.push({negate:e(this,"negate"),before:function(a){var c;c=e(a,"whenObject")();return e(a,"changeStart",c)},after:h});return e(this,"whenActions",a)});k.Assertion.addProperty("increase",function(){var a;a=e(this,"whenActions")||[];a.push({negate:e(this,"negate"),before:function(a){var c;c=e(a,"whenObject")();return e(a,"increaseStart",c)},after:function(a){var c,d,f,g;f=e(a,"whenObject");c=f();g=e(a,"increaseStart");d=e(a,"negate");
+function(){var a;e(this,"no-change",!0);a=e(this,"whenActions")||[];a.push({negate:e(this,"negate"),before:function(a){var c;c=e(a,"whenObject")();return e(a,"changeStart",c)},after:g});return e(this,"whenActions",a)});k.Assertion.addProperty("increase",function(){var a;a=e(this,"whenActions")||[];a.push({negate:e(this,"negate"),before:function(a){var c;c=e(a,"whenObject")();return e(a,"increaseStart",c)},after:function(a){var c,d,f,g;f=e(a,"whenObject");c=f();g=e(a,"increaseStart");d=e(a,"negate");
 e(a,"negate",this.negate);d||a.assert(g!==c,"expected `"+l(f)+"` to increase, but it did not change","not supported");a.assert(g<c,"expected `"+l(f)+"` to increase, but it decreased by "+(g-c),"expected `"+l(f)+"` not to increase, but it increased by "+(c-g));return e(a,"negate",d)}});return e(this,"whenActions",a)});k.Assertion.addProperty("decrease",function(){var a;a=e(this,"whenActions")||[];a.push({negate:e(this,"negate"),before:function(a){var c;c=e(a,"whenObject")();return e(a,"decreaseStart",
 c)},after:function(a){var c,d,f,g;f=e(a,"whenObject");c=f();g=e(a,"decreaseStart");d=e(a,"negate");e(a,"negate",this.negate);d||a.assert(g!==c,"expected `"+l(f)+"` to decrease, but it did not change","not supported");a.assert(g>c,"expected `"+l(f)+"` to decrease, but it increased by "+(c-g),"expected `"+l(f)+"` not to decrease, but it decreased by "+(g-c));return e(a,"negate",d)}});return e(this,"whenActions",a)});k.Assertion.addChainableMethod("atLeast",function(a){var b;b=e(this,"whenActions")||
 [];b.push({negate:e(this,"negate"),before:function(a){var b;b=e(a,"whenObject")();return e(a,"atLeastStart",b)},after:function(b){var c,f,g,h;g=e(b,"whenObject");c=g();h=e(b,"atLeastStart");f=e(b,"negate");e(b,"negate",this.negate);c=Math.abs(c-h);b.assert(c>=a,"expected `"+l(g)+"` to change by at least "+a+", but changed by "+c,"not supported");return e(b,"negate",f)}});return e(this,"whenActions",b)},function(){return this});k.Assertion.addChainableMethod("atMost",function(a){var b;b=e(this,"whenActions")||
 [];b.push({negate:e(this,"negate"),before:function(a){var b;b=e(a,"whenObject")();return e(a,"atMostStart",b)},after:function(b){var c,f,g,h;g=e(b,"whenObject");c=g();h=e(b,"atMostStart");f=e(b,"negate");e(b,"negate",this.negate);c=Math.abs(c-h);b.assert(c<=a,"expected `"+l(g)+"` to change by at most "+a+", but changed by "+c,"not supported");return e(b,"negate",f)}});return e(this,"whenActions",b)},function(){return this});l=function(a){return a.toString().replace(/^\s*function \(\) {\s*/,"").replace(/\s+}$/,
 "").replace(/\s*return\s*/,"")};k.Assertion.addChainableMethod("by",function(c){var b;e(this,"no-change",!1);b=e(this,"whenActions")||[];b.push({negate:e(this,"negate"),expectedDelta:c,after:a});return e(this,"whenActions",b)},function(){return this});k.Assertion.addChainableMethod("to",function(a){var b;e(this,"no-change",!1);b=e(this,"whenActions")||[];b.push({negate:e(this,"negate"),expectedEndValue:a,before:m,after:n});return e(this,"whenActions",b)},function(){return this});return k.Assertion.addChainableMethod("from",
-function(a){var b;e(this,"no-change",!1);b=e(this,"whenActions")||[];b.push({negate:e(this,"negate"),expectedStartValue:a,before:g,after:f});return e(this,"whenActions",b)},function(){return this})})}).call(this);
-(function(){(function(k){return"function"===typeof require&&"object"===typeof exports&&"object"===typeof module?module.exports=k:"function"===typeof define&&define.amd?define(function(){return k}):chai.use(k)})(function(k,c){var a,f,g;f=c.inspect;a=c.flag;k.Assertion.addMethod("trigger",function(c,g){var e;null==g&&(g={});e=a(this,"whenActions")||[];e.push({negate:a(this,"negate"),before:function(e){this.callback=sinon.spy();return a(e,"object").on(c,this.callback)},after:function(e){var h,d;h=a(e,
-"negate");a(e,"negate",this.negate);e.assert(this.callback.called,"expected to trigger "+c,"expected not to trigger "+c);null!=g["with"]&&e.assert((d=this.callback).calledWith.apply(d,g["with"]),"expected trigger to be called with "+f(g["with"])+", but was called with "+f(this.callback.args[0])+".","expected trigger not to be called with "+f(g["with"])+", but was");return a(e,"negate",h)}});return a(this,"whenActions",e)});k.Assertion.addProperty("route",function(){return a(this,"routing",!0)});g=
-function(c,g,e){var k,h,d,b,p,t;null==e&&(e={});if(!("object"===typeof c&&c instanceof Backbone.Router))throw new TypeError("provided router is not a Backbone.Router");h=Backbone.history;Backbone.history=new Backbone.History;d=sinon.stub(c,g);c._bindRoutes();if(null!=e.considering)for(t=e.considering,b=0,p=t.length;b<p;b++)k=t[b],k._bindRoutes();Backbone.history.options={root:"/"};k=a(this,"object");Backbone.history.loadUrl(k);Backbone.history=h;c[g].restore();this.assert(d.calledOnce,"expected `"+
-k+"` to route to "+g,"expected `"+k+"` not to route to "+g);if(null!=e.arguments)return this.assert(d.calledWith.apply(d,e.arguments),"expected `"+g+"` to be called with "+f(e.arguments)+", but was called with "+f(d.args[0])+" instead","expected `"+g+"` not to be called with "+f(e.arguments)+", but was")};k.Assertion.overwriteProperty("to",function(c){return function(){return a(this,"routing")?g:c.apply(this,arguments)}});return k.Assertion.addMethod("call",function(c){var f,e;e=a(this,"object");
+function(a){var b;e(this,"no-change",!1);b=e(this,"whenActions")||[];b.push({negate:e(this,"negate"),expectedStartValue:a,before:h,after:f});return e(this,"whenActions",b)},function(){return this})})}).call(this);
+(function(){(function(k){return"function"===typeof require&&"object"===typeof exports&&"object"===typeof module?module.exports=k:"function"===typeof define&&define.amd?define(function(){return k}):chai.use(k)})(function(k,c){var a,f,h;f=c.inspect;a=c.flag;k.Assertion.addMethod("trigger",function(c,h){var e;null==h&&(h={});e=a(this,"whenActions")||[];e.push({negate:a(this,"negate"),before:function(e){this.callback=sinon.spy();return a(e,"object").on(c,this.callback)},after:function(e){var g,d;g=a(e,
+"negate");a(e,"negate",this.negate);e.assert(this.callback.called,"expected to trigger "+c,"expected not to trigger "+c);null!=h["with"]&&e.assert((d=this.callback).calledWith.apply(d,h["with"]),"expected trigger to be called with "+f(h["with"])+", but was called with "+f(this.callback.args[0])+".","expected trigger not to be called with "+f(h["with"])+", but was");return a(e,"negate",g)}});return a(this,"whenActions",e)});k.Assertion.addProperty("route",function(){return a(this,"routing",!0)});h=
+function(c,h,e){var k,g,d,b,p,u;null==e&&(e={});if(!("object"===typeof c&&c instanceof Backbone.Router))throw new TypeError("provided router is not a Backbone.Router");g=Backbone.history;Backbone.history=new Backbone.History;d=sinon.stub(c,h);c._bindRoutes();if(null!=e.considering)for(u=e.considering,b=0,p=u.length;b<p;b++)k=u[b],k._bindRoutes();Backbone.history.options={root:"/"};k=a(this,"object");Backbone.history.loadUrl(k);Backbone.history=g;c[h].restore();this.assert(d.calledOnce,"expected `"+
+k+"` to route to "+h,"expected `"+k+"` not to route to "+h);if(null!=e.arguments)return this.assert(d.calledWith.apply(d,e.arguments),"expected `"+h+"` to be called with "+f(e.arguments)+", but was called with "+f(d.args[0])+" instead","expected `"+h+"` not to be called with "+f(e.arguments)+", but was")};k.Assertion.overwriteProperty("to",function(c){return function(){return a(this,"routing")?h:c.apply(this,arguments)}});return k.Assertion.addMethod("call",function(c){var f,e;e=a(this,"object");
 f=a(this,"whenActions")||[];f.push({negate:a(this,"negate"),before:function(a){this.originalMethod=e[c];this.spy=sinon.spy();e[c]=this.spy;return"function"===typeof e.delegateEvents?e.delegateEvents():void 0},after:function(a){e[c]=this.originalMethod;"function"===typeof e.delegateEvents&&e.delegateEvents();return a.assert(0<this.spy.callCount,this.spy.printf("expected %n to have been called at least once"),this.spy.printf("expected %n to not have been called"))}});return a(this,"whenActions",f)})})}).call(this);
diff --git a/minified-assets-prod/private-scripts.js-raw b/minified-assets-prod/private-scripts.js-raw
index f2adbc9..a6a5f9e 100644
--- a/minified-assets-prod/private-scripts.js-raw
+++ b/minified-assets-prod/private-scripts.js-raw
@@ -929,12 +929,13 @@ var Private_Menu = EC_View.extend({
 		var self = this;
 		ec_confirm({
 			subject: loc('Enter email'),
-			body: "<input type=text id=unlock_account style=width:300px>",
+			body: "<input type=text id=private_menu_unlock_account style=width:300px>",
 			buttons: [
 				{
 					label: 'Unlock',
 					action: function() {
-						var email = $('#unlock_account').val();
+						var email = $('#private_menu_unlock_account').val();
+						var url = '/api/unlock_account/' + encodeURIComponent(email);
 						Client.request(
 							url,
 							{
